
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../tricys_utils/">
      
      
        <link rel="next" href="../tricys_postprocess/">
      
      
        
          <link rel="alternate" href="./" hreflang="en">
        
          <link rel="alternate" href="../../../api/tricys_analysis/" hreflang="zh">
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>tricys.analysis - TRitium Integrated CYcle Simulation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference-analysis-modules" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../" title="TRitium Integrated CYcle Simulation" class="md-header__button md-logo" aria-label="TRitium Integrated CYcle Simulation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TRitium Integrated CYcle Simulation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              tricys.analysis
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../api/tricys_analysis/" hreflang="zh" class="md-select__link">
              简体中文
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/asipp-neutronics/tricys" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    TRICYS
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/quickstart/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../tricys_simulation/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../explanation/architecture/" class="md-tabs__link">
          
  
  
  Explanation

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../questions/installation/" class="md-tabs__link">
          
  
  
  FAQ

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../license/" class="md-tabs__link">
        
  
  
    
  
  License

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../" title="TRitium Integrated CYcle Simulation" class="md-nav__button md-logo" aria-label="TRitium Integrated CYcle Simulation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    TRitium Integrated CYcle Simulation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/asipp-neutronics/tricys" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    TRICYS
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Model Overview
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Model Overview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/models/cycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    0D Tritium Fuel Cycle Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Basic Simulation (TRICYS BASIC)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Basic Simulation (TRICYS BASIC)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_basic/basic_configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_basic/parameter_sweep/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Parameter Sweep
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_basic/concurrent_operation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concurrent Operation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_basic/post_processing_module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Post-processing Module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_basic/co_simulation_module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Co-simulation Module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Automated Analysis (TRICYS ANALYSIS)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Automated Analysis (TRICYS ANALYSIS)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_analysis/baseline_condition_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Baseline Condition Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_analysis/single_parameter_sensitivity_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Single Parameter Sensitivity Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_analysis/multi_parameter_sensitivity_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-parameter Sensitivity Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_analysis/sobol_global_sensitivity_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SOBOL Global Sensitivity Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_analysis/latin_uncertainty_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Latin Uncertainty Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tricys_simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.simulation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tricys_core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tricys_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    tricys.analysis
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.analysis
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.metric" class="md-nav__link">
    <span class="md-ellipsis">
      
        metric
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.metric.calculate_doubling_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_doubling_time
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.metric.calculate_startup_inventory" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_startup_inventory
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.metric.extract_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        extract_metrics
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.metric.get_final_value" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_final_value
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.metric.time_of_turning_point" class="md-nav__link">
    <span class="md-ellipsis">
      
        time_of_turning_point
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.plot" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.plot.generate_analysis_plots" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_analysis_plots
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.plot.load_glossary" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_glossary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.plot.plot_sweep_time_series" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot_sweep_time_series
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.plot.set_plot_language" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_plot_language
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report" class="md-nav__link">
    <span class="md-ellipsis">
      
        report
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report.call_openai_analysis_api" class="md-nav__link">
    <span class="md-ellipsis">
      
        call_openai_analysis_api
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report.consolidate_reports" class="md-nav__link">
    <span class="md-ellipsis">
      
        consolidate_reports
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report.generate_analysis_cases_summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_analysis_cases_summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report.generate_prompt_templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_prompt_templates
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report.generate_sensitivity_academic_report" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_sensitivity_academic_report
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report.retry_ai_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        retry_ai_analysis
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.salib" class="md-nav__link">
    <span class="md-ellipsis">
      
        salib
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer" class="md-nav__link">
    <span class="md-ellipsis">
      
        TricysSALibAnalyzer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TricysSALibAnalyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.analyze_fast" class="md-nav__link">
    <span class="md-ellipsis">
      
        analyze_fast
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.analyze_lhs" class="md-nav__link">
    <span class="md-ellipsis">
      
        analyze_lhs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.analyze_morris" class="md-nav__link">
    <span class="md-ellipsis">
      
        analyze_morris
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.analyze_sobol" class="md-nav__link">
    <span class="md-ellipsis">
      
        analyze_sobol
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.define_problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        define_problem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.generate_samples" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_samples
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.generate_tricys_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_tricys_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.get_compatible_analysis_methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_compatible_analysis_methods
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.load_tricys_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_tricys_results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.plot_fast_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot_fast_results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.plot_lhs_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot_lhs_results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.plot_morris_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot_morris_results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.plot_sobol_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot_sobol_results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.run_salib_analysis_from_tricys_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_salib_analysis_from_tricys_results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.run_tricys_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_tricys_analysis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.run_tricys_simulations" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_tricys_simulations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.save_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        save_results
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.salib.call_llm_for_academic_report" class="md-nav__link">
    <span class="md-ellipsis">
      
        call_llm_for_academic_report
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.salib.call_llm_for_salib_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        call_llm_for_salib_analysis
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.salib.run_salib_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_salib_analysis
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tricys_postprocess/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.postprocess
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tricys_handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.handlers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Explanation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Explanation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/simulation_flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Simulation Flow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/co_simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Co-simulation Principle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/concurrency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Concurrency Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/sensitivity_algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Sensitivity Analysis Algorithms
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/data_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6.Data Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    FAQ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../questions/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Installation & Environment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../questions/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Configuration & Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../questions/advanced_features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Advanced Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../questions/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../questions/best_practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Best Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    License
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.metric" class="md-nav__link">
    <span class="md-ellipsis">
      
        metric
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.metric.calculate_doubling_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_doubling_time
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.metric.calculate_startup_inventory" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_startup_inventory
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.metric.extract_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        extract_metrics
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.metric.get_final_value" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_final_value
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.metric.time_of_turning_point" class="md-nav__link">
    <span class="md-ellipsis">
      
        time_of_turning_point
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.plot" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.plot.generate_analysis_plots" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_analysis_plots
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.plot.load_glossary" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_glossary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.plot.plot_sweep_time_series" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot_sweep_time_series
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.plot.set_plot_language" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_plot_language
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report" class="md-nav__link">
    <span class="md-ellipsis">
      
        report
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report.call_openai_analysis_api" class="md-nav__link">
    <span class="md-ellipsis">
      
        call_openai_analysis_api
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report.consolidate_reports" class="md-nav__link">
    <span class="md-ellipsis">
      
        consolidate_reports
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report.generate_analysis_cases_summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_analysis_cases_summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report.generate_prompt_templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_prompt_templates
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report.generate_sensitivity_academic_report" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_sensitivity_academic_report
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.report.retry_ai_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        retry_ai_analysis
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.salib" class="md-nav__link">
    <span class="md-ellipsis">
      
        salib
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer" class="md-nav__link">
    <span class="md-ellipsis">
      
        TricysSALibAnalyzer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TricysSALibAnalyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.analyze_fast" class="md-nav__link">
    <span class="md-ellipsis">
      
        analyze_fast
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.analyze_lhs" class="md-nav__link">
    <span class="md-ellipsis">
      
        analyze_lhs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.analyze_morris" class="md-nav__link">
    <span class="md-ellipsis">
      
        analyze_morris
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.analyze_sobol" class="md-nav__link">
    <span class="md-ellipsis">
      
        analyze_sobol
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.define_problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        define_problem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.generate_samples" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_samples
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.generate_tricys_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_tricys_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.get_compatible_analysis_methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_compatible_analysis_methods
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.load_tricys_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_tricys_results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.plot_fast_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot_fast_results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.plot_lhs_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot_lhs_results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.plot_morris_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot_morris_results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.plot_sobol_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot_sobol_results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.run_salib_analysis_from_tricys_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_salib_analysis_from_tricys_results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.run_tricys_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_tricys_analysis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.run_tricys_simulations" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_tricys_simulations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tricys.analysis.salib.TricysSALibAnalyzer.save_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        save_results
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.salib.call_llm_for_academic_report" class="md-nav__link">
    <span class="md-ellipsis">
      
        call_llm_for_academic_report
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.salib.call_llm_for_salib_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        call_llm_for_salib_analysis
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.analysis.salib.run_salib_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_salib_analysis
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  
  



  
  


<h1 id="api-reference-analysis-modules">API Reference - Analysis Modules<a class="headerlink" href="#api-reference-analysis-modules" title="Permanent link">&para;</a></h1>
<div class="admonition tip">
<p class="admonition-title">Analysis Modules</p>
<p>The Analysis modules provide tools for processing, visualizing, and reporting TRICYS simulation results.
Please select a specific module of interest from the tabs below.</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><input id="__tabbed_1_4" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Metric</label><label for="__tabbed_1_2">Plot</label><label for="__tabbed_1_3">Report</label><label for="__tabbed_1_4">SALib (Sensitivity)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">


<div class="doc doc-object doc-module">



<a id="tricys.analysis.metric"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.metric.calculate_doubling_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_doubling_time</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">time_series</span><span class="p">)</span></code>

<a href="#tricys.analysis.metric.calculate_doubling_time" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculates the time it takes for the inventory to double its initial value.</p>
<p>This function finds the first time point, after the inventory's minimum
(turning point), where the inventory level reaches or exceeds twice its
initial value.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>series</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The inventory time series data.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_series</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The corresponding time data.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The doubling time, or NaN if the inventory never doubles.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">引发：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If time_series is None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Only considers the portion of the series after the turning point (minimum).
Returns NaN if the inventory never reaches twice the initial value in the
post-turning-point region.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/metric.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_doubling_time</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">time_series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the time it takes for the inventory to double its initial value.</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    This function finds the first time point, after the inventory&#39;s minimum</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    (turning point), where the inventory level reaches or exceeds twice its</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    initial value.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        series: The inventory time series data.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        time_series: The corresponding time data.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        The doubling time, or NaN if the inventory never doubles.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        ValueError: If time_series is None.</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        Only considers the portion of the series after the turning point (minimum).</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        Returns NaN if the inventory never reaches twice the initial value in the</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        post-turning-point region.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">if</span> <span class="n">time_series</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;time_series must be provided for calculate_doubling_time&quot;</span><span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="n">initial_inventory</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="n">doubled_inventory</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">initial_inventory</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="c1"># Find the first index where the inventory is &gt;= doubled_inventory</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="c1"># We should only consider the part of the series after the turning point</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">min_index</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">after_turning_point_series</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">min_index</span><span class="p">:]</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="n">doubling_indices</span> <span class="o">=</span> <span class="n">after_turning_point_series</span><span class="p">[</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">after_turning_point_series</span> <span class="o">&gt;=</span> <span class="n">doubled_inventory</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="p">]</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">doubling_indices</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">doubling_index</span> <span class="o">=</span> <span class="n">doubling_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="k">return</span> <span class="n">time_series</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">doubling_index</span><span class="p">]</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="c1"># If it never doubles, return NaN</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.metric.calculate_startup_inventory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_startup_inventory</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">time_series</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.metric.calculate_startup_inventory" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculates the startup inventory.</p>
<p>The startup inventory is calculated as the difference between the initial
inventory and the minimum inventory (the turning point).</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>series</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The inventory time series data.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_series</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="pandas.Series">Series</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The corresponding time data (unused).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated startup inventory.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>The time_series parameter is provided for interface consistency but is not
used in the calculation. The startup inventory represents the amount of
inventory consumed before reaching the minimum point.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/metric.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_startup_inventory</span><span class="p">(</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">time_series</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the startup inventory.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    The startup inventory is calculated as the difference between the initial</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    inventory and the minimum inventory (the turning point).</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        series: The inventory time series data.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        time_series: The corresponding time data (unused).</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        The calculated startup inventory.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        The time_series parameter is provided for interface consistency but is not</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        used in the calculation. The startup inventory represents the amount of</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        inventory consumed before reaching the minimum point.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="n">initial_inventory</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">minimum_inventory</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="k">return</span> <span class="n">initial_inventory</span> <span class="o">-</span> <span class="n">minimum_inventory</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.metric.extract_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_metrics</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">metrics_definition</span><span class="p">,</span> <span class="n">analysis_case</span><span class="p">)</span></code>

<a href="#tricys.analysis.metric.extract_metrics" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Extracts summary metrics from detailed simulation results.</p>
<p>This function processes a DataFrame from a parameter sweep, calculates
various metrics for each run based on a definitions dictionary, and
pivots the results into a summary DataFrame where each row corresponds
to a unique parameter combination.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>results_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame from the combined sweep results.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metrics_definition</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary defining how to calculate each metric
(e.g., source column, method).</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>analysis_case</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The analysis case configuration, used to identify
dependent variables.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A pivoted DataFrame with parameters as the index and metric names as columns.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Parses column names in format "variable&amp;param1=value1&amp;param2=value2" to extract
parameter values. Skips metrics with "bisection_search" method. Returns empty
DataFrame if no valid metrics are found or if pivoting fails.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/metric.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_metrics</span><span class="p">(</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="n">results_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="n">metrics_definition</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="n">analysis_case</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts summary metrics from detailed simulation results.</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    This function processes a DataFrame from a parameter sweep, calculates</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    various metrics for each run based on a definitions dictionary, and</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    pivots the results into a summary DataFrame where each row corresponds</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    to a unique parameter combination.</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        results_df: DataFrame from the combined sweep results.</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        metrics_definition: Dictionary defining how to calculate each metric</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">            (e.g., source column, method).</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">        analysis_case: The analysis case configuration, used to identify</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">            dependent variables.</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        A pivoted DataFrame with parameters as the index and metric names as columns.</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        Parses column names in format &quot;variable&amp;param1=value1&amp;param2=value2&quot; to extract</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        parameter values. Skips metrics with &quot;bisection_search&quot; method. Returns empty</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">        DataFrame if no valid metrics are found or if pivoting fails.</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="n">analysis_results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="n">source_to_metric</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="n">dependent_vars</span> <span class="o">=</span> <span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependent_variables&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">dependent_vars</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">definition</span> <span class="o">=</span> <span class="n">metrics_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="c1"># If the metric is not in the definition or is calculated via optimization, skip it.</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">definition</span> <span class="ow">or</span> <span class="n">definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;bisection_search&quot;</span><span class="p">:</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="k">continue</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="n">source</span> <span class="o">=</span> <span class="n">definition</span><span class="p">[</span><span class="s2">&quot;source_column&quot;</span><span class="p">]</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source_to_metric</span><span class="p">:</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="n">source_to_metric</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">source_to_metric</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="p">{</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>                <span class="s2">&quot;metric_name&quot;</span><span class="p">:</span> <span class="n">metric_name</span><span class="p">,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">definition</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="p">}</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">results_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="k">if</span> <span class="n">col_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="k">continue</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="n">source_var</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">source_to_metric</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="k">if</span> <span class="n">col_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                <span class="n">source_var</span> <span class="o">=</span> <span class="n">var</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                <span class="k">break</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_var</span><span class="p">:</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="k">continue</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="n">param_str</span> <span class="o">=</span> <span class="n">col_name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">source_var</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">param_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">))</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                <span class="sa">f</span><span class="s2">&quot;Warning: Could not parse parameters from column &#39;</span><span class="si">{</span><span class="n">col_name</span><span class="si">}</span><span class="s2">&#39;. Skipping.&quot;</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="p">)</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="k">continue</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="k">for</span> <span class="n">metric_info</span> <span class="ow">in</span> <span class="n">source_to_metric</span><span class="p">[</span><span class="n">source_var</span><span class="p">]:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="n">method_name</span> <span class="o">=</span> <span class="n">metric_info</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="n">metric_name</span> <span class="o">=</span> <span class="n">metric_info</span><span class="p">[</span><span class="s2">&quot;metric_name&quot;</span><span class="p">]</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="k">if</span> <span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;final_value&quot;</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                <span class="n">calculation_func</span> <span class="o">=</span> <span class="n">get_final_value</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="k">elif</span> <span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;calculate_startup_inventory&quot;</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>                <span class="n">calculation_func</span> <span class="o">=</span> <span class="n">calculate_startup_inventory</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="k">elif</span> <span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;time_of_turning_point&quot;</span><span class="p">:</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                <span class="n">calculation_func</span> <span class="o">=</span> <span class="n">time_of_turning_point</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="k">elif</span> <span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;calculate_doubling_time&quot;</span><span class="p">:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                <span class="n">calculation_func</span> <span class="o">=</span> <span class="n">calculate_doubling_time</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                    <span class="sa">f</span><span class="s2">&quot;Warning: Calculation method &#39;</span><span class="si">{</span><span class="n">method_name</span><span class="si">}</span><span class="s2">&#39; not implemented. Skipping.&quot;</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                <span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                <span class="k">continue</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="n">metric_value</span> <span class="o">=</span> <span class="n">calculation_func</span><span class="p">(</span><span class="n">results_df</span><span class="p">[</span><span class="n">col_name</span><span class="p">],</span> <span class="n">results_df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="n">result_row</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="n">result_row</span><span class="p">[</span><span class="s2">&quot;metric_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_name</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="n">result_row</span><span class="p">[</span><span class="s2">&quot;metric_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_value</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="n">analysis_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result_row</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">analysis_results</span><span class="p">:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">analysis_results</span><span class="p">)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="c1"># Dynamically identify all parameter columns from the dataframe</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="n">param_cols</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;metric_name&quot;</span><span class="p">,</span> <span class="s2">&quot;metric_value&quot;</span><span class="p">]</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="p">]</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">param_cols</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="n">pivot_df</span> <span class="o">=</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="n">index</span><span class="o">=</span><span class="n">param_cols</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;metric_name&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;metric_value&quot;</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="k">return</span> <span class="n">pivot_df</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during pivoting: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.metric.get_final_value" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_final_value</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">time_series</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.metric.get_final_value" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Gets the final value of a time series.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>series</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time series data.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_series</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="pandas.Series">Series</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The corresponding time data (unused).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The last value in the series.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>The time_series parameter is kept for interface consistency but is not used
in the calculation. Only the series data is required.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/metric.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_final_value</span><span class="p">(</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">time_series</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the final value of a time series.</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">        series: The time series data.</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">        time_series: The corresponding time data (unused).</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">        The last value in the series.</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">        The time_series parameter is kept for interface consistency but is not used</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">        in the calculation. Only the series data is required.</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="k">return</span> <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.metric.time_of_turning_point" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">time_of_turning_point</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">time_series</span><span class="p">)</span></code>

<a href="#tricys.analysis.metric.time_of_turning_point" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Finds the time of the turning point (minimum value) in a series.</p>
<p>This function identifies the time corresponding to the minimum value in the
series, which often represents the self-sufficiency time in tritium inventory
simulations. To handle noisy data, it first smooths the series to find the
general trend's minimum. If the smoothed minimum is not at the boundaries,
it returns the time of the absolute minimum from the original data.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>series</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time series data to analyze.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_series</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The corresponding time data.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time of the turning point, or NaN if the trend is monotonic.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">引发：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If time_series is None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Uses a rolling window (0.1% of data length) for smoothing to identify the
general trend. If the smoothed minimum is within the last 30% of the series,
the trend is considered monotonic and NaN is returned. Otherwise, returns
the time of the absolute minimum in the original data.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/metric.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="k">def</span><span class="w"> </span><span class="nf">time_of_turning_point</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">time_series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the time of the turning point (minimum value) in a series.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    This function identifies the time corresponding to the minimum value in the</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    series, which often represents the self-sufficiency time in tritium inventory</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    simulations. To handle noisy data, it first smooths the series to find the</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    general trend&#39;s minimum. If the smoothed minimum is not at the boundaries,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    it returns the time of the absolute minimum from the original data.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        series: The time series data to analyze.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        time_series: The corresponding time data.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        The time of the turning point, or NaN if the trend is monotonic.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        ValueError: If time_series is None.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        Uses a rolling window (0.1% of data length) for smoothing to identify the</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        general trend. If the smoothed minimum is within the last 30% of the series,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        the trend is considered monotonic and NaN is returned. Otherwise, returns</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        the time of the absolute minimum in the original data.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="sa">f</span><span class="s2">&quot;Calculating time_of_turning_point for series with length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">time_series</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="p">)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="k">if</span> <span class="n">time_series</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;time_series must be provided for time_of_turning_point&quot;</span><span class="p">)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="c1"># Define a window size for the rolling average, e.g., 5% of the data length</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="c1"># with a minimum size of 1. This helps in smoothing out local fluctuations.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="n">window_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">))</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">smoothed_series</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">window</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="c1"># Find the index label of the minimum value in the smoothed series.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="n">smooth_min_index</span> <span class="o">=</span> <span class="n">smoothed_series</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="n">min_index</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="c1"># Check if the minimum of the smoothed data is within the first or last 5%</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="c1"># of the series. If so, the trend is considered monotonic.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="n">smooth_min_pos</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">smooth_min_index</span><span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">five_percent_threshold</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">if</span> <span class="n">smooth_min_pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span> <span class="o">-</span> <span class="n">five_percent_threshold</span><span class="p">:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="c1"># A clear turning point is identified in the overall trend.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="c1"># Now, find the precise turning point in the original, noisy data.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">min_index</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="k">return</span> <span class="n">time_series</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
<div class="tabbed-block">


<div class="doc doc-object doc-module">



<a id="tricys.analysis.plot"></a>
    <div class="doc doc-contents first">

        <p>Utility functions for plotting simulation results.</p>
<p>This module provides functions to generate plots from the simulation output
CSV files, such as visualizing startup tritium inventory or time-series data.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.plot.generate_analysis_plots" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_analysis_plots</span><span class="p">(</span><span class="n">summary_df</span><span class="p">,</span> <span class="n">analysis_case</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">,</span> <span class="n">unit_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">glossary_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.plot.generate_analysis_plots" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generates and saves plots based on the sensitivity analysis summary.</p>
<p>This function first generates dedicated plots for all 'Required_***' metrics,
then handles plotting for all other standard metrics.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>summary_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing the summarized analysis results.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>analysis_case</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration for the analysis cases.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the plot images.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unit_map</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary for unit conversion and labeling. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>glossary_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional path to the glossary CSV file for professional labels.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of paths to the saved plot images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Handles Required_*** metrics separately with multi-subplot layouts. Standard
metrics can be combined or plotted individually based on case configuration.
Returns empty list if summary_df is empty. Loads glossary if path provided.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/plot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_analysis_plots</span><span class="p">(</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="n">summary_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>    <span class="n">analysis_case</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="n">unit_map</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>    <span class="n">glossary_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates and saves plots based on the sensitivity analysis summary.</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">    This function first generates dedicated plots for all &#39;Required_***&#39; metrics,</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">    then handles plotting for all other standard metrics.</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">        summary_df: DataFrame containing the summarized analysis results.</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">        analysis_case: Configuration for the analysis cases.</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">        save_dir: Directory to save the plot images.</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">        unit_map: Optional dictionary for unit conversion and labeling. Defaults to None.</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">        glossary_path: Optional path to the glossary CSV file for professional labels.</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">        A list of paths to the saved plot images.</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">        Handles Required_*** metrics separately with multi-subplot layouts. Standard</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">        metrics can be combined or plotted individually based on case configuration.</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">        Returns empty list if summary_df is empty. Loads glossary if path provided.</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>    <span class="k">if</span> <span class="n">glossary_path</span><span class="p">:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="n">load_glossary</span><span class="p">(</span><span class="n">glossary_path</span><span class="p">)</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="k">if</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="n">analysis_cases</span> <span class="o">=</span> <span class="p">[</span><span class="n">analysis_case</span><span class="p">]</span>  <span class="c1"># Keep as a list for consistency</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="n">line_colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="n">plot_paths</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="c1"># If unit_map is not provided, initialize as empty dict</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="k">if</span> <span class="n">unit_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="n">unit_map</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="c1"># --- 1. Handle ALL &#39;Required_***&#39; plots first and separately ---</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="n">all_required_vars_from_config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="n">var</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">analysis_cases</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependent_variables&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Required_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="p">}</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="k">for</span> <span class="n">req_var</span> <span class="ow">in</span> <span class="n">all_required_vars_from_config</span><span class="p">:</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="c1"># Find all actual columns in the dataframe for this base name</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="n">matching_cols</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="p">[</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                <span class="n">c</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">req_var</span> <span class="ow">or</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">req_var</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span><span class="p">)</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>            <span class="p">]</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">matching_cols</span><span class="p">:</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>            <span class="k">continue</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>        <span class="n">case_for_plot</span> <span class="o">=</span> <span class="n">analysis_cases</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matching_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>            <span class="c1"># Multi-value case -&gt; generate a multi-subplot figure</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>            <span class="n">multi_plot_paths</span> <span class="o">=</span> <span class="n">_generate_multi_required_plot</span><span class="p">(</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                <span class="n">summary_df</span><span class="p">,</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                <span class="n">case_for_plot</span><span class="p">,</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                <span class="n">matching_cols</span><span class="p">,</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                <span class="n">req_var</span><span class="p">,</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>                <span class="n">save_dir</span><span class="p">,</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>                <span class="n">unit_map</span><span class="o">=</span><span class="n">unit_map</span><span class="p">,</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>            <span class="p">)</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="n">plot_paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">multi_plot_paths</span><span class="p">)</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">matching_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="c1"># Single-value case -&gt; generate a single, individual plot</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="n">plot_config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                <span class="s2">&quot;case_name&quot;</span><span class="p">:</span> <span class="n">case_for_plot</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>                <span class="s2">&quot;x_var&quot;</span><span class="p">:</span> <span class="n">case_for_plot</span><span class="p">[</span><span class="s2">&quot;independent_variable&quot;</span><span class="p">],</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>                <span class="s2">&quot;y_var&quot;</span><span class="p">:</span> <span class="n">matching_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                <span class="s2">&quot;plot_type&quot;</span><span class="p">:</span> <span class="s2">&quot;line&quot;</span><span class="p">,</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>                <span class="s2">&quot;hue_vars&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>                    <span class="nb">list</span><span class="p">(</span><span class="n">case_for_plot</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default_simulation_values&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>                <span class="p">),</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>            <span class="p">}</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>            <span class="n">single_plot_path</span> <span class="o">=</span> <span class="n">_generate_individual_plots</span><span class="p">(</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>                <span class="n">summary_df</span><span class="p">,</span> <span class="p">[</span><span class="n">plot_config</span><span class="p">],</span> <span class="n">save_dir</span><span class="p">,</span> <span class="n">line_colors</span><span class="p">,</span> <span class="n">unit_map</span><span class="o">=</span><span class="n">unit_map</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>            <span class="p">)</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>            <span class="n">plot_paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">single_plot_path</span><span class="p">)</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>    <span class="c1"># --- 2. Handle all other (non-Required) plots ---</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>    <span class="c1"># Collect plot configurations for remaining standard variables</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>    <span class="n">valid_plots_for_combine</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>    <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">analysis_cases</span><span class="p">:</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>        <span class="n">case_name</span> <span class="o">=</span> <span class="n">case</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>        <span class="n">x_var</span> <span class="o">=</span> <span class="n">case</span><span class="p">[</span><span class="s2">&quot;independent_variable&quot;</span><span class="p">]</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="c1"># Filter out the Required_*** vars that we just plotted</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="n">y_vars</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>            <span class="n">v</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependent_variables&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Required_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="p">]</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="k">if</span> <span class="n">x_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>                <span class="sa">f</span><span class="s2">&quot;Warning: Independent variable &#39;</span><span class="si">{</span><span class="n">x_var</span><span class="si">}</span><span class="s2">&#39; not found in summary data for case &#39;</span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">&#39;. Skipping.&quot;</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>            <span class="p">)</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>            <span class="k">continue</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="n">case_sim_params</span> <span class="o">=</span> <span class="n">case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default_simulation_values&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>        <span class="n">hue_vars</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">case_sim_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>        <span class="k">for</span> <span class="n">y_var</span> <span class="ow">in</span> <span class="n">y_vars</span><span class="p">:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>            <span class="k">if</span> <span class="n">y_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>                    <span class="sa">f</span><span class="s2">&quot;Warning: Dependent variable &#39;</span><span class="si">{</span><span class="n">y_var</span><span class="si">}</span><span class="s2">&#39; not found in summary data for case &#39;</span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">&#39;. Skipping.&quot;</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>                <span class="p">)</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>                <span class="k">continue</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>            <span class="c1"># We assume standard metrics have a 1-to-1 name match in the dataframe</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>            <span class="n">valid_plots_for_combine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>                <span class="p">{</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>                    <span class="s2">&quot;case_name&quot;</span><span class="p">:</span> <span class="n">case_name</span><span class="p">,</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>                    <span class="s2">&quot;x_var&quot;</span><span class="p">:</span> <span class="n">x_var</span><span class="p">,</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>                    <span class="s2">&quot;y_var&quot;</span><span class="p">:</span> <span class="n">y_var</span><span class="p">,</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>                    <span class="s2">&quot;plot_type&quot;</span><span class="p">:</span> <span class="s2">&quot;line&quot;</span><span class="p">,</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>                    <span class="s2">&quot;hue_vars&quot;</span><span class="p">:</span> <span class="n">hue_vars</span><span class="p">,</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>                <span class="p">}</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>            <span class="p">)</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>    <span class="k">if</span> <span class="n">valid_plots_for_combine</span><span class="p">:</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>        <span class="n">combine_plots</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;combine_plots&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">analysis_cases</span><span class="p">)</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>        <span class="n">generated_paths</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="k">if</span> <span class="n">combine_plots</span><span class="p">:</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>            <span class="n">generated_paths</span> <span class="o">=</span> <span class="n">_generate_combined_plots</span><span class="p">(</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>                <span class="n">summary_df</span><span class="p">,</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>                <span class="n">valid_plots_for_combine</span><span class="p">,</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>                <span class="n">save_dir</span><span class="p">,</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>                <span class="n">line_colors</span><span class="p">,</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>                <span class="n">unit_map</span><span class="o">=</span><span class="n">unit_map</span><span class="p">,</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>            <span class="p">)</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>            <span class="c1"># If not combining, plot them individually anyway</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>            <span class="n">generated_paths</span> <span class="o">=</span> <span class="n">_generate_individual_plots</span><span class="p">(</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>                <span class="n">summary_df</span><span class="p">,</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>                <span class="n">valid_plots_for_combine</span><span class="p">,</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>                <span class="n">save_dir</span><span class="p">,</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>                <span class="n">line_colors</span><span class="p">,</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>                <span class="n">unit_map</span><span class="o">=</span><span class="n">unit_map</span><span class="p">,</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>            <span class="p">)</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="n">plot_paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">generated_paths</span><span class="p">)</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>    <span class="k">return</span> <span class="n">plot_paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.plot.load_glossary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_glossary</span><span class="p">(</span><span class="n">glossary_path</span><span class="p">)</span></code>

<a href="#tricys.analysis.plot.load_glossary" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Loads glossary data from a CSV file.</p>
<p>The CSV file should contain columns for the model parameter, the English
term, and the Chinese translation. This data is used to format plot labels.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>glossary_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the glossary CSV file.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Expected CSV columns: "模型参数 (Model Parameter)", "英文术语 (English Term)",
and "中文翻译 (Chinese Translation)". Prints warning if file not found or
columns missing. Clears existing glossary maps on error.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/plot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_glossary</span><span class="p">(</span><span class="n">glossary_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads glossary data from a CSV file.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    The CSV file should contain columns for the model parameter, the English</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    term, and the Chinese translation. This data is used to format plot labels.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        glossary_path: The path to the glossary CSV file.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        Expected CSV columns: &quot;模型参数 (Model Parameter)&quot;, &quot;英文术语 (English Term)&quot;,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        and &quot;中文翻译 (Chinese Translation)&quot;. Prints warning if file not found or</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        columns missing. Clears existing glossary maps on error.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">global</span> <span class="n">_english_glossary_map</span><span class="p">,</span> <span class="n">_chinese_glossary_map</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">glossary_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">glossary_path</span><span class="p">):</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="sa">f</span><span class="s2">&quot;Warning: Glossary file not found at </span><span class="si">{</span><span class="n">glossary_path</span><span class="si">}</span><span class="s2">. No labels will be loaded.&quot;</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="p">)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">_english_glossary_map</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">_chinese_glossary_map</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">return</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">glossary_path</span><span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="s2">&quot;模型参数 (Model Parameter)&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="ow">and</span> <span class="s2">&quot;英文术语 (English Term)&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="ow">and</span> <span class="s2">&quot;中文翻译 (Chinese Translation)&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="p">):</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;模型参数 (Model Parameter)&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="n">_english_glossary_map</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;英文术语 (English Term)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;模型参数 (Model Parameter)&quot;</span><span class="p">],</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="n">_chinese_glossary_map</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;中文翻译 (Chinese Translation)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>                <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;模型参数 (Model Parameter)&quot;</span><span class="p">],</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded glossary from </span><span class="si">{</span><span class="n">glossary_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Glossary CSV does not contain expected columns.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="n">_english_glossary_map</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="n">_chinese_glossary_map</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Failed to load or parse glossary file. Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">_english_glossary_map</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">_chinese_glossary_map</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.plot.plot_sweep_time_series" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_sweep_time_series</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">,</span> <span class="n">y_var_name</span><span class="p">,</span> <span class="n">independent_var_name</span><span class="p">,</span> <span class="n">independent_var_alias</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">glossary_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.plot.plot_sweep_time_series" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generates a single figure with two subplots: an overall time-series view and a zoomed-in view.</p>
<p>The time axis is in days. The overall view hides data points for a curve if
they exceed twice its initial value.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>csv_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the scan result CSV file.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the image.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y_var_name</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name(s) of the Y-axis variable(s).</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>independent_var_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Full name of the scan parameter.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>independent_var_alias</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alias for the scan parameter for cleaner plot titles.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_params</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of default parameters. If provided, only curves
matching these parameters will be plotted.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>glossary_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the glossary file for professional labels.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of paths to the saved plot images, or an empty list on failure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Converts time from hours to days. Generates bilingual plots (English and Chinese).
Overall view masks data exceeding 2x initial value. Zoomed view shows region from
t=0 to 2 days past minimum, with red rectangle indicator on overall view. Data is
converted from grams to kilograms for display.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/plot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_sweep_time_series</span><span class="p">(</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>    <span class="n">csv_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>    <span class="n">y_var_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>    <span class="n">independent_var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>    <span class="n">independent_var_alias</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>    <span class="n">default_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>    <span class="n">glossary_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a single figure with two subplots: an overall time-series view and a zoomed-in view.</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a><span class="sd">    The time axis is in days. The overall view hides data points for a curve if</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">    they exceed twice its initial value.</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a><span class="sd">        csv_path: Path to the scan result CSV file.</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a><span class="sd">        save_dir: Directory to save the image.</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a><span class="sd">        y_var_name: Name(s) of the Y-axis variable(s).</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a><span class="sd">        independent_var_name: Full name of the scan parameter.</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="sd">        independent_var_alias: Alias for the scan parameter for cleaner plot titles.</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a><span class="sd">        default_params: A dictionary of default parameters. If provided, only curves</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a><span class="sd">            matching these parameters will be plotted.</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="sd">        glossary_path: Path to the glossary file for professional labels.</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">        A list of paths to the saved plot images, or an empty list on failure.</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">        Converts time from hours to days. Generates bilingual plots (English and Chinese).</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="sd">        Overall view masks data exceeding 2x initial value. Zoomed view shows region from</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="sd">        t=0 to 2 days past minimum, with red rectangle indicator on overall view. Data is</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="sd">        converted from grams to kilograms for display.</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>    <span class="k">if</span> <span class="n">glossary_path</span><span class="p">:</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>        <span class="n">load_glossary</span><span class="p">(</span><span class="n">glossary_path</span><span class="p">)</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Could not find results file at </span><span class="si">{</span><span class="n">csv_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>        <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: &#39;time&#39; column not found in </span><span class="si">{</span><span class="n">csv_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>        <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>    <span class="c1"># Convert time from hours to days</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>    <span class="n">time_days</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">24</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>    <span class="c1"># Use alias if provided, otherwise format the original name</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>    <span class="n">raw_plot_alias</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>        <span class="n">independent_var_alias</span> <span class="k">if</span> <span class="n">independent_var_alias</span> <span class="k">else</span> <span class="n">independent_var_name</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>    <span class="p">)</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y_var_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>        <span class="n">y_var_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_var_name</span><span class="p">]</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>        <span class="n">y_var_names</span> <span class="o">=</span> <span class="n">y_var_name</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>    <span class="n">y_var_columns</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>    <span class="k">for</span> <span class="n">y_var</span> <span class="ow">in</span> <span class="n">y_var_names</span><span class="p">:</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>        <span class="n">y_var_columns</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>            <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;time&quot;</span> <span class="ow">and</span> <span class="n">y_var</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>        <span class="p">)</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>    <span class="n">y_var_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">y_var_columns</span><span class="p">))</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>    <span class="c1"># If default_params are provided, filter columns to only plot baseline curves</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>    <span class="k">if</span> <span class="n">default_params</span><span class="p">:</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>        <span class="n">filtered_columns</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">y_var_columns</span><span class="p">:</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                <span class="n">param_str</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>                <span class="n">col_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>                <span class="c1"># Check if all default_params match the parameters in the column name</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>                <span class="n">is_match</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>                    <span class="n">col_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">default_params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>                <span class="p">)</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>                <span class="k">if</span> <span class="n">is_match</span><span class="p">:</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>                    <span class="n">filtered_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>                <span class="c1"># This column does not have parameters in its name, so it can&#39;t be a match</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>        <span class="n">y_var_columns</span> <span class="o">=</span> <span class="n">filtered_columns</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">y_var_columns</span><span class="p">:</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>            <span class="sa">f</span><span class="s2">&quot;Warning: No columns found containing any of </span><span class="si">{</span><span class="n">y_var_names</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">csv_path</span><span class="si">}</span><span class="s2"> that match the criteria.&quot;</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>        <span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>        <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>    <span class="c1"># Convert y-axis data from grams to kilograms</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">y_var_columns</span><span class="p">:</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>        <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1000.0</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>    <span class="c1"># Generate clean labels (values only) for the legend</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>    <span class="n">plot_labels</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">y_var_columns</span><span class="p">:</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>        <span class="n">label</span> <span class="o">=</span> <span class="n">col</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>            <span class="n">param_parts</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">param_parts</span><span class="p">:</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>                <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">independent_var_name</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>                    <span class="n">label</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Extract just the value</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>                    <span class="k">break</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>            <span class="k">pass</span>  <span class="c1"># No parameters in name, use full column name</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>        <span class="n">plot_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>    <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>        <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y_var_columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns to plot containing </span><span class="si">{</span><span class="n">y_var_names</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">y_var_columns</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>    <span class="p">)</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>    <span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>    <span class="n">plot_paths</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>    <span class="n">original_lang_is_chinese</span> <span class="o">=</span> <span class="n">_use_chinese_labels</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>    <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="s2">&quot;cn&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>        <span class="n">set_plot_language</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>        <span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;plasma&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_var_columns</span><span class="p">))</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>        <span class="c1"># Create a figure with two subplots (overall and zoom)</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height_ratios&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]}</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>        <span class="p">)</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>        <span class="n">y_var_names_formatted</span> <span class="o">=</span> <span class="p">[</span><span class="n">_format_label</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">y_var_names</span><span class="p">]</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>        <span class="n">min_y_global</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>        <span class="n">min_x_global</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>        <span class="c1"># Define the y-axis label with units</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">y_var_names_formatted</span><span class="p">)</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">_get_text</span><span class="p">(</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>        <span class="c1"># --- Subplot 1: Overall View ---</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y_var_columns</span><span class="p">):</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>            <span class="n">y_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>            <span class="c1"># For the global view, mask data that is more than 2x the initial value</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">y_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>                <span class="n">initial_value</span> <span class="o">=</span> <span class="n">y_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>                <span class="n">threshold</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">initial_value</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>                <span class="n">y_masked</span> <span class="o">=</span> <span class="n">y_data</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_data</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">)</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>                <span class="n">y_masked</span> <span class="o">=</span> <span class="n">y_data</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>                <span class="n">time_days</span><span class="p">,</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>                <span class="n">y_masked</span><span class="p">,</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>                <span class="n">label</span><span class="o">=</span><span class="n">plot_labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>                <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>            <span class="p">)</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>            <span class="c1"># Calculations for zoom window should use the original, unmasked data</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">y_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>                <span class="n">min_idx</span> <span class="o">=</span> <span class="n">y_data</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>                <span class="n">current_min_y</span> <span class="o">=</span> <span class="n">y_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">min_idx</span><span class="p">]</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>                <span class="k">if</span> <span class="n">current_min_y</span> <span class="o">&lt;</span> <span class="n">min_y_global</span><span class="p">:</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>                    <span class="n">min_y_global</span> <span class="o">=</span> <span class="n">current_min_y</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>                    <span class="n">min_x_global</span> <span class="o">=</span> <span class="n">time_days</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">min_idx</span><span class="p">]</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">_get_text</span><span class="p">(</span><span class="s2">&quot;overall_view&quot;</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">_format_label</span><span class="p">(</span><span class="n">independent_var_name</span><span class="p">))</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>        <span class="c1"># --- Subplot 2: Zoomed-in View (uses original data) ---</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>        <span class="k">if</span> <span class="n">min_y_global</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">min_y_global</span><span class="p">):</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y_var_columns</span><span class="p">):</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>                <span class="c1"># Plot original, unmasked data in the zoom plot</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>                <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>                    <span class="n">time_days</span><span class="p">,</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>                    <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">],</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>                    <span class="n">label</span><span class="o">=</span><span class="n">plot_labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>                    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>                    <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>                <span class="p">)</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>            <span class="c1"># Define the zoom window from t=0 to a bit after the minimum</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>            <span class="n">x1</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>            <span class="n">x2</span> <span class="o">=</span> <span class="n">min_x_global</span> <span class="o">+</span> <span class="mi">2</span>  <span class="c1"># Show 2 days past the minimum</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>            <span class="c1"># Filter the DataFrame to the new x-range to find the y-range</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>            <span class="n">zoom_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_days</span> <span class="o">&gt;=</span> <span class="n">x1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">time_days</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">)</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>            <span class="n">df_zoom_range</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">zoom_mask</span><span class="p">]</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>            <span class="c1"># Find y-min and y-max within this specific range</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>            <span class="n">y_min_in_range</span> <span class="o">=</span> <span class="n">df_zoom_range</span><span class="p">[</span><span class="n">y_var_columns</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>            <span class="n">y_max_in_range</span> <span class="o">=</span> <span class="n">df_zoom_range</span><span class="p">[</span><span class="n">y_var_columns</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>            <span class="c1"># Add padding to the y-axis</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>            <span class="n">y_padding</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_max_in_range</span> <span class="o">-</span> <span class="n">y_min_in_range</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.05</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>            <span class="n">y1</span> <span class="o">=</span> <span class="n">y_min_in_range</span> <span class="o">-</span> <span class="n">y_padding</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>            <span class="n">y2</span> <span class="o">=</span> <span class="n">y_max_in_range</span> <span class="o">+</span> <span class="n">y_padding</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">_get_text</span><span class="p">(</span><span class="s2">&quot;time_days&quot;</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">_get_text</span><span class="p">(</span><span class="s2">&quot;detailed_view&quot;</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>            <span class="c1"># Add a rectangle to the main plot to indicate the new zoom area</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>            <span class="n">rect</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>                <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>                <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">),</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>                <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">),</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>                <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>                <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>            <span class="p">)</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>            <span class="c1"># If no zoom, hide the second subplot</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">_get_text</span><span class="p">(</span><span class="s2">&quot;time_days&quot;</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>  <span class="c1"># Adjust for suptitle</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>        <span class="c1"># --- Save Figure ---</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>        <span class="n">safe_y_vars</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>            <span class="p">[</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>                <span class="n">var</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">y_var_names</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>            <span class="p">]</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>        <span class="p">)</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>        <span class="n">safe_param</span> <span class="o">=</span> <span class="n">raw_plot_alias</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>        <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;_zh&quot;</span> <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;cn&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>        <span class="n">svg_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>            <span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sweep_</span><span class="si">{</span><span class="n">safe_y_vars</span><span class="si">}</span><span class="s2">_vs_</span><span class="si">{</span><span class="n">safe_param</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">.svg&quot;</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>        <span class="p">)</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>            <span class="c1"># Force text to be rendered as paths in SVG.</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;svg.fonttype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;path&quot;</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">svg_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully generated combined sweep plot: </span><span class="si">{</span><span class="n">svg_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>            <span class="n">plot_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">svg_path</span><span class="p">)</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving plot: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>    <span class="n">set_plot_language</span><span class="p">(</span><span class="s2">&quot;cn&quot;</span> <span class="k">if</span> <span class="n">original_lang_is_chinese</span> <span class="k">else</span> <span class="s2">&quot;en&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>    <span class="k">return</span> <span class="n">plot_paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.plot.set_plot_language" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_plot_language</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">)</span></code>

<a href="#tricys.analysis.plot.set_plot_language" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Sets the preferred language for plot labels and text.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lang</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The language to set. 'en' for English (default), 'cn' for Chinese.</p>
              </div>
            </td>
            <td>
                  <code>&#39;en&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>For Chinese language, sets font to SimHei and adjusts unicode_minus handling.
For English, restores matplotlib default settings. Changes apply to all
subsequent plots until called again.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/plot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="k">def</span><span class="w"> </span><span class="nf">set_plot_language</span><span class="p">(</span><span class="n">lang</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets the preferred language for plot labels and text.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        lang: The language to set. &#39;en&#39; for English (default), &#39;cn&#39; for Chinese.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        For Chinese language, sets font to SimHei and adjusts unicode_minus handling.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        For English, restores matplotlib default settings. Changes apply to all</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        subsequent plots until called again.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">global</span> <span class="n">_use_chinese_labels</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="n">_use_chinese_labels</span> <span class="o">=</span> <span class="n">lang</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;cn&quot;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="k">if</span> <span class="n">_use_chinese_labels</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="c1"># To display Chinese characters correctly, specify a list of fallback fonts.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.sans-serif&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SimHei&quot;</span><span class="p">]</span>  <span class="c1"># 替换成你电脑上有的字体</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.unicode_minus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># To display minus sign correctly.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sans-serif&quot;</span>  <span class="c1"># 确保字体家族设置生效</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="c1"># Restore default settings</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.sans-serif&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParamsDefault</span><span class="p">[</span><span class="s2">&quot;font.sans-serif&quot;</span><span class="p">]</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.unicode_minus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParamsDefault</span><span class="p">[</span><span class="s2">&quot;axes.unicode_minus&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
<div class="tabbed-block">


<div class="doc doc-object doc-module">



<a id="tricys.analysis.report"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.report.call_openai_analysis_api" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">call_openai_analysis_api</span><span class="p">(</span><span class="n">case_name</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">ai_model</span><span class="p">,</span> <span class="n">independent_variable</span><span class="p">,</span> <span class="n">report_content</span><span class="p">,</span> <span class="n">original_config</span><span class="p">,</span> <span class="n">case_data</span><span class="p">,</span> <span class="n">reference_col_for_turning_point</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.report.call_openai_analysis_api" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Constructs a text-only prompt, calls the OpenAI API for analysis, and returns the result string.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>case_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the analysis case.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing summary data.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>api_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OpenAI API key.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>base_url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base URL for the OpenAI API.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ai_model</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model name to use for analysis.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>independent_variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the independent variable.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>report_content</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The report content to analyze.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_config</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original configuration dictionary.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>case_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Case-specific data dictionary.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reference_col_for_turning_point</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional reference column for turning point analysis.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The combined prompt and LLM analysis result, or None if failed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Constructs dynamic prompts based on case configuration. Includes sections for
global sensitivity analysis, interaction effects (if simulation parameters present),
and dynamic process analysis (if reference column provided). Retries up to 3 times
on failure with 5-second delays.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/report.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">call_openai_analysis_api</span><span class="p">(</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">case_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">ai_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">independent_variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">report_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">original_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">case_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">reference_col_for_turning_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructs a text-only prompt, calls the OpenAI API for analysis, and returns the result string.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        case_name: Name of the analysis case.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        df: DataFrame containing summary data.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        api_key: OpenAI API key.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        base_url: Base URL for the OpenAI API.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        ai_model: Model name to use for analysis.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        independent_variable: Name of the independent variable.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        report_content: The report content to analyze.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        original_config: Original configuration dictionary.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        case_data: Case-specific data dictionary.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        reference_col_for_turning_point: Optional reference column for turning point analysis.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        The combined prompt and LLM analysis result, or None if failed.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        Constructs dynamic prompts based on case configuration. Includes sections for</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        global sensitivity analysis, interaction effects (if simulation parameters present),</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        and dynamic process analysis (if reference column provided). Retries up to 3 times</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        on failure with 5-second delays.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Proceeding with LLM analysis for case </span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="c1"># 1. Construct the prompt for the API</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="n">role_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;**角色：** 你是一名聚变反应堆氚燃料循环领域的专家。</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="s2">**任务：** 请**完全基于**下方提供的**两类数据表格**，对聚变堆燃料循环模型的**敏感性分析**结果进行深度解读。</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">analysis_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="s2">**分析数据：**(注意：分析中不可使用任何图表信息，所有结论必须源于数据表格。)</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="si">{</span><span class="n">report_content</span><span class="si">}</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="c1"># --- Dynamic Prompt Construction ---</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="c1"># 1. Detect analysis scenario</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">has_sim_params</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">))</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="c1"># 2. Build prompt sections dynamically</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">prompt_sections</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="c1"># Section 1: Global Sensitivity Analysis</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="n">global_sensitivity_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="s2">&quot;1.  **全局敏感性分析 (参考“性能指标总表”) :**&quot;</span><span class="p">,</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="s2">&quot;    *   分析性能指标总表（ `Startup_Inventory`, `Doubling_Time` 以及以 `Required_` 开头的求解指标等）呈现出怎样的**总体趋势**？请进行量化描述。&quot;</span><span class="p">,</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="sa">f</span><span class="s2">&quot;    *   如果存在多个性能指标，分析哪个性能指标对独立变量 `</span><span class="si">{</span><span class="n">independent_variable</span><span class="si">}</span><span class="s2">` 的变化最为敏感？哪个最不敏感？</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="p">]</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="c1"># Interaction effect analysis, with refined description</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="k">if</span> <span class="n">has_sim_params</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="n">param_names_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">case_data</span><span class="p">[</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s2">&quot;Required_TBR&quot;</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>                    <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;`Required_TBR约束值 (hour)`&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>                    <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">`&quot;</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="n">param_names_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">param_names</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">param_names_list</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">interaction_text</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>                <span class="sa">f</span><span class="s2">&quot;2.  **交互效应分析：** 本次分析包含了多变量的交互效应。请分析独立变量 `</span><span class="si">{</span><span class="n">independent_variable</span><span class="si">}</span><span class="s2">` &quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                <span class="sa">f</span><span class="s2">&quot;与背景扫描参数 (</span><span class="si">{</span><span class="n">param_names</span><span class="si">}</span><span class="s2">) 之间的交互作用对各项性能指标的影响。&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>                <span class="s2">&quot;请注意，独立变量或背景扫描参数中，可能包含常规的模型参数，也可能包含为满足特定性能目标（限制倍增时间Double_Time达到倍增）而求解出的特殊变量（约束限制变量Double_Time）。&quot;</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>                <span class="s2">&quot;请讨论在不同的变量组合下，性能指标的敏感性有何不同？是否存在显著的交互效应？&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">global_sensitivity_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interaction_text</span><span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">prompt_sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">global_sensitivity_points</span><span class="p">))</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="c1"># Section 2: Dynamic Process Analysis</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">if</span> <span class="n">reference_col_for_turning_point</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="n">dynamic_process_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>                <span class="s2">&quot;3.  **动态过程分析 (参考“关键动态数据切片：过程数据”) :**&quot;</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>                <span class="s2">&quot;    *   观察过程数据切片：系统在“初始阶段”和“结束阶段”的行为有何不同？&quot;</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                <span class="sa">f</span><span class="s2">&quot;    *   以 `</span><span class="si">{</span><span class="n">reference_col_for_turning_point</span><span class="si">}</span><span class="s2">` 为参考，其“转折点阶段”的数据揭示了什么物理过程？（例如，它是否是氚库存由消耗转为净增长的关键时刻？）&quot;</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="p">]</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="n">prompt_sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dynamic_process_points</span><span class="p">))</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="c1"># Section 3: Overall Conclusion (renumbered from 4)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">conclusion_points</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;3.  **综合结论：**&quot;</span><span class="p">]</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">conclusion_intro</span> <span class="o">=</span> <span class="s2">&quot;结合所有分析（包括主趋势&quot;</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="k">if</span> <span class="n">has_sim_params</span><span class="p">:</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="n">conclusion_intro</span> <span class="o">+=</span> <span class="s2">&quot;、背景参数交互效应&quot;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">conclusion_intro</span> <span class="o">+=</span> <span class="s2">&quot;），&quot;</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">conclusion_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="n">conclusion_intro</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;总结在不同的运行场景下，调整 `</span><span class="si">{</span><span class="n">independent_variable</span><span class="si">}</span><span class="s2">` 对整个氚燃料循环系统的综合影响和潜在的利弊权衡。&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">conclusion_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="s2">&quot;    *   基于这些发现，可以得出哪些关于系统设计或运行优化的初步建议？&quot;</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">prompt_sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conclusion_points</span><span class="p">))</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="c1"># Assemble the final prompt</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">points_prompt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt_sections</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">points_prompt</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**分析要点 (必须严格依据数据表格作答)：**</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">points_prompt</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="c1"># 2. Call API with retry logic</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>                <span class="n">client</span> <span class="o">=</span> <span class="n">openai</span><span class="o">.</span><span class="n">OpenAI</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>                    <span class="sa">f</span><span class="s2">&quot;Sending request to OpenAI API for case </span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2"> (Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2">)...&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>                <span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="n">full_text_prompt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                    <span class="p">[</span><span class="n">role_prompt</span><span class="p">,</span> <span class="n">analysis_prompt</span><span class="p">,</span> <span class="n">points_prompt</span><span class="p">]</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                    <span class="n">model</span><span class="o">=</span><span class="n">ai_model</span><span class="p">,</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                    <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">full_text_prompt</span><span class="p">}],</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                    <span class="n">max_tokens</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>                <span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="n">analysis_result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LLM analysis successful for case </span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                    <span class="n">role_prompt</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                    <span class="o">+</span> <span class="n">points_prompt</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">```</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">---</span><span class="se">\n\n</span><span class="s2"># AI模型分析结果</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                    <span class="o">+</span> <span class="n">analysis_result</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="p">)</span>  <span class="c1"># Return the result string</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error calling OpenAI API on attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                        <span class="sa">f</span><span class="s2">&quot;Failed to call OpenAI API after </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> attempts.&quot;</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                    <span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                    <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Return None on failure</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="sa">f</span><span class="s2">&quot;Error in call_openai_analysis_api for case </span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.report.consolidate_reports" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">consolidate_reports</span><span class="p">(</span><span class="n">case_configs</span><span class="p">,</span> <span class="n">original_config</span><span class="p">)</span></code>

<a href="#tricys.analysis.report.consolidate_reports" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Consolidates generated reports and their images into a 'report' directory for each case.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>case_configs</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of case configuration dictionaries.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_config</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original configuration dictionary.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Moves analysis reports, academic reports, and plot images from results directory
to report directory. Uses move operation (not copy). Creates report directory
if it doesn't exist. Skips cases where source directory not found.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/report.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1463" name="__codelineno-0-1463"></a><span class="k">def</span><span class="w"> </span><span class="nf">consolidate_reports</span><span class="p">(</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>    <span class="n">case_configs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">original_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Consolidates generated reports and their images into a &#39;report&#39; directory for each case.</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a><span class="sd">        case_configs: List of case configuration dictionaries.</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a><span class="sd">        original_config: Original configuration dictionary.</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a><span class="sd">        Moves analysis reports, academic reports, and plot images from results directory</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a><span class="sd">        to report directory. Uses move operation (not copy). Creates report directory</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a><span class="sd">        if it doesn&#39;t exist. Skips cases where source directory not found.</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Consolidating analysis reports...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>        <span class="k">for</span> <span class="n">case_info</span> <span class="ow">in</span> <span class="n">case_configs</span><span class="p">:</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>            <span class="n">case_workspace</span> <span class="o">=</span> <span class="n">case_info</span><span class="p">[</span><span class="s2">&quot;workspace&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>            <span class="n">source_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">case_workspace</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a>            <span class="n">dest_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">case_workspace</span><span class="p">,</span> <span class="s2">&quot;report&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">source_dir</span><span class="p">):</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>                    <span class="sa">f</span><span class="s2">&quot;Source directory not found, skipping consolidation for case: </span><span class="si">{</span><span class="n">case_workspace</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>                <span class="p">)</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>            <span class="c1"># Find files to copy</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>            <span class="n">files_to_copy</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">source_dir</span><span class="p">):</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>                <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>                    <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;analysis_report&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>                    <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;academic_report&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>                <span class="p">)</span> <span class="ow">and</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.md&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>                    <span class="n">files_to_copy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>                <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.svg&quot;</span><span class="p">,</span> <span class="s2">&quot;.png&quot;</span><span class="p">)):</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>                    <span class="n">files_to_copy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">files_to_copy</span><span class="p">:</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>                    <span class="sa">f</span><span class="s2">&quot;No reports or images found in </span><span class="si">{</span><span class="n">source_dir</span><span class="si">}</span><span class="s2">, skipping consolidation.&quot;</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>                <span class="p">)</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>            <span class="c1"># Create destination directory and copy files</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consolidating reports into: </span><span class="si">{</span><span class="n">dest_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files_to_copy</span><span class="p">:</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>                <span class="n">source_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">)</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Moved </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">dest_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during report consolidation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.report.generate_analysis_cases_summary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_analysis_cases_summary</span><span class="p">(</span><span class="n">case_configs</span><span class="p">,</span> <span class="n">original_config</span><span class="p">)</span></code>

<a href="#tricys.analysis.report.generate_analysis_cases_summary" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate summary report for analysis_cases.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>case_configs</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of case configuration dictionaries.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_config</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original configuration dictionary containing run timestamp.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Creates an execution report with basic information, case details, and status.
Saves report to {run_timestamp}/execution_report_{run_timestamp}.md in current
working directory. Also triggers generate_prompt_templates and consolidate_reports.
Logs summary of successfully executed cases.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/report.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1520" name="__codelineno-0-1520"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_analysis_cases_summary</span><span class="p">(</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>    <span class="n">case_configs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">original_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate summary report for analysis_cases.</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a><span class="sd">        case_configs: List of case configuration dictionaries.</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a><span class="sd">        original_config: Original configuration dictionary containing run timestamp.</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a><span class="sd">        Creates an execution report with basic information, case details, and status.</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a><span class="sd">        Saves report to {run_timestamp}/execution_report_{run_timestamp}.md in current</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a><span class="sd">        working directory. Also triggers generate_prompt_templates and consolidate_reports.</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a><span class="sd">        Logs summary of successfully executed cases.</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>        <span class="n">run_timestamp</span> <span class="o">=</span> <span class="n">original_config</span><span class="p">[</span><span class="s2">&quot;run_timestamp&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>        <span class="c1"># Generate report in current working directory</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>        <span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>        <span class="c1"># Create summary report</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>        <span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>        <span class="k">for</span> <span class="n">case_info</span> <span class="ow">in</span> <span class="n">case_configs</span><span class="p">:</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>            <span class="n">case_data</span> <span class="o">=</span> <span class="n">case_info</span><span class="p">[</span><span class="s2">&quot;case_data&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>            <span class="n">case_workspace</span> <span class="o">=</span> <span class="n">case_info</span><span class="p">[</span><span class="s2">&quot;workspace&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>            <span class="c1"># Check if case results exist</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>            <span class="n">case_results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">case_workspace</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>            <span class="n">has_results</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">case_results_dir</span><span class="p">)</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">case_results_dir</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>            <span class="p">)</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>            <span class="n">summary_entry</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>                <span class="s2">&quot;case_name&quot;</span><span class="p">:</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Case</span><span class="si">{</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>                <span class="s2">&quot;independent_variable&quot;</span><span class="p">:</span> <span class="n">case_data</span><span class="p">[</span><span class="s2">&quot;independent_variable&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>                <span class="s2">&quot;independent_variable_sampling&quot;</span><span class="p">:</span> <span class="n">case_data</span><span class="p">[</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>                    <span class="s2">&quot;independent_variable_sampling&quot;</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>                <span class="p">],</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>                <span class="s2">&quot;workspace_path&quot;</span><span class="p">:</span> <span class="n">case_workspace</span><span class="p">,</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>                <span class="s2">&quot;has_results&quot;</span><span class="p">:</span> <span class="n">has_results</span><span class="p">,</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>                <span class="s2">&quot;config_file&quot;</span><span class="p">:</span> <span class="n">case_info</span><span class="p">[</span><span class="s2">&quot;config_path&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>            <span class="p">}</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>            <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary_entry</span><span class="p">)</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>        <span class="c1"># Generate text report</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>        <span class="n">report_lines</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>            <span class="s2">&quot;# Analysis Cases Execution Report&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Basic Information&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>            <span class="sa">f</span><span class="s2">&quot;- Execution time: </span><span class="si">{</span><span class="n">run_timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>            <span class="sa">f</span><span class="s2">&quot;- Total cases: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">case_configs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>            <span class="sa">f</span><span class="s2">&quot;- Successfully executed: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">summary_data</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;has_results&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>            <span class="sa">f</span><span class="s2">&quot;- Working directory: </span><span class="si">{</span><span class="n">current_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Case Details&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>        <span class="p">]</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;✓ Success&quot;</span> <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;has_results&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;✗ Failed&quot;</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>            <span class="n">report_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>                <span class="p">[</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">### </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;case_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>                    <span class="sa">f</span><span class="s2">&quot;- Status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>                    <span class="sa">f</span><span class="s2">&quot;- Independent variable: </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;independent_variable&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>                    <span class="sa">f</span><span class="s2">&quot;- Sampling method: </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;independent_variable_sampling&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>                    <span class="sa">f</span><span class="s2">&quot;- Working directory: </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;workspace_path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>                    <span class="sa">f</span><span class="s2">&quot;- Configuration file: </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;config_file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>                <span class="p">]</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>            <span class="p">)</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>        <span class="c1"># Save report to current directory</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>        <span class="n">report_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>            <span class="n">current_dir</span><span class="p">,</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>            <span class="n">run_timestamp</span><span class="p">,</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>            <span class="sa">f</span><span class="s2">&quot;execution_report_</span><span class="si">{</span><span class="n">run_timestamp</span><span class="si">}</span><span class="s2">.md&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>        <span class="p">)</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">report_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">report_lines</span><span class="p">))</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Summary report generated:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Detailed report: </span><span class="si">{</span><span class="n">report_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>        <span class="c1"># Generate prompt engineering template for each case</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>        <span class="n">generate_prompt_templates</span><span class="p">(</span><span class="n">case_configs</span><span class="p">,</span> <span class="n">original_config</span><span class="p">)</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>        <span class="c1"># Consolidate all generated reports</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>        <span class="n">consolidate_reports</span><span class="p">(</span><span class="n">case_configs</span><span class="p">,</span> <span class="n">original_config</span><span class="p">)</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error generating summary report: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.report.generate_prompt_templates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_prompt_templates</span><span class="p">(</span><span class="n">case_configs</span><span class="p">,</span> <span class="n">original_config</span><span class="p">)</span></code>

<a href="#tricys.analysis.report.generate_prompt_templates" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate detailed Markdown analysis reports for each analysis case.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>case_configs</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of case configuration dictionaries containing case data and workspace info.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_config</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original configuration dictionary with sensitivity analysis settings.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Skips SALib cases (those with analyzer.method defined). For each case, generates
a detailed Markdown report including configuration details, optimization configs,
time-series plots, performance metric plots, and data tables. Supports AI-enhanced
reporting if API credentials are available. Creates bilingual plots prioritizing
Chinese versions (_zh suffix).</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/report.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-451"> 451</a></span>
<span class="normal"><a href="#__codelineno-0-452"> 452</a></span>
<span class="normal"><a href="#__codelineno-0-453"> 453</a></span>
<span class="normal"><a href="#__codelineno-0-454"> 454</a></span>
<span class="normal"><a href="#__codelineno-0-455"> 455</a></span>
<span class="normal"><a href="#__codelineno-0-456"> 456</a></span>
<span class="normal"><a href="#__codelineno-0-457"> 457</a></span>
<span class="normal"><a href="#__codelineno-0-458"> 458</a></span>
<span class="normal"><a href="#__codelineno-0-459"> 459</a></span>
<span class="normal"><a href="#__codelineno-0-460"> 460</a></span>
<span class="normal"><a href="#__codelineno-0-461"> 461</a></span>
<span class="normal"><a href="#__codelineno-0-462"> 462</a></span>
<span class="normal"><a href="#__codelineno-0-463"> 463</a></span>
<span class="normal"><a href="#__codelineno-0-464"> 464</a></span>
<span class="normal"><a href="#__codelineno-0-465"> 465</a></span>
<span class="normal"><a href="#__codelineno-0-466"> 466</a></span>
<span class="normal"><a href="#__codelineno-0-467"> 467</a></span>
<span class="normal"><a href="#__codelineno-0-468"> 468</a></span>
<span class="normal"><a href="#__codelineno-0-469"> 469</a></span>
<span class="normal"><a href="#__codelineno-0-470"> 470</a></span>
<span class="normal"><a href="#__codelineno-0-471"> 471</a></span>
<span class="normal"><a href="#__codelineno-0-472"> 472</a></span>
<span class="normal"><a href="#__codelineno-0-473"> 473</a></span>
<span class="normal"><a href="#__codelineno-0-474"> 474</a></span>
<span class="normal"><a href="#__codelineno-0-475"> 475</a></span>
<span class="normal"><a href="#__codelineno-0-476"> 476</a></span>
<span class="normal"><a href="#__codelineno-0-477"> 477</a></span>
<span class="normal"><a href="#__codelineno-0-478"> 478</a></span>
<span class="normal"><a href="#__codelineno-0-479"> 479</a></span>
<span class="normal"><a href="#__codelineno-0-480"> 480</a></span>
<span class="normal"><a href="#__codelineno-0-481"> 481</a></span>
<span class="normal"><a href="#__codelineno-0-482"> 482</a></span>
<span class="normal"><a href="#__codelineno-0-483"> 483</a></span>
<span class="normal"><a href="#__codelineno-0-484"> 484</a></span>
<span class="normal"><a href="#__codelineno-0-485"> 485</a></span>
<span class="normal"><a href="#__codelineno-0-486"> 486</a></span>
<span class="normal"><a href="#__codelineno-0-487"> 487</a></span>
<span class="normal"><a href="#__codelineno-0-488"> 488</a></span>
<span class="normal"><a href="#__codelineno-0-489"> 489</a></span>
<span class="normal"><a href="#__codelineno-0-490"> 490</a></span>
<span class="normal"><a href="#__codelineno-0-491"> 491</a></span>
<span class="normal"><a href="#__codelineno-0-492"> 492</a></span>
<span class="normal"><a href="#__codelineno-0-493"> 493</a></span>
<span class="normal"><a href="#__codelineno-0-494"> 494</a></span>
<span class="normal"><a href="#__codelineno-0-495"> 495</a></span>
<span class="normal"><a href="#__codelineno-0-496"> 496</a></span>
<span class="normal"><a href="#__codelineno-0-497"> 497</a></span>
<span class="normal"><a href="#__codelineno-0-498"> 498</a></span>
<span class="normal"><a href="#__codelineno-0-499"> 499</a></span>
<span class="normal"><a href="#__codelineno-0-500"> 500</a></span>
<span class="normal"><a href="#__codelineno-0-501"> 501</a></span>
<span class="normal"><a href="#__codelineno-0-502"> 502</a></span>
<span class="normal"><a href="#__codelineno-0-503"> 503</a></span>
<span class="normal"><a href="#__codelineno-0-504"> 504</a></span>
<span class="normal"><a href="#__codelineno-0-505"> 505</a></span>
<span class="normal"><a href="#__codelineno-0-506"> 506</a></span>
<span class="normal"><a href="#__codelineno-0-507"> 507</a></span>
<span class="normal"><a href="#__codelineno-0-508"> 508</a></span>
<span class="normal"><a href="#__codelineno-0-509"> 509</a></span>
<span class="normal"><a href="#__codelineno-0-510"> 510</a></span>
<span class="normal"><a href="#__codelineno-0-511"> 511</a></span>
<span class="normal"><a href="#__codelineno-0-512"> 512</a></span>
<span class="normal"><a href="#__codelineno-0-513"> 513</a></span>
<span class="normal"><a href="#__codelineno-0-514"> 514</a></span>
<span class="normal"><a href="#__codelineno-0-515"> 515</a></span>
<span class="normal"><a href="#__codelineno-0-516"> 516</a></span>
<span class="normal"><a href="#__codelineno-0-517"> 517</a></span>
<span class="normal"><a href="#__codelineno-0-518"> 518</a></span>
<span class="normal"><a href="#__codelineno-0-519"> 519</a></span>
<span class="normal"><a href="#__codelineno-0-520"> 520</a></span>
<span class="normal"><a href="#__codelineno-0-521"> 521</a></span>
<span class="normal"><a href="#__codelineno-0-522"> 522</a></span>
<span class="normal"><a href="#__codelineno-0-523"> 523</a></span>
<span class="normal"><a href="#__codelineno-0-524"> 524</a></span>
<span class="normal"><a href="#__codelineno-0-525"> 525</a></span>
<span class="normal"><a href="#__codelineno-0-526"> 526</a></span>
<span class="normal"><a href="#__codelineno-0-527"> 527</a></span>
<span class="normal"><a href="#__codelineno-0-528"> 528</a></span>
<span class="normal"><a href="#__codelineno-0-529"> 529</a></span>
<span class="normal"><a href="#__codelineno-0-530"> 530</a></span>
<span class="normal"><a href="#__codelineno-0-531"> 531</a></span>
<span class="normal"><a href="#__codelineno-0-532"> 532</a></span>
<span class="normal"><a href="#__codelineno-0-533"> 533</a></span>
<span class="normal"><a href="#__codelineno-0-534"> 534</a></span>
<span class="normal"><a href="#__codelineno-0-535"> 535</a></span>
<span class="normal"><a href="#__codelineno-0-536"> 536</a></span>
<span class="normal"><a href="#__codelineno-0-537"> 537</a></span>
<span class="normal"><a href="#__codelineno-0-538"> 538</a></span>
<span class="normal"><a href="#__codelineno-0-539"> 539</a></span>
<span class="normal"><a href="#__codelineno-0-540"> 540</a></span>
<span class="normal"><a href="#__codelineno-0-541"> 541</a></span>
<span class="normal"><a href="#__codelineno-0-542"> 542</a></span>
<span class="normal"><a href="#__codelineno-0-543"> 543</a></span>
<span class="normal"><a href="#__codelineno-0-544"> 544</a></span>
<span class="normal"><a href="#__codelineno-0-545"> 545</a></span>
<span class="normal"><a href="#__codelineno-0-546"> 546</a></span>
<span class="normal"><a href="#__codelineno-0-547"> 547</a></span>
<span class="normal"><a href="#__codelineno-0-548"> 548</a></span>
<span class="normal"><a href="#__codelineno-0-549"> 549</a></span>
<span class="normal"><a href="#__codelineno-0-550"> 550</a></span>
<span class="normal"><a href="#__codelineno-0-551"> 551</a></span>
<span class="normal"><a href="#__codelineno-0-552"> 552</a></span>
<span class="normal"><a href="#__codelineno-0-553"> 553</a></span>
<span class="normal"><a href="#__codelineno-0-554"> 554</a></span>
<span class="normal"><a href="#__codelineno-0-555"> 555</a></span>
<span class="normal"><a href="#__codelineno-0-556"> 556</a></span>
<span class="normal"><a href="#__codelineno-0-557"> 557</a></span>
<span class="normal"><a href="#__codelineno-0-558"> 558</a></span>
<span class="normal"><a href="#__codelineno-0-559"> 559</a></span>
<span class="normal"><a href="#__codelineno-0-560"> 560</a></span>
<span class="normal"><a href="#__codelineno-0-561"> 561</a></span>
<span class="normal"><a href="#__codelineno-0-562"> 562</a></span>
<span class="normal"><a href="#__codelineno-0-563"> 563</a></span>
<span class="normal"><a href="#__codelineno-0-564"> 564</a></span>
<span class="normal"><a href="#__codelineno-0-565"> 565</a></span>
<span class="normal"><a href="#__codelineno-0-566"> 566</a></span>
<span class="normal"><a href="#__codelineno-0-567"> 567</a></span>
<span class="normal"><a href="#__codelineno-0-568"> 568</a></span>
<span class="normal"><a href="#__codelineno-0-569"> 569</a></span>
<span class="normal"><a href="#__codelineno-0-570"> 570</a></span>
<span class="normal"><a href="#__codelineno-0-571"> 571</a></span>
<span class="normal"><a href="#__codelineno-0-572"> 572</a></span>
<span class="normal"><a href="#__codelineno-0-573"> 573</a></span>
<span class="normal"><a href="#__codelineno-0-574"> 574</a></span>
<span class="normal"><a href="#__codelineno-0-575"> 575</a></span>
<span class="normal"><a href="#__codelineno-0-576"> 576</a></span>
<span class="normal"><a href="#__codelineno-0-577"> 577</a></span>
<span class="normal"><a href="#__codelineno-0-578"> 578</a></span>
<span class="normal"><a href="#__codelineno-0-579"> 579</a></span>
<span class="normal"><a href="#__codelineno-0-580"> 580</a></span>
<span class="normal"><a href="#__codelineno-0-581"> 581</a></span>
<span class="normal"><a href="#__codelineno-0-582"> 582</a></span>
<span class="normal"><a href="#__codelineno-0-583"> 583</a></span>
<span class="normal"><a href="#__codelineno-0-584"> 584</a></span>
<span class="normal"><a href="#__codelineno-0-585"> 585</a></span>
<span class="normal"><a href="#__codelineno-0-586"> 586</a></span>
<span class="normal"><a href="#__codelineno-0-587"> 587</a></span>
<span class="normal"><a href="#__codelineno-0-588"> 588</a></span>
<span class="normal"><a href="#__codelineno-0-589"> 589</a></span>
<span class="normal"><a href="#__codelineno-0-590"> 590</a></span>
<span class="normal"><a href="#__codelineno-0-591"> 591</a></span>
<span class="normal"><a href="#__codelineno-0-592"> 592</a></span>
<span class="normal"><a href="#__codelineno-0-593"> 593</a></span>
<span class="normal"><a href="#__codelineno-0-594"> 594</a></span>
<span class="normal"><a href="#__codelineno-0-595"> 595</a></span>
<span class="normal"><a href="#__codelineno-0-596"> 596</a></span>
<span class="normal"><a href="#__codelineno-0-597"> 597</a></span>
<span class="normal"><a href="#__codelineno-0-598"> 598</a></span>
<span class="normal"><a href="#__codelineno-0-599"> 599</a></span>
<span class="normal"><a href="#__codelineno-0-600"> 600</a></span>
<span class="normal"><a href="#__codelineno-0-601"> 601</a></span>
<span class="normal"><a href="#__codelineno-0-602"> 602</a></span>
<span class="normal"><a href="#__codelineno-0-603"> 603</a></span>
<span class="normal"><a href="#__codelineno-0-604"> 604</a></span>
<span class="normal"><a href="#__codelineno-0-605"> 605</a></span>
<span class="normal"><a href="#__codelineno-0-606"> 606</a></span>
<span class="normal"><a href="#__codelineno-0-607"> 607</a></span>
<span class="normal"><a href="#__codelineno-0-608"> 608</a></span>
<span class="normal"><a href="#__codelineno-0-609"> 609</a></span>
<span class="normal"><a href="#__codelineno-0-610"> 610</a></span>
<span class="normal"><a href="#__codelineno-0-611"> 611</a></span>
<span class="normal"><a href="#__codelineno-0-612"> 612</a></span>
<span class="normal"><a href="#__codelineno-0-613"> 613</a></span>
<span class="normal"><a href="#__codelineno-0-614"> 614</a></span>
<span class="normal"><a href="#__codelineno-0-615"> 615</a></span>
<span class="normal"><a href="#__codelineno-0-616"> 616</a></span>
<span class="normal"><a href="#__codelineno-0-617"> 617</a></span>
<span class="normal"><a href="#__codelineno-0-618"> 618</a></span>
<span class="normal"><a href="#__codelineno-0-619"> 619</a></span>
<span class="normal"><a href="#__codelineno-0-620"> 620</a></span>
<span class="normal"><a href="#__codelineno-0-621"> 621</a></span>
<span class="normal"><a href="#__codelineno-0-622"> 622</a></span>
<span class="normal"><a href="#__codelineno-0-623"> 623</a></span>
<span class="normal"><a href="#__codelineno-0-624"> 624</a></span>
<span class="normal"><a href="#__codelineno-0-625"> 625</a></span>
<span class="normal"><a href="#__codelineno-0-626"> 626</a></span>
<span class="normal"><a href="#__codelineno-0-627"> 627</a></span>
<span class="normal"><a href="#__codelineno-0-628"> 628</a></span>
<span class="normal"><a href="#__codelineno-0-629"> 629</a></span>
<span class="normal"><a href="#__codelineno-0-630"> 630</a></span>
<span class="normal"><a href="#__codelineno-0-631"> 631</a></span>
<span class="normal"><a href="#__codelineno-0-632"> 632</a></span>
<span class="normal"><a href="#__codelineno-0-633"> 633</a></span>
<span class="normal"><a href="#__codelineno-0-634"> 634</a></span>
<span class="normal"><a href="#__codelineno-0-635"> 635</a></span>
<span class="normal"><a href="#__codelineno-0-636"> 636</a></span>
<span class="normal"><a href="#__codelineno-0-637"> 637</a></span>
<span class="normal"><a href="#__codelineno-0-638"> 638</a></span>
<span class="normal"><a href="#__codelineno-0-639"> 639</a></span>
<span class="normal"><a href="#__codelineno-0-640"> 640</a></span>
<span class="normal"><a href="#__codelineno-0-641"> 641</a></span>
<span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_prompt_templates</span><span class="p">(</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="n">case_configs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">original_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate detailed Markdown analysis reports for each analysis case.</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">        case_configs: List of case configuration dictionaries containing case data and workspace info.</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">        original_config: Original configuration dictionary with sensitivity analysis settings.</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">        Skips SALib cases (those with analyzer.method defined). For each case, generates</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">        a detailed Markdown report including configuration details, optimization configs,</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        time-series plots, performance metric plots, and data tables. Supports AI-enhanced</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">        reporting if API credentials are available. Creates bilingual plots prioritizing</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">        Chinese versions (_zh suffix).</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_find_unit_config</span><span class="p">(</span><span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unit_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">        Finds the unit configuration for a variable name from the unit_map.</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        1. Checks for an exact match.</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        2. Checks if the last part of a dot-separated name matches.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">        3. Checks for a simple substring containment as a fallback, matching longest keys first.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">unit_map</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">var_name</span><span class="p">:</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">unit_map</span><span class="p">:</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="k">return</span> <span class="n">unit_map</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="n">components</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">components</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">unit_map</span><span class="p">:</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="k">return</span> <span class="n">unit_map</span><span class="p">[</span><span class="n">components</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">unit_map</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">var_name</span><span class="p">:</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                <span class="k">return</span> <span class="n">unit_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_format_label</span><span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Formats a label for display, replacing underscores/dots with spaces and capitalizing each word.&quot;&quot;&quot;</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="k">return</span> <span class="n">label</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="n">label</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;!\d)\.|\.(?!\d)&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="k">return</span> <span class="n">label</span>  <span class="c1"># .title()</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="n">sensitivity_analysis_config</span> <span class="o">=</span> <span class="n">original_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="n">unit_map</span> <span class="o">=</span> <span class="n">sensitivity_analysis_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit_map&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>        <span class="k">for</span> <span class="n">case_info</span> <span class="ow">in</span> <span class="n">case_configs</span><span class="p">:</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="n">case_data</span> <span class="o">=</span> <span class="n">case_info</span><span class="p">[</span><span class="s2">&quot;case_data&quot;</span><span class="p">]</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>            <span class="k">if</span> <span class="s2">&quot;analyzer&quot;</span> <span class="ow">in</span> <span class="n">case_data</span> <span class="ow">and</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;analyzer&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">):</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                    <span class="sa">f</span><span class="s2">&quot;Skipping default report generation for SALib case: </span><span class="si">{</span><span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                <span class="p">)</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                <span class="k">continue</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>            <span class="n">case_workspace</span> <span class="o">=</span> <span class="n">case_info</span><span class="p">[</span><span class="s2">&quot;workspace&quot;</span><span class="p">]</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>            <span class="n">case_name</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Case</span><span class="si">{</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>            <span class="n">case_results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">case_workspace</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">)</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">case_results_dir</span><span class="p">):</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                <span class="k">continue</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="n">summary_csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                <span class="n">case_results_dir</span><span class="p">,</span> <span class="s2">&quot;sensitivity_analysis_summary.csv&quot;</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="p">)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="n">sweep_csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">case_results_dir</span><span class="p">,</span> <span class="s2">&quot;sweep_results.csv&quot;</span><span class="p">)</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">summary_csv_path</span><span class="p">):</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>                    <span class="sa">f</span><span class="s2">&quot;summary_csv not found for case </span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">, skipping report generation.&quot;</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>                <span class="p">)</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>                <span class="k">continue</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>            <span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">summary_csv_path</span><span class="p">)</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>            <span class="n">independent_variable</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;independent_variable&quot;</span><span class="p">,</span> <span class="s2">&quot;燃烧率&quot;</span><span class="p">)</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>            <span class="c1"># Use a dictionary to ensure we only get one version of each plot, prioritizing Chinese</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>            <span class="n">all_plots_all_langs</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>                <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">case_results_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.svg&quot;</span><span class="p">)</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>            <span class="p">]</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>            <span class="n">plot_map</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>            <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>                <span class="n">all_plots_all_langs</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>            <span class="p">):</span>  <span class="c1"># Process _zh.svg first</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>                <span class="n">base_name</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_zh.svg&quot;</span><span class="p">,</span> <span class="s2">&quot;.svg&quot;</span><span class="p">)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>                <span class="k">if</span> <span class="n">base_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_map</span><span class="p">:</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>                    <span class="n">plot_map</span><span class="p">[</span><span class="n">base_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>            <span class="n">all_plots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">plot_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>            <span class="n">sweep_plots</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_plots</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sweep_&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>            <span class="n">combined_plots</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_plots</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;combined_&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>            <span class="n">multi_metric_plots</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>                <span class="n">f</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_plots</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;multi_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_analysis_by_param.svg&quot;</span><span class="p">)</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>            <span class="p">]</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>            <span class="n">all_individual_plots</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>                <span class="n">f</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_plots</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sweep_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>                <span class="ow">and</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;combined_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>                <span class="ow">and</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;multi_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>            <span class="p">]</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>            <span class="n">required_individual_plots</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>                <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_individual_plots</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;line_Required_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>            <span class="p">]</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>            <span class="n">standard_individual_plots</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>                <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_individual_plots</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;line_Required_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>            <span class="p">]</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="c1"># --- Markdown Generation (with dynamic title) ---</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>            <span class="n">sim_params</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">)</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>            <span class="k">if</span> <span class="n">sim_params</span><span class="p">:</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>                <span class="n">main_var_label</span> <span class="o">=</span> <span class="n">_format_label</span><span class="p">(</span><span class="n">independent_variable</span><span class="p">)</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>                <span class="n">other_vars_labels_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sim_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>                    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s2">&quot;Required_TBR&quot;</span><span class="p">:</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>                        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Required_TBR约束值&quot;</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>                        <span class="n">label</span> <span class="o">=</span> <span class="n">_format_label</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>                    <span class="n">other_vars_labels_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>                <span class="n">other_vars_labels</span> <span class="o">=</span> <span class="s2">&quot;、&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other_vars_labels_list</span><span class="p">)</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>                <span class="n">report_title</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>                    <span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="n">main_var_label</span><span class="si">}</span><span class="s2"> 与 </span><span class="si">{</span><span class="n">other_vars_labels</span><span class="si">}</span><span class="s2"> 交互敏感性分析报告</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>                <span class="p">)</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>                <span class="n">report_title</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>                    <span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="n">_format_label</span><span class="p">(</span><span class="n">independent_variable</span><span class="p">)</span><span class="si">}</span><span class="s2"> 敏感性分析报告</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>                <span class="p">)</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>            <span class="n">prompt_lines</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>                <span class="n">report_title</span><span class="p">,</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>                <span class="sa">f</span><span class="s2">&quot;生成时间: </span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>            <span class="p">]</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>            <span class="n">config_details_lines</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>                <span class="s2">&quot;## 分析案例配置详情</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>                <span class="s2">&quot;本分析案例的具体配置如下，这决定了仿真的扫描方式和分析的重点：</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>                <span class="s2">&quot;| 配置项 | 值 | 说明 |&quot;</span><span class="p">,</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>                <span class="s2">&quot;| :--- | :--- | :--- |&quot;</span><span class="p">,</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>            <span class="p">]</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">format_for_md</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">|&quot;</span><span class="p">)</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>            <span class="n">config_details_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>                <span class="p">[</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>                    <span class="sa">f</span><span class="s2">&quot;| **`name`** | </span><span class="si">{</span><span class="n">format_for_md</span><span class="p">(</span><span class="n">case_name</span><span class="p">)</span><span class="si">}</span><span class="s2"> | 本次分析案例的名称。 |&quot;</span><span class="p">,</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>                    <span class="sa">f</span><span class="s2">&quot;| **`independent_variable`** | </span><span class="si">{</span><span class="n">format_for_md</span><span class="p">(</span><span class="n">independent_variable</span><span class="p">)</span><span class="si">}</span><span class="s2"> | 独立扫描变量，即本次分析中主要改变的参数。 |&quot;</span><span class="p">,</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>                    <span class="sa">f</span><span class="s2">&quot;| **`independent_variable_sampling`** | </span><span class="si">{</span><span class="n">format_for_md</span><span class="p">(</span><span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;independent_variable_sampling&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2"> | 独立变量的采样方法和范围。 |&quot;</span><span class="p">,</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>                <span class="p">]</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="p">)</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="k">if</span> <span class="s2">&quot;default_independent_values&quot;</span> <span class="ow">in</span> <span class="n">case_data</span><span class="p">:</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>                <span class="n">config_details_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>                    <span class="sa">f</span><span class="s2">&quot;| **`default_independent_values`** | </span><span class="si">{</span><span class="n">format_for_md</span><span class="p">(</span><span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;default_independent_values&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> | 独立扫描变量在模型中的原始默认值。 |&quot;</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>                <span class="p">)</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>            <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>                <span class="s2">&quot;simulation_parameters&quot;</span> <span class="ow">in</span> <span class="n">case_data</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>                <span class="ow">and</span> <span class="n">case_data</span><span class="p">[</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">]</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>            <span class="p">):</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>                <span class="n">config_details_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>                    <span class="sa">f</span><span class="s2">&quot;| **`simulation_parameters`** | </span><span class="si">{</span><span class="n">format_for_md</span><span class="p">(</span><span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;simulation_parameters&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> | 背景扫描参数，与独立变量组合形成多维扫描。 |&quot;</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>                <span class="p">)</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>            <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                <span class="s2">&quot;default_simulation_values&quot;</span> <span class="ow">in</span> <span class="n">case_data</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>                <span class="ow">and</span> <span class="n">case_data</span><span class="p">[</span><span class="s2">&quot;default_simulation_values&quot;</span><span class="p">]</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>            <span class="p">):</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>                <span class="n">config_details_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>                    <span class="sa">f</span><span class="s2">&quot;| **`default_simulation_values`** | </span><span class="si">{</span><span class="n">format_for_md</span><span class="p">(</span><span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;default_simulation_values&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> | 背景扫描参数在模型中的原始默认值。 |&quot;</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>                <span class="p">)</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>            <span class="n">config_details_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>                <span class="sa">f</span><span class="s2">&quot;| **`dependent_variables`** | </span><span class="si">{</span><span class="n">format_for_md</span><span class="p">(</span><span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dependent_variables&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2"> | 因变量，即我们关心的、随自变量变化的性能指标。 |&quot;</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>            <span class="p">)</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="n">config_details_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>            <span class="n">prompt_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">config_details_lines</span><span class="p">)</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>            <span class="n">optimization_metrics</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>                <span class="n">v</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependent_variables&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Required_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>            <span class="p">]</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>            <span class="k">if</span> <span class="n">optimization_metrics</span><span class="p">:</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>                <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">optimization_metrics</span><span class="p">:</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>                    <span class="n">metric_config</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>                        <span class="n">original_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>                        <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metrics_definition&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>                        <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">)</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>                    <span class="p">)</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>                    <span class="k">if</span> <span class="n">metric_config</span><span class="p">:</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>                        <span class="n">details_lines</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>                            <span class="sa">f</span><span class="s2">&quot;## “</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">”优化配置</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>                            <span class="sa">f</span><span class="s2">&quot;当“</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">”作为因变量时，系统会启用一个二分查找算法来寻找满足特定性能指标的最小`</span><span class="si">{</span><span class="n">metric_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameter_to_optimize&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">`值。以下是本次优化任务的具体配置：</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>                            <span class="s2">&quot;| 配置项 | 值 | 说明 |&quot;</span><span class="p">,</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>                            <span class="s2">&quot;| :--- | :--- | :--- |&quot;</span><span class="p">,</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>                        <span class="p">]</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>                        <span class="n">config_map</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>                            <span class="s2">&quot;source_column&quot;</span><span class="p">:</span> <span class="s2">&quot;限制条件的数据源列。&quot;</span><span class="p">,</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>                            <span class="s2">&quot;parameter_to_optimize&quot;</span><span class="p">:</span> <span class="s2">&quot;优化的目标参数。&quot;</span><span class="p">,</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>                            <span class="s2">&quot;search_range&quot;</span><span class="p">:</span> <span class="s2">&quot;参数的搜索范围。&quot;</span><span class="p">,</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>                            <span class="s2">&quot;tolerance&quot;</span><span class="p">:</span> <span class="s2">&quot;搜索的收敛精度。&quot;</span><span class="p">,</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>                            <span class="s2">&quot;max_iterations&quot;</span><span class="p">:</span> <span class="s2">&quot;最大迭代次数。&quot;</span><span class="p">,</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>                            <span class="s2">&quot;metric_name&quot;</span><span class="p">:</span> <span class="s2">&quot;限制条件的性能指标。&quot;</span><span class="p">,</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>                            <span class="s2">&quot;metric_max_value&quot;</span><span class="p">:</span> <span class="s2">&quot;限制条件满足的上限值。（hour）&quot;</span><span class="p">,</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>                        <span class="p">}</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">config_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metric_config</span><span class="p">:</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>                                <span class="n">value</span> <span class="o">=</span> <span class="n">metric_config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>                                <span class="n">details_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>                                    <span class="sa">f</span><span class="s2">&quot;| **`</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`** | </span><span class="si">{</span><span class="n">format_for_md</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2"> |&quot;</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>                                <span class="p">)</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>                            <span class="n">metric_config_sim</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>                                <span class="s2">&quot;simulation_parameters&quot;</span><span class="p">,</span> <span class="p">{}</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>                            <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Required_TBR&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>                            <span class="k">if</span> <span class="n">metric_config_sim</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metric_config_sim</span><span class="p">:</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>                                <span class="n">value</span> <span class="o">=</span> <span class="n">metric_config_sim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>                                <span class="n">details_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>                                    <span class="sa">f</span><span class="s2">&quot;| **`</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> (from simulation_parameters)`** | </span><span class="si">{</span><span class="n">format_for_md</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2"> |&quot;</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>                                <span class="p">)</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>                        <span class="n">details_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>                        <span class="n">prompt_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">details_lines</span><span class="p">)</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>            <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">sweep_plots</span><span class="p">:</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>                <span class="n">prompt_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>                    <span class="p">[</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>                        <span class="s2">&quot;## SDS Inventory 的时间曲线图:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>                        <span class="sa">f</span><span class="s2">&quot;![SDS Inventory 的时间曲线图](</span><span class="si">{</span><span class="n">plot</span><span class="si">}</span><span class="s2">)</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>                    <span class="p">]</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>                <span class="p">)</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>                <span class="k">if</span> <span class="s2">&quot;default_simulation_values&quot;</span> <span class="ow">in</span> <span class="n">case_data</span> <span class="ow">and</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>                    <span class="s2">&quot;default_simulation_values&quot;</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>                <span class="p">):</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>                    <span class="n">default_values_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>                        <span class="n">case_data</span><span class="p">[</span><span class="s2">&quot;default_simulation_values&quot;</span><span class="p">],</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>                        <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>                        <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>                    <span class="p">)</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>                    <span class="n">note</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>                        <span class="s2">&quot;**筛选说明**：当存在多个背景扫描参数 (`simulation_parameters`) 时，为突出重点，上图默认仅显示与原始默认值 &quot;</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>                        <span class="sa">f</span><span class="s2">&quot;(`default_simulation_values`) 相匹配的基准情景曲线。本次分析中用于筛选的默认值为：</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>                        <span class="sa">f</span><span class="s2">&quot;```json</span><span class="se">\n</span><span class="si">{</span><span class="n">default_values_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">```</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>                        <span class="s2">&quot;此方法有助于在固定的基准条件下，清晰地观察独立变量变化带来的影响。</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>                    <span class="p">)</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>                    <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>            <span class="k">if</span> <span class="n">combined_plots</span><span class="p">:</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>                <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">combined_plots</span><span class="p">:</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>                    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;性能指标趋势曲线图&quot;</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                    <span class="n">prompt_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;![</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">plot</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">])</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>            <span class="k">elif</span> <span class="n">standard_individual_plots</span><span class="p">:</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>                <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;## 性能指标分析图</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>                <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">standard_individual_plots</span><span class="p">:</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>                    <span class="n">title</span> <span class="o">=</span> <span class="n">_format_label</span><span class="p">(</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">plot</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;line_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                    <span class="p">)</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                    <span class="n">prompt_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;### </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;![</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">plot</span><span class="si">}</span><span class="s2">)</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">])</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>            <span class="k">if</span> <span class="n">multi_metric_plots</span> <span class="ow">or</span> <span class="n">required_individual_plots</span><span class="p">:</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>                <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;## 约束求解性能指标分析图</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>                <span class="k">for</span> <span class="n">plot_file</span> <span class="ow">in</span> <span class="n">multi_metric_plots</span><span class="p">:</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                        <span class="n">base_metric_name</span> <span class="o">=</span> <span class="n">plot_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;multi_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                            <span class="s2">&quot;_analysis_by_param.svg&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                        <span class="p">)</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                        <span class="n">friendly_name</span> <span class="o">=</span> <span class="n">_format_label</span><span class="p">(</span><span class="n">base_metric_name</span><span class="p">)</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>                        <span class="n">friendly_name</span> <span class="o">=</span> <span class="s2">&quot;Optimization&quot;</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>                    <span class="n">prompt_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>                        <span class="p">[</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>                            <span class="sa">f</span><span class="s2">&quot;### 不同约束值下的“</span><span class="si">{</span><span class="n">friendly_name</span><span class="si">}</span><span class="s2">”分析 (按参数分组)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>                            <span class="sa">f</span><span class="s2">&quot;下图展示了“</span><span class="si">{</span><span class="n">friendly_name</span><span class="si">}</span><span class="s2">”指标随独立变量变化的趋势。每个子图对应一组特定的背景扫描参数组合，子图内的每条曲线代表一个具体的约束值。</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>                            <span class="sa">f</span><span class="s2">&quot;![不同约束值下的</span><span class="si">{</span><span class="n">friendly_name</span><span class="si">}</span><span class="s2">分析](</span><span class="si">{</span><span class="n">plot_file</span><span class="si">}</span><span class="s2">)</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>                        <span class="p">]</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>                    <span class="p">)</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>                <span class="k">for</span> <span class="n">plot_file</span> <span class="ow">in</span> <span class="n">required_individual_plots</span><span class="p">:</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>                    <span class="n">title</span> <span class="o">=</span> <span class="n">_format_label</span><span class="p">(</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">plot_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;line_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>                    <span class="p">)</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>                    <span class="n">prompt_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>                        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;### </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;![</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">plot_file</span><span class="si">}</span><span class="s2">)</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">]</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>                    <span class="p">)</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">_format_df_to_md</span><span class="p">(</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>                <span class="n">sub_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>                <span class="n">ind_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>                <span class="n">case_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>                <span class="n">current_unit_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>            <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>                <span class="k">if</span> <span class="n">sub_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>                    <span class="k">return</span> <span class="s2">&quot;无数据。&quot;</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>                <span class="n">all_markdown_lines</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>                <span class="n">all_cols</span> <span class="o">=</span> <span class="n">sub_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>                <span class="k">if</span> <span class="n">ind_var</span> <span class="ow">in</span> <span class="n">all_cols</span><span class="p">:</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>                    <span class="n">all_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ind_var</span><span class="p">)</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>                <span class="n">standard_cols</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>                    <span class="n">c</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">all_cols</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Required_&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;_for_Required_&quot;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>                <span class="p">]</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>                <span class="n">required_groups</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>                <span class="n">required_base_names</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>                    <span class="n">v</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependent_variables&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>                    <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Required_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>                <span class="p">]</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>                <span class="k">for</span> <span class="n">base_name</span> <span class="ow">in</span> <span class="n">required_base_names</span><span class="p">:</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>                    <span class="n">group_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>                    <span class="c1"># pattern = re.compile(f&quot;_for_{re.escape(base_name)}(?:\\(.*\\))?$&quot;)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">all_cols</span><span class="p">:</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>                        <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="n">base_name</span> <span class="ow">or</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">base_name</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span><span class="p">):</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>                            <span class="n">group_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>                    <span class="k">if</span> <span class="n">group_cols</span><span class="p">:</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>                        <span class="n">required_groups</span><span class="p">[</span><span class="n">base_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_cols</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>                <span class="k">def</span><span class="w"> </span><span class="nf">_format_slice_to_md</span><span class="p">(</span><span class="n">df_slice</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">umap</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>                    <span class="k">if</span> <span class="n">df_slice</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>                        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>                    <span class="n">df_formatted</span> <span class="o">=</span> <span class="n">df_slice</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>                    <span class="n">new_columns</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>                    <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">df_formatted</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>                        <span class="n">unit_config</span> <span class="o">=</span> <span class="n">_find_unit_config</span><span class="p">(</span><span class="n">col_name</span><span class="p">,</span> <span class="n">umap</span><span class="p">)</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>                        <span class="n">new_col_name</span> <span class="o">=</span> <span class="n">_format_label</span><span class="p">(</span><span class="n">col_name</span><span class="p">)</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>                        <span class="k">if</span> <span class="n">unit_config</span><span class="p">:</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>                            <span class="n">unit</span> <span class="o">=</span> <span class="n">unit_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">)</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>                            <span class="n">factor</span> <span class="o">=</span> <span class="n">unit_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;conversion_factor&quot;</span><span class="p">)</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>                            <span class="k">if</span> <span class="n">factor</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>                                <span class="n">df_formatted</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>                            <span class="p">):</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>                                <span class="n">df_formatted</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_formatted</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>                                    <span class="n">factor</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>                                <span class="p">)</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>                            <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>                                <span class="n">new_col_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_col_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>                        <span class="n">new_columns</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_col_name</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>                    <span class="n">df_formatted</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">new_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>                    <span class="n">format_map</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>                    <span class="k">for</span> <span class="n">original_col_name</span> <span class="ow">in</span> <span class="n">df_slice</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>                        <span class="k">if</span> <span class="n">original_col_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Required_&quot;</span><span class="p">):</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>                            <span class="n">format_map</span><span class="p">[</span><span class="n">new_columns</span><span class="p">[</span><span class="n">original_col_name</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.4f}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>                    <span class="n">default_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_formatted</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>                        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span><span class="n">df_formatted</span><span class="p">[</span><span class="n">col</span><span class="p">]):</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>                            <span class="n">formatter</span> <span class="o">=</span> <span class="n">format_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">default_format</span><span class="p">)</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>                            <span class="n">df_formatted</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_formatted</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>                                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>                            <span class="p">)</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>                    <span class="k">return</span> <span class="n">df_formatted</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>                <span class="k">if</span> <span class="n">standard_cols</span><span class="p">:</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>                    <span class="n">all_markdown_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;##### 性能指标</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>                    <span class="n">std_df_slice</span> <span class="o">=</span> <span class="n">sub_df</span><span class="p">[[</span><span class="n">ind_var</span><span class="p">]</span> <span class="o">+</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">standard_cols</span><span class="p">)]</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>                    <span class="n">all_markdown_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>                        <span class="n">_format_slice_to_md</span><span class="p">(</span><span class="n">std_df_slice</span><span class="p">,</span> <span class="n">current_unit_map</span><span class="p">)</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>                    <span class="p">)</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>                    <span class="n">all_markdown_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>                <span class="k">if</span> <span class="n">required_groups</span><span class="p">:</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>                    <span class="k">for</span> <span class="n">base_name</span><span class="p">,</span> <span class="n">cols</span> <span class="ow">in</span> <span class="n">required_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>                        <span class="n">existing_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">sub_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_cols</span><span class="p">:</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>                            <span class="k">continue</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>                        <span class="n">all_markdown_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>                            <span class="sa">f</span><span class="s2">&quot;##### “</span><span class="si">{</span><span class="n">_format_label</span><span class="p">(</span><span class="n">base_name</span><span class="p">)</span><span class="si">}</span><span class="s2">” 相关数据</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>                        <span class="p">)</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>                        <span class="n">req_df_slice</span> <span class="o">=</span> <span class="n">sub_df</span><span class="p">[[</span><span class="n">ind_var</span><span class="p">]</span> <span class="o">+</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">existing_cols</span><span class="p">)]</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>                        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>                            <span class="c1"># --- PIVOT LOGIC to transform data from wide to long format ---</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>                            <span class="c1"># e.g., from [A, B(v1), B(v2)] to [A, new_col, B]</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                            <span class="c1"># Columns to unpivot, e.g., [&#39;Required_TBR(7.0)&#39;, &#39;Required_TBR(10.0)&#39;]</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>                            <span class="n">value_vars</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>                                <span class="n">c</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>                                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">req_df_slice</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>                                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">base_name</span><span class="p">)</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>                                <span class="ow">and</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">c</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>                                <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>                            <span class="p">]</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>                            <span class="c1"># If no columns are in the format B(v), pivot is not applicable.</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">value_vars</span><span class="p">:</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>                                <span class="n">all_markdown_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>                                    <span class="n">_format_slice_to_md</span><span class="p">(</span><span class="n">req_df_slice</span><span class="p">,</span> <span class="n">current_unit_map</span><span class="p">)</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>                                <span class="p">)</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>                                <span class="n">all_markdown_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>                                <span class="k">continue</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>                            <span class="c1"># Melt the dataframe from wide to long format</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>                            <span class="n">melted_df</span> <span class="o">=</span> <span class="n">req_df_slice</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>                                <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="n">ind_var</span><span class="p">],</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>                                <span class="n">value_vars</span><span class="o">=</span><span class="n">value_vars</span><span class="p">,</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>                                <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;variable_col&quot;</span><span class="p">,</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>                                <span class="n">value_name</span><span class="o">=</span><span class="n">base_name</span><span class="p">,</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>                            <span class="p">)</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>                            <span class="c1"># Determine the name for the new column from config (e.g., &#39;Doubling_Time&#39;)</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>                            <span class="n">new_col_name</span> <span class="o">=</span> <span class="s2">&quot;Constraint&quot;</span>  <span class="c1"># Default name</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>                            <span class="n">metric_def</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>                                <span class="s2">&quot;Required_TBR&quot;</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>                            <span class="p">)</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>                            <span class="k">if</span> <span class="n">metric_def</span> <span class="ow">and</span> <span class="n">metric_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metric_name&quot;</span><span class="p">):</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>                                <span class="n">new_col_name</span> <span class="o">=</span> <span class="s2">&quot;Constraint &quot;</span> <span class="o">+</span> <span class="n">metric_def</span><span class="p">[</span><span class="s2">&quot;metric_name&quot;</span><span class="p">]</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>                            <span class="c1"># Extract constraint value from old column name, e.g., &#39;7.0&#39; from &#39;Required_TBR(7.0)&#39;</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>                            <span class="n">pattern_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">base_name</span><span class="p">)</span><span class="si">}</span><span class="se">\\</span><span class="s2">((.*)</span><span class="se">\\</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>                            <span class="n">melted_df</span><span class="p">[</span><span class="n">new_col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">melted_df</span><span class="p">[</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>                                <span class="s2">&quot;variable_col&quot;</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>                            <span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="n">pattern_str</span><span class="p">)</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>                            <span class="c1"># Create the final dataframe with the desired columns: [A, new_col, B]</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>                            <span class="n">final_df</span> <span class="o">=</span> <span class="n">melted_df</span><span class="p">[</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>                                <span class="p">[</span><span class="n">ind_var</span><span class="p">,</span> <span class="n">new_col_name</span><span class="p">,</span> <span class="n">base_name</span><span class="p">]</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>                            <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>                            <span class="n">final_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">base_name</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>                            <span class="n">all_markdown_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_df</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>                            <span class="n">all_markdown_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>                                <span class="sa">f</span><span class="s2">&quot;Could not pivot data for &#39;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">&#39;, displaying in wide format. Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>                            <span class="p">)</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>                            <span class="n">all_markdown_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>                                <span class="n">_format_slice_to_md</span><span class="p">(</span><span class="n">req_df_slice</span><span class="p">,</span> <span class="n">current_unit_map</span><span class="p">)</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>                            <span class="p">)</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>                            <span class="n">all_markdown_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>                <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">all_markdown_lines</span><span class="p">)</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>            <span class="n">reference_col_for_turning_point</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>            <span class="k">if</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sweep_time&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">sweep_csv_path</span><span class="p">):</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading sweep_results.csv for dynamic slicing.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                    <span class="n">sweep_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">sweep_csv_path</span><span class="p">)</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>                    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">sweep_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sweep_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>                        <span class="n">reference_col_for_turning_point</span> <span class="o">=</span> <span class="n">sweep_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>                            <span class="nb">len</span><span class="p">(</span><span class="n">sweep_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>                        <span class="p">]</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>                    <span class="k">if</span> <span class="n">reference_col_for_turning_point</span><span class="p">:</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>                        <span class="n">data_to_slice_df</span> <span class="o">=</span> <span class="n">sweep_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>                        <span class="n">data_to_slice_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_to_slice_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>                            <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;## 关键动态数据切片：过程数据</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>                            <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>                                <span class="sa">f</span><span class="s2">&quot;下表展示了过程数据中，以 `</span><span class="si">{</span><span class="n">reference_col_for_turning_point</span><span class="si">}</span><span class="s2">` 为参考变量，在关键阶段的数据切片。**注意：下表中的默认单位为：时间(h), 库存(g), 功率(MW)。**</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>                            <span class="p">)</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>                            <span class="n">base_var_name</span> <span class="o">=</span> <span class="n">reference_col_for_turning_point</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)[</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>                                <span class="mi">0</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>                            <span class="p">]</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>                            <span class="n">cols_to_rename</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>                                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data_to_slice_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;time&quot;</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>                            <span class="p">]</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>                            <span class="n">rename_map</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>                                <span class="n">col</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols_to_rename</span><span class="p">)</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>                            <span class="p">}</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>                            <span class="n">legend_lines</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>                                <span class="s2">&quot;**表格图例说明**：&quot;</span><span class="p">,</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>                                <span class="s2">&quot;| 简称 | 参数组合 |&quot;</span><span class="p">,</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>                                <span class="s2">&quot;| :--- | :--- |&quot;</span><span class="p">,</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>                            <span class="p">]</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>                            <span class="k">for</span> <span class="n">original_name</span><span class="p">,</span> <span class="n">abbr</span> <span class="ow">in</span> <span class="n">rename_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>                                <span class="n">param_parts</span> <span class="o">=</span> <span class="n">original_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>                                <span class="n">param_str</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>                                    <span class="n">param_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;无&quot;</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>                                <span class="p">)</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>                                <span class="n">param_str_formatted</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>                                    <span class="s2">&quot;`&quot;</span> <span class="o">+</span> <span class="s2">&quot;`, `&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">param_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;`&quot;</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>                                <span class="p">)</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>                                <span class="n">legend_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>                                    <span class="sa">f</span><span class="s2">&quot;| **</span><span class="si">{</span><span class="n">abbr</span><span class="si">}</span><span class="s2">** | </span><span class="si">{</span><span class="n">param_str_formatted</span><span class="si">}</span><span class="s2"> |&quot;</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>                                <span class="p">)</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>                            <span class="n">base_var_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;**注**：表格中所有简称列（C1, C2, ...）的数据均代表变量 `</span><span class="si">{</span><span class="n">base_var_name</span><span class="si">}</span><span class="s2">` 在不同参数组合下的值。</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>                            <span class="n">legend_md</span> <span class="o">=</span> <span class="n">base_var_info</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">legend_lines</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>                            <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">legend_md</span><span class="p">)</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>                            <span class="n">primary_y_var</span> <span class="o">=</span> <span class="n">reference_col_for_turning_point</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>                            <span class="n">min_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>                            <span class="k">if</span> <span class="n">primary_y_var</span> <span class="ow">in</span> <span class="n">data_to_slice_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>                                <span class="n">y_data</span> <span class="o">=</span> <span class="n">data_to_slice_df</span><span class="p">[</span><span class="n">primary_y_var</span><span class="p">]</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>                                <span class="k">if</span> <span class="ow">not</span> <span class="n">y_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>                                    <span class="n">min_idx</span> <span class="o">=</span> <span class="n">y_data</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>                            <span class="n">num_points</span><span class="p">,</span> <span class="n">interval</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>                            <span class="n">window_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">interval</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>                            <span class="n">start_data</span> <span class="o">=</span> <span class="n">data_to_slice_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">window_size</span><span class="p">:</span><span class="n">interval</span><span class="p">]</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>                            <span class="n">end_data</span> <span class="o">=</span> <span class="n">data_to_slice_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">window_size</span><span class="p">)::</span><span class="n">interval</span><span class="p">]</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>                            <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>                                <span class="sa">f</span><span class="s2">&quot;### 1. 初始阶段 (前 </span><span class="si">{</span><span class="n">num_points</span><span class="si">}</span><span class="s2"> 个数据点, 间隔 </span><span class="si">{</span><span class="n">interval</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>                            <span class="p">)</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>                            <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>                                <span class="n">start_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename_map</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>                                    <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>                                <span class="p">)</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>                                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>                            <span class="p">)</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>                            <span class="k">if</span> <span class="n">min_idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>                                <span class="n">window_radius_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">interval</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>                                <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">min_idx</span> <span class="o">-</span> <span class="n">window_radius_indices</span><span class="p">)</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>                                <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>                                    <span class="nb">len</span><span class="p">(</span><span class="n">data_to_slice_df</span><span class="p">),</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>                                    <span class="n">min_idx</span> <span class="o">+</span> <span class="n">window_radius_indices</span><span class="p">,</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>                                <span class="p">)</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>                                <span class="n">turning_point_data</span> <span class="o">=</span> <span class="n">data_to_slice_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>                                    <span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">:</span><span class="n">interval</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>                                <span class="p">]</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>                                <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>                                    <span class="sa">f</span><span class="s2">&quot;### 2. 转折点阶段 (围绕 &#39;</span><span class="si">{</span><span class="n">primary_y_var</span><span class="si">}</span><span class="s2">&#39; 最小值)</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>                                <span class="p">)</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>                                <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>                                    <span class="n">turning_point_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>                                        <span class="n">columns</span><span class="o">=</span><span class="n">rename_map</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>                                    <span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>                                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>                                <span class="p">)</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>                            <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>                                <span class="sa">f</span><span class="s2">&quot;### 3. 结束阶段 (后 </span><span class="si">{</span><span class="n">num_points</span><span class="si">}</span><span class="s2"> 个数据点, 间隔 </span><span class="si">{</span><span class="n">interval</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>                            <span class="p">)</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>                            <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>                                <span class="n">end_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename_map</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>                                    <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>                                <span class="p">)</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>                                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>                            <span class="p">)</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>                        <span class="sa">f</span><span class="s2">&quot;Could not generate dynamic data slices for case </span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>                    <span class="p">)</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>            <span class="n">grouping_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default_simulation_values&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">grouping_vars</span><span class="p">:</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>                <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;## 性能指标总表</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>                <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>                    <span class="n">_format_df_to_md</span><span class="p">(</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>                        <span class="n">summary_df</span><span class="p">,</span> <span class="n">independent_variable</span><span class="p">,</span> <span class="n">case_data</span><span class="p">,</span> <span class="n">unit_map</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>                    <span class="p">)</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>                <span class="p">)</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>                <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>                    <span class="sa">f</span><span class="s2">&quot;## 性能指标总表 (分组: `</span><span class="si">{</span><span class="s1">&#39;`, `&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">grouping_vars</span><span class="p">)</span><span class="si">}</span><span class="s2">`)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>                <span class="p">)</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>                <span class="n">groups</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">summary_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">grouping_vars</span><span class="p">)))</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>                <span class="n">default_values</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default_simulation_values&quot;</span><span class="p">)</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>                <span class="n">default_group_key</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>                <span class="k">if</span> <span class="n">default_values</span><span class="p">:</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>                        <span class="n">default_group_key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                            <span class="n">default_values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">grouping_vars</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                            <span class="s2">&quot;Mismatch between default_simulation_values and grouping_vars. Cannot find default group.&quot;</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>                        <span class="n">default_group_key</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>                <span class="k">if</span> <span class="n">default_group_key</span> <span class="ow">and</span> <span class="n">default_group_key</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                    <span class="n">default_group_df</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">default_group_key</span><span class="p">)</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>                    <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot; &amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>                        <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">`&quot;</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>                        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grouping_vars</span><span class="p">,</span> <span class="n">default_group_key</span><span class="p">)</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>                    <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;#### 数据子表 (原始默认值: </span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>                    <span class="n">sub_df_to_format</span> <span class="o">=</span> <span class="n">default_group_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>                        <span class="n">columns</span><span class="o">=</span><span class="n">grouping_vars</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>                    <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>                        <span class="n">_format_df_to_md</span><span class="p">(</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>                            <span class="n">sub_df_to_format</span><span class="p">,</span> <span class="n">independent_variable</span><span class="p">,</span> <span class="n">case_data</span><span class="p">,</span> <span class="n">unit_map</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>                    <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">---</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>                <span class="k">if</span> <span class="n">groups</span><span class="p">:</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>                    <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&gt; 其他参数组合下的数据子表：</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>                <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">group_df</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>                    <span class="n">header</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>                        <span class="s2">&quot; &amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>                            <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">`&quot;</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>                            <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grouping_vars</span><span class="p">,</span> <span class="n">group_name</span><span class="p">)</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>                        <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">grouping_vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">`&quot;</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>                    <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;#### 数据子表 (当 </span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2"> 时)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>                    <span class="n">sub_df_to_format</span> <span class="o">=</span> <span class="n">group_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>                        <span class="n">columns</span><span class="o">=</span><span class="n">grouping_vars</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>                    <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>                        <span class="n">_format_df_to_md</span><span class="p">(</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>                            <span class="n">sub_df_to_format</span><span class="p">,</span> <span class="n">independent_variable</span><span class="p">,</span> <span class="n">case_data</span><span class="p">,</span> <span class="n">unit_map</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>                    <span class="n">prompt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>            <span class="n">base_report_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt_lines</span><span class="p">)</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>            <span class="c1"># --- AI Analysis and Report Writing ---</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ai&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>                <span class="c1"># AI is off: write a single, simple report</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>                <span class="n">report_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>                    <span class="n">case_results_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;analysis_report_</span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">.md&quot;</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>                <span class="p">)</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">base_report_content</span><span class="p">)</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>                    <span class="sa">f</span><span class="s2">&quot;Detailed analysis report generated for </span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">report_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>                <span class="p">)</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>                <span class="k">continue</span>  <span class="c1"># Go to next case</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>            <span class="c1"># AI is ON: go into multi-model logic</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>            <span class="n">load_dotenv</span><span class="p">()</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>            <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;API_KEY&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>            <span class="n">base_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;BASE_URL&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>            <span class="n">ai_models_str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;AI_MODELS&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ai_models_str</span><span class="p">:</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>                <span class="n">ai_models_str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;AI_MODEL&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">((</span><span class="n">api_key</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">ai_models_str</span><span class="p">)):</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>                    <span class="s2">&quot;API_KEY, BASE_URL, or AI_MODELS/AI_MODEL not found in environment variables. Skipping LLM analysis.&quot;</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>                <span class="p">)</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>                <span class="c1"># Also write the base report here so something is generated</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>                <span class="n">report_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>                    <span class="n">case_results_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;analysis_report_</span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">.md&quot;</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>                <span class="p">)</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">base_report_content</span><span class="p">)</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>                    <span class="sa">f</span><span class="s2">&quot;Wrote base report for </span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2"> because AI credentials were not found: </span><span class="si">{</span><span class="n">report_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>                <span class="p">)</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>            <span class="n">ai_models</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">ai_models_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>            <span class="k">for</span> <span class="n">ai_model</span> <span class="ow">in</span> <span class="n">ai_models</span><span class="p">:</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>                    <span class="sa">f</span><span class="s2">&quot;Generating AI analysis for case &#39;</span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">&#39; with model &#39;</span><span class="si">{</span><span class="n">ai_model</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>                <span class="p">)</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                <span class="n">sanitized_model_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>                    <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ai_model</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>                <span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>                <span class="n">model_report_filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>                    <span class="sa">f</span><span class="s2">&quot;analysis_report_</span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">sanitized_model_name</span><span class="si">}</span><span class="s2">.md&quot;</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>                <span class="p">)</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>                <span class="n">model_report_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>                    <span class="n">case_results_dir</span><span class="p">,</span> <span class="n">model_report_filename</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>                <span class="p">)</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_report_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">base_report_content</span><span class="p">)</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>                    <span class="sa">f</span><span class="s2">&quot;Generated base report for model </span><span class="si">{</span><span class="n">ai_model</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">model_report_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>                <span class="p">)</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>                <span class="n">llm_analysis</span> <span class="o">=</span> <span class="n">call_openai_analysis_api</span><span class="p">(</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>                    <span class="n">case_name</span><span class="o">=</span><span class="n">case_name</span><span class="p">,</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>                    <span class="n">df</span><span class="o">=</span><span class="n">summary_df</span><span class="p">,</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>                    <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>                    <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>                    <span class="n">ai_model</span><span class="o">=</span><span class="n">ai_model</span><span class="p">,</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>                    <span class="n">independent_variable</span><span class="o">=</span><span class="n">independent_variable</span><span class="p">,</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>                    <span class="n">report_content</span><span class="o">=</span><span class="n">base_report_content</span><span class="p">,</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>                    <span class="n">original_config</span><span class="o">=</span><span class="n">original_config</span><span class="p">,</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>                    <span class="n">case_data</span><span class="o">=</span><span class="n">case_data</span><span class="p">,</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>                    <span class="n">reference_col_for_turning_point</span><span class="o">=</span><span class="n">reference_col_for_turning_point</span><span class="p">,</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>                <span class="p">)</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>                <span class="k">if</span> <span class="n">llm_analysis</span><span class="p">:</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_report_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">---</span><span class="se">\n\n</span><span class="s2"># AI模型分析提示词 (</span><span class="si">{</span><span class="n">ai_model</span><span class="si">}</span><span class="s2">)</span><span class="se">\n\n</span><span class="s2">```markdown</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">llm_analysis</span><span class="p">)</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">```</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Appended LLM analysis to </span><span class="si">{</span><span class="n">model_report_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>                    <span class="n">generate_sensitivity_academic_report</span><span class="p">(</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>                        <span class="n">case_name</span><span class="o">=</span><span class="n">case_name</span><span class="p">,</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>                        <span class="n">case_workspace</span><span class="o">=</span><span class="n">case_workspace</span><span class="p">,</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>                        <span class="n">independent_variable</span><span class="o">=</span><span class="n">independent_variable</span><span class="p">,</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>                        <span class="n">original_config</span><span class="o">=</span><span class="n">original_config</span><span class="p">,</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>                        <span class="n">case_data</span><span class="o">=</span><span class="n">case_data</span><span class="p">,</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>                        <span class="n">ai_model</span><span class="o">=</span><span class="n">ai_model</span><span class="p">,</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>                        <span class="n">report_path</span><span class="o">=</span><span class="n">model_report_path</span><span class="p">,</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error generating detailed analysis reports: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.report.generate_sensitivity_academic_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_sensitivity_academic_report</span><span class="p">(</span><span class="n">case_name</span><span class="p">,</span> <span class="n">case_workspace</span><span class="p">,</span> <span class="n">independent_variable</span><span class="p">,</span> <span class="n">original_config</span><span class="p">,</span> <span class="n">case_data</span><span class="p">,</span> <span class="n">ai_model</span><span class="p">,</span> <span class="n">report_path</span><span class="p">)</span></code>

<a href="#tricys.analysis.report.generate_sensitivity_academic_report" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generates a professional academic analysis summary for a sensitivity analysis case.</p>
<p>Sends the existing report and a glossary of terms to an LLM for academic formatting.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>case_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the analysis case.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>case_workspace</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the case workspace directory.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>independent_variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the independent variable.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_config</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original configuration dictionary.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>case_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Case-specific data dictionary.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ai_model</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model name to use for generating the report.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>report_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the existing report file.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Requires report file and glossary file to exist. Loads API credentials from
environment variables. Generates academic report with proper structure including
title, abstract, introduction, methodology, results &amp; discussion, and conclusion.
Retries up to 3 times on API failure. Saves result to academic_report_{case_name}_{model}.md.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/report.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_sensitivity_academic_report</span><span class="p">(</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="n">case_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="n">case_workspace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="n">independent_variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="n">original_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="n">case_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="n">ai_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="n">report_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a professional academic analysis summary for a sensitivity analysis case.</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    Sends the existing report and a glossary of terms to an LLM for academic formatting.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        case_name: Name of the analysis case.</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        case_workspace: Path to the case workspace directory.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        independent_variable: Name of the independent variable.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        original_config: Original configuration dictionary.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        case_data: Case-specific data dictionary.</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        ai_model: Model name to use for generating the report.</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        report_path: Path to the existing report file.</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        Requires report file and glossary file to exist. Loads API credentials from</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        environment variables. Generates academic report with proper structure including</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        title, abstract, introduction, methodology, results &amp; discussion, and conclusion.</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        Retries up to 3 times on API failure. Saves result to academic_report_{case_name}_{model}.md.</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="sa">f</span><span class="s2">&quot;Starting generation of the academic analysis summary for case </span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2"> with model </span><span class="si">{</span><span class="n">ai_model</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="p">)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="c1"># 1. Read the existing report</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">case_workspace</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">)</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="n">report_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">report_path</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">report_path</span><span class="p">):</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                <span class="sa">f</span><span class="s2">&quot;Cannot generate academic summary: Original report &#39;</span><span class="si">{</span><span class="n">report_path</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="k">return</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="n">original_report_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="c1"># 2. Read the glossary</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="n">glossary_path</span> <span class="o">=</span> <span class="n">original_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="s2">&quot;glossary_path&quot;</span><span class="p">,</span> <span class="s2">&quot;./sheets.csv&quot;</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="p">)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">glossary_path</span><span class="p">):</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                <span class="sa">f</span><span class="s2">&quot;Cannot generate academic summary: Glossary file &#39;</span><span class="si">{</span><span class="n">glossary_path</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="k">return</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">glossary_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="n">glossary_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="c1"># 3. Check for API credentials</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="n">load_dotenv</span><span class="p">()</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;API_KEY&quot;</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="n">base_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;BASE_URL&quot;</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">api_key</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">ai_model</span><span class="p">]):</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                <span class="s2">&quot;API_KEY, BASE_URL, or AI_MODEL not found. Skipping academic summary generation.&quot;</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="k">return</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="c1"># 4. Construct the prompt</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="n">role_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;**角色：** 您是一位在核聚变工程，特别是氚燃料循环领域，具有深厚学术背景的资深科学家。</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="s2">**任务：** 您收到了一个关于**敏感性分析**的程序自动生成的初步报告和一份专业术语表。请您基于这两份文件，撰写一份更加专业、正式、符合学术发表标准的深度分析总结报告。</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="c1"># Extract relevant details from case_data for the prompt</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">sampling_range</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;independent_variable_sampling&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">simulation_parameters</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="n">dependent_variables</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependent_variables&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="n">simulation_params_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="k">if</span> <span class="n">simulation_parameters</span><span class="p">:</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="n">params_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="c1"># Access metric definitions from the original config</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="n">metrics_definitions</span> <span class="o">=</span> <span class="n">original_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>                <span class="s2">&quot;metrics_definition&quot;</span><span class="p">,</span> <span class="p">{}</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="p">)</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">simulation_parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                <span class="c1"># Check if the parameter is a &#39;Required_&#39; metric and has configurations defined</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>                    <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Required_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                    <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">metrics_definitions</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                    <span class="ow">and</span> <span class="s2">&quot;configurations&quot;</span> <span class="ow">in</span> <span class="n">metrics_definitions</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                <span class="p">):</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                        <span class="n">metric_configs</span> <span class="o">=</span> <span class="n">metrics_definitions</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;configurations&quot;</span><span class="p">]</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                        <span class="c1"># Look up the metric_max_value for each configuration key in the scan list `v`</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>                        <span class="n">actual_values</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>                            <span class="n">metric_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">conf_name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>                                <span class="s2">&quot;metric_max_value&quot;</span><span class="p">,</span> <span class="n">conf_name</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>                            <span class="p">)</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>                            <span class="k">for</span> <span class="n">conf_name</span> <span class="ow">in</span> <span class="n">v</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                        <span class="p">]</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                        <span class="n">params_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">` (约束扫描值): </span><span class="si">{</span><span class="n">actual_values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                        <span class="c1"># If lookup fails for any reason, fall back to the original representation</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                        <span class="n">params_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">`: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                    <span class="c1"># For regular parameters</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                    <span class="n">params_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">`: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="n">simulation_params_str</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">        *   **背景扫描参数 (Simulation Parameters):** &quot;</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params_list</span><span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="p">)</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="n">dependent_vars_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="k">if</span> <span class="n">dependent_variables</span><span class="p">:</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="n">dependent_vars_str</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">        *   **因变量 (Dependent Variables):** &quot;</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">`&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dependent_variables</span><span class="p">])</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="p">)</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="c1"># Find all plots to instruct the LLM to include them, prioritizing Chinese versions</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="n">all_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">results_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.svg&quot;</span><span class="p">,</span> <span class="s2">&quot;.png&quot;</span><span class="p">))]</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="n">plot_map</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="c1"># Handle SVGs, prioritizing _zh versions</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="n">svg_plots</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.svg&quot;</span><span class="p">)],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">svg_plots</span><span class="p">:</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>            <span class="n">base_name</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_zh.svg&quot;</span><span class="p">,</span> <span class="s2">&quot;.svg&quot;</span><span class="p">)</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>            <span class="k">if</span> <span class="n">base_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_map</span><span class="p">:</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                <span class="n">plot_map</span><span class="p">[</span><span class="n">base_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="c1"># Add PNGs (which are not bilingual)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="n">png_plots</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">png_plots</span><span class="p">:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>            <span class="n">plot_map</span><span class="p">[</span><span class="n">plot</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot</span>  <span class="c1"># Use plot name as key for uniqueness</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">all_plots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">plot_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">plot_list_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;    *   `</span><span class="si">{</span><span class="n">plot</span><span class="si">}</span><span class="s2">`&quot;</span> <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">all_plots</span><span class="p">])</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="c1"># Dynamically build the &quot;Results and Discussion&quot; section for the prompt</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">results_and_discussion_points</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="c1"># 1. Main Effect Analysis (always included)</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="n">main_effect_text</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="sa">f</span><span class="s2">&quot;           *   **主效应分析：** 详细分析独立变量 **`</span><span class="si">{</span><span class="n">independent_variable</span><span class="si">}</span><span class="s2">`** 的变化对主要性能指标（如 `Startup_Inventory`, `Doubling_Time` 等）的总体影响趋势。&quot;</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="s2">&quot;评估不同指标对自变量变化的敏感度，并讨论指标间的**权衡关系 (Trade-offs)**。&quot;</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="n">results_and_discussion_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_effect_text</span><span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="c1"># 2. Interaction Effect Analysis (conditional)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="k">if</span> <span class="n">simulation_parameters</span><span class="p">:</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="n">interaction_text</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>                <span class="sa">f</span><span class="s2">&quot;           *   **交互效应分析：** 深入探讨独立变量与背景参数间的**交互效应**。&quot;</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                <span class="s2">&quot;背景参数可能包含常规的模型参数，也可能包含约束相关的变量（例如 `Required_TBR`）。&quot;</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>                <span class="sa">f</span><span class="s2">&quot;请阐述在不同的背景参数组合下，`</span><span class="si">{</span><span class="n">independent_variable</span><span class="si">}</span><span class="s2">` 对性能指标的敏感性是否存在显著差异（例如，是被放大还是减弱）。&quot;</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>                <span class="s2">&quot;请特别关注当独立变量与约束类背景参数交互时，对系统性能和达成工程目标的影响。&quot;</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>            <span class="n">results_and_discussion_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interaction_text</span><span class="p">)</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="c1"># 3. Dynamic Behavior Analysis (conditional)</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="k">if</span> <span class="s2">&quot;关键动态数据切片&quot;</span> <span class="ow">in</span> <span class="n">original_report_content</span><span class="p">:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>            <span class="n">dynamic_text</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>                <span class="sa">f</span><span class="s2">&quot;           *   **动态行为分析：** 解读系统在“初始”、“转折点”和“结束”阶段的行为变化。&quot;</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>                <span class="sa">f</span><span class="s2">&quot;分析 **`</span><span class="si">{</span><span class="n">independent_variable</span><span class="si">}</span><span class="s2">`** 的变化如何影响系统的动态过程，如达到平衡的时间、库存的转折点等。&quot;</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="p">)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="n">results_and_discussion_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dynamic_text</span><span class="p">)</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="n">results_and_discussion_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_and_discussion_points</span><span class="p">)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="c1"># Dynamically create the title instruction</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="k">if</span> <span class="n">simulation_parameters</span><span class="p">:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="n">title_instruction_text</span> <span class="o">=</span> <span class="s2">&quot;请在标题中明确指出，本次分析是关于“独立变量”与“背景扫描参数”的【交互敏感性分析】。&quot;</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="n">title_instruction_text</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                <span class="s2">&quot;请在标题中明确指出，本次分析是关于“独立变量”的【敏感性分析】。&quot;</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="n">instructions_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;**指令：**</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="s2">1.  **专业化语言：** 将初步报告中的模型参数/缩写（例如 `sds.I[1]`, `Startup_Inventory`）替换为术语表中对应的“中文翻译”或“英文术语”。例如，应将“`sds`的库存”表述为“储存与输送系统 (SDS) 的氚库存量 (Tritium Inventory)”。</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="s2">2.  **学术化重述：** 用严谨、客观的学术语言重新组织和阐述初步报告中的发现。避免使用“看起来”、“好像”等模糊词汇。</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="s2">3.  **图表和表格的呈现与引用：**</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="s2">    *   **显示图表：** 在报告的“结果与讨论”部分，您**必须**使用Markdown语法 `![图表标题](图表文件名)` 来**直接嵌入**和显示初步报告中包含的所有图表。可用的图表文件如下：</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="si">{</span><span class="n">plot_list_str</span><span class="si">}</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="s2">    *   **引用图表：** 在正文中分析和讨论图表内容时，请使用“如图1所示...”等方式对图表进行编号和文字引用。</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="s2">    *   **显示表格：** 当呈现数据时（例如，性能指标总表或关键动态数据切片），您**必须**使用Markdown的管道表格（pipe-table）格式来清晰地展示它们。您可以直接复用或重新格式化初步报告中的数据表格。</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="s2">4.  **结构化报告：** 您的报告是关于一项**敏感性分析**。报告应包含以下部分：</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="s2">    *   **标题 (Title):** </span><span class="si">{</span><span class="n">title_instruction_text</span><span class="si">}</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="s2">    *   **摘要 (Abstract):** 简要概括本次敏感性研究的目的，明确指明独立变量是 **`</span><span class="si">{</span><span class="n">independent_variable</span><span class="si">}</span><span class="s2">`** 以及背景扫描参数，总结其对哪些关键性能指标（如启动库存、增殖时间等）影响最显著，并陈述核心结论。</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="s2">    *   **引言 (Introduction):** 描述进行这项关于 **`</span><span class="si">{</span><span class="n">independent_variable</span><span class="si">}</span><span class="s2">`** 的敏感性分析的背景和重要性。阐述研究目标，即量化评估 **`</span><span class="si">{</span><span class="n">independent_variable</span><span class="si">}</span><span class="s2">`** 的变化对氚燃料循环系统性能的影响。</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="s2">        *   **独立变量采样 (Independent Variable Sampling):** 本次分析中，独立变量 `</span><span class="si">{</span><span class="n">independent_variable</span><span class="si">}</span><span class="s2">` 扫描范围为 `</span><span class="si">{</span><span class="n">sampling_range</span><span class="si">}</span><span class="s2">`。</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="si">{</span><span class="n">simulation_params_str</span><span class="si">}{</span><span class="n">dependent_vars_str</span><span class="si">}</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="s2">    *   **方法 (Methodology):** 简要说明分析方法，包括提及 **`</span><span class="si">{</span><span class="n">independent_variable</span><span class="si">}</span><span class="s2">`** 的扫描范围和被评估的关键性能指标。</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="s2">    *   **结果与讨论 (Results and Discussion):** 这是报告的核心。请结合所有图表和数据表格，并根据分析内容，组织分点详细论述：</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="si">{</span><span class="n">results_and_discussion_str</span><span class="si">}</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="s2">    *   **结论 (Conclusion):** 总结本次敏感性分析得出的主要学术结论，并对反应堆设计或未来运行策略提出具体建议。</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="s2">5.  **输出格式：** 请直接输出完整的学术分析报告正文，确保所有内容（包括图表和表格）都遵循正确的Markdown语法。</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="s2">**输入文件：**</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="n">analysis_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="s2">---</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="s2">### 1. 初步分析报告 (`</span><span class="si">{</span><span class="n">report_filename</span><span class="si">}</span><span class="s2">`)</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="s2">---</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="si">{</span><span class="n">original_report_content</span><span class="si">}</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="s2">---</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="s2">### 2. 专业术语表 (`sheets.csv`)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="s2">---</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="si">{</span><span class="n">glossary_content</span><span class="si">}</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="c1"># 5. Call the API</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>                <span class="n">client</span> <span class="o">=</span> <span class="n">openai</span><span class="o">.</span><span class="n">OpenAI</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">)</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                    <span class="sa">f</span><span class="s2">&quot;Sending request to OpenAI API for academic summary for case </span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2"> with model </span><span class="si">{</span><span class="n">ai_model</span><span class="si">}</span><span class="s2"> (Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2">)...&quot;</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                <span class="p">)</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                <span class="n">full_text_prompt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>                    <span class="p">[</span><span class="n">role_prompt</span><span class="p">,</span> <span class="n">instructions_prompt</span><span class="p">,</span> <span class="n">analysis_prompt</span><span class="p">]</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>                <span class="p">)</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>                    <span class="n">model</span><span class="o">=</span><span class="n">ai_model</span><span class="p">,</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>                    <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">full_text_prompt</span><span class="p">}],</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>                    <span class="n">max_tokens</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                <span class="p">)</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>                <span class="n">academic_summary</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>                <span class="c1"># 6. Save the result</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>                <span class="n">sanitized_model_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>                    <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ai_model</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                <span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                <span class="n">summary_filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                    <span class="sa">f</span><span class="s2">&quot;academic_report_</span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">sanitized_model_name</span><span class="si">}</span><span class="s2">.md&quot;</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                <span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>                <span class="n">summary_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">summary_filename</span><span class="p">)</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">summary_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">academic_summary</span><span class="p">)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>                    <span class="sa">f</span><span class="s2">&quot;Successfully generated academic analysis summary: </span><span class="si">{</span><span class="n">summary_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>                <span class="p">)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>                <span class="k">return</span>  <span class="c1"># Exit after success</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                    <span class="sa">f</span><span class="s2">&quot;Error calling OpenAI API for academic summary on attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                <span class="p">)</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>                        <span class="sa">f</span><span class="s2">&quot;Failed to generate academic summary for </span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2"> after </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> attempts.&quot;</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>                    <span class="p">)</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                    <span class="k">return</span>  <span class="c1"># Exit after all retries failed</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="sa">f</span><span class="s2">&quot;Error in generate_sensitivity_academic_report for case </span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.report.retry_ai_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">retry_ai_analysis</span><span class="p">(</span><span class="n">case_configs</span><span class="p">,</span> <span class="n">original_config</span><span class="p">)</span></code>

<a href="#tricys.analysis.report.retry_ai_analysis" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Retries AI analysis for cases where it might have failed due to network issues.</p>
<p>Checks for existing reports and re-runs only the AI-dependent parts if they are missing.
This function can be triggered by setting an environment variable.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>case_configs</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of case configuration dictionaries.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_config</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original configuration dictionary.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Routes to _retry_salib_case for SALib cases or _retry_standard_case for standard cases.
Only regenerates missing AI analysis and academic reports. Does not re-run simulations.
Logs all retry attempts and failures.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/report.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1434" name="__codelineno-0-1434"></a><span class="k">def</span><span class="w"> </span><span class="nf">retry_ai_analysis</span><span class="p">(</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>    <span class="n">case_configs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">original_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Retries AI analysis for cases where it might have failed due to network issues.</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a><span class="sd">    Checks for existing reports and re-runs only the AI-dependent parts if they are missing.</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a><span class="sd">    This function can be triggered by setting an environment variable.</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a><span class="sd">        case_configs: List of case configuration dictionaries.</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a><span class="sd">        original_config: Original configuration dictionary.</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a><span class="sd">        Routes to _retry_salib_case for SALib cases or _retry_standard_case for standard cases.</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a><span class="sd">        Only regenerates missing AI analysis and academic reports. Does not re-run simulations.</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a><span class="sd">        Logs all retry attempts and failures.</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting AI analysis retry process...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>        <span class="k">for</span> <span class="n">case_info</span> <span class="ow">in</span> <span class="n">case_configs</span><span class="p">:</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>            <span class="n">case_data</span> <span class="o">=</span> <span class="n">case_info</span><span class="p">[</span><span class="s2">&quot;case_data&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>            <span class="k">if</span> <span class="s2">&quot;analyzer&quot;</span> <span class="ow">in</span> <span class="n">case_data</span> <span class="ow">and</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;analyzer&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>                <span class="n">_retry_salib_case</span><span class="p">(</span><span class="n">case_info</span><span class="p">,</span> <span class="n">original_config</span><span class="p">)</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>                <span class="n">_retry_standard_case</span><span class="p">(</span><span class="n">case_info</span><span class="p">,</span> <span class="n">original_config</span><span class="p">)</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during AI analysis retry process: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
<div class="tabbed-block">


<div class="doc doc-object doc-module">



<a id="tricys.analysis.salib"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="tricys.analysis.salib.TricysSALibAnalyzer" class="doc doc-heading">
            <code>TricysSALibAnalyzer</code>


<a href="#tricys.analysis.salib.TricysSALibAnalyzer" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



        <p>Integrated SALib's Tricys Sensitivity Analyzer.</p>
<p>Supported Analysis Methods:
- Sobol: Variance-based global sensitivity analysis
- Morris: Screening-based sensitivity analysis
- FAST: Fourier Amplitude Sensitivity Test
- LHS: Latin Hypercube Sampling uncertainty analysis</p>


<p><span class="doc-section-title">属性：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="tricys.analysis.salib.TricysSALibAnalyzer.base_config">base_config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Copy of the Tricys base configuration.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="tricys.analysis.salib.TricysSALibAnalyzer.problem">problem</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SALib problem definition dictionary.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="tricys.analysis.salib.TricysSALibAnalyzer.parameter_samples">parameter_samples</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generated parameter samples array.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="tricys.analysis.salib.TricysSALibAnalyzer.simulation_results">simulation_results</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results from simulations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="tricys.analysis.salib.TricysSALibAnalyzer.sensitivity_results">sensitivity_results</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary storing sensitivity analysis results by method.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Automatically sets up Chinese font support and validates Tricys configuration
on initialization. Supports multiple sensitivity analysis methods with appropriate
sampling strategies.</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>tricys/analysis/salib.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-29">  29</a></span>
<span class="normal"><a href="#__codelineno-0-30">  30</a></span>
<span class="normal"><a href="#__codelineno-0-31">  31</a></span>
<span class="normal"><a href="#__codelineno-0-32">  32</a></span>
<span class="normal"><a href="#__codelineno-0-33">  33</a></span>
<span class="normal"><a href="#__codelineno-0-34">  34</a></span>
<span class="normal"><a href="#__codelineno-0-35">  35</a></span>
<span class="normal"><a href="#__codelineno-0-36">  36</a></span>
<span class="normal"><a href="#__codelineno-0-37">  37</a></span>
<span class="normal"><a href="#__codelineno-0-38">  38</a></span>
<span class="normal"><a href="#__codelineno-0-39">  39</a></span>
<span class="normal"><a href="#__codelineno-0-40">  40</a></span>
<span class="normal"><a href="#__codelineno-0-41">  41</a></span>
<span class="normal"><a href="#__codelineno-0-42">  42</a></span>
<span class="normal"><a href="#__codelineno-0-43">  43</a></span>
<span class="normal"><a href="#__codelineno-0-44">  44</a></span>
<span class="normal"><a href="#__codelineno-0-45">  45</a></span>
<span class="normal"><a href="#__codelineno-0-46">  46</a></span>
<span class="normal"><a href="#__codelineno-0-47">  47</a></span>
<span class="normal"><a href="#__codelineno-0-48">  48</a></span>
<span class="normal"><a href="#__codelineno-0-49">  49</a></span>
<span class="normal"><a href="#__codelineno-0-50">  50</a></span>
<span class="normal"><a href="#__codelineno-0-51">  51</a></span>
<span class="normal"><a href="#__codelineno-0-52">  52</a></span>
<span class="normal"><a href="#__codelineno-0-53">  53</a></span>
<span class="normal"><a href="#__codelineno-0-54">  54</a></span>
<span class="normal"><a href="#__codelineno-0-55">  55</a></span>
<span class="normal"><a href="#__codelineno-0-56">  56</a></span>
<span class="normal"><a href="#__codelineno-0-57">  57</a></span>
<span class="normal"><a href="#__codelineno-0-58">  58</a></span>
<span class="normal"><a href="#__codelineno-0-59">  59</a></span>
<span class="normal"><a href="#__codelineno-0-60">  60</a></span>
<span class="normal"><a href="#__codelineno-0-61">  61</a></span>
<span class="normal"><a href="#__codelineno-0-62">  62</a></span>
<span class="normal"><a href="#__codelineno-0-63">  63</a></span>
<span class="normal"><a href="#__codelineno-0-64">  64</a></span>
<span class="normal"><a href="#__codelineno-0-65">  65</a></span>
<span class="normal"><a href="#__codelineno-0-66">  66</a></span>
<span class="normal"><a href="#__codelineno-0-67">  67</a></span>
<span class="normal"><a href="#__codelineno-0-68">  68</a></span>
<span class="normal"><a href="#__codelineno-0-69">  69</a></span>
<span class="normal"><a href="#__codelineno-0-70">  70</a></span>
<span class="normal"><a href="#__codelineno-0-71">  71</a></span>
<span class="normal"><a href="#__codelineno-0-72">  72</a></span>
<span class="normal"><a href="#__codelineno-0-73">  73</a></span>
<span class="normal"><a href="#__codelineno-0-74">  74</a></span>
<span class="normal"><a href="#__codelineno-0-75">  75</a></span>
<span class="normal"><a href="#__codelineno-0-76">  76</a></span>
<span class="normal"><a href="#__codelineno-0-77">  77</a></span>
<span class="normal"><a href="#__codelineno-0-78">  78</a></span>
<span class="normal"><a href="#__codelineno-0-79">  79</a></span>
<span class="normal"><a href="#__codelineno-0-80">  80</a></span>
<span class="normal"><a href="#__codelineno-0-81">  81</a></span>
<span class="normal"><a href="#__codelineno-0-82">  82</a></span>
<span class="normal"><a href="#__codelineno-0-83">  83</a></span>
<span class="normal"><a href="#__codelineno-0-84">  84</a></span>
<span class="normal"><a href="#__codelineno-0-85">  85</a></span>
<span class="normal"><a href="#__codelineno-0-86">  86</a></span>
<span class="normal"><a href="#__codelineno-0-87">  87</a></span>
<span class="normal"><a href="#__codelineno-0-88">  88</a></span>
<span class="normal"><a href="#__codelineno-0-89">  89</a></span>
<span class="normal"><a href="#__codelineno-0-90">  90</a></span>
<span class="normal"><a href="#__codelineno-0-91">  91</a></span>
<span class="normal"><a href="#__codelineno-0-92">  92</a></span>
<span class="normal"><a href="#__codelineno-0-93">  93</a></span>
<span class="normal"><a href="#__codelineno-0-94">  94</a></span>
<span class="normal"><a href="#__codelineno-0-95">  95</a></span>
<span class="normal"><a href="#__codelineno-0-96">  96</a></span>
<span class="normal"><a href="#__codelineno-0-97">  97</a></span>
<span class="normal"><a href="#__codelineno-0-98">  98</a></span>
<span class="normal"><a href="#__codelineno-0-99">  99</a></span>
<span class="normal"><a href="#__codelineno-0-100"> 100</a></span>
<span class="normal"><a href="#__codelineno-0-101"> 101</a></span>
<span class="normal"><a href="#__codelineno-0-102"> 102</a></span>
<span class="normal"><a href="#__codelineno-0-103"> 103</a></span>
<span class="normal"><a href="#__codelineno-0-104"> 104</a></span>
<span class="normal"><a href="#__codelineno-0-105"> 105</a></span>
<span class="normal"><a href="#__codelineno-0-106"> 106</a></span>
<span class="normal"><a href="#__codelineno-0-107"> 107</a></span>
<span class="normal"><a href="#__codelineno-0-108"> 108</a></span>
<span class="normal"><a href="#__codelineno-0-109"> 109</a></span>
<span class="normal"><a href="#__codelineno-0-110"> 110</a></span>
<span class="normal"><a href="#__codelineno-0-111"> 111</a></span>
<span class="normal"><a href="#__codelineno-0-112"> 112</a></span>
<span class="normal"><a href="#__codelineno-0-113"> 113</a></span>
<span class="normal"><a href="#__codelineno-0-114"> 114</a></span>
<span class="normal"><a href="#__codelineno-0-115"> 115</a></span>
<span class="normal"><a href="#__codelineno-0-116"> 116</a></span>
<span class="normal"><a href="#__codelineno-0-117"> 117</a></span>
<span class="normal"><a href="#__codelineno-0-118"> 118</a></span>
<span class="normal"><a href="#__codelineno-0-119"> 119</a></span>
<span class="normal"><a href="#__codelineno-0-120"> 120</a></span>
<span class="normal"><a href="#__codelineno-0-121"> 121</a></span>
<span class="normal"><a href="#__codelineno-0-122"> 122</a></span>
<span class="normal"><a href="#__codelineno-0-123"> 123</a></span>
<span class="normal"><a href="#__codelineno-0-124"> 124</a></span>
<span class="normal"><a href="#__codelineno-0-125"> 125</a></span>
<span class="normal"><a href="#__codelineno-0-126"> 126</a></span>
<span class="normal"><a href="#__codelineno-0-127"> 127</a></span>
<span class="normal"><a href="#__codelineno-0-128"> 128</a></span>
<span class="normal"><a href="#__codelineno-0-129"> 129</a></span>
<span class="normal"><a href="#__codelineno-0-130"> 130</a></span>
<span class="normal"><a href="#__codelineno-0-131"> 131</a></span>
<span class="normal"><a href="#__codelineno-0-132"> 132</a></span>
<span class="normal"><a href="#__codelineno-0-133"> 133</a></span>
<span class="normal"><a href="#__codelineno-0-134"> 134</a></span>
<span class="normal"><a href="#__codelineno-0-135"> 135</a></span>
<span class="normal"><a href="#__codelineno-0-136"> 136</a></span>
<span class="normal"><a href="#__codelineno-0-137"> 137</a></span>
<span class="normal"><a href="#__codelineno-0-138"> 138</a></span>
<span class="normal"><a href="#__codelineno-0-139"> 139</a></span>
<span class="normal"><a href="#__codelineno-0-140"> 140</a></span>
<span class="normal"><a href="#__codelineno-0-141"> 141</a></span>
<span class="normal"><a href="#__codelineno-0-142"> 142</a></span>
<span class="normal"><a href="#__codelineno-0-143"> 143</a></span>
<span class="normal"><a href="#__codelineno-0-144"> 144</a></span>
<span class="normal"><a href="#__codelineno-0-145"> 145</a></span>
<span class="normal"><a href="#__codelineno-0-146"> 146</a></span>
<span class="normal"><a href="#__codelineno-0-147"> 147</a></span>
<span class="normal"><a href="#__codelineno-0-148"> 148</a></span>
<span class="normal"><a href="#__codelineno-0-149"> 149</a></span>
<span class="normal"><a href="#__codelineno-0-150"> 150</a></span>
<span class="normal"><a href="#__codelineno-0-151"> 151</a></span>
<span class="normal"><a href="#__codelineno-0-152"> 152</a></span>
<span class="normal"><a href="#__codelineno-0-153"> 153</a></span>
<span class="normal"><a href="#__codelineno-0-154"> 154</a></span>
<span class="normal"><a href="#__codelineno-0-155"> 155</a></span>
<span class="normal"><a href="#__codelineno-0-156"> 156</a></span>
<span class="normal"><a href="#__codelineno-0-157"> 157</a></span>
<span class="normal"><a href="#__codelineno-0-158"> 158</a></span>
<span class="normal"><a href="#__codelineno-0-159"> 159</a></span>
<span class="normal"><a href="#__codelineno-0-160"> 160</a></span>
<span class="normal"><a href="#__codelineno-0-161"> 161</a></span>
<span class="normal"><a href="#__codelineno-0-162"> 162</a></span>
<span class="normal"><a href="#__codelineno-0-163"> 163</a></span>
<span class="normal"><a href="#__codelineno-0-164"> 164</a></span>
<span class="normal"><a href="#__codelineno-0-165"> 165</a></span>
<span class="normal"><a href="#__codelineno-0-166"> 166</a></span>
<span class="normal"><a href="#__codelineno-0-167"> 167</a></span>
<span class="normal"><a href="#__codelineno-0-168"> 168</a></span>
<span class="normal"><a href="#__codelineno-0-169"> 169</a></span>
<span class="normal"><a href="#__codelineno-0-170"> 170</a></span>
<span class="normal"><a href="#__codelineno-0-171"> 171</a></span>
<span class="normal"><a href="#__codelineno-0-172"> 172</a></span>
<span class="normal"><a href="#__codelineno-0-173"> 173</a></span>
<span class="normal"><a href="#__codelineno-0-174"> 174</a></span>
<span class="normal"><a href="#__codelineno-0-175"> 175</a></span>
<span class="normal"><a href="#__codelineno-0-176"> 176</a></span>
<span class="normal"><a href="#__codelineno-0-177"> 177</a></span>
<span class="normal"><a href="#__codelineno-0-178"> 178</a></span>
<span class="normal"><a href="#__codelineno-0-179"> 179</a></span>
<span class="normal"><a href="#__codelineno-0-180"> 180</a></span>
<span class="normal"><a href="#__codelineno-0-181"> 181</a></span>
<span class="normal"><a href="#__codelineno-0-182"> 182</a></span>
<span class="normal"><a href="#__codelineno-0-183"> 183</a></span>
<span class="normal"><a href="#__codelineno-0-184"> 184</a></span>
<span class="normal"><a href="#__codelineno-0-185"> 185</a></span>
<span class="normal"><a href="#__codelineno-0-186"> 186</a></span>
<span class="normal"><a href="#__codelineno-0-187"> 187</a></span>
<span class="normal"><a href="#__codelineno-0-188"> 188</a></span>
<span class="normal"><a href="#__codelineno-0-189"> 189</a></span>
<span class="normal"><a href="#__codelineno-0-190"> 190</a></span>
<span class="normal"><a href="#__codelineno-0-191"> 191</a></span>
<span class="normal"><a href="#__codelineno-0-192"> 192</a></span>
<span class="normal"><a href="#__codelineno-0-193"> 193</a></span>
<span class="normal"><a href="#__codelineno-0-194"> 194</a></span>
<span class="normal"><a href="#__codelineno-0-195"> 195</a></span>
<span class="normal"><a href="#__codelineno-0-196"> 196</a></span>
<span class="normal"><a href="#__codelineno-0-197"> 197</a></span>
<span class="normal"><a href="#__codelineno-0-198"> 198</a></span>
<span class="normal"><a href="#__codelineno-0-199"> 199</a></span>
<span class="normal"><a href="#__codelineno-0-200"> 200</a></span>
<span class="normal"><a href="#__codelineno-0-201"> 201</a></span>
<span class="normal"><a href="#__codelineno-0-202"> 202</a></span>
<span class="normal"><a href="#__codelineno-0-203"> 203</a></span>
<span class="normal"><a href="#__codelineno-0-204"> 204</a></span>
<span class="normal"><a href="#__codelineno-0-205"> 205</a></span>
<span class="normal"><a href="#__codelineno-0-206"> 206</a></span>
<span class="normal"><a href="#__codelineno-0-207"> 207</a></span>
<span class="normal"><a href="#__codelineno-0-208"> 208</a></span>
<span class="normal"><a href="#__codelineno-0-209"> 209</a></span>
<span class="normal"><a href="#__codelineno-0-210"> 210</a></span>
<span class="normal"><a href="#__codelineno-0-211"> 211</a></span>
<span class="normal"><a href="#__codelineno-0-212"> 212</a></span>
<span class="normal"><a href="#__codelineno-0-213"> 213</a></span>
<span class="normal"><a href="#__codelineno-0-214"> 214</a></span>
<span class="normal"><a href="#__codelineno-0-215"> 215</a></span>
<span class="normal"><a href="#__codelineno-0-216"> 216</a></span>
<span class="normal"><a href="#__codelineno-0-217"> 217</a></span>
<span class="normal"><a href="#__codelineno-0-218"> 218</a></span>
<span class="normal"><a href="#__codelineno-0-219"> 219</a></span>
<span class="normal"><a href="#__codelineno-0-220"> 220</a></span>
<span class="normal"><a href="#__codelineno-0-221"> 221</a></span>
<span class="normal"><a href="#__codelineno-0-222"> 222</a></span>
<span class="normal"><a href="#__codelineno-0-223"> 223</a></span>
<span class="normal"><a href="#__codelineno-0-224"> 224</a></span>
<span class="normal"><a href="#__codelineno-0-225"> 225</a></span>
<span class="normal"><a href="#__codelineno-0-226"> 226</a></span>
<span class="normal"><a href="#__codelineno-0-227"> 227</a></span>
<span class="normal"><a href="#__codelineno-0-228"> 228</a></span>
<span class="normal"><a href="#__codelineno-0-229"> 229</a></span>
<span class="normal"><a href="#__codelineno-0-230"> 230</a></span>
<span class="normal"><a href="#__codelineno-0-231"> 231</a></span>
<span class="normal"><a href="#__codelineno-0-232"> 232</a></span>
<span class="normal"><a href="#__codelineno-0-233"> 233</a></span>
<span class="normal"><a href="#__codelineno-0-234"> 234</a></span>
<span class="normal"><a href="#__codelineno-0-235"> 235</a></span>
<span class="normal"><a href="#__codelineno-0-236"> 236</a></span>
<span class="normal"><a href="#__codelineno-0-237"> 237</a></span>
<span class="normal"><a href="#__codelineno-0-238"> 238</a></span>
<span class="normal"><a href="#__codelineno-0-239"> 239</a></span>
<span class="normal"><a href="#__codelineno-0-240"> 240</a></span>
<span class="normal"><a href="#__codelineno-0-241"> 241</a></span>
<span class="normal"><a href="#__codelineno-0-242"> 242</a></span>
<span class="normal"><a href="#__codelineno-0-243"> 243</a></span>
<span class="normal"><a href="#__codelineno-0-244"> 244</a></span>
<span class="normal"><a href="#__codelineno-0-245"> 245</a></span>
<span class="normal"><a href="#__codelineno-0-246"> 246</a></span>
<span class="normal"><a href="#__codelineno-0-247"> 247</a></span>
<span class="normal"><a href="#__codelineno-0-248"> 248</a></span>
<span class="normal"><a href="#__codelineno-0-249"> 249</a></span>
<span class="normal"><a href="#__codelineno-0-250"> 250</a></span>
<span class="normal"><a href="#__codelineno-0-251"> 251</a></span>
<span class="normal"><a href="#__codelineno-0-252"> 252</a></span>
<span class="normal"><a href="#__codelineno-0-253"> 253</a></span>
<span class="normal"><a href="#__codelineno-0-254"> 254</a></span>
<span class="normal"><a href="#__codelineno-0-255"> 255</a></span>
<span class="normal"><a href="#__codelineno-0-256"> 256</a></span>
<span class="normal"><a href="#__codelineno-0-257"> 257</a></span>
<span class="normal"><a href="#__codelineno-0-258"> 258</a></span>
<span class="normal"><a href="#__codelineno-0-259"> 259</a></span>
<span class="normal"><a href="#__codelineno-0-260"> 260</a></span>
<span class="normal"><a href="#__codelineno-0-261"> 261</a></span>
<span class="normal"><a href="#__codelineno-0-262"> 262</a></span>
<span class="normal"><a href="#__codelineno-0-263"> 263</a></span>
<span class="normal"><a href="#__codelineno-0-264"> 264</a></span>
<span class="normal"><a href="#__codelineno-0-265"> 265</a></span>
<span class="normal"><a href="#__codelineno-0-266"> 266</a></span>
<span class="normal"><a href="#__codelineno-0-267"> 267</a></span>
<span class="normal"><a href="#__codelineno-0-268"> 268</a></span>
<span class="normal"><a href="#__codelineno-0-269"> 269</a></span>
<span class="normal"><a href="#__codelineno-0-270"> 270</a></span>
<span class="normal"><a href="#__codelineno-0-271"> 271</a></span>
<span class="normal"><a href="#__codelineno-0-272"> 272</a></span>
<span class="normal"><a href="#__codelineno-0-273"> 273</a></span>
<span class="normal"><a href="#__codelineno-0-274"> 274</a></span>
<span class="normal"><a href="#__codelineno-0-275"> 275</a></span>
<span class="normal"><a href="#__codelineno-0-276"> 276</a></span>
<span class="normal"><a href="#__codelineno-0-277"> 277</a></span>
<span class="normal"><a href="#__codelineno-0-278"> 278</a></span>
<span class="normal"><a href="#__codelineno-0-279"> 279</a></span>
<span class="normal"><a href="#__codelineno-0-280"> 280</a></span>
<span class="normal"><a href="#__codelineno-0-281"> 281</a></span>
<span class="normal"><a href="#__codelineno-0-282"> 282</a></span>
<span class="normal"><a href="#__codelineno-0-283"> 283</a></span>
<span class="normal"><a href="#__codelineno-0-284"> 284</a></span>
<span class="normal"><a href="#__codelineno-0-285"> 285</a></span>
<span class="normal"><a href="#__codelineno-0-286"> 286</a></span>
<span class="normal"><a href="#__codelineno-0-287"> 287</a></span>
<span class="normal"><a href="#__codelineno-0-288"> 288</a></span>
<span class="normal"><a href="#__codelineno-0-289"> 289</a></span>
<span class="normal"><a href="#__codelineno-0-290"> 290</a></span>
<span class="normal"><a href="#__codelineno-0-291"> 291</a></span>
<span class="normal"><a href="#__codelineno-0-292"> 292</a></span>
<span class="normal"><a href="#__codelineno-0-293"> 293</a></span>
<span class="normal"><a href="#__codelineno-0-294"> 294</a></span>
<span class="normal"><a href="#__codelineno-0-295"> 295</a></span>
<span class="normal"><a href="#__codelineno-0-296"> 296</a></span>
<span class="normal"><a href="#__codelineno-0-297"> 297</a></span>
<span class="normal"><a href="#__codelineno-0-298"> 298</a></span>
<span class="normal"><a href="#__codelineno-0-299"> 299</a></span>
<span class="normal"><a href="#__codelineno-0-300"> 300</a></span>
<span class="normal"><a href="#__codelineno-0-301"> 301</a></span>
<span class="normal"><a href="#__codelineno-0-302"> 302</a></span>
<span class="normal"><a href="#__codelineno-0-303"> 303</a></span>
<span class="normal"><a href="#__codelineno-0-304"> 304</a></span>
<span class="normal"><a href="#__codelineno-0-305"> 305</a></span>
<span class="normal"><a href="#__codelineno-0-306"> 306</a></span>
<span class="normal"><a href="#__codelineno-0-307"> 307</a></span>
<span class="normal"><a href="#__codelineno-0-308"> 308</a></span>
<span class="normal"><a href="#__codelineno-0-309"> 309</a></span>
<span class="normal"><a href="#__codelineno-0-310"> 310</a></span>
<span class="normal"><a href="#__codelineno-0-311"> 311</a></span>
<span class="normal"><a href="#__codelineno-0-312"> 312</a></span>
<span class="normal"><a href="#__codelineno-0-313"> 313</a></span>
<span class="normal"><a href="#__codelineno-0-314"> 314</a></span>
<span class="normal"><a href="#__codelineno-0-315"> 315</a></span>
<span class="normal"><a href="#__codelineno-0-316"> 316</a></span>
<span class="normal"><a href="#__codelineno-0-317"> 317</a></span>
<span class="normal"><a href="#__codelineno-0-318"> 318</a></span>
<span class="normal"><a href="#__codelineno-0-319"> 319</a></span>
<span class="normal"><a href="#__codelineno-0-320"> 320</a></span>
<span class="normal"><a href="#__codelineno-0-321"> 321</a></span>
<span class="normal"><a href="#__codelineno-0-322"> 322</a></span>
<span class="normal"><a href="#__codelineno-0-323"> 323</a></span>
<span class="normal"><a href="#__codelineno-0-324"> 324</a></span>
<span class="normal"><a href="#__codelineno-0-325"> 325</a></span>
<span class="normal"><a href="#__codelineno-0-326"> 326</a></span>
<span class="normal"><a href="#__codelineno-0-327"> 327</a></span>
<span class="normal"><a href="#__codelineno-0-328"> 328</a></span>
<span class="normal"><a href="#__codelineno-0-329"> 329</a></span>
<span class="normal"><a href="#__codelineno-0-330"> 330</a></span>
<span class="normal"><a href="#__codelineno-0-331"> 331</a></span>
<span class="normal"><a href="#__codelineno-0-332"> 332</a></span>
<span class="normal"><a href="#__codelineno-0-333"> 333</a></span>
<span class="normal"><a href="#__codelineno-0-334"> 334</a></span>
<span class="normal"><a href="#__codelineno-0-335"> 335</a></span>
<span class="normal"><a href="#__codelineno-0-336"> 336</a></span>
<span class="normal"><a href="#__codelineno-0-337"> 337</a></span>
<span class="normal"><a href="#__codelineno-0-338"> 338</a></span>
<span class="normal"><a href="#__codelineno-0-339"> 339</a></span>
<span class="normal"><a href="#__codelineno-0-340"> 340</a></span>
<span class="normal"><a href="#__codelineno-0-341"> 341</a></span>
<span class="normal"><a href="#__codelineno-0-342"> 342</a></span>
<span class="normal"><a href="#__codelineno-0-343"> 343</a></span>
<span class="normal"><a href="#__codelineno-0-344"> 344</a></span>
<span class="normal"><a href="#__codelineno-0-345"> 345</a></span>
<span class="normal"><a href="#__codelineno-0-346"> 346</a></span>
<span class="normal"><a href="#__codelineno-0-347"> 347</a></span>
<span class="normal"><a href="#__codelineno-0-348"> 348</a></span>
<span class="normal"><a href="#__codelineno-0-349"> 349</a></span>
<span class="normal"><a href="#__codelineno-0-350"> 350</a></span>
<span class="normal"><a href="#__codelineno-0-351"> 351</a></span>
<span class="normal"><a href="#__codelineno-0-352"> 352</a></span>
<span class="normal"><a href="#__codelineno-0-353"> 353</a></span>
<span class="normal"><a href="#__codelineno-0-354"> 354</a></span>
<span class="normal"><a href="#__codelineno-0-355"> 355</a></span>
<span class="normal"><a href="#__codelineno-0-356"> 356</a></span>
<span class="normal"><a href="#__codelineno-0-357"> 357</a></span>
<span class="normal"><a href="#__codelineno-0-358"> 358</a></span>
<span class="normal"><a href="#__codelineno-0-359"> 359</a></span>
<span class="normal"><a href="#__codelineno-0-360"> 360</a></span>
<span class="normal"><a href="#__codelineno-0-361"> 361</a></span>
<span class="normal"><a href="#__codelineno-0-362"> 362</a></span>
<span class="normal"><a href="#__codelineno-0-363"> 363</a></span>
<span class="normal"><a href="#__codelineno-0-364"> 364</a></span>
<span class="normal"><a href="#__codelineno-0-365"> 365</a></span>
<span class="normal"><a href="#__codelineno-0-366"> 366</a></span>
<span class="normal"><a href="#__codelineno-0-367"> 367</a></span>
<span class="normal"><a href="#__codelineno-0-368"> 368</a></span>
<span class="normal"><a href="#__codelineno-0-369"> 369</a></span>
<span class="normal"><a href="#__codelineno-0-370"> 370</a></span>
<span class="normal"><a href="#__codelineno-0-371"> 371</a></span>
<span class="normal"><a href="#__codelineno-0-372"> 372</a></span>
<span class="normal"><a href="#__codelineno-0-373"> 373</a></span>
<span class="normal"><a href="#__codelineno-0-374"> 374</a></span>
<span class="normal"><a href="#__codelineno-0-375"> 375</a></span>
<span class="normal"><a href="#__codelineno-0-376"> 376</a></span>
<span class="normal"><a href="#__codelineno-0-377"> 377</a></span>
<span class="normal"><a href="#__codelineno-0-378"> 378</a></span>
<span class="normal"><a href="#__codelineno-0-379"> 379</a></span>
<span class="normal"><a href="#__codelineno-0-380"> 380</a></span>
<span class="normal"><a href="#__codelineno-0-381"> 381</a></span>
<span class="normal"><a href="#__codelineno-0-382"> 382</a></span>
<span class="normal"><a href="#__codelineno-0-383"> 383</a></span>
<span class="normal"><a href="#__codelineno-0-384"> 384</a></span>
<span class="normal"><a href="#__codelineno-0-385"> 385</a></span>
<span class="normal"><a href="#__codelineno-0-386"> 386</a></span>
<span class="normal"><a href="#__codelineno-0-387"> 387</a></span>
<span class="normal"><a href="#__codelineno-0-388"> 388</a></span>
<span class="normal"><a href="#__codelineno-0-389"> 389</a></span>
<span class="normal"><a href="#__codelineno-0-390"> 390</a></span>
<span class="normal"><a href="#__codelineno-0-391"> 391</a></span>
<span class="normal"><a href="#__codelineno-0-392"> 392</a></span>
<span class="normal"><a href="#__codelineno-0-393"> 393</a></span>
<span class="normal"><a href="#__codelineno-0-394"> 394</a></span>
<span class="normal"><a href="#__codelineno-0-395"> 395</a></span>
<span class="normal"><a href="#__codelineno-0-396"> 396</a></span>
<span class="normal"><a href="#__codelineno-0-397"> 397</a></span>
<span class="normal"><a href="#__codelineno-0-398"> 398</a></span>
<span class="normal"><a href="#__codelineno-0-399"> 399</a></span>
<span class="normal"><a href="#__codelineno-0-400"> 400</a></span>
<span class="normal"><a href="#__codelineno-0-401"> 401</a></span>
<span class="normal"><a href="#__codelineno-0-402"> 402</a></span>
<span class="normal"><a href="#__codelineno-0-403"> 403</a></span>
<span class="normal"><a href="#__codelineno-0-404"> 404</a></span>
<span class="normal"><a href="#__codelineno-0-405"> 405</a></span>
<span class="normal"><a href="#__codelineno-0-406"> 406</a></span>
<span class="normal"><a href="#__codelineno-0-407"> 407</a></span>
<span class="normal"><a href="#__codelineno-0-408"> 408</a></span>
<span class="normal"><a href="#__codelineno-0-409"> 409</a></span>
<span class="normal"><a href="#__codelineno-0-410"> 410</a></span>
<span class="normal"><a href="#__codelineno-0-411"> 411</a></span>
<span class="normal"><a href="#__codelineno-0-412"> 412</a></span>
<span class="normal"><a href="#__codelineno-0-413"> 413</a></span>
<span class="normal"><a href="#__codelineno-0-414"> 414</a></span>
<span class="normal"><a href="#__codelineno-0-415"> 415</a></span>
<span class="normal"><a href="#__codelineno-0-416"> 416</a></span>
<span class="normal"><a href="#__codelineno-0-417"> 417</a></span>
<span class="normal"><a href="#__codelineno-0-418"> 418</a></span>
<span class="normal"><a href="#__codelineno-0-419"> 419</a></span>
<span class="normal"><a href="#__codelineno-0-420"> 420</a></span>
<span class="normal"><a href="#__codelineno-0-421"> 421</a></span>
<span class="normal"><a href="#__codelineno-0-422"> 422</a></span>
<span class="normal"><a href="#__codelineno-0-423"> 423</a></span>
<span class="normal"><a href="#__codelineno-0-424"> 424</a></span>
<span class="normal"><a href="#__codelineno-0-425"> 425</a></span>
<span class="normal"><a href="#__codelineno-0-426"> 426</a></span>
<span class="normal"><a href="#__codelineno-0-427"> 427</a></span>
<span class="normal"><a href="#__codelineno-0-428"> 428</a></span>
<span class="normal"><a href="#__codelineno-0-429"> 429</a></span>
<span class="normal"><a href="#__codelineno-0-430"> 430</a></span>
<span class="normal"><a href="#__codelineno-0-431"> 431</a></span>
<span class="normal"><a href="#__codelineno-0-432"> 432</a></span>
<span class="normal"><a href="#__codelineno-0-433"> 433</a></span>
<span class="normal"><a href="#__codelineno-0-434"> 434</a></span>
<span class="normal"><a href="#__codelineno-0-435"> 435</a></span>
<span class="normal"><a href="#__codelineno-0-436"> 436</a></span>
<span class="normal"><a href="#__codelineno-0-437"> 437</a></span>
<span class="normal"><a href="#__codelineno-0-438"> 438</a></span>
<span class="normal"><a href="#__codelineno-0-439"> 439</a></span>
<span class="normal"><a href="#__codelineno-0-440"> 440</a></span>
<span class="normal"><a href="#__codelineno-0-441"> 441</a></span>
<span class="normal"><a href="#__codelineno-0-442"> 442</a></span>
<span class="normal"><a href="#__codelineno-0-443"> 443</a></span>
<span class="normal"><a href="#__codelineno-0-444"> 444</a></span>
<span class="normal"><a href="#__codelineno-0-445"> 445</a></span>
<span class="normal"><a href="#__codelineno-0-446"> 446</a></span>
<span class="normal"><a href="#__codelineno-0-447"> 447</a></span>
<span class="normal"><a href="#__codelineno-0-448"> 448</a></span>
<span class="normal"><a href="#__codelineno-0-449"> 449</a></span>
<span class="normal"><a href="#__codelineno-0-450"> 450</a></span>
<span class="normal"><a href="#__codelineno-0-451"> 451</a></span>
<span class="normal"><a href="#__codelineno-0-452"> 452</a></span>
<span class="normal"><a href="#__codelineno-0-453"> 453</a></span>
<span class="normal"><a href="#__codelineno-0-454"> 454</a></span>
<span class="normal"><a href="#__codelineno-0-455"> 455</a></span>
<span class="normal"><a href="#__codelineno-0-456"> 456</a></span>
<span class="normal"><a href="#__codelineno-0-457"> 457</a></span>
<span class="normal"><a href="#__codelineno-0-458"> 458</a></span>
<span class="normal"><a href="#__codelineno-0-459"> 459</a></span>
<span class="normal"><a href="#__codelineno-0-460"> 460</a></span>
<span class="normal"><a href="#__codelineno-0-461"> 461</a></span>
<span class="normal"><a href="#__codelineno-0-462"> 462</a></span>
<span class="normal"><a href="#__codelineno-0-463"> 463</a></span>
<span class="normal"><a href="#__codelineno-0-464"> 464</a></span>
<span class="normal"><a href="#__codelineno-0-465"> 465</a></span>
<span class="normal"><a href="#__codelineno-0-466"> 466</a></span>
<span class="normal"><a href="#__codelineno-0-467"> 467</a></span>
<span class="normal"><a href="#__codelineno-0-468"> 468</a></span>
<span class="normal"><a href="#__codelineno-0-469"> 469</a></span>
<span class="normal"><a href="#__codelineno-0-470"> 470</a></span>
<span class="normal"><a href="#__codelineno-0-471"> 471</a></span>
<span class="normal"><a href="#__codelineno-0-472"> 472</a></span>
<span class="normal"><a href="#__codelineno-0-473"> 473</a></span>
<span class="normal"><a href="#__codelineno-0-474"> 474</a></span>
<span class="normal"><a href="#__codelineno-0-475"> 475</a></span>
<span class="normal"><a href="#__codelineno-0-476"> 476</a></span>
<span class="normal"><a href="#__codelineno-0-477"> 477</a></span>
<span class="normal"><a href="#__codelineno-0-478"> 478</a></span>
<span class="normal"><a href="#__codelineno-0-479"> 479</a></span>
<span class="normal"><a href="#__codelineno-0-480"> 480</a></span>
<span class="normal"><a href="#__codelineno-0-481"> 481</a></span>
<span class="normal"><a href="#__codelineno-0-482"> 482</a></span>
<span class="normal"><a href="#__codelineno-0-483"> 483</a></span>
<span class="normal"><a href="#__codelineno-0-484"> 484</a></span>
<span class="normal"><a href="#__codelineno-0-485"> 485</a></span>
<span class="normal"><a href="#__codelineno-0-486"> 486</a></span>
<span class="normal"><a href="#__codelineno-0-487"> 487</a></span>
<span class="normal"><a href="#__codelineno-0-488"> 488</a></span>
<span class="normal"><a href="#__codelineno-0-489"> 489</a></span>
<span class="normal"><a href="#__codelineno-0-490"> 490</a></span>
<span class="normal"><a href="#__codelineno-0-491"> 491</a></span>
<span class="normal"><a href="#__codelineno-0-492"> 492</a></span>
<span class="normal"><a href="#__codelineno-0-493"> 493</a></span>
<span class="normal"><a href="#__codelineno-0-494"> 494</a></span>
<span class="normal"><a href="#__codelineno-0-495"> 495</a></span>
<span class="normal"><a href="#__codelineno-0-496"> 496</a></span>
<span class="normal"><a href="#__codelineno-0-497"> 497</a></span>
<span class="normal"><a href="#__codelineno-0-498"> 498</a></span>
<span class="normal"><a href="#__codelineno-0-499"> 499</a></span>
<span class="normal"><a href="#__codelineno-0-500"> 500</a></span>
<span class="normal"><a href="#__codelineno-0-501"> 501</a></span>
<span class="normal"><a href="#__codelineno-0-502"> 502</a></span>
<span class="normal"><a href="#__codelineno-0-503"> 503</a></span>
<span class="normal"><a href="#__codelineno-0-504"> 504</a></span>
<span class="normal"><a href="#__codelineno-0-505"> 505</a></span>
<span class="normal"><a href="#__codelineno-0-506"> 506</a></span>
<span class="normal"><a href="#__codelineno-0-507"> 507</a></span>
<span class="normal"><a href="#__codelineno-0-508"> 508</a></span>
<span class="normal"><a href="#__codelineno-0-509"> 509</a></span>
<span class="normal"><a href="#__codelineno-0-510"> 510</a></span>
<span class="normal"><a href="#__codelineno-0-511"> 511</a></span>
<span class="normal"><a href="#__codelineno-0-512"> 512</a></span>
<span class="normal"><a href="#__codelineno-0-513"> 513</a></span>
<span class="normal"><a href="#__codelineno-0-514"> 514</a></span>
<span class="normal"><a href="#__codelineno-0-515"> 515</a></span>
<span class="normal"><a href="#__codelineno-0-516"> 516</a></span>
<span class="normal"><a href="#__codelineno-0-517"> 517</a></span>
<span class="normal"><a href="#__codelineno-0-518"> 518</a></span>
<span class="normal"><a href="#__codelineno-0-519"> 519</a></span>
<span class="normal"><a href="#__codelineno-0-520"> 520</a></span>
<span class="normal"><a href="#__codelineno-0-521"> 521</a></span>
<span class="normal"><a href="#__codelineno-0-522"> 522</a></span>
<span class="normal"><a href="#__codelineno-0-523"> 523</a></span>
<span class="normal"><a href="#__codelineno-0-524"> 524</a></span>
<span class="normal"><a href="#__codelineno-0-525"> 525</a></span>
<span class="normal"><a href="#__codelineno-0-526"> 526</a></span>
<span class="normal"><a href="#__codelineno-0-527"> 527</a></span>
<span class="normal"><a href="#__codelineno-0-528"> 528</a></span>
<span class="normal"><a href="#__codelineno-0-529"> 529</a></span>
<span class="normal"><a href="#__codelineno-0-530"> 530</a></span>
<span class="normal"><a href="#__codelineno-0-531"> 531</a></span>
<span class="normal"><a href="#__codelineno-0-532"> 532</a></span>
<span class="normal"><a href="#__codelineno-0-533"> 533</a></span>
<span class="normal"><a href="#__codelineno-0-534"> 534</a></span>
<span class="normal"><a href="#__codelineno-0-535"> 535</a></span>
<span class="normal"><a href="#__codelineno-0-536"> 536</a></span>
<span class="normal"><a href="#__codelineno-0-537"> 537</a></span>
<span class="normal"><a href="#__codelineno-0-538"> 538</a></span>
<span class="normal"><a href="#__codelineno-0-539"> 539</a></span>
<span class="normal"><a href="#__codelineno-0-540"> 540</a></span>
<span class="normal"><a href="#__codelineno-0-541"> 541</a></span>
<span class="normal"><a href="#__codelineno-0-542"> 542</a></span>
<span class="normal"><a href="#__codelineno-0-543"> 543</a></span>
<span class="normal"><a href="#__codelineno-0-544"> 544</a></span>
<span class="normal"><a href="#__codelineno-0-545"> 545</a></span>
<span class="normal"><a href="#__codelineno-0-546"> 546</a></span>
<span class="normal"><a href="#__codelineno-0-547"> 547</a></span>
<span class="normal"><a href="#__codelineno-0-548"> 548</a></span>
<span class="normal"><a href="#__codelineno-0-549"> 549</a></span>
<span class="normal"><a href="#__codelineno-0-550"> 550</a></span>
<span class="normal"><a href="#__codelineno-0-551"> 551</a></span>
<span class="normal"><a href="#__codelineno-0-552"> 552</a></span>
<span class="normal"><a href="#__codelineno-0-553"> 553</a></span>
<span class="normal"><a href="#__codelineno-0-554"> 554</a></span>
<span class="normal"><a href="#__codelineno-0-555"> 555</a></span>
<span class="normal"><a href="#__codelineno-0-556"> 556</a></span>
<span class="normal"><a href="#__codelineno-0-557"> 557</a></span>
<span class="normal"><a href="#__codelineno-0-558"> 558</a></span>
<span class="normal"><a href="#__codelineno-0-559"> 559</a></span>
<span class="normal"><a href="#__codelineno-0-560"> 560</a></span>
<span class="normal"><a href="#__codelineno-0-561"> 561</a></span>
<span class="normal"><a href="#__codelineno-0-562"> 562</a></span>
<span class="normal"><a href="#__codelineno-0-563"> 563</a></span>
<span class="normal"><a href="#__codelineno-0-564"> 564</a></span>
<span class="normal"><a href="#__codelineno-0-565"> 565</a></span>
<span class="normal"><a href="#__codelineno-0-566"> 566</a></span>
<span class="normal"><a href="#__codelineno-0-567"> 567</a></span>
<span class="normal"><a href="#__codelineno-0-568"> 568</a></span>
<span class="normal"><a href="#__codelineno-0-569"> 569</a></span>
<span class="normal"><a href="#__codelineno-0-570"> 570</a></span>
<span class="normal"><a href="#__codelineno-0-571"> 571</a></span>
<span class="normal"><a href="#__codelineno-0-572"> 572</a></span>
<span class="normal"><a href="#__codelineno-0-573"> 573</a></span>
<span class="normal"><a href="#__codelineno-0-574"> 574</a></span>
<span class="normal"><a href="#__codelineno-0-575"> 575</a></span>
<span class="normal"><a href="#__codelineno-0-576"> 576</a></span>
<span class="normal"><a href="#__codelineno-0-577"> 577</a></span>
<span class="normal"><a href="#__codelineno-0-578"> 578</a></span>
<span class="normal"><a href="#__codelineno-0-579"> 579</a></span>
<span class="normal"><a href="#__codelineno-0-580"> 580</a></span>
<span class="normal"><a href="#__codelineno-0-581"> 581</a></span>
<span class="normal"><a href="#__codelineno-0-582"> 582</a></span>
<span class="normal"><a href="#__codelineno-0-583"> 583</a></span>
<span class="normal"><a href="#__codelineno-0-584"> 584</a></span>
<span class="normal"><a href="#__codelineno-0-585"> 585</a></span>
<span class="normal"><a href="#__codelineno-0-586"> 586</a></span>
<span class="normal"><a href="#__codelineno-0-587"> 587</a></span>
<span class="normal"><a href="#__codelineno-0-588"> 588</a></span>
<span class="normal"><a href="#__codelineno-0-589"> 589</a></span>
<span class="normal"><a href="#__codelineno-0-590"> 590</a></span>
<span class="normal"><a href="#__codelineno-0-591"> 591</a></span>
<span class="normal"><a href="#__codelineno-0-592"> 592</a></span>
<span class="normal"><a href="#__codelineno-0-593"> 593</a></span>
<span class="normal"><a href="#__codelineno-0-594"> 594</a></span>
<span class="normal"><a href="#__codelineno-0-595"> 595</a></span>
<span class="normal"><a href="#__codelineno-0-596"> 596</a></span>
<span class="normal"><a href="#__codelineno-0-597"> 597</a></span>
<span class="normal"><a href="#__codelineno-0-598"> 598</a></span>
<span class="normal"><a href="#__codelineno-0-599"> 599</a></span>
<span class="normal"><a href="#__codelineno-0-600"> 600</a></span>
<span class="normal"><a href="#__codelineno-0-601"> 601</a></span>
<span class="normal"><a href="#__codelineno-0-602"> 602</a></span>
<span class="normal"><a href="#__codelineno-0-603"> 603</a></span>
<span class="normal"><a href="#__codelineno-0-604"> 604</a></span>
<span class="normal"><a href="#__codelineno-0-605"> 605</a></span>
<span class="normal"><a href="#__codelineno-0-606"> 606</a></span>
<span class="normal"><a href="#__codelineno-0-607"> 607</a></span>
<span class="normal"><a href="#__codelineno-0-608"> 608</a></span>
<span class="normal"><a href="#__codelineno-0-609"> 609</a></span>
<span class="normal"><a href="#__codelineno-0-610"> 610</a></span>
<span class="normal"><a href="#__codelineno-0-611"> 611</a></span>
<span class="normal"><a href="#__codelineno-0-612"> 612</a></span>
<span class="normal"><a href="#__codelineno-0-613"> 613</a></span>
<span class="normal"><a href="#__codelineno-0-614"> 614</a></span>
<span class="normal"><a href="#__codelineno-0-615"> 615</a></span>
<span class="normal"><a href="#__codelineno-0-616"> 616</a></span>
<span class="normal"><a href="#__codelineno-0-617"> 617</a></span>
<span class="normal"><a href="#__codelineno-0-618"> 618</a></span>
<span class="normal"><a href="#__codelineno-0-619"> 619</a></span>
<span class="normal"><a href="#__codelineno-0-620"> 620</a></span>
<span class="normal"><a href="#__codelineno-0-621"> 621</a></span>
<span class="normal"><a href="#__codelineno-0-622"> 622</a></span>
<span class="normal"><a href="#__codelineno-0-623"> 623</a></span>
<span class="normal"><a href="#__codelineno-0-624"> 624</a></span>
<span class="normal"><a href="#__codelineno-0-625"> 625</a></span>
<span class="normal"><a href="#__codelineno-0-626"> 626</a></span>
<span class="normal"><a href="#__codelineno-0-627"> 627</a></span>
<span class="normal"><a href="#__codelineno-0-628"> 628</a></span>
<span class="normal"><a href="#__codelineno-0-629"> 629</a></span>
<span class="normal"><a href="#__codelineno-0-630"> 630</a></span>
<span class="normal"><a href="#__codelineno-0-631"> 631</a></span>
<span class="normal"><a href="#__codelineno-0-632"> 632</a></span>
<span class="normal"><a href="#__codelineno-0-633"> 633</a></span>
<span class="normal"><a href="#__codelineno-0-634"> 634</a></span>
<span class="normal"><a href="#__codelineno-0-635"> 635</a></span>
<span class="normal"><a href="#__codelineno-0-636"> 636</a></span>
<span class="normal"><a href="#__codelineno-0-637"> 637</a></span>
<span class="normal"><a href="#__codelineno-0-638"> 638</a></span>
<span class="normal"><a href="#__codelineno-0-639"> 639</a></span>
<span class="normal"><a href="#__codelineno-0-640"> 640</a></span>
<span class="normal"><a href="#__codelineno-0-641"> 641</a></span>
<span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">class</span><span class="w"> </span><span class="nc">TricysSALibAnalyzer</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Integrated SALib&#39;s Tricys Sensitivity Analyzer.</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    Supported Analysis Methods:</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    - Sobol: Variance-based global sensitivity analysis</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    - Morris: Screening-based sensitivity analysis</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    - FAST: Fourier Amplitude Sensitivity Test</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    - LHS: Latin Hypercube Sampling uncertainty analysis</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        base_config: Copy of the Tricys base configuration.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        problem: SALib problem definition dictionary.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        parameter_samples: Generated parameter samples array.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        simulation_results: Results from simulations.</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        sensitivity_results: Dictionary storing sensitivity analysis results by method.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        Automatically sets up Chinese font support and validates Tricys configuration</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        on initialization. Supports multiple sensitivity analysis methods with appropriate</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        sampling strategies.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the analyzer.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            base_config: Tricys base configuration dictionary.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        Note:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            Creates a deep copy of base_config. Initializes problem, samples, and results</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            to None. Calls _setup_chinese_font() and _validate_tricys_config() automatically.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_config</span> <span class="o">=</span> <span class="n">base_config</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_chinese_font</span><span class="p">()</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tricys_config</span><span class="p">()</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_chinese_font</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the Chinese font to ensure proper display of Chinese characters in charts.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        Note:</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            Tries multiple Chinese fonts in order of preference. Falls back to default</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            if no Chinese font found. Also sets axes.unicode_minus to False for proper</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            minus sign display. Logs warnings if font setup fails.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.font_manager</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fm</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">chinese_fonts</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>                <span class="s2">&quot;SimHei&quot;</span><span class="p">,</span>  <span class="c1"># 黑体</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>                <span class="s2">&quot;Microsoft YaHei&quot;</span><span class="p">,</span>  <span class="c1"># 微软雅黑</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>                <span class="s2">&quot;KaiTi&quot;</span><span class="p">,</span>  <span class="c1"># 楷体</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>                <span class="s2">&quot;FangSong&quot;</span><span class="p">,</span>  <span class="c1"># 仿宋</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>                <span class="s2">&quot;STSong&quot;</span><span class="p">,</span>  <span class="c1"># 华文宋体</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>                <span class="s2">&quot;STKaiti&quot;</span><span class="p">,</span>  <span class="c1"># 华文楷体</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="s2">&quot;STHeiti&quot;</span><span class="p">,</span>  <span class="c1"># 华文黑体</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="s2">&quot;DejaVu Sans&quot;</span><span class="p">,</span>  <span class="c1"># 备用字体</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>                <span class="s2">&quot;Arial Unicode MS&quot;</span><span class="p">,</span>  <span class="c1"># 备用字体</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="p">]</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">available_font</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">system_fonts</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fm</span><span class="o">.</span><span class="n">fontManager</span><span class="o">.</span><span class="n">ttflist</span><span class="p">]</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="k">for</span> <span class="n">font</span> <span class="ow">in</span> <span class="n">chinese_fonts</span><span class="p">:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>                <span class="k">if</span> <span class="n">font</span> <span class="ow">in</span> <span class="n">system_fonts</span><span class="p">:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>                    <span class="n">available_font</span> <span class="o">=</span> <span class="n">font</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>                    <span class="k">break</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="k">if</span> <span class="n">available_font</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>                <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.sans-serif&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">available_font</span><span class="p">]</span> <span class="o">+</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>                    <span class="s2">&quot;font.sans-serif&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>                <span class="p">]</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using Chinese font&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;font&quot;</span><span class="p">:</span> <span class="n">available_font</span><span class="p">})</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>                    <span class="s2">&quot;No suitable Chinese font found, which may affect Chinese display&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>                <span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.unicode_minus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>                <span class="s2">&quot;Failed to set Chinese font, using default font&quot;</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)},</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="p">)</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_nan_values</span><span class="p">(</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">method_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Sensitivity analysis&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        Handling NaN values with maximum interpolation</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">            Y: Output array that may contain NaN values</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">            method_name: Analysis method name for logging</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">            Processed output array</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">nan_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nan_indices</span><span class="p">):</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">n_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nan_indices</span><span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                <span class="s2">&quot;Found NaN values, using maximum value for imputation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>                    <span class="s2">&quot;method_name&quot;</span><span class="p">:</span> <span class="n">method_name</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>                    <span class="s2">&quot;nan_count&quot;</span><span class="p">:</span> <span class="n">n_nan</span><span class="p">,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>                <span class="p">},</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">valid_values</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="o">~</span><span class="n">nan_indices</span><span class="p">]</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="n">max_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">valid_values</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="n">Y_processed</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="n">Y_processed</span><span class="p">[</span><span class="n">nan_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_value</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                <span class="k">return</span> <span class="n">Y_processed</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                    <span class="s2">&quot;All values are NaN, analysis cannot be performed&quot;</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                        <span class="s2">&quot;method_name&quot;</span><span class="p">:</span> <span class="n">method_name</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                    <span class="p">},</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                <span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method_name</span><span class="si">}</span><span class="s2">: All simulation results are NaN, sensitivity analysis cannot be performed&quot;</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="k">return</span> <span class="n">Y</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_tricys_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the Tricys configuration for required sections and keys.&quot;&quot;&quot;</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="n">required_keys</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="s2">&quot;paths&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;package_path&quot;</span><span class="p">],</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="s2">&quot;simulation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">,</span> <span class="s2">&quot;stop_time&quot;</span><span class="p">],</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="p">}</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="k">for</span> <span class="n">section</span><span class="p">,</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="k">if</span> <span class="n">section</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                    <span class="s2">&quot;Missing configuration section, default values will be used&quot;</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                        <span class="s2">&quot;section&quot;</span><span class="p">:</span> <span class="n">section</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                    <span class="p">},</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>                <span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>                <span class="k">continue</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="p">[</span><span class="n">section</span><span class="p">]:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                        <span class="s2">&quot;Missing configuration item, using default value&quot;</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                            <span class="s2">&quot;section&quot;</span><span class="p">:</span> <span class="n">section</span><span class="p">,</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                        <span class="p">},</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                    <span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="n">package_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;paths&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;package_path&quot;</span><span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="k">if</span> <span class="n">package_path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">package_path</span><span class="p">):</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="s2">&quot;Model file does not exist, which may cause simulation failure&quot;</span><span class="p">,</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                    <span class="s2">&quot;package_path&quot;</span><span class="p">:</span> <span class="n">package_path</span><span class="p">,</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                <span class="p">},</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_find_unit_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unit_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        Finds the unit configuration for a variable name from the unit_map.</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        1. Checks for an exact match.</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        2. Checks if the last part of a dot-separated name matches.</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        3. Checks for a simple substring containment as a fallback, matching longest keys first.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">unit_map</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">var_name</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">unit_map</span><span class="p">:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="k">return</span> <span class="n">unit_map</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="n">components</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">components</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">unit_map</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>            <span class="k">return</span> <span class="n">unit_map</span><span class="p">[</span><span class="n">components</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="c1"># Fallback to substring match, longest key first</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">unit_map</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">var_name</span><span class="p">:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="k">return</span> <span class="n">unit_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">define_problem</span><span class="p">(</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">param_bounds</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="n">param_distributions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Define SALib problem space.</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">            param_bounds: Parameter bounds dictionary {&#39;param_name&#39;: (min_val, max_val)}.</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">            param_distributions: Parameter distribution type dictionary {&#39;param_name&#39;: &#39;unif&#39;/&#39;norm&#39;/etc}.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">                Valid distribution types: &#39;unif&#39;, &#39;triang&#39;, &#39;norm&#39;, &#39;truncnorm&#39;, &#39;lognorm&#39;.</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">            SALib problem definition dictionary.</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        Note:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">            Defaults to &#39;unif&#39; distribution if not specified. Validates distribution types</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">            and warns if invalid. Logs parameter definitions including bounds and distributions.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="k">if</span> <span class="n">param_distributions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="n">param_distributions</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&quot;unif&quot;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">param_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="n">valid_dists</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unif&quot;</span><span class="p">,</span> <span class="s2">&quot;triang&quot;</span><span class="p">,</span> <span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="s2">&quot;truncnorm&quot;</span><span class="p">,</span> <span class="s2">&quot;lognorm&quot;</span><span class="p">]</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dist</span> <span class="ow">in</span> <span class="n">param_distributions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>            <span class="k">if</span> <span class="n">dist</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_dists</span><span class="p">:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                    <span class="s2">&quot;Invalid distribution type, using &#39;unif&#39; instead&quot;</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                        <span class="s2">&quot;parameter_name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                        <span class="s2">&quot;invalid_distribution&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                    <span class="p">},</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                <span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                <span class="n">param_distributions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;unif&quot;</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="s2">&quot;num_vars&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_bounds</span><span class="p">),</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="s2">&quot;names&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_bounds</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="s2">&quot;dists&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                <span class="n">param_distributions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;unif&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">param_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="p">],</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="p">}</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="s2">&quot;Defined a problem space&quot;</span><span class="p">,</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>                <span class="s2">&quot;num_parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;num_vars&quot;</span><span class="p">],</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="p">},</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="p">)</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                <span class="s2">&quot;Parameter definition&quot;</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                    <span class="s2">&quot;parameter_name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                    <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                    <span class="s2">&quot;distribution&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;dists&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>                <span class="p">},</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_samples</span><span class="p">(</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sobol&quot;</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate parameter samples.</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">            method: Sampling method (&#39;sobol&#39;, &#39;morris&#39;, &#39;fast&#39;, &#39;latin&#39;).</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">            N: Number of samples (for Sobol this is the base sample count, actual count is N*(2*D+2)).</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">            **kwargs: Method-specific parameters.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">            Parameter sample array (n_samples, n_params).</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">            ValueError: If problem not defined or unsupported method.</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        Note:</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">            Sobol generates N*(2*D+2) samples. Morris generates N trajectories. Samples are</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">            rounded to 5 decimal places. Stores last sampling method for compatibility checking.</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>                <span class="s2">&quot;You must first call define_problem() to define the problem space.&quot;</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="s2">&quot;Generating samples&quot;</span><span class="p">,</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                <span class="s2">&quot;base_sample_count&quot;</span><span class="p">:</span> <span class="n">N</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="p">},</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="p">)</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sobol&quot;</span><span class="p">:</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>            <span class="c1"># Sobol method: generate N*(2*D+2) samples</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">saltelli</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="n">actual_samples</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;num_vars&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;morris&quot;</span><span class="p">:</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="c1"># Morris method: Generate N trajectories</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="c1"># Note: Different versions of SALib may have different parameter names</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="n">morris_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;num_levels&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>            <span class="c1"># Check the SALib version and use the correct parameter names</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>                <span class="n">morris_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">morris</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="o">**</span><span class="n">morris_kwargs</span><span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>                <span class="k">if</span> <span class="s2">&quot;grid_jump&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>                    <span class="n">morris_kwargs</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                        <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">morris_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;grid_jump&quot;</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                    <span class="p">}</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                    <span class="n">morris_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                        <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;grid_jump&quot;</span><span class="p">}</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>                    <span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">morris</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="o">**</span><span class="n">morris_kwargs</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>                    <span class="p">)</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>                    <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="n">actual_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;fast&quot;</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>            <span class="c1"># FAST method</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="n">fast_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>            <span class="n">fast_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">fast_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="o">**</span><span class="n">fast_kwargs</span><span class="p">)</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>            <span class="n">actual_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span><span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;latin&quot;</span><span class="p">:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="c1"># Latin Hypercube Sampling</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">latin</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>            <span class="n">actual_samples</span> <span class="o">=</span> <span class="n">N</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported sampling method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="s2">&quot;Successfully generated samples&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;actual_samples&quot;</span><span class="p">:</span> <span class="n">actual_samples</span><span class="p">}</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parameter sample precision adjusted to 5 decimal places&quot;</span><span class="p">)</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_tricys_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">        Generate sampling parameters and output them as a CSV file, which can be subsequently read by the Tricys simulation engine.</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">            output_metrics: List of output metrics to be extracted (for recording but does not affect CSV generation)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">            max_workers: Number of concurrent worker processes (reserved for compatibility, currently unused)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">            Path to the generated CSV file</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                <span class="s2">&quot;You must first call generate_samples() to generate samples.&quot;</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="k">if</span> <span class="n">output_metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="n">output_metrics</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                <span class="s2">&quot;Startup_Inventory&quot;</span><span class="p">,</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                <span class="s2">&quot;Self_Sufficiency_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>                <span class="s2">&quot;Doubling_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="p">]</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Target output metrics&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;output_metrics&quot;</span><span class="p">:</span> <span class="n">output_metrics</span><span class="p">})</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="n">sampled_param_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="n">base_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="n">csv_output_path</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;paths&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_dir&quot;</span><span class="p">))</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>            <span class="o">/</span> <span class="s2">&quot;salib_sampling.csv&quot;</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="p">)</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">csv_output_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>        <span class="n">param_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span><span class="p">):</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>            <span class="n">sampled_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>                <span class="n">sampled_param_names</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span> <span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sampled_param_names</span><span class="p">))</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>            <span class="p">}</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>            <span class="n">job_params</span> <span class="o">=</span> <span class="n">base_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>            <span class="n">job_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sampled_params</span><span class="p">)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="n">param_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job_params</span><span class="p">)</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">param_data</span><span class="p">)</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span> <span class="s2">&quot;float32&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>            <span class="s2">&quot;Successfully generated parameter samples&quot;</span><span class="p">,</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>            <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_samples&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_data</span><span class="p">)},</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>        <span class="p">)</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parameter file saved&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">csv_output_path</span><span class="p">})</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parameter file columns&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)})</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parameter precision set to 5 decimal places&quot;</span><span class="p">)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sample statistics&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;statistics&quot;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()})</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sampling_csv_path</span> <span class="o">=</span> <span class="n">csv_output_path</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="k">return</span> <span class="n">csv_output_path</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_tricys_config</span><span class="p">(</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">csv_file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">output_metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">        Generate Tricys configuration file for reading CSV parameter files and executing simulations</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">        This function reuses the base configuration and specifically modifies simulation_parameters and analysis_case for file-based SALib runs</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">            csv_file_path: Path to the CSV parameter file. If None, the last generated file is used</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">            output_metrics: List of output metrics to be calculated</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">            Path of the generated configuration file</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="k">if</span> <span class="n">csv_file_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;sampling_csv_path&quot;</span><span class="p">):</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                <span class="n">csv_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_csv_path</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                    <span class="s2">&quot;CSV file path not found, please first call run_tricys_simulations() or specify csv_file_path&quot;</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                <span class="p">)</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="k">if</span> <span class="n">output_metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="n">output_metrics</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                <span class="s2">&quot;Startup_Inventory&quot;</span><span class="p">,</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                <span class="s2">&quot;Self_Sufficiency_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                <span class="s2">&quot;Doubling_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>            <span class="p">]</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="n">csv_abs_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="n">tricys_config</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="p">)</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="n">tricys_config</span><span class="p">[</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">csv_abs_path</span><span class="p">}</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="k">if</span> <span class="s2">&quot;sensitivity_analysis&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tricys_config</span><span class="p">:</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>            <span class="n">tricys_config</span><span class="p">[</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="n">tricys_config</span><span class="p">[</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">][</span><span class="s2">&quot;analysis_case&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;SALib_Analysis&quot;</span><span class="p">,</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>            <span class="s2">&quot;independent_variable&quot;</span><span class="p">:</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="s2">&quot;independent_variable_sampling&quot;</span><span class="p">:</span> <span class="n">csv_abs_path</span><span class="p">,</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>            <span class="s2">&quot;dependent_variables&quot;</span><span class="p">:</span> <span class="n">output_metrics</span><span class="p">,</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="p">}</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="k">return</span> <span class="n">tricys_config</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_tricys_results</span><span class="p">(</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">sensitivity_summary_csv</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">        Read simulation results from the sensitivity_analysis_summary.csv file output by Tricys</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">            sensitivity_summary_csv: Path to the sensitivity analysis summary CSV file output by Tricys</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">            output_metrics: List of output metrics to extract</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">            Simulation result array (n_samples, n_metrics)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="k">if</span> <span class="n">output_metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>            <span class="n">output_metrics</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>                <span class="s2">&quot;Startup_Inventory&quot;</span><span class="p">,</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>                <span class="s2">&quot;Self_Sufficiency_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>                <span class="s2">&quot;Doubling_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>            <span class="p">]</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read data from the Tricys result file: </span><span class="si">{</span><span class="n">sensitivity_summary_csv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">sensitivity_summary_csv</span><span class="p">)</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> simulation results&quot;</span><span class="p">)</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Result file columns: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="n">param_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>        <span class="n">metric_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">output_metrics</span><span class="p">:</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                <span class="n">metric_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="k">elif</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span> <span class="k">else</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>                <span class="n">param_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recognized parameter columns: </span><span class="si">{</span><span class="n">param_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Identified metric columns: </span><span class="si">{</span><span class="n">metric_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="n">ordered_metric_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">output_metrics</span><span class="p">:</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>            <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_cols</span><span class="p">:</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>                <span class="n">ordered_metric_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metric column not found: </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ordered_metric_cols</span><span class="p">:</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No valid output metrics columns found: </span><span class="si">{</span><span class="n">output_metrics</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="n">results_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ordered_metric_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span> <span class="o">=</span> <span class="n">results_data</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded simulation results: </span><span class="si">{</span><span class="n">results_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>            <span class="sa">f</span><span class="s2">&quot;Result Statistics:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_data</span><span class="p">,</span><span class="w"> </span><span class="n">columns</span><span class="o">=</span><span class="n">ordered_metric_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>        <span class="p">)</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>            <span class="sa">f</span><span class="s2">&quot;Result preview:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_data</span><span class="p">,</span><span class="w"> </span><span class="n">columns</span><span class="o">=</span><span class="n">metric_cols</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>        <span class="p">)</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_compatible_analysis_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling_method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">        Get analysis methods compatible with the specified sampling method.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">            sampling_method: Sampling method</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">            List of compatible analysis methods</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>        <span class="n">compatibility_map</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>            <span class="s2">&quot;sobol&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">],</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>            <span class="s2">&quot;morris&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;morris&quot;</span><span class="p">],</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>            <span class="s2">&quot;fast&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;fast&quot;</span><span class="p">],</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>            <span class="s2">&quot;latin&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">],</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>            <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="p">[],</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="p">}</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="k">return</span> <span class="n">compatibility_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sampling_method</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_tricys_analysis</span><span class="p">(</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">csv_file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">output_metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">        Run the Tricys simulation using the generated CSV parameter file and obtain the sensitivity analysis results</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">            csv_file_path: Path to the CSV parameter file. If None, the last generated file will be used</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">            output_metrics: List of output metrics to be calculated</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">            config_output_path: Path for the configuration file output. If None, it will be automatically generated</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">            Path to the sensitivity_analysis_summary.csv file</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="c1"># Generate Tricys configuration file</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>        <span class="n">tricys_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_tricys_config</span><span class="p">(</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>            <span class="n">csv_file_path</span><span class="o">=</span><span class="n">csv_file_path</span><span class="p">,</span> <span class="n">output_metrics</span><span class="o">=</span><span class="n">output_metrics</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>        <span class="p">)</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting Tricys simulation analysis...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>            <span class="c1"># Call the Tricys simulation engine</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">tricys.simulation.simulation_analysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_simulation</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>            <span class="n">tricys_config</span><span class="p">[</span><span class="s2">&quot;run_timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>            <span class="n">run_simulation</span><span class="p">(</span><span class="n">tricys_config</span><span class="p">)</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>            <span class="n">results_dir</span> <span class="o">=</span> <span class="n">tricys_config</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">][</span><span class="s2">&quot;results_dir&quot;</span><span class="p">]</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">results_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;sensitivity_analysis_summary.csv&quot;</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tricys simulation execution failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="k">raise</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_sobol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">        Perform Sobol Sensitivity Analysis</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="sd">            output_index: Output variable index</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="sd">            **kwargs: Sobol analysis parameters</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">            Sobol sensitivity analysis results</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">        Note:</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="sd">            Sobol analysis requires samples generated using the Saltelli sampling method!</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">            Results from Morris or FAST sampling cannot be used.</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The simulation must be run first to obtain the results.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>        <span class="c1"># Check sampling method compatibility</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>            <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_last_sampling_method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span> <span class="o">!=</span> <span class="s2">&quot;sobol&quot;</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>        <span class="p">):</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>                <span class="sa">f</span><span class="s2">&quot;⚠️ Currently using </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span><span class="si">}</span><span class="s2"> sampling, but Sobol analysis requires Saltelli sampling!&quot;</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>            <span class="p">)</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>                <span class="s2">&quot;Suggestion: Regenerate samples using generate_samples(&#39;sobol&#39;)&quot;</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>            <span class="p">)</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_nan_values</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="s2">&quot;Sobol分析&quot;</span><span class="p">)</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>        <span class="c1"># Remove NaN values</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>        <span class="c1"># valid_indices = ~np.isnan(Y)</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>        <span class="c1"># if not np.all(valid_indices):</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>        <span class="c1">#    logger.warning(f&quot;发现{np.sum(~valid_indices)}个无效结果，将被排除&quot;)</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>        <span class="c1">#    Y = Y[valid_indices]</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>        <span class="c1">#    X = self.parameter_samples[valid_indices]</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>        <span class="c1"># else:</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>        <span class="c1">#    X = self.parameter_samples</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>            <span class="n">Si</span> <span class="o">=</span> <span class="n">sobol</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>            <span class="k">if</span> <span class="s2">&quot;sobol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>            <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>                <span class="s2">&quot;output_index&quot;</span><span class="p">:</span> <span class="n">output_index</span><span class="p">,</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>                <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">,</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>                <span class="s2">&quot;S1&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">],</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                <span class="s2">&quot;ST&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">],</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                <span class="s2">&quot;S2&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;S2&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>                <span class="s2">&quot;S1_conf&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;S1_conf&quot;</span><span class="p">],</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>                <span class="s2">&quot;ST_conf&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;ST_conf&quot;</span><span class="p">],</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>                <span class="s2">&quot;sampling_method&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_last_sampling_method&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>            <span class="p">}</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sobol sensitivity analysis completed (index </span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>            <span class="k">if</span> <span class="s2">&quot;saltelli&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;sample&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>                    <span class="sa">f</span><span class="s2">&quot;Sobol analysis failed, possibly due to incompatible sampling method: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">Please regenerate samples using generate_samples(&#39;sobol&#39;)&quot;</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>                <span class="k">raise</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_morris</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="sd">        Perform Morris sensitivity analysis</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">            output_index: Output variable index</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">            **kwargs: Morris analysis parameters</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">            Morris sensitivity analysis results</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The simulation must be run first to obtain the results.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_nan_values</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="s2">&quot;Morris分析&quot;</span><span class="p">)</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>        <span class="c1"># Remove NaN values</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>        <span class="c1"># valid_indices = ~np.isnan(Y)</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>        <span class="c1"># if not np.all(valid_indices):</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="c1">#    logger.warning(f&quot;发现{np.sum(~valid_indices)}个无效结果，将被排除&quot;)</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>        <span class="c1">#    Y = Y[valid_indices]</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>        <span class="c1">#    X = self.parameter_samples[valid_indices]</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>        <span class="c1"># else:</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="c1">#    X = self.parameter_samples</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>        <span class="c1"># Perform Morris analysis</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="sa">f</span><span class="s2">&quot;Start Morris sensitivity analysis: X.shape=</span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, Y.shape=</span><span class="si">{</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, X.dtype=</span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="p">)</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>            <span class="n">Si</span> <span class="o">=</span> <span class="n">morris_analyze</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Morris analysis execution failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;problem: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X shape: </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, type: </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Yshape: </span><span class="si">{</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, type: </span><span class="si">{</span><span class="n">Y</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">X</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                    <span class="s2">&quot;X contains non-numeric data, please check the sampled data&quot;</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                <span class="p">)</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>            <span class="k">raise</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>        <span class="k">if</span> <span class="s2">&quot;morris&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;morris&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>        <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;morris&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>            <span class="s2">&quot;output_index&quot;</span><span class="p">:</span> <span class="n">output_index</span><span class="p">,</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>            <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">,</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>            <span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>            <span class="s2">&quot;mu_star&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">],</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>            <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">],</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>            <span class="s2">&quot;mu_star_conf&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu_star_conf&quot;</span><span class="p">],</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>        <span class="p">}</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Morris sensitivity analysis completed (metric </span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;morris&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_fast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">        Perform FAST sensitivity analysis</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">            output_index: Output variable index</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a><span class="sd">            **kwargs: FAST analysis parameters</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="sd">            FAST sensitivity analysis results</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="sd">        Note:</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">            FAST analysis requires samples generated by the fast_sampler sampling method!</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">            Results from Morris or Sobol sampling cannot be used.</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The simulation must be run first to obtain the results.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>            <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_last_sampling_method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span> <span class="o">!=</span> <span class="s2">&quot;fast&quot;</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>        <span class="p">):</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>                <span class="sa">f</span><span class="s2">&quot;⚠️ The current sampling method is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span><span class="si">}</span><span class="s2">, but FAST analysis requires FAST sampling!&quot;</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>            <span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>                <span class="s2">&quot;Suggestion: Regenerate samples using generate_samples(&#39;fast&#39;)&quot;</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>            <span class="p">)</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_nan_values</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="s2">&quot;FAST分析&quot;</span><span class="p">)</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>        <span class="c1"># Remove NaN values</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>        <span class="c1"># valid_indices = ~np.isnan(Y)</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>        <span class="c1"># if not np.all(valid_indices):</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>        <span class="c1">#    logger.warning(f&quot;发现{np.sum(~valid_indices)}个无效结果，将被排除&quot;)</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>        <span class="c1">#    Y = Y[valid_indices]</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>            <span class="c1"># Perform FAST analysis</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>            <span class="n">Si</span> <span class="o">=</span> <span class="n">fast</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>            <span class="k">if</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;fast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>            <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;fast&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>                <span class="s2">&quot;output_index&quot;</span><span class="p">:</span> <span class="n">output_index</span><span class="p">,</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>                <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">,</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>                <span class="s2">&quot;S1&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">],</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>                <span class="s2">&quot;ST&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">],</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>                <span class="s2">&quot;sampling_method&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_last_sampling_method&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>            <span class="p">}</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>                <span class="sa">f</span><span class="s2">&quot;FAST sensitivity analysis completed (indicator </span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>            <span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;fast&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>            <span class="k">if</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;sample&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>                    <span class="sa">f</span><span class="s2">&quot;FAST analysis failed, possibly due to incompatible sampling method: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">Please regenerate samples using generate_samples(&#39;fast&#39;)&quot;</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>                <span class="k">raise</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_lhs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">        Perform LHS (Latin Hypercube Sampling) uncertainty analysis</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a><span class="sd">        Note: This is a basic statistical analysis method for LHS samples,</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a><span class="sd">        providing descriptive statistics and basic sensitivity indices.</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a><span class="sd">            output_index: Output variable index</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="sd">            **kwargs: Analysis parameters (reserved for future use)</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="sd">            LHS uncertainty analysis results</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The simulation must be run first to obtain the results.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>            <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_last_sampling_method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span> <span class="o">!=</span> <span class="s2">&quot;latin&quot;</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>        <span class="p">):</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>                <span class="sa">f</span><span class="s2">&quot;⚠️ The current sampling method is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span><span class="si">}</span><span class="s2">, but LHS analysis is designed for Latin Hypercube Sampling!&quot;</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>            <span class="p">)</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>                <span class="s2">&quot;Suggestion: Regenerate samples using generate_samples(&#39;latin&#39;)&quot;</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>            <span class="p">)</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>        <span class="c1"># Handle NaN values</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_nan_values</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="s2">&quot;LHS分析&quot;</span><span class="p">)</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>        <span class="c1"># Basic statistical analysis</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>        <span class="n">mean_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>        <span class="n">std_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>        <span class="n">min_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>        <span class="n">max_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>        <span class="n">percentile_5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>        <span class="n">percentile_95</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>        <span class="c1"># Create results dictionary</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>        <span class="n">Si</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">mean_val</span><span class="p">,</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">std_val</span><span class="p">,</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">min_val</span><span class="p">,</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">max_val</span><span class="p">,</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>            <span class="s2">&quot;percentile_5&quot;</span><span class="p">:</span> <span class="n">percentile_5</span><span class="p">,</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>            <span class="s2">&quot;percentile_95&quot;</span><span class="p">:</span> <span class="n">percentile_95</span><span class="p">,</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>        <span class="p">}</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>        <span class="k">if</span> <span class="s2">&quot;latin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>        <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>            <span class="s2">&quot;output_index&quot;</span><span class="p">:</span> <span class="n">output_index</span><span class="p">,</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>            <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">,</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">mean_val</span><span class="p">,</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">std_val</span><span class="p">,</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">min_val</span><span class="p">,</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">max_val</span><span class="p">,</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>            <span class="s2">&quot;percentile_5&quot;</span><span class="p">:</span> <span class="n">percentile_5</span><span class="p">,</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>            <span class="s2">&quot;percentile_95&quot;</span><span class="p">:</span> <span class="n">percentile_95</span><span class="p">,</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>            <span class="s2">&quot;sampling_method&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_last_sampling_method&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>        <span class="p">}</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LHS uncertainty analysis completed (指标 </span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_salib_analysis_from_tricys_results</span><span class="p">(</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>        <span class="n">sensitivity_summary_csv</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>        <span class="n">param_bounds</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>        <span class="n">output_metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>        <span class="n">methods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">,</span> <span class="s2">&quot;morris&quot;</span><span class="p">,</span> <span class="s2">&quot;fast&quot;</span><span class="p">],</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>        <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a><span class="sd">        Run a complete SALib sensitivity analysis from the sensitivity analysis results file output by Tricys</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a><span class="sd">            sensitivity_summary_csv: Path to the sensitivity summary CSV file output by Tricys</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a><span class="sd">            param_bounds: Dictionary of parameter bounds, inferred from the CSV file if None</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a><span class="sd">            output_metrics: List of output metrics to analyze</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="sd">            methods: List of sensitivity analysis methods to execute</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="sd">            save_dir: Directory to save the results</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">            Dictionary containing all analysis results</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>        <span class="k">if</span> <span class="n">output_metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>            <span class="n">output_metrics</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>                <span class="s2">&quot;Startup_Inventory&quot;</span><span class="p">,</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>                <span class="s2">&quot;Self_Sufficiency_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>                <span class="s2">&quot;Doubling_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>            <span class="p">]</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>            <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sensitivity_summary_csv</span><span class="p">),</span> <span class="s2">&quot;salib_analysis&quot;</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>            <span class="p">)</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">sensitivity_summary_csv</span><span class="p">)</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>        <span class="k">if</span> <span class="n">param_bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>            <span class="n">param_bounds</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>            <span class="n">param_candidates</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>                <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output_metrics</span> <span class="ow">and</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>                    <span class="n">param_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">param_candidates</span><span class="p">:</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>                <span class="n">param_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>                    <span class="n">param_bounds</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">param_data</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">param_data</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">param_bounds</span><span class="p">:</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>                <span class="s2">&quot;Unable to determine parameter boundaries, please provide the param_bounds parameter&quot;</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>            <span class="p">)</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">define_problem</span><span class="p">(</span><span class="n">param_bounds</span><span class="p">)</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_tricys_results</span><span class="p">(</span><span class="n">sensitivity_summary_csv</span><span class="p">,</span> <span class="n">output_metrics</span><span class="p">)</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>        <span class="n">detected_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>        <span class="n">methods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compatible_analysis_methods</span><span class="p">(</span><span class="n">detected_method</span><span class="p">)</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>        <span class="n">all_results</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>        <span class="k">for</span> <span class="n">metric_idx</span><span class="p">,</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">output_metrics</span><span class="p">):</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>            <span class="k">if</span> <span class="n">metric_idx</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The metric </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> is out of range, skipping&quot;</span><span class="p">)</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>                <span class="k">continue</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Analysis indicators: </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>            <span class="n">metric_results</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>            <span class="c1"># Check data validity</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>            <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">metric_idx</span><span class="p">]</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>            <span class="n">valid_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Valid data ratio: </span><span class="si">{</span><span class="n">valid_ratio</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>            <span class="k">if</span> <span class="n">valid_ratio</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>                    <span class="sa">f</span><span class="s2">&quot;The metric </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> has less than 50% valid data, which may affect the analysis quality.&quot;</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>                <span class="p">)</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>            <span class="c1"># Sobol analysis</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>            <span class="k">if</span> <span class="s2">&quot;sobol&quot;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing Sobol sensitivity analysis...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>                    <span class="n">sobol_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_sobol</span><span class="p">(</span><span class="n">output_index</span><span class="o">=</span><span class="n">metric_idx</span><span class="p">)</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>                    <span class="n">metric_results</span><span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sobol_result</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>                    <span class="c1"># Display Sobol results summary</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sobol sensitivity index:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>                        <span class="n">s1</span> <span class="o">=</span> <span class="n">sobol_result</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>                        <span class="n">st</span> <span class="o">=</span> <span class="n">sobol_result</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">: S1=</span><span class="si">{</span><span class="n">s1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, ST=</span><span class="si">{</span><span class="n">st</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sobol analysis failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>            <span class="c1"># Morris analysis</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>            <span class="k">if</span> <span class="s2">&quot;morris&quot;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing Morris sensitivity analysis...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>                    <span class="n">morris_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_morris</span><span class="p">(</span><span class="n">output_index</span><span class="o">=</span><span class="n">metric_idx</span><span class="p">)</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>                    <span class="n">metric_results</span><span class="p">[</span><span class="s2">&quot;morris&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">morris_result</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>                    <span class="c1"># Display Morris results summary</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Morris sensitivity index:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>                        <span class="n">mu_star</span> <span class="o">=</span> <span class="n">morris_result</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>                        <span class="n">sigma</span> <span class="o">=</span> <span class="n">morris_result</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">: μ*=</span><span class="si">{</span><span class="n">mu_star</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, σ=</span><span class="si">{</span><span class="n">sigma</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Morris analysis failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>            <span class="c1"># FAST analysis</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>            <span class="k">if</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing FAST sensitivity analysis...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>                    <span class="n">fast_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_fast</span><span class="p">(</span><span class="n">output_index</span><span class="o">=</span><span class="n">metric_idx</span><span class="p">)</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>                    <span class="n">metric_results</span><span class="p">[</span><span class="s2">&quot;fast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fast_result</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                    <span class="c1"># Display FAST results summary</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">FAST sensitivity index:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                        <span class="n">s1</span> <span class="o">=</span> <span class="n">fast_result</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                        <span class="n">st</span> <span class="o">=</span> <span class="n">fast_result</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">: S1=</span><span class="si">{</span><span class="n">s1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, ST=</span><span class="si">{</span><span class="n">st</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FAST analysis failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>            <span class="c1"># LHS analysis</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>            <span class="k">if</span> <span class="s2">&quot;latin&quot;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing LHS uncertainty analysis...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>                    <span class="n">lhs_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_lhs</span><span class="p">(</span><span class="n">output_index</span><span class="o">=</span><span class="n">metric_idx</span><span class="p">)</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>                    <span class="n">metric_results</span><span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lhs_result</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>                    <span class="c1"># Display LHS results summary</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">LHS分析结果:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  均值: </span><span class="si">{</span><span class="n">lhs_result</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  标准差: </span><span class="si">{</span><span class="n">lhs_result</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  最小值: </span><span class="si">{</span><span class="n">lhs_result</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  最大值: </span><span class="si">{</span><span class="n">lhs_result</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  5%分位数: </span><span class="si">{</span><span class="n">lhs_result</span><span class="p">[</span><span class="s1">&#39;percentile_5&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  95%分位数: </span><span class="si">{</span><span class="n">lhs_result</span><span class="p">[</span><span class="s1">&#39;percentile_95&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LHS分析失败: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>            <span class="n">all_results</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_results</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>            <span class="k">if</span> <span class="s2">&quot;sobol&quot;</span> <span class="ow">in</span> <span class="n">methods</span> <span class="ow">and</span> <span class="s2">&quot;sobol&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plot_sobol_results</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">output_metrics</span><span class="p">)</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>            <span class="k">if</span> <span class="s2">&quot;morris&quot;</span> <span class="ow">in</span> <span class="n">methods</span> <span class="ow">and</span> <span class="s2">&quot;morris&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plot_morris_results</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">output_metrics</span><span class="p">)</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>            <span class="k">if</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">in</span> <span class="n">methods</span> <span class="ow">and</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plot_fast_results</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">output_metrics</span><span class="p">)</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>            <span class="c1"># Plot LHS results</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>            <span class="k">if</span> <span class="s2">&quot;latin&quot;</span> <span class="ow">in</span> <span class="n">methods</span> <span class="ow">and</span> <span class="s2">&quot;latin&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plot_lhs_results</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">output_metrics</span><span class="p">)</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Drawing failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">save_results</span><span class="p">(</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>                <span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">output_metrics</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>            <span class="p">)</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>            <span class="n">report_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_sensitivity_report</span><span class="p">(</span><span class="n">all_results</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">)</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>            <span class="n">report_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="s2">&quot;analysis_report.md&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>            <span class="n">load_dotenv</span><span class="p">()</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>            <span class="c1"># --- LLM Calls for analysis ---</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>            <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;API_KEY&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>            <span class="n">base_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;BASE_URL&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>            <span class="n">ai_model</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;AI_MODEL&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>            <span class="n">sa_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>            <span class="n">case_config</span> <span class="o">=</span> <span class="n">sa_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;analysis_case&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>            <span class="n">ai_config</span> <span class="o">=</span> <span class="n">case_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ai&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>            <span class="n">ai_enabled</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ai_config</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>                <span class="n">ai_enabled</span> <span class="o">=</span> <span class="n">ai_config</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ai_config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>                <span class="n">ai_enabled</span> <span class="o">=</span> <span class="n">ai_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>            <span class="k">if</span> <span class="n">api_key</span> <span class="ow">and</span> <span class="n">base_url</span> <span class="ow">and</span> <span class="n">ai_model</span> <span class="ow">and</span> <span class="n">ai_enabled</span><span class="p">:</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>                <span class="c1"># First LLM call for initial analysis</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>                <span class="n">wrapper_prompt</span><span class="p">,</span> <span class="n">llm_summary</span> <span class="o">=</span> <span class="n">call_llm_for_salib_analysis</span><span class="p">(</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>                    <span class="n">report_content</span><span class="o">=</span><span class="n">report_content</span><span class="p">,</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>                    <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>                    <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>                    <span class="n">ai_model</span><span class="o">=</span><span class="n">ai_model</span><span class="p">,</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>                    <span class="n">method</span><span class="o">=</span><span class="n">detected_method</span><span class="p">,</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>                <span class="p">)</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>                <span class="k">if</span> <span class="n">wrapper_prompt</span> <span class="ow">and</span> <span class="n">llm_summary</span><span class="p">:</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">---</span><span class="se">\n\n</span><span class="s2"># AI模型分析提示词</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;```markdown</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">wrapper_prompt</span><span class="p">)</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">```</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">---</span><span class="se">\n\n</span><span class="s2"># AI模型分析结果</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">llm_summary</span><span class="p">)</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Appended LLM prompt and summary to </span><span class="si">{</span><span class="n">report_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>                    <span class="c1"># Second LLM call for academic report</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>                    <span class="n">glossary_path</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">case_config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>                        <span class="n">glossary_path</span> <span class="o">=</span> <span class="n">sa_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;glossary_path&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>                    <span class="k">if</span> <span class="n">glossary_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">glossary_path</span><span class="p">):</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>                        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>                            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">glossary_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>                                <span class="n">glossary_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>                            <span class="p">(</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>                                <span class="n">academic_wrapper_prompt</span><span class="p">,</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>                                <span class="n">academic_report</span><span class="p">,</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>                            <span class="p">)</span> <span class="o">=</span> <span class="n">call_llm_for_academic_report</span><span class="p">(</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>                                <span class="n">analysis_report</span><span class="o">=</span><span class="n">llm_summary</span><span class="p">,</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>                                <span class="n">glossary_content</span><span class="o">=</span><span class="n">glossary_content</span><span class="p">,</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>                                <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>                                <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>                                <span class="n">ai_model</span><span class="o">=</span><span class="n">ai_model</span><span class="p">,</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>                                <span class="n">problem_details</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>                                <span class="n">metric_names</span><span class="o">=</span><span class="n">output_metrics</span><span class="p">,</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>                                <span class="n">method</span><span class="o">=</span><span class="n">detected_method</span><span class="p">,</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>                                <span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>                            <span class="k">if</span> <span class="n">academic_wrapper_prompt</span> <span class="ow">and</span> <span class="n">academic_report</span><span class="p">:</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>                                <span class="n">academic_report_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>                                    <span class="n">save_dir</span><span class="p">,</span> <span class="s2">&quot;academic_report.md&quot;</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>                                <span class="p">)</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>                                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>                                    <span class="n">academic_report_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>                                <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>                                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">academic_report</span><span class="p">)</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>                                    <span class="sa">f</span><span class="s2">&quot;Generated academic report: </span><span class="si">{</span><span class="n">academic_report_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>                                <span class="p">)</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>                                <span class="sa">f</span><span class="s2">&quot;Failed to generate or save academic report: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>                    <span class="k">elif</span> <span class="n">glossary_path</span><span class="p">:</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>                            <span class="sa">f</span><span class="s2">&quot;Glossary file not found at </span><span class="si">{</span><span class="n">glossary_path</span><span class="si">}</span><span class="s2">, skipping academic report generation.&quot;</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>                    <span class="s2">&quot;API_KEY, BASE_URL, or AI_MODEL not set, or AI analysis is disabled. Skipping LLM summary generation.&quot;</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>                <span class="p">)</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save result: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✅ SALib sensitivity analysis completed!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📁 The result has been saved to: </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>        <span class="k">return</span> <span class="n">all_results</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_save_sensitivity_report</span><span class="p">(</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">all_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The result has been saved to: {save_dir}&quot;&quot;&quot;</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>        <span class="n">report_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="s2">&quot;analysis_report.md&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>        <span class="c1"># Determine analysis type based on sampling method</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>        <span class="n">is_uncertainty_analysis</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>            <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_last_sampling_method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span> <span class="o">==</span> <span class="s2">&quot;latin&quot;</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>        <span class="p">)</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>        <span class="n">report_title</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>            <span class="s2">&quot;# SALib 不确定性分析报告</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>            <span class="k">if</span> <span class="n">is_uncertainty_analysis</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>            <span class="k">else</span> <span class="s2">&quot;# SALib 敏感性分析报告</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>        <span class="p">)</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>        <span class="n">report_lines</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>        <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">report_title</span><span class="p">)</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>        <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;生成时间: </span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>        <span class="c1"># Get unit_map from config</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>        <span class="n">sensitivity_analysis_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>        <span class="n">unit_map</span> <span class="o">=</span> <span class="n">sensitivity_analysis_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit_map&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>        <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;## 分析参数</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">:</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>                <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>                <span class="c1"># --- Unit Conversion Logic for Bounds ---</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>                <span class="n">unit_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_unit_config</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">unit_map</span><span class="p">)</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>                <span class="n">display_bounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>                <span class="n">unit_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>                <span class="k">if</span> <span class="n">unit_config</span><span class="p">:</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>                    <span class="n">unit</span> <span class="o">=</span> <span class="n">unit_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>                    <span class="n">factor</span> <span class="o">=</span> <span class="n">unit_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;conversion_factor&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>                    <span class="k">if</span> <span class="n">factor</span><span class="p">:</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>                        <span class="n">display_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>                        <span class="n">display_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>                    <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>                        <span class="n">unit_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>                <span class="c1"># --- End Conversion Logic ---</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>                    <span class="sa">f</span><span class="s2">&quot;- **</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">**: [</span><span class="si">{</span><span class="n">display_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">display_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">unit_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>                <span class="p">)</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>        <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_results</span> <span class="ow">in</span> <span class="n">all_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>            <span class="n">metric_section_title</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>                <span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> 不确定性分析结果</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>                <span class="k">if</span> <span class="n">is_uncertainty_analysis</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>                <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> 敏感性分析结果</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>            <span class="p">)</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>            <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metric_section_title</span><span class="p">)</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>            <span class="k">if</span> <span class="s2">&quot;sobol&quot;</span> <span class="ow">in</span> <span class="n">metric_results</span><span class="p">:</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;### Sobol敏感性指数</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>                    <span class="s2">&quot;| 参数 | S1 (一阶) | ST (总) | S1置信区间 | ST置信区间 |</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>                <span class="p">)</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>                    <span class="s2">&quot;|------|----------|---------|------------|------------|</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>                <span class="p">)</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>                <span class="n">sobol_data</span> <span class="o">=</span> <span class="n">metric_results</span><span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>                    <span class="n">s1</span> <span class="o">=</span> <span class="n">sobol_data</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>                    <span class="n">st</span> <span class="o">=</span> <span class="n">sobol_data</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>                    <span class="n">s1_conf</span> <span class="o">=</span> <span class="n">sobol_data</span><span class="p">[</span><span class="s2">&quot;S1_conf&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>                    <span class="n">st_conf</span> <span class="o">=</span> <span class="n">sobol_data</span><span class="p">[</span><span class="s2">&quot;ST_conf&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>                        <span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">s1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">st</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> | ±</span><span class="si">{</span><span class="n">s1_conf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> | ±</span><span class="si">{</span><span class="n">st_conf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> |</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>                <span class="n">plot_filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>                    <span class="sa">f</span><span class="s1">&#39;sobol_sensitivity_indices_</span><span class="si">{</span><span class="n">metric_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>                <span class="p">)</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>                    <span class="sa">f</span><span class="s2">&quot;![Sobol Analysis for </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">plot_filename</span><span class="si">}</span><span class="s2">)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>                <span class="p">)</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>            <span class="k">if</span> <span class="s2">&quot;morris&quot;</span> <span class="ow">in</span> <span class="n">metric_results</span><span class="p">:</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;### Morris敏感性指数</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>                    <span class="s2">&quot;| 参数 | μ* (平均绝对效应) | σ (标准差) | μ*置信区间 |</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>                <span class="p">)</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>                    <span class="s2">&quot;|------|-------------------|------------|------------|</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>                <span class="p">)</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>                <span class="n">morris_data</span> <span class="o">=</span> <span class="n">metric_results</span><span class="p">[</span><span class="s2">&quot;morris&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>                    <span class="n">mu_star</span> <span class="o">=</span> <span class="n">morris_data</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>                    <span class="n">sigma</span> <span class="o">=</span> <span class="n">morris_data</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>                    <span class="n">mu_star_conf</span> <span class="o">=</span> <span class="n">morris_data</span><span class="p">[</span><span class="s2">&quot;mu_star_conf&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>                        <span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">mu_star</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">sigma</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> | ±</span><span class="si">{</span><span class="n">mu_star_conf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> |</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>                <span class="n">plot_filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>                    <span class="sa">f</span><span class="s1">&#39;morris_sensitivity_analysis_</span><span class="si">{</span><span class="n">metric_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>                <span class="p">)</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>                    <span class="sa">f</span><span class="s2">&quot;![Morris Analysis for </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">plot_filename</span><span class="si">}</span><span class="s2">)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>                <span class="p">)</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>            <span class="k">if</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">in</span> <span class="n">metric_results</span><span class="p">:</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;### FAST敏感性指数</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;| 参数 | S1 (一阶) | ST (总) |</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;|------|----------|---------|</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>                <span class="n">fast_data</span> <span class="o">=</span> <span class="n">metric_results</span><span class="p">[</span><span class="s2">&quot;fast&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>                    <span class="n">s1</span> <span class="o">=</span> <span class="n">fast_data</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>                    <span class="n">st</span> <span class="o">=</span> <span class="n">fast_data</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">s1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">st</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> |</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>                <span class="n">plot_filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>                    <span class="sa">f</span><span class="s1">&#39;fast_sensitivity_indices_</span><span class="si">{</span><span class="n">metric_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>                <span class="p">)</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>                    <span class="sa">f</span><span class="s2">&quot;![FAST Analysis for </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">plot_filename</span><span class="si">}</span><span class="s2">)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>                <span class="p">)</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>            <span class="k">if</span> <span class="s2">&quot;latin&quot;</span> <span class="ow">in</span> <span class="n">metric_results</span><span class="p">:</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>                <span class="c1"># --- Unit Conversion Logic for Metrics ---</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>                <span class="n">unit_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_unit_config</span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="n">unit_map</span><span class="p">)</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>                <span class="n">unit_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>                <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.0</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>                <span class="k">if</span> <span class="n">unit_config</span><span class="p">:</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>                    <span class="n">unit</span> <span class="o">=</span> <span class="n">unit_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>                    <span class="n">conv_factor</span> <span class="o">=</span> <span class="n">unit_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;conversion_factor&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>                    <span class="k">if</span> <span class="n">conv_factor</span><span class="p">:</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>                        <span class="n">factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">conv_factor</span><span class="p">)</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>                    <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>                        <span class="n">unit_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>                <span class="c1"># --- End Conversion Logic ---</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>                <span class="c1"># 1. Get raw data and clean it</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>                <span class="n">output_index</span> <span class="o">=</span> <span class="n">metric_results</span><span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">][</span><span class="s2">&quot;output_index&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>                <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>                <span class="n">Y_clean</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Y</span><span class="p">)]</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>                <span class="c1"># --- Modify report generation ---</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;### 统计摘要</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>                <span class="n">lhs_data</span> <span class="o">=</span> <span class="n">metric_results</span><span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>                    <span class="sa">f</span><span class="s2">&quot;- 均值: </span><span class="si">{</span><span class="n">lhs_data</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">factor</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}{</span><span class="n">unit_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>                <span class="p">)</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>                    <span class="sa">f</span><span class="s2">&quot;- 标准差: </span><span class="si">{</span><span class="n">lhs_data</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">factor</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}{</span><span class="n">unit_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>                <span class="p">)</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>                    <span class="sa">f</span><span class="s2">&quot;- 最小值: </span><span class="si">{</span><span class="n">lhs_data</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">factor</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}{</span><span class="n">unit_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>                <span class="p">)</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>                    <span class="sa">f</span><span class="s2">&quot;- 最大值: </span><span class="si">{</span><span class="n">lhs_data</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">factor</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}{</span><span class="n">unit_str</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>                <span class="p">)</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>                <span class="c1"># 2. Calculate more percentiles</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y_clean</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>                    <span class="n">percentiles_to_calc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">95</span><span class="p">]</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>                    <span class="n">percentile_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">Y_clean</span><span class="p">,</span> <span class="n">percentiles_to_calc</span><span class="p">)</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;### 分布关键点 (CDF)</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>                        <span class="sa">f</span><span class="s2">&quot;- 5%分位数: </span><span class="si">{</span><span class="n">percentile_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">factor</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}{</span><span class="n">unit_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>                        <span class="sa">f</span><span class="s2">&quot;- 10%分位数: </span><span class="si">{</span><span class="n">percentile_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">factor</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}{</span><span class="n">unit_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>                        <span class="sa">f</span><span class="s2">&quot;- 25%分位数 (Q1): </span><span class="si">{</span><span class="n">percentile_values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">factor</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}{</span><span class="n">unit_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>                        <span class="sa">f</span><span class="s2">&quot;- 50%分位数 (中位数): </span><span class="si">{</span><span class="n">percentile_values</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="n">factor</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}{</span><span class="n">unit_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a>                        <span class="sa">f</span><span class="s2">&quot;- 75%分位数 (Q3): </span><span class="si">{</span><span class="n">percentile_values</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">/</span><span class="n">factor</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}{</span><span class="n">unit_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>                        <span class="sa">f</span><span class="s2">&quot;- 90%分位数: </span><span class="si">{</span><span class="n">percentile_values</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="n">factor</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}{</span><span class="n">unit_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>                        <span class="sa">f</span><span class="s2">&quot;- 95%分位数: </span><span class="si">{</span><span class="n">percentile_values</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">/</span><span class="n">factor</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}{</span><span class="n">unit_str</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>                    <span class="c1"># 3. Calculate histogram data</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>                    <span class="n">hist_freq</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">Y_clean</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;### 输出分布 (直方图数据)</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;| 数值范围 | 频数 |</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;|:---|---:|</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hist_freq</span><span class="p">)):</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>                        <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">factor</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>                        <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">factor</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>                        <span class="n">freq</span> <span class="o">=</span> <span class="n">hist_freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>                        <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>                            <span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">lower_bound</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">upper_bound</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2"> |</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>                    <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>                <span class="n">plot_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;lhs_analysis_</span><span class="si">{</span><span class="n">metric_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>                <span class="n">report_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>                    <span class="sa">f</span><span class="s2">&quot;![LHS Analysis for </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">plot_filename</span><span class="si">}</span><span class="s2">)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>                <span class="p">)</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>        <span class="n">report_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">report_lines</span><span class="p">)</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">report_content</span><span class="p">)</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sensitivity analysis report has been saved.: </span><span class="si">{</span><span class="n">report_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>        <span class="k">return</span> <span class="n">report_content</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_sobol_results</span><span class="p">(</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>        <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>        <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>        <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot Sobol analysis results&quot;&quot;&quot;</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>        <span class="k">if</span> <span class="s2">&quot;sobol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No analysis results for the Sobol method were found.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>        <span class="c1"># Ensure Chinese font settings</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_chinese_font</span><span class="p">()</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>            <span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>        <span class="c1"># Get the results of all indicators</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>        <span class="n">sobol_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">sobol_results</span><span class="p">:</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sobol analysis results not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>        <span class="c1"># Generate charts for each metric</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>        <span class="k">for</span> <span class="n">metric_key</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">sobol_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>            <span class="n">Si</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>            <span class="n">output_index</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;output_index&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>            <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">and</span> <span class="n">output_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_names</span><span class="p">):</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>                <span class="n">metric_display_name</span> <span class="o">=</span> <span class="n">metric_names</span><span class="p">[</span><span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>                <span class="n">metric_display_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>            <span class="c1"># Bar chart of first-order and total sensitivity indices</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>            <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>            <span class="c1"># First-order sensitivity index</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">Si</span><span class="p">[</span><span class="s2">&quot;S1_conf&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;skyblue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;First-order sensitivity index (S1)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>                <span class="sa">f</span><span class="s2">&quot;First-order Sensitivity Indices</span><span class="se">\n</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>                <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>                <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>            <span class="p">)</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>            <span class="c1"># # Total Sensitivity Index</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">Si</span><span class="p">[</span><span class="s2">&quot;ST_conf&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Total Sensitivity Index (ST)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>                <span class="sa">f</span><span class="s2">&quot;Total Sensitivity Indices</span><span class="se">\n</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>            <span class="p">)</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>            <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>                <span class="sa">f</span><span class="s1">&#39;sobol_sensitivity_indices_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>            <span class="p">)</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sobol result chart has been saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_morris_results</span><span class="p">(</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>        <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>        <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>        <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the Morris analysis results&quot;&quot;&quot;</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>        <span class="k">if</span> <span class="s2">&quot;morris&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No analysis results were found for the Morris method.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>        <span class="c1"># Ensure Chinese font settings</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_chinese_font</span><span class="p">()</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>            <span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>        <span class="c1"># Obtain the results of all indicators</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>        <span class="n">morris_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;morris&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">morris_results</span><span class="p">:</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No Morris analysis results found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>        <span class="k">for</span> <span class="n">metric_key</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">morris_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>            <span class="n">Si</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>            <span class="n">output_index</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;output_index&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>            <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">and</span> <span class="n">output_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_names</span><span class="p">):</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>                <span class="n">metric_display_name</span> <span class="o">=</span> <span class="n">metric_names</span><span class="p">[</span><span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>                <span class="n">metric_display_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>            <span class="c1"># Morris μ*-σ diagram</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>            <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>            <span class="c1"># μ*-σ scatter plot</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">],</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>                <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>                    <span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>                    <span class="p">(</span><span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>                    <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>                <span class="p">)</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;μ*(Average Absolute Effect)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;σ (Standard Deviation)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>                <span class="sa">f</span><span class="s2">&quot;Morris μ*-σ Plot</span><span class="se">\n</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>            <span class="p">)</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>                <span class="n">y_pos</span><span class="p">,</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu_star_conf&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>            <span class="p">)</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;μ*(Average Absolute Effect)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>                <span class="sa">f</span><span class="s2">&quot;Morris Elementary Effects</span><span class="se">\n</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>            <span class="p">)</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;morris_sensitivity_analysis_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Morris result chart has been saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_fast_results</span><span class="p">(</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a>        <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>        <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>        <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot FAST analysis results&quot;&quot;&quot;</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>        <span class="k">if</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No analysis results found for the FAST method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>        <span class="c1"># No analysis results found for the FAST method</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_chinese_font</span><span class="p">()</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>            <span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>        <span class="c1"># Get the results of all indicators</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>        <span class="n">fast_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;fast&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">fast_results</span><span class="p">:</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;FAST analysis results not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>        <span class="c1"># Generate a chart for each metric</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>        <span class="k">for</span> <span class="n">metric_key</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">fast_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>            <span class="n">Si</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>            <span class="n">output_index</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;output_index&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>            <span class="c1"># Determine the indicator name</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>            <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">and</span> <span class="n">output_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_names</span><span class="p">):</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>                <span class="n">metric_display_name</span> <span class="o">=</span> <span class="n">metric_names</span><span class="p">[</span><span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>                <span class="n">metric_display_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>            <span class="c1"># Bar charts of first-order and total sensitivity indices</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>            <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>            <span class="c1"># first-order sensitivity index</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;一阶敏感性指数 (S1)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>                <span class="sa">f</span><span class="s2">&quot;FAST First-order Sensitivity Indices</span><span class="se">\n</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>                <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>                <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>            <span class="p">)</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>            <span class="c1"># Total Sensitivity Index</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;总敏感性指数 (ST)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>                <span class="sa">f</span><span class="s2">&quot;FAST Total Sensitivity Indices</span><span class="se">\n</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>                <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>                <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>            <span class="p">)</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>            <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>                <span class="sa">f</span><span class="s1">&#39;fast_sensitivity_indices_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>            <span class="p">)</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The FAST result chart has been saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_lhs_results</span><span class="p">(</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>        <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>        <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>        <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot LHS (Latin Hypercube Sampling) uncertainty analysis results&quot;&quot;&quot;</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>        <span class="k">if</span> <span class="s2">&quot;latin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No analysis results found for the LHS method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>        <span class="c1"># Ensure Chinese font settings</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_chinese_font</span><span class="p">()</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>            <span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>        <span class="c1"># Get the results of all indicators</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>        <span class="n">lhs_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">lhs_results</span><span class="p">:</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;LHS analysis results not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>        <span class="c1"># Generate charts for each metric</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>        <span class="k">for</span> <span class="n">metric_key</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">lhs_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>            <span class="n">Si</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>            <span class="n">output_index</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;output_index&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>            <span class="c1"># Determine the indicator name</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>            <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">and</span> <span class="n">output_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_names</span><span class="p">):</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>                <span class="n">metric_display_name</span> <span class="o">=</span> <span class="n">metric_names</span><span class="p">[</span><span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>                <span class="n">metric_display_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>            <span class="c1"># Get unit from config</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>            <span class="n">sensitivity_analysis_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>                <span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">,</span> <span class="p">{}</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>            <span class="p">)</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>            <span class="n">unit_map</span> <span class="o">=</span> <span class="n">sensitivity_analysis_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit_map&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>            <span class="n">unit_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_unit_config</span><span class="p">(</span><span class="n">metric_display_name</span><span class="p">,</span> <span class="n">unit_map</span><span class="p">)</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>            <span class="n">unit_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>            <span class="k">if</span> <span class="n">unit_config</span><span class="p">:</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>                <span class="n">unit</span> <span class="o">=</span> <span class="n">unit_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>                <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>                    <span class="n">unit_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}{</span><span class="n">unit_str</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>            <span class="c1"># Create a figure with two subplots</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>            <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>            <span class="c1"># Plot 1: Distribution histogram</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">output_index</span><span class="p">],</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>                <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;skyblue&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>            <span class="p">)</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;频率&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;输出分布直方图&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>            <span class="c1"># Add statistics text to the histogram plot</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>            <span class="n">stats_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;均值: </span><span class="si">{</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">标准差: </span><span class="si">{</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">最小值: </span><span class="si">{</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">最大值: </span><span class="si">{</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>                <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>                <span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>                <span class="n">stats_text</span><span class="p">,</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>                <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>                <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>                <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>                <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>            <span class="p">)</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>            <span class="c1"># Plot 2: Cumulative distribution function</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>            <span class="n">sorted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">output_index</span><span class="p">])</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>            <span class="n">y_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">)</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">,</span> <span class="n">y_vals</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;累积概率&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;累积分布函数&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;lhs_analysis_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LHS分析结果图表已保存: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_results</span><span class="p">(</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a><span class="sd">        Save sensitivity analysis results</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a><span class="sd">            save_dir: Save directory</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a><span class="sd">            format: Save format (&#39;csv</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>            <span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">method_results</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">method_results</span><span class="p">:</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>            <span class="k">for</span> <span class="n">metric_key</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">method_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>                <span class="n">output_index</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;output_index&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>                <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">and</span> <span class="n">output_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_names</span><span class="p">):</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>                    <span class="n">metric_display_name</span> <span class="o">=</span> <span class="n">metric_names</span><span class="p">[</span><span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>                    <span class="n">metric_display_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>                <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>                    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;sobol&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>                        <span class="n">sobol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>                            <span class="p">{</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>                                <span class="s2">&quot;Parameter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>                                <span class="s2">&quot;S1&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>                                <span class="s2">&quot;ST&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>                                <span class="s2">&quot;S1_conf&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;S1_conf&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>                                <span class="s2">&quot;ST_conf&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ST_conf&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>                            <span class="p">}</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>                        <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>                            <span class="sa">f</span><span class="s1">&#39;sobol_indices_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.csv&#39;</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>                        <span class="n">sobol_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sobol results have been saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;morris&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>                        <span class="n">morris_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>                            <span class="p">{</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>                                <span class="s2">&quot;Parameter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>                                <span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>                                <span class="s2">&quot;mu_star&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>                                <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>                                <span class="s2">&quot;mu_star_conf&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mu_star_conf&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>                            <span class="p">}</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>                        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;morris_indices_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.csv&#39;</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>                        <span class="n">morris_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Morris results have been saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fast&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>                        <span class="n">fast_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>                            <span class="p">{</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>                                <span class="s2">&quot;Parameter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>                                <span class="s2">&quot;S1&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>                                <span class="s2">&quot;ST&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>                            <span class="p">}</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>                        <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>                            <span class="sa">f</span><span class="s1">&#39;fast_indices_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.csv&#39;</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>                        <span class="n">fast_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FAST results have been saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;latin&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>                        <span class="c1"># Save LHS statistics</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>                        <span class="n">lhs_stats_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>                            <span class="p">{</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>                                <span class="s2">&quot;Metric&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">metric_display_name</span><span class="p">],</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>                                <span class="s2">&quot;Mean&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]],</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>                                <span class="s2">&quot;Std&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]],</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>                                <span class="s2">&quot;Min&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]],</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>                                <span class="s2">&quot;Max&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]],</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>                                <span class="s2">&quot;Percentile_5&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;percentile_5&quot;</span><span class="p">]],</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>                                <span class="s2">&quot;Percentile_95&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;percentile_95&quot;</span><span class="p">]],</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>                            <span class="p">}</span>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>                        <span class="n">filename_stats</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>                            <span class="sa">f</span><span class="s1">&#39;lhs_stats_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.csv&#39;</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>                        <span class="n">lhs_stats_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename_stats</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LHS统计结果已保存: </span><span class="si">{</span><span class="n">filename_stats</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>                        <span class="c1"># Remove LHS sensitivity indices saving</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>                        <span class="c1"># lhs_sens_df = pd.DataFrame({</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>                        <span class="c1">#     &quot;Parameter&quot;: self.problem[&quot;names&quot;],</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>                        <span class="c1">#     &quot;Partial_Correlation&quot;: results[&quot;partial_correlations&quot;]</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>                        <span class="c1"># })</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>                        <span class="c1"># filename_sens = f&#39;lhs_sensitivity_{metric_display_name.replace(&quot; &quot;, &quot;_&quot;)}.csv&#39;</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>                        <span class="c1"># lhs_sens_df.to_csv(os.path.join(save_dir, filename_sens), index=False)</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>                        <span class="c1"># logger.info(f&quot;LHS敏感性结果已保存: {filename_sens}&quot;)</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The result has been saved to: </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">base_config</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the analyzer.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>base_config</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tricys base configuration dictionary.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Creates a deep copy of base_config. Initializes problem, samples, and results
to None. Calls _setup_chinese_font() and _validate_tricys_config() automatically.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the analyzer.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        base_config: Tricys base configuration dictionary.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        Creates a deep copy of base_config. Initializes problem, samples, and results</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        to None. Calls _setup_chinese_font() and _validate_tricys_config() automatically.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">base_config</span> <span class="o">=</span> <span class="n">base_config</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">problem</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_chinese_font</span><span class="p">()</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tricys_config</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.analyze_fast" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">analyze_fast</span><span class="p">(</span><span class="n">output_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.analyze_fast" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Perform FAST sensitivity analysis</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output variable index</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>FAST analysis parameters</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>FAST sensitivity analysis results</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>FAST analysis requires samples generated by the fast_sampler sampling method!
Results from Morris or Sobol sampling cannot be used.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="k">def</span><span class="w"> </span><span class="nf">analyze_fast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">    Perform FAST sensitivity analysis</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">        output_index: Output variable index</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a><span class="sd">        **kwargs: FAST analysis parameters</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="sd">        FAST sensitivity analysis results</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">        FAST analysis requires samples generated by the fast_sampler sampling method!</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">        Results from Morris or Sobol sampling cannot be used.</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The simulation must be run first to obtain the results.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>        <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_last_sampling_method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span> <span class="o">!=</span> <span class="s2">&quot;fast&quot;</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>    <span class="p">):</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>            <span class="sa">f</span><span class="s2">&quot;⚠️ The current sampling method is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span><span class="si">}</span><span class="s2">, but FAST analysis requires FAST sampling!&quot;</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>        <span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>            <span class="s2">&quot;Suggestion: Regenerate samples using generate_samples(&#39;fast&#39;)&quot;</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="p">)</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>    <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>    <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_nan_values</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="s2">&quot;FAST分析&quot;</span><span class="p">)</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>    <span class="c1"># Remove NaN values</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>    <span class="c1"># valid_indices = ~np.isnan(Y)</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>    <span class="c1"># if not np.all(valid_indices):</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>    <span class="c1">#    logger.warning(f&quot;发现{np.sum(~valid_indices)}个无效结果，将被排除&quot;)</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>    <span class="c1">#    Y = Y[valid_indices]</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>        <span class="c1"># Perform FAST analysis</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>        <span class="n">Si</span> <span class="o">=</span> <span class="n">fast</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>        <span class="k">if</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;fast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>        <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;fast&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>            <span class="s2">&quot;output_index&quot;</span><span class="p">:</span> <span class="n">output_index</span><span class="p">,</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>            <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">,</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>            <span class="s2">&quot;S1&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">],</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>            <span class="s2">&quot;ST&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">],</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>            <span class="s2">&quot;sampling_method&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_last_sampling_method&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="p">}</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>            <span class="sa">f</span><span class="s2">&quot;FAST sensitivity analysis completed (indicator </span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>        <span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;fast&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>        <span class="k">if</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;sample&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>                <span class="sa">f</span><span class="s2">&quot;FAST analysis failed, possibly due to incompatible sampling method: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">Please regenerate samples using generate_samples(&#39;fast&#39;)&quot;</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>            <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.analyze_lhs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">analyze_lhs</span><span class="p">(</span><span class="n">output_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.analyze_lhs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Perform LHS (Latin Hypercube Sampling) uncertainty analysis</p>
<p>Note: This is a basic statistical analysis method for LHS samples,
providing descriptive statistics and basic sensitivity indices.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output variable index</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Analysis parameters (reserved for future use)</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>LHS uncertainty analysis results</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="k">def</span><span class="w"> </span><span class="nf">analyze_lhs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">    Perform LHS (Latin Hypercube Sampling) uncertainty analysis</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a><span class="sd">    Note: This is a basic statistical analysis method for LHS samples,</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a><span class="sd">    providing descriptive statistics and basic sensitivity indices.</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a><span class="sd">        output_index: Output variable index</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="sd">        **kwargs: Analysis parameters (reserved for future use)</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="sd">        LHS uncertainty analysis results</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The simulation must be run first to obtain the results.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>        <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_last_sampling_method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span> <span class="o">!=</span> <span class="s2">&quot;latin&quot;</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>    <span class="p">):</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>            <span class="sa">f</span><span class="s2">&quot;⚠️ The current sampling method is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span><span class="si">}</span><span class="s2">, but LHS analysis is designed for Latin Hypercube Sampling!&quot;</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>        <span class="p">)</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>            <span class="s2">&quot;Suggestion: Regenerate samples using generate_samples(&#39;latin&#39;)&quot;</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>        <span class="p">)</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>    <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>    <span class="c1"># Handle NaN values</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>    <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_nan_values</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="s2">&quot;LHS分析&quot;</span><span class="p">)</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>    <span class="c1"># Basic statistical analysis</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>    <span class="n">mean_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>    <span class="n">std_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>    <span class="n">min_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>    <span class="n">max_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>    <span class="n">percentile_5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>    <span class="n">percentile_95</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>    <span class="c1"># Create results dictionary</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>    <span class="n">Si</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>        <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">mean_val</span><span class="p">,</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>        <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">std_val</span><span class="p">,</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>        <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">min_val</span><span class="p">,</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>        <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">max_val</span><span class="p">,</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>        <span class="s2">&quot;percentile_5&quot;</span><span class="p">:</span> <span class="n">percentile_5</span><span class="p">,</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>        <span class="s2">&quot;percentile_95&quot;</span><span class="p">:</span> <span class="n">percentile_95</span><span class="p">,</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>    <span class="p">}</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>    <span class="k">if</span> <span class="s2">&quot;latin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>    <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>        <span class="s2">&quot;output_index&quot;</span><span class="p">:</span> <span class="n">output_index</span><span class="p">,</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>        <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">,</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>        <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">mean_val</span><span class="p">,</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>        <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">std_val</span><span class="p">,</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>        <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">min_val</span><span class="p">,</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>        <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">max_val</span><span class="p">,</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>        <span class="s2">&quot;percentile_5&quot;</span><span class="p">:</span> <span class="n">percentile_5</span><span class="p">,</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>        <span class="s2">&quot;percentile_95&quot;</span><span class="p">:</span> <span class="n">percentile_95</span><span class="p">,</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>        <span class="s2">&quot;sampling_method&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_last_sampling_method&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>    <span class="p">}</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LHS uncertainty analysis completed (指标 </span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.analyze_morris" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">analyze_morris</span><span class="p">(</span><span class="n">output_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.analyze_morris" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Perform Morris sensitivity analysis</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output variable index</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Morris analysis parameters</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Morris sensitivity analysis results</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="k">def</span><span class="w"> </span><span class="nf">analyze_morris</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="sd">    Perform Morris sensitivity analysis</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">        output_index: Output variable index</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">        **kwargs: Morris analysis parameters</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">        Morris sensitivity analysis results</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The simulation must be run first to obtain the results.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>    <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>    <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_nan_values</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="s2">&quot;Morris分析&quot;</span><span class="p">)</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>    <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>    <span class="c1"># Remove NaN values</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>    <span class="c1"># valid_indices = ~np.isnan(Y)</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>    <span class="c1"># if not np.all(valid_indices):</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>    <span class="c1">#    logger.warning(f&quot;发现{np.sum(~valid_indices)}个无效结果，将被排除&quot;)</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>    <span class="c1">#    Y = Y[valid_indices]</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>    <span class="c1">#    X = self.parameter_samples[valid_indices]</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>    <span class="c1"># else:</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>    <span class="c1">#    X = self.parameter_samples</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>    <span class="c1"># Perform Morris analysis</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="sa">f</span><span class="s2">&quot;Start Morris sensitivity analysis: X.shape=</span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, Y.shape=</span><span class="si">{</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, X.dtype=</span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>    <span class="p">)</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>        <span class="n">Si</span> <span class="o">=</span> <span class="n">morris_analyze</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Morris analysis execution failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;problem: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X shape: </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, type: </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Yshape: </span><span class="si">{</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, type: </span><span class="si">{</span><span class="n">Y</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">X</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                <span class="s2">&quot;X contains non-numeric data, please check the sampled data&quot;</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>            <span class="p">)</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>        <span class="k">raise</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>    <span class="k">if</span> <span class="s2">&quot;morris&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;morris&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>    <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;morris&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>        <span class="s2">&quot;output_index&quot;</span><span class="p">:</span> <span class="n">output_index</span><span class="p">,</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>        <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">,</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>        <span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>        <span class="s2">&quot;mu_star&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">],</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>        <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">],</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>        <span class="s2">&quot;mu_star_conf&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu_star_conf&quot;</span><span class="p">],</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>    <span class="p">}</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Morris sensitivity analysis completed (metric </span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;morris&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.analyze_sobol" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">analyze_sobol</span><span class="p">(</span><span class="n">output_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.analyze_sobol" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Perform Sobol Sensitivity Analysis</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output variable index</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sobol analysis parameters</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sobol sensitivity analysis results</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Sobol analysis requires samples generated using the Saltelli sampling method!
Results from Morris or FAST sampling cannot be used.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="k">def</span><span class="w"> </span><span class="nf">analyze_sobol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">    Perform Sobol Sensitivity Analysis</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="sd">        output_index: Output variable index</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="sd">        **kwargs: Sobol analysis parameters</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">        Sobol sensitivity analysis results</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="sd">        Sobol analysis requires samples generated using the Saltelli sampling method!</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">        Results from Morris or FAST sampling cannot be used.</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The simulation must be run first to obtain the results.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>    <span class="c1"># Check sampling method compatibility</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_last_sampling_method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span> <span class="o">!=</span> <span class="s2">&quot;sobol&quot;</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>    <span class="p">):</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>            <span class="sa">f</span><span class="s2">&quot;⚠️ Currently using </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span><span class="si">}</span><span class="s2"> sampling, but Sobol analysis requires Saltelli sampling!&quot;</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="p">)</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>            <span class="s2">&quot;Suggestion: Regenerate samples using generate_samples(&#39;sobol&#39;)&quot;</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>        <span class="p">)</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>    <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>    <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_nan_values</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="s2">&quot;Sobol分析&quot;</span><span class="p">)</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>    <span class="c1"># Remove NaN values</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>    <span class="c1"># valid_indices = ~np.isnan(Y)</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>    <span class="c1"># if not np.all(valid_indices):</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>    <span class="c1">#    logger.warning(f&quot;发现{np.sum(~valid_indices)}个无效结果，将被排除&quot;)</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>    <span class="c1">#    Y = Y[valid_indices]</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>    <span class="c1">#    X = self.parameter_samples[valid_indices]</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>    <span class="c1"># else:</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>    <span class="c1">#    X = self.parameter_samples</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>        <span class="n">Si</span> <span class="o">=</span> <span class="n">sobol</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="k">if</span> <span class="s2">&quot;sobol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>            <span class="s2">&quot;output_index&quot;</span><span class="p">:</span> <span class="n">output_index</span><span class="p">,</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>            <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">,</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>            <span class="s2">&quot;S1&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">],</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>            <span class="s2">&quot;ST&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">],</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>            <span class="s2">&quot;S2&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;S2&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>            <span class="s2">&quot;S1_conf&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;S1_conf&quot;</span><span class="p">],</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>            <span class="s2">&quot;ST_conf&quot;</span><span class="p">:</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;ST_conf&quot;</span><span class="p">],</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>            <span class="s2">&quot;sampling_method&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_last_sampling_method&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>        <span class="p">}</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sobol sensitivity analysis completed (index </span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>        <span class="k">if</span> <span class="s2">&quot;saltelli&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;sample&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>                <span class="sa">f</span><span class="s2">&quot;Sobol analysis failed, possibly due to incompatible sampling method: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">Please regenerate samples using generate_samples(&#39;sobol&#39;)&quot;</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>            <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.define_problem" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">define_problem</span><span class="p">(</span><span class="n">param_bounds</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.define_problem" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Define SALib problem space.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>param_bounds</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Tuple">Tuple</span>[<span title="float">float</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter bounds dictionary {'param_name': (min_val, max_val)}.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>param_distributions</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter distribution type dictionary {'param_name': 'unif'/'norm'/etc}.
Valid distribution types: 'unif', 'triang', 'norm', 'truncnorm', 'lognorm'.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SALib problem definition dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Defaults to 'unif' distribution if not specified. Validates distribution types
and warns if invalid. Logs parameter definitions including bounds and distributions.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="k">def</span><span class="w"> </span><span class="nf">define_problem</span><span class="p">(</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="n">param_bounds</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="n">param_distributions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Define SALib problem space.</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">        param_bounds: Parameter bounds dictionary {&#39;param_name&#39;: (min_val, max_val)}.</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        param_distributions: Parameter distribution type dictionary {&#39;param_name&#39;: &#39;unif&#39;/&#39;norm&#39;/etc}.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">            Valid distribution types: &#39;unif&#39;, &#39;triang&#39;, &#39;norm&#39;, &#39;truncnorm&#39;, &#39;lognorm&#39;.</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        SALib problem definition dictionary.</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">        Defaults to &#39;unif&#39; distribution if not specified. Validates distribution types</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">        and warns if invalid. Logs parameter definitions including bounds and distributions.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="k">if</span> <span class="n">param_distributions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="n">param_distributions</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&quot;unif&quot;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">param_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="n">valid_dists</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unif&quot;</span><span class="p">,</span> <span class="s2">&quot;triang&quot;</span><span class="p">,</span> <span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="s2">&quot;truncnorm&quot;</span><span class="p">,</span> <span class="s2">&quot;lognorm&quot;</span><span class="p">]</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dist</span> <span class="ow">in</span> <span class="n">param_distributions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="k">if</span> <span class="n">dist</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_dists</span><span class="p">:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                <span class="s2">&quot;Invalid distribution type, using &#39;unif&#39; instead&quot;</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                    <span class="s2">&quot;parameter_name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                    <span class="s2">&quot;invalid_distribution&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                <span class="p">},</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="n">param_distributions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;unif&quot;</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">problem</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="s2">&quot;num_vars&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_bounds</span><span class="p">),</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="s2">&quot;names&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_bounds</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="s2">&quot;dists&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="n">param_distributions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;unif&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">param_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="p">],</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="p">}</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="s2">&quot;Defined a problem space&quot;</span><span class="p">,</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="s2">&quot;num_parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;num_vars&quot;</span><span class="p">],</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="p">},</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="p">)</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="s2">&quot;Parameter definition&quot;</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                <span class="s2">&quot;parameter_name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                <span class="s2">&quot;distribution&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;dists&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="p">},</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.generate_samples" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_samples</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;sobol&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.generate_samples" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate parameter samples.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sampling method ('sobol', 'morris', 'fast', 'latin').</p>
              </div>
            </td>
            <td>
                  <code>&#39;sobol&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>N</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples (for Sobol this is the base sample count, actual count is N<em>(2</em>D+2)).</p>
              </div>
            </td>
            <td>
                  <code>1024</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method-specific parameters.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter sample array (n_samples, n_params).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">引发：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If problem not defined or unsupported method.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Sobol generates N<em>(2</em>D+2) samples. Morris generates N trajectories. Samples are
rounded to 5 decimal places. Stores last sampling method for compatibility checking.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_samples</span><span class="p">(</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sobol&quot;</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate parameter samples.</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">        method: Sampling method (&#39;sobol&#39;, &#39;morris&#39;, &#39;fast&#39;, &#39;latin&#39;).</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        N: Number of samples (for Sobol this is the base sample count, actual count is N*(2*D+2)).</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">        **kwargs: Method-specific parameters.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        Parameter sample array (n_samples, n_params).</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        ValueError: If problem not defined or unsupported method.</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">        Sobol generates N*(2*D+2) samples. Morris generates N trajectories. Samples are</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        rounded to 5 decimal places. Stores last sampling method for compatibility checking.</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="s2">&quot;You must first call define_problem() to define the problem space.&quot;</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="s2">&quot;Generating samples&quot;</span><span class="p">,</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="s2">&quot;base_sample_count&quot;</span><span class="p">:</span> <span class="n">N</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="p">},</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="p">)</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sobol&quot;</span><span class="p">:</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="c1"># Sobol method: generate N*(2*D+2) samples</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">saltelli</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="n">actual_samples</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;num_vars&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;morris&quot;</span><span class="p">:</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="c1"># Morris method: Generate N trajectories</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="c1"># Note: Different versions of SALib may have different parameter names</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">morris_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;num_levels&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="c1"># Check the SALib version and use the correct parameter names</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="n">morris_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">morris</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="o">**</span><span class="n">morris_kwargs</span><span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="k">if</span> <span class="s2">&quot;grid_jump&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>                <span class="n">morris_kwargs</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">morris_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;grid_jump&quot;</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                <span class="p">}</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                <span class="n">morris_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                    <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;grid_jump&quot;</span><span class="p">}</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>                <span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">morris</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="o">**</span><span class="n">morris_kwargs</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>                <span class="p">)</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>                <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="n">actual_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;fast&quot;</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="c1"># FAST method</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="n">fast_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="n">fast_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">fast_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="o">**</span><span class="n">fast_kwargs</span><span class="p">)</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="n">actual_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span><span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;latin&quot;</span><span class="p">:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="c1"># Latin Hypercube Sampling</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">latin</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="n">actual_samples</span> <span class="o">=</span> <span class="n">N</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported sampling method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="s2">&quot;Successfully generated samples&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;actual_samples&quot;</span><span class="p">:</span> <span class="n">actual_samples</span><span class="p">}</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parameter sample precision adjusted to 5 decimal places&quot;</span><span class="p">)</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.generate_tricys_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_tricys_config</span><span class="p">(</span><span class="n">csv_file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.generate_tricys_config" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate Tricys configuration file for reading CSV parameter files and executing simulations
This function reuses the base configuration and specifically modifies simulation_parameters and analysis_case for file-based SALib runs</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>csv_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the CSV parameter file. If None, the last generated file is used</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_metrics</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of output metrics to be calculated</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path of the generated configuration file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_tricys_config</span><span class="p">(</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">csv_file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">output_metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">    Generate Tricys configuration file for reading CSV parameter files and executing simulations</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">    This function reuses the base configuration and specifically modifies simulation_parameters and analysis_case for file-based SALib runs</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">        csv_file_path: Path to the CSV parameter file. If None, the last generated file is used</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">        output_metrics: List of output metrics to be calculated</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">        Path of the generated configuration file</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="k">if</span> <span class="n">csv_file_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;sampling_csv_path&quot;</span><span class="p">):</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="n">csv_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_csv_path</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                <span class="s2">&quot;CSV file path not found, please first call run_tricys_simulations() or specify csv_file_path&quot;</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>            <span class="p">)</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>    <span class="k">if</span> <span class="n">output_metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>        <span class="n">output_metrics</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>            <span class="s2">&quot;Startup_Inventory&quot;</span><span class="p">,</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="s2">&quot;Self_Sufficiency_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>            <span class="s2">&quot;Doubling_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="p">]</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="n">csv_abs_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="n">tricys_config</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="p">)</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="n">tricys_config</span><span class="p">[</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">csv_abs_path</span><span class="p">}</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="k">if</span> <span class="s2">&quot;sensitivity_analysis&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tricys_config</span><span class="p">:</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>        <span class="n">tricys_config</span><span class="p">[</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="n">tricys_config</span><span class="p">[</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">][</span><span class="s2">&quot;analysis_case&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;SALib_Analysis&quot;</span><span class="p">,</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="s2">&quot;independent_variable&quot;</span><span class="p">:</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="s2">&quot;independent_variable_sampling&quot;</span><span class="p">:</span> <span class="n">csv_abs_path</span><span class="p">,</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="s2">&quot;dependent_variables&quot;</span><span class="p">:</span> <span class="n">output_metrics</span><span class="p">,</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="p">}</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>    <span class="k">return</span> <span class="n">tricys_config</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.get_compatible_analysis_methods" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_compatible_analysis_methods</span><span class="p">(</span><span class="n">sampling_method</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.get_compatible_analysis_methods" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get analysis methods compatible with the specified sampling method.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sampling_method</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sampling method</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of compatible analysis methods</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_compatible_analysis_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling_method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">    Get analysis methods compatible with the specified sampling method.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">        sampling_method: Sampling method</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">        List of compatible analysis methods</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="n">compatibility_map</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>        <span class="s2">&quot;sobol&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">],</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="s2">&quot;morris&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;morris&quot;</span><span class="p">],</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="s2">&quot;fast&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;fast&quot;</span><span class="p">],</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="s2">&quot;latin&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">],</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="p">[],</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="p">}</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="k">return</span> <span class="n">compatibility_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sampling_method</span><span class="p">,</span> <span class="p">[])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.load_tricys_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_tricys_results</span><span class="p">(</span><span class="n">sensitivity_summary_csv</span><span class="p">,</span> <span class="n">output_metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.load_tricys_results" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Read simulation results from the sensitivity_analysis_summary.csv file output by Tricys</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sensitivity_summary_csv</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the sensitivity analysis summary CSV file output by Tricys</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_metrics</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of output metrics to extract</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Simulation result array (n_samples, n_metrics)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_tricys_results</span><span class="p">(</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">sensitivity_summary_csv</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    Read simulation results from the sensitivity_analysis_summary.csv file output by Tricys</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">        sensitivity_summary_csv: Path to the sensitivity analysis summary CSV file output by Tricys</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">        output_metrics: List of output metrics to extract</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">        Simulation result array (n_samples, n_metrics)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="k">if</span> <span class="n">output_metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>        <span class="n">output_metrics</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>            <span class="s2">&quot;Startup_Inventory&quot;</span><span class="p">,</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="s2">&quot;Self_Sufficiency_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>            <span class="s2">&quot;Doubling_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>        <span class="p">]</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read data from the Tricys result file: </span><span class="si">{</span><span class="n">sensitivity_summary_csv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">sensitivity_summary_csv</span><span class="p">)</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> simulation results&quot;</span><span class="p">)</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Result file columns: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>    <span class="n">param_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>    <span class="n">metric_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>        <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">output_metrics</span><span class="p">:</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>            <span class="n">metric_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="k">elif</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span> <span class="k">else</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="n">param_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recognized parameter columns: </span><span class="si">{</span><span class="n">param_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Identified metric columns: </span><span class="si">{</span><span class="n">metric_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>    <span class="n">ordered_metric_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>    <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">output_metrics</span><span class="p">:</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>        <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_cols</span><span class="p">:</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>            <span class="n">ordered_metric_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metric column not found: </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ordered_metric_cols</span><span class="p">:</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No valid output metrics columns found: </span><span class="si">{</span><span class="n">output_metrics</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>    <span class="n">results_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ordered_metric_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span> <span class="o">=</span> <span class="n">results_data</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded simulation results: </span><span class="si">{</span><span class="n">results_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="sa">f</span><span class="s2">&quot;Result Statistics:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_data</span><span class="p">,</span><span class="w"> </span><span class="n">columns</span><span class="o">=</span><span class="n">ordered_metric_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>    <span class="p">)</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="sa">f</span><span class="s2">&quot;Result preview:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_data</span><span class="p">,</span><span class="w"> </span><span class="n">columns</span><span class="o">=</span><span class="n">metric_cols</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>    <span class="p">)</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.plot_fast_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_fast_results</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">metric_names</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.plot_fast_results" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Plot FAST analysis results</p>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1480" name="__codelineno-0-1480"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_fast_results</span><span class="p">(</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a>    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>    <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>    <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot FAST analysis results&quot;&quot;&quot;</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>    <span class="k">if</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No analysis results found for the FAST method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>    <span class="c1"># No analysis results found for the FAST method</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_chinese_font</span><span class="p">()</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>        <span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>    <span class="c1"># Get the results of all indicators</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>    <span class="n">fast_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;fast&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">fast_results</span><span class="p">:</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;FAST analysis results not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>    <span class="c1"># Generate a chart for each metric</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>    <span class="k">for</span> <span class="n">metric_key</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">fast_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>        <span class="n">Si</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>        <span class="n">output_index</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;output_index&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>        <span class="c1"># Determine the indicator name</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>        <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">and</span> <span class="n">output_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_names</span><span class="p">):</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>            <span class="n">metric_display_name</span> <span class="o">=</span> <span class="n">metric_names</span><span class="p">[</span><span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>            <span class="n">metric_display_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>        <span class="c1"># Bar charts of first-order and total sensitivity indices</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>        <span class="c1"># first-order sensitivity index</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>        <span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;一阶敏感性指数 (S1)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>            <span class="sa">f</span><span class="s2">&quot;FAST First-order Sensitivity Indices</span><span class="se">\n</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>            <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>            <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>        <span class="p">)</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>        <span class="c1"># Total Sensitivity Index</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;总敏感性指数 (ST)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>            <span class="sa">f</span><span class="s2">&quot;FAST Total Sensitivity Indices</span><span class="se">\n</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>            <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>            <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>        <span class="p">)</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>            <span class="sa">f</span><span class="s1">&#39;fast_sensitivity_indices_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>        <span class="p">)</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The FAST result chart has been saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.plot_lhs_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_lhs_results</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">metric_names</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.plot_lhs_results" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Plot LHS (Latin Hypercube Sampling) uncertainty analysis results</p>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1550" name="__codelineno-0-1550"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_lhs_results</span><span class="p">(</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>    <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>    <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot LHS (Latin Hypercube Sampling) uncertainty analysis results&quot;&quot;&quot;</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>    <span class="k">if</span> <span class="s2">&quot;latin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No analysis results found for the LHS method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>    <span class="c1"># Ensure Chinese font settings</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_chinese_font</span><span class="p">()</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>        <span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>    <span class="c1"># Get the results of all indicators</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>    <span class="n">lhs_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">lhs_results</span><span class="p">:</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;LHS analysis results not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>    <span class="c1"># Generate charts for each metric</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>    <span class="k">for</span> <span class="n">metric_key</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">lhs_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>        <span class="n">Si</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>        <span class="n">output_index</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;output_index&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>        <span class="c1"># Determine the indicator name</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>        <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">and</span> <span class="n">output_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_names</span><span class="p">):</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>            <span class="n">metric_display_name</span> <span class="o">=</span> <span class="n">metric_names</span><span class="p">[</span><span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>            <span class="n">metric_display_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>        <span class="c1"># Get unit from config</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>        <span class="n">sensitivity_analysis_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>            <span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">,</span> <span class="p">{}</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>        <span class="p">)</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>        <span class="n">unit_map</span> <span class="o">=</span> <span class="n">sensitivity_analysis_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit_map&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>        <span class="n">unit_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_unit_config</span><span class="p">(</span><span class="n">metric_display_name</span><span class="p">,</span> <span class="n">unit_map</span><span class="p">)</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>        <span class="n">unit_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>        <span class="k">if</span> <span class="n">unit_config</span><span class="p">:</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>            <span class="n">unit</span> <span class="o">=</span> <span class="n">unit_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>            <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>                <span class="n">unit_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>        <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}{</span><span class="n">unit_str</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>        <span class="c1"># Create a figure with two subplots</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>        <span class="c1"># Plot 1: Distribution histogram</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">output_index</span><span class="p">],</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>            <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;skyblue&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>        <span class="p">)</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;频率&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;输出分布直方图&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>        <span class="c1"># Add statistics text to the histogram plot</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>        <span class="n">stats_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;均值: </span><span class="si">{</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">标准差: </span><span class="si">{</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">最小值: </span><span class="si">{</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">最大值: </span><span class="si">{</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>            <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>            <span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>            <span class="n">stats_text</span><span class="p">,</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>            <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>            <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>            <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>        <span class="p">)</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>        <span class="c1"># Plot 2: Cumulative distribution function</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>        <span class="n">sorted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">output_index</span><span class="p">])</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>        <span class="n">y_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">)</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">,</span> <span class="n">y_vals</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;累积概率&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;累积分布函数&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;lhs_analysis_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LHS分析结果图表已保存: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.plot_morris_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_morris_results</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">metric_names</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.plot_morris_results" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Plot the Morris analysis results</p>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1409" name="__codelineno-0-1409"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_morris_results</span><span class="p">(</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>    <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>    <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the Morris analysis results&quot;&quot;&quot;</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>    <span class="k">if</span> <span class="s2">&quot;morris&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No analysis results were found for the Morris method.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>    <span class="c1"># Ensure Chinese font settings</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_chinese_font</span><span class="p">()</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>        <span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>    <span class="c1"># Obtain the results of all indicators</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>    <span class="n">morris_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;morris&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">morris_results</span><span class="p">:</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No Morris analysis results found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>    <span class="k">for</span> <span class="n">metric_key</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">morris_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>        <span class="n">Si</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>        <span class="n">output_index</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;output_index&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>        <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">and</span> <span class="n">output_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_names</span><span class="p">):</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>            <span class="n">metric_display_name</span> <span class="o">=</span> <span class="n">metric_names</span><span class="p">[</span><span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>            <span class="n">metric_display_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>        <span class="c1"># Morris μ*-σ diagram</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>        <span class="c1"># μ*-σ scatter plot</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">],</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>                <span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>                <span class="p">(</span><span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>                <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>                <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>                <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>            <span class="p">)</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;μ*(Average Absolute Effect)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;σ (Standard Deviation)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>            <span class="sa">f</span><span class="s2">&quot;Morris μ*-σ Plot</span><span class="se">\n</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>        <span class="p">)</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>        <span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>            <span class="n">y_pos</span><span class="p">,</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">Si</span><span class="p">[</span><span class="s2">&quot;mu_star_conf&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>        <span class="p">)</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;μ*(Average Absolute Effect)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>            <span class="sa">f</span><span class="s2">&quot;Morris Elementary Effects</span><span class="se">\n</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>        <span class="p">)</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;morris_sensitivity_analysis_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Morris result chart has been saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.plot_sobol_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_sobol_results</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">metric_names</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.plot_sobol_results" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Plot Sobol analysis results</p>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1342" name="__codelineno-0-1342"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_sobol_results</span><span class="p">(</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>    <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>    <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot Sobol analysis results&quot;&quot;&quot;</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>    <span class="k">if</span> <span class="s2">&quot;sobol&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No analysis results for the Sobol method were found.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>    <span class="c1"># Ensure Chinese font settings</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_chinese_font</span><span class="p">()</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>        <span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>    <span class="c1"># Get the results of all indicators</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>    <span class="n">sobol_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">sobol_results</span><span class="p">:</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sobol analysis results not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>    <span class="c1"># Generate charts for each metric</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>    <span class="k">for</span> <span class="n">metric_key</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">sobol_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>        <span class="n">Si</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>        <span class="n">output_index</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;output_index&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>        <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">and</span> <span class="n">output_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_names</span><span class="p">):</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>            <span class="n">metric_display_name</span> <span class="o">=</span> <span class="n">metric_names</span><span class="p">[</span><span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>            <span class="n">metric_display_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>        <span class="c1"># Bar chart of first-order and total sensitivity indices</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>        <span class="c1"># First-order sensitivity index</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>        <span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">Si</span><span class="p">[</span><span class="s2">&quot;S1_conf&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;skyblue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;First-order sensitivity index (S1)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>            <span class="sa">f</span><span class="s2">&quot;First-order Sensitivity Indices</span><span class="se">\n</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>            <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>            <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>        <span class="p">)</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>        <span class="c1"># # Total Sensitivity Index</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">Si</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">Si</span><span class="p">[</span><span class="s2">&quot;ST_conf&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Total Sensitivity Index (ST)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>            <span class="sa">f</span><span class="s2">&quot;Total Sensitivity Indices</span><span class="se">\n</span><span class="si">{</span><span class="n">metric_display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>        <span class="p">)</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>            <span class="sa">f</span><span class="s1">&#39;sobol_sensitivity_indices_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>        <span class="p">)</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sobol result chart has been saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.run_salib_analysis_from_tricys_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_salib_analysis_from_tricys_results</span><span class="p">(</span><span class="n">sensitivity_summary_csv</span><span class="p">,</span> <span class="n">param_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sobol&#39;</span><span class="p">,</span> <span class="s1">&#39;morris&#39;</span><span class="p">,</span> <span class="s1">&#39;fast&#39;</span><span class="p">],</span> <span class="n">save_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.run_salib_analysis_from_tricys_results" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Run a complete SALib sensitivity analysis from the sensitivity analysis results file output by Tricys</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sensitivity_summary_csv</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the sensitivity summary CSV file output by Tricys</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>param_bounds</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Tuple">Tuple</span>[<span title="float">float</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of parameter bounds, inferred from the CSV file if None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_metrics</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of output metrics to analyze</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>methods</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of sensitivity analysis methods to execute</p>
              </div>
            </td>
            <td>
                  <code>[&#39;sobol&#39;, &#39;morris&#39;, &#39;fast&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the results</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing all analysis results</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-877" name="__codelineno-0-877"></a><span class="k">def</span><span class="w"> </span><span class="nf">run_salib_analysis_from_tricys_results</span><span class="p">(</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>    <span class="n">sensitivity_summary_csv</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>    <span class="n">param_bounds</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>    <span class="n">output_metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>    <span class="n">methods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">,</span> <span class="s2">&quot;morris&quot;</span><span class="p">,</span> <span class="s2">&quot;fast&quot;</span><span class="p">],</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a><span class="sd">    Run a complete SALib sensitivity analysis from the sensitivity analysis results file output by Tricys</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a><span class="sd">        sensitivity_summary_csv: Path to the sensitivity summary CSV file output by Tricys</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a><span class="sd">        param_bounds: Dictionary of parameter bounds, inferred from the CSV file if None</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a><span class="sd">        output_metrics: List of output metrics to analyze</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="sd">        methods: List of sensitivity analysis methods to execute</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="sd">        save_dir: Directory to save the results</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">        Dictionary containing all analysis results</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>    <span class="k">if</span> <span class="n">output_metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>        <span class="n">output_metrics</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>            <span class="s2">&quot;Startup_Inventory&quot;</span><span class="p">,</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>            <span class="s2">&quot;Self_Sufficiency_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>            <span class="s2">&quot;Doubling_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>        <span class="p">]</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sensitivity_summary_csv</span><span class="p">),</span> <span class="s2">&quot;salib_analysis&quot;</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>        <span class="p">)</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">sensitivity_summary_csv</span><span class="p">)</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>    <span class="k">if</span> <span class="n">param_bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>        <span class="n">param_bounds</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>        <span class="n">param_candidates</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>            <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output_metrics</span> <span class="ow">and</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>                <span class="n">param_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">param_candidates</span><span class="p">:</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>            <span class="n">param_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>                <span class="n">param_bounds</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">param_data</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">param_data</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">param_bounds</span><span class="p">:</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>            <span class="s2">&quot;Unable to determine parameter boundaries, please provide the param_bounds parameter&quot;</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>        <span class="p">)</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">define_problem</span><span class="p">(</span><span class="n">param_bounds</span><span class="p">)</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">load_tricys_results</span><span class="p">(</span><span class="n">sensitivity_summary_csv</span><span class="p">,</span> <span class="n">output_metrics</span><span class="p">)</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>    <span class="n">detected_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_sampling_method</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>    <span class="n">methods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compatible_analysis_methods</span><span class="p">(</span><span class="n">detected_method</span><span class="p">)</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>    <span class="n">all_results</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>    <span class="k">for</span> <span class="n">metric_idx</span><span class="p">,</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">output_metrics</span><span class="p">):</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>        <span class="k">if</span> <span class="n">metric_idx</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The metric </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> is out of range, skipping&quot;</span><span class="p">)</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>            <span class="k">continue</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Analysis indicators: </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>        <span class="n">metric_results</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>        <span class="c1"># Check data validity</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_results</span><span class="p">[:,</span> <span class="n">metric_idx</span><span class="p">]</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>        <span class="n">valid_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Valid data ratio: </span><span class="si">{</span><span class="n">valid_ratio</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>        <span class="k">if</span> <span class="n">valid_ratio</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>                <span class="sa">f</span><span class="s2">&quot;The metric </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> has less than 50% valid data, which may affect the analysis quality.&quot;</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>            <span class="p">)</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>        <span class="c1"># Sobol analysis</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>        <span class="k">if</span> <span class="s2">&quot;sobol&quot;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing Sobol sensitivity analysis...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>                <span class="n">sobol_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_sobol</span><span class="p">(</span><span class="n">output_index</span><span class="o">=</span><span class="n">metric_idx</span><span class="p">)</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>                <span class="n">metric_results</span><span class="p">[</span><span class="s2">&quot;sobol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sobol_result</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>                <span class="c1"># Display Sobol results summary</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sobol sensitivity index:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>                    <span class="n">s1</span> <span class="o">=</span> <span class="n">sobol_result</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>                    <span class="n">st</span> <span class="o">=</span> <span class="n">sobol_result</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">: S1=</span><span class="si">{</span><span class="n">s1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, ST=</span><span class="si">{</span><span class="n">st</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sobol analysis failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>        <span class="c1"># Morris analysis</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>        <span class="k">if</span> <span class="s2">&quot;morris&quot;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing Morris sensitivity analysis...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>                <span class="n">morris_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_morris</span><span class="p">(</span><span class="n">output_index</span><span class="o">=</span><span class="n">metric_idx</span><span class="p">)</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>                <span class="n">metric_results</span><span class="p">[</span><span class="s2">&quot;morris&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">morris_result</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>                <span class="c1"># Display Morris results summary</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Morris sensitivity index:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>                    <span class="n">mu_star</span> <span class="o">=</span> <span class="n">morris_result</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>                    <span class="n">sigma</span> <span class="o">=</span> <span class="n">morris_result</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">: μ*=</span><span class="si">{</span><span class="n">mu_star</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, σ=</span><span class="si">{</span><span class="n">sigma</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Morris analysis failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>        <span class="c1"># FAST analysis</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>        <span class="k">if</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing FAST sensitivity analysis...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>                <span class="n">fast_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_fast</span><span class="p">(</span><span class="n">output_index</span><span class="o">=</span><span class="n">metric_idx</span><span class="p">)</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>                <span class="n">metric_results</span><span class="p">[</span><span class="s2">&quot;fast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fast_result</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                <span class="c1"># Display FAST results summary</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">FAST sensitivity index:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                    <span class="n">s1</span> <span class="o">=</span> <span class="n">fast_result</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                    <span class="n">st</span> <span class="o">=</span> <span class="n">fast_result</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">: S1=</span><span class="si">{</span><span class="n">s1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, ST=</span><span class="si">{</span><span class="n">st</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FAST analysis failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>        <span class="c1"># LHS analysis</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>        <span class="k">if</span> <span class="s2">&quot;latin&quot;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing LHS uncertainty analysis...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>                <span class="n">lhs_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_lhs</span><span class="p">(</span><span class="n">output_index</span><span class="o">=</span><span class="n">metric_idx</span><span class="p">)</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>                <span class="n">metric_results</span><span class="p">[</span><span class="s2">&quot;latin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lhs_result</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>                <span class="c1"># Display LHS results summary</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">LHS分析结果:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  均值: </span><span class="si">{</span><span class="n">lhs_result</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  标准差: </span><span class="si">{</span><span class="n">lhs_result</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  最小值: </span><span class="si">{</span><span class="n">lhs_result</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  最大值: </span><span class="si">{</span><span class="n">lhs_result</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  5%分位数: </span><span class="si">{</span><span class="n">lhs_result</span><span class="p">[</span><span class="s1">&#39;percentile_5&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  95%分位数: </span><span class="si">{</span><span class="n">lhs_result</span><span class="p">[</span><span class="s1">&#39;percentile_95&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LHS分析失败: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>        <span class="n">all_results</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_results</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>        <span class="k">if</span> <span class="s2">&quot;sobol&quot;</span> <span class="ow">in</span> <span class="n">methods</span> <span class="ow">and</span> <span class="s2">&quot;sobol&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_sobol_results</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">output_metrics</span><span class="p">)</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>        <span class="k">if</span> <span class="s2">&quot;morris&quot;</span> <span class="ow">in</span> <span class="n">methods</span> <span class="ow">and</span> <span class="s2">&quot;morris&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_morris_results</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">output_metrics</span><span class="p">)</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>        <span class="k">if</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">in</span> <span class="n">methods</span> <span class="ow">and</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_fast_results</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">output_metrics</span><span class="p">)</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>        <span class="c1"># Plot LHS results</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>        <span class="k">if</span> <span class="s2">&quot;latin&quot;</span> <span class="ow">in</span> <span class="n">methods</span> <span class="ow">and</span> <span class="s2">&quot;latin&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="p">:</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_lhs_results</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">output_metrics</span><span class="p">)</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Drawing failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_results</span><span class="p">(</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>            <span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">output_metrics</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>        <span class="p">)</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>        <span class="n">report_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_sensitivity_report</span><span class="p">(</span><span class="n">all_results</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">)</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>        <span class="n">report_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="s2">&quot;analysis_report.md&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>        <span class="n">load_dotenv</span><span class="p">()</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>        <span class="c1"># --- LLM Calls for analysis ---</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>        <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;API_KEY&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>        <span class="n">base_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;BASE_URL&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>        <span class="n">ai_model</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;AI_MODEL&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>        <span class="n">sa_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>        <span class="n">case_config</span> <span class="o">=</span> <span class="n">sa_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;analysis_case&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>        <span class="n">ai_config</span> <span class="o">=</span> <span class="n">case_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ai&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>        <span class="n">ai_enabled</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ai_config</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>            <span class="n">ai_enabled</span> <span class="o">=</span> <span class="n">ai_config</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ai_config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>            <span class="n">ai_enabled</span> <span class="o">=</span> <span class="n">ai_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>        <span class="k">if</span> <span class="n">api_key</span> <span class="ow">and</span> <span class="n">base_url</span> <span class="ow">and</span> <span class="n">ai_model</span> <span class="ow">and</span> <span class="n">ai_enabled</span><span class="p">:</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>            <span class="c1"># First LLM call for initial analysis</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>            <span class="n">wrapper_prompt</span><span class="p">,</span> <span class="n">llm_summary</span> <span class="o">=</span> <span class="n">call_llm_for_salib_analysis</span><span class="p">(</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>                <span class="n">report_content</span><span class="o">=</span><span class="n">report_content</span><span class="p">,</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>                <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>                <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>                <span class="n">ai_model</span><span class="o">=</span><span class="n">ai_model</span><span class="p">,</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>                <span class="n">method</span><span class="o">=</span><span class="n">detected_method</span><span class="p">,</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>            <span class="p">)</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>            <span class="k">if</span> <span class="n">wrapper_prompt</span> <span class="ow">and</span> <span class="n">llm_summary</span><span class="p">:</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">---</span><span class="se">\n\n</span><span class="s2"># AI模型分析提示词</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;```markdown</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">wrapper_prompt</span><span class="p">)</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">```</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">---</span><span class="se">\n\n</span><span class="s2"># AI模型分析结果</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">llm_summary</span><span class="p">)</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Appended LLM prompt and summary to </span><span class="si">{</span><span class="n">report_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>                <span class="c1"># Second LLM call for academic report</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>                <span class="n">glossary_path</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">case_config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>                    <span class="n">glossary_path</span> <span class="o">=</span> <span class="n">sa_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;glossary_path&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>                <span class="k">if</span> <span class="n">glossary_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">glossary_path</span><span class="p">):</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">glossary_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>                            <span class="n">glossary_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>                        <span class="p">(</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>                            <span class="n">academic_wrapper_prompt</span><span class="p">,</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>                            <span class="n">academic_report</span><span class="p">,</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>                        <span class="p">)</span> <span class="o">=</span> <span class="n">call_llm_for_academic_report</span><span class="p">(</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>                            <span class="n">analysis_report</span><span class="o">=</span><span class="n">llm_summary</span><span class="p">,</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>                            <span class="n">glossary_content</span><span class="o">=</span><span class="n">glossary_content</span><span class="p">,</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>                            <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>                            <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>                            <span class="n">ai_model</span><span class="o">=</span><span class="n">ai_model</span><span class="p">,</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>                            <span class="n">problem_details</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">,</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>                            <span class="n">metric_names</span><span class="o">=</span><span class="n">output_metrics</span><span class="p">,</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>                            <span class="n">method</span><span class="o">=</span><span class="n">detected_method</span><span class="p">,</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>                            <span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>                        <span class="k">if</span> <span class="n">academic_wrapper_prompt</span> <span class="ow">and</span> <span class="n">academic_report</span><span class="p">:</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>                            <span class="n">academic_report_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>                                <span class="n">save_dir</span><span class="p">,</span> <span class="s2">&quot;academic_report.md&quot;</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>                            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>                                <span class="n">academic_report_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>                            <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>                                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">academic_report</span><span class="p">)</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>                                <span class="sa">f</span><span class="s2">&quot;Generated academic report: </span><span class="si">{</span><span class="n">academic_report_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>                            <span class="sa">f</span><span class="s2">&quot;Failed to generate or save academic report: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>                <span class="k">elif</span> <span class="n">glossary_path</span><span class="p">:</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>                        <span class="sa">f</span><span class="s2">&quot;Glossary file not found at </span><span class="si">{</span><span class="n">glossary_path</span><span class="si">}</span><span class="s2">, skipping academic report generation.&quot;</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>                <span class="s2">&quot;API_KEY, BASE_URL, or AI_MODEL not set, or AI analysis is disabled. Skipping LLM summary generation.&quot;</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>            <span class="p">)</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save result: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✅ SALib sensitivity analysis completed!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📁 The result has been saved to: </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>    <span class="k">return</span> <span class="n">all_results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.run_tricys_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_tricys_analysis</span><span class="p">(</span><span class="n">csv_file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.run_tricys_analysis" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Run the Tricys simulation using the generated CSV parameter file and obtain the sensitivity analysis results</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>csv_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the CSV parameter file. If None, the last generated file will be used</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_metrics</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of output metrics to be calculated</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_output_path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path for the configuration file output. If None, it will be automatically generated</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the sensitivity_analysis_summary.csv file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="k">def</span><span class="w"> </span><span class="nf">run_tricys_analysis</span><span class="p">(</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">csv_file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">output_metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">    Run the Tricys simulation using the generated CSV parameter file and obtain the sensitivity analysis results</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">        csv_file_path: Path to the CSV parameter file. If None, the last generated file will be used</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">        output_metrics: List of output metrics to be calculated</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">        config_output_path: Path for the configuration file output. If None, it will be automatically generated</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">        Path to the sensitivity_analysis_summary.csv file</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>    <span class="c1"># Generate Tricys configuration file</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>    <span class="n">tricys_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_tricys_config</span><span class="p">(</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="n">csv_file_path</span><span class="o">=</span><span class="n">csv_file_path</span><span class="p">,</span> <span class="n">output_metrics</span><span class="o">=</span><span class="n">output_metrics</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>    <span class="p">)</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting Tricys simulation analysis...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>        <span class="c1"># Call the Tricys simulation engine</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">tricys.simulation.simulation_analysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_simulation</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="n">tricys_config</span><span class="p">[</span><span class="s2">&quot;run_timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="n">run_simulation</span><span class="p">(</span><span class="n">tricys_config</span><span class="p">)</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="n">results_dir</span> <span class="o">=</span> <span class="n">tricys_config</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">][</span><span class="s2">&quot;results_dir&quot;</span><span class="p">]</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">results_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;sensitivity_analysis_summary.csv&quot;</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tricys simulation execution failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.run_tricys_simulations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_tricys_simulations</span><span class="p">(</span><span class="n">output_metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.run_tricys_simulations" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate sampling parameters and output them as a CSV file, which can be subsequently read by the Tricys simulation engine.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_metrics</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of output metrics to be extracted (for recording but does not affect CSV generation)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_workers</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of concurrent worker processes (reserved for compatibility, currently unused)</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">返回：</span></p>
    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the generated CSV file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="k">def</span><span class="w"> </span><span class="nf">run_tricys_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">    Generate sampling parameters and output them as a CSV file, which can be subsequently read by the Tricys simulation engine.</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">        output_metrics: List of output metrics to be extracted (for recording but does not affect CSV generation)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">        max_workers: Number of concurrent worker processes (reserved for compatibility, currently unused)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">        Path to the generated CSV file</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="s2">&quot;You must first call generate_samples() to generate samples.&quot;</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="k">if</span> <span class="n">output_metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="n">output_metrics</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="s2">&quot;Startup_Inventory&quot;</span><span class="p">,</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>            <span class="s2">&quot;Self_Sufficiency_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>            <span class="s2">&quot;Doubling_Time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="p">]</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Target output metrics&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;output_metrics&quot;</span><span class="p">:</span> <span class="n">output_metrics</span><span class="p">})</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="n">sampled_param_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="n">base_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>    <span class="n">csv_output_path</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;paths&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_dir&quot;</span><span class="p">))</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="o">/</span> <span class="s2">&quot;salib_sampling.csv&quot;</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>    <span class="p">)</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">csv_output_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>    <span class="n">param_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_samples</span><span class="p">):</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="n">sampled_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>            <span class="n">sampled_param_names</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span> <span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sampled_param_names</span><span class="p">))</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="p">}</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="n">job_params</span> <span class="o">=</span> <span class="n">base_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="n">job_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sampled_params</span><span class="p">)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="n">param_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job_params</span><span class="p">)</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">param_data</span><span class="p">)</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span> <span class="s2">&quot;float32&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="s2">&quot;Successfully generated parameter samples&quot;</span><span class="p">,</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_samples&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_data</span><span class="p">)},</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="p">)</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parameter file saved&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">csv_output_path</span><span class="p">})</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parameter file columns&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)})</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parameter precision set to 5 decimal places&quot;</span><span class="p">)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sample statistics&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;statistics&quot;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()})</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sampling_csv_path</span> <span class="o">=</span> <span class="n">csv_output_path</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>    <span class="k">return</span> <span class="n">csv_output_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tricys.analysis.salib.TricysSALibAnalyzer.save_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_results</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.TricysSALibAnalyzer.save_results" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Save sensitivity analysis results</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>save_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Save directory</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>format</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Save format ('csv</p>
              </div>
            </td>
            <td>
                  <code>&#39;csv&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1641" name="__codelineno-0-1641"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_results</span><span class="p">(</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a><span class="sd">    Save sensitivity analysis results</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a><span class="sd">        save_dir: Save directory</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a><span class="sd">        format: Save format (&#39;csv</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>    <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>        <span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>    <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">method_results</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">method_results</span><span class="p">:</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>            <span class="k">continue</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>        <span class="k">for</span> <span class="n">metric_key</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">method_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>            <span class="n">output_index</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;output_index&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>            <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">and</span> <span class="n">output_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_names</span><span class="p">):</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>                <span class="n">metric_display_name</span> <span class="o">=</span> <span class="n">metric_names</span><span class="p">[</span><span class="n">output_index</span><span class="p">]</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>                <span class="n">metric_display_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Metric_</span><span class="si">{</span><span class="n">output_index</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>            <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;sobol&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>                    <span class="n">sobol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>                        <span class="p">{</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>                            <span class="s2">&quot;Parameter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>                            <span class="s2">&quot;S1&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>                            <span class="s2">&quot;ST&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>                            <span class="s2">&quot;S1_conf&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;S1_conf&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>                            <span class="s2">&quot;ST_conf&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ST_conf&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>                        <span class="p">}</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>                    <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>                        <span class="sa">f</span><span class="s1">&#39;sobol_indices_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.csv&#39;</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>                    <span class="n">sobol_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sobol results have been saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;morris&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>                    <span class="n">morris_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>                        <span class="p">{</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>                            <span class="s2">&quot;Parameter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>                            <span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>                            <span class="s2">&quot;mu_star&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>                            <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>                            <span class="s2">&quot;mu_star_conf&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mu_star_conf&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>                        <span class="p">}</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>                    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;morris_indices_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.csv&#39;</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>                    <span class="n">morris_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Morris results have been saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fast&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>                    <span class="n">fast_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>                        <span class="p">{</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>                            <span class="s2">&quot;Parameter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>                            <span class="s2">&quot;S1&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>                            <span class="s2">&quot;ST&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>                        <span class="p">}</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>                    <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>                        <span class="sa">f</span><span class="s1">&#39;fast_indices_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.csv&#39;</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>                    <span class="n">fast_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FAST results have been saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;latin&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>                    <span class="c1"># Save LHS statistics</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>                    <span class="n">lhs_stats_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>                        <span class="p">{</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>                            <span class="s2">&quot;Metric&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">metric_display_name</span><span class="p">],</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>                            <span class="s2">&quot;Mean&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]],</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>                            <span class="s2">&quot;Std&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]],</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>                            <span class="s2">&quot;Min&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]],</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>                            <span class="s2">&quot;Max&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]],</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>                            <span class="s2">&quot;Percentile_5&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;percentile_5&quot;</span><span class="p">]],</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>                            <span class="s2">&quot;Percentile_95&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;percentile_95&quot;</span><span class="p">]],</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>                        <span class="p">}</span>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>                    <span class="n">filename_stats</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>                        <span class="sa">f</span><span class="s1">&#39;lhs_stats_</span><span class="si">{</span><span class="n">metric_display_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.csv&#39;</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>                    <span class="n">lhs_stats_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename_stats</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LHS统计结果已保存: </span><span class="si">{</span><span class="n">filename_stats</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>                    <span class="c1"># Remove LHS sensitivity indices saving</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>                    <span class="c1"># lhs_sens_df = pd.DataFrame({</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>                    <span class="c1">#     &quot;Parameter&quot;: self.problem[&quot;names&quot;],</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>                    <span class="c1">#     &quot;Partial_Correlation&quot;: results[&quot;partial_correlations&quot;]</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>                    <span class="c1"># })</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>                    <span class="c1"># filename_sens = f&#39;lhs_sensitivity_{metric_display_name.replace(&quot; &quot;, &quot;_&quot;)}.csv&#39;</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>                    <span class="c1"># lhs_sens_df.to_csv(os.path.join(save_dir, filename_sens), index=False)</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>                    <span class="c1"># logger.info(f&quot;LHS敏感性结果已保存: {filename_sens}&quot;)</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The result has been saved to: </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.salib.call_llm_for_academic_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">call_llm_for_academic_report</span><span class="p">(</span><span class="n">analysis_report</span><span class="p">,</span> <span class="n">glossary_content</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">ai_model</span><span class="p">,</span> <span class="n">problem_details</span><span class="p">,</span> <span class="n">metric_names</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.call_llm_for_academic_report" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Sends an analysis report and a glossary to an LLM to generate a professional academic report.</p>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span>
<span class="normal"><a href="#__codelineno-0-1875">1875</a></span>
<span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span>
<span class="normal"><a href="#__codelineno-0-1881">1881</a></span>
<span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span>
<span class="normal"><a href="#__codelineno-0-1890">1890</a></span>
<span class="normal"><a href="#__codelineno-0-1891">1891</a></span>
<span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1844" name="__codelineno-0-1844"></a><span class="k">def</span><span class="w"> </span><span class="nf">call_llm_for_academic_report</span><span class="p">(</span>
<a id="__codelineno-0-1845" name="__codelineno-0-1845"></a>    <span class="n">analysis_report</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1846" name="__codelineno-0-1846"></a>    <span class="n">glossary_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1847" name="__codelineno-0-1847"></a>    <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>    <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>    <span class="n">ai_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1850" name="__codelineno-0-1850"></a>    <span class="n">problem_details</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851"></a>    <span class="n">metric_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
<a id="__codelineno-0-1852" name="__codelineno-0-1852"></a>    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1853" name="__codelineno-0-1853"></a>    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1854" name="__codelineno-0-1854"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-1855" name="__codelineno-0-1855"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sends an analysis report and a glossary to an LLM to generate a professional academic report.&quot;&quot;&quot;</span>
<a id="__codelineno-0-1856" name="__codelineno-0-1856"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1857" name="__codelineno-0-1857"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Proceeding with LLM for academic report generation.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1858" name="__codelineno-0-1858"></a>
<a id="__codelineno-0-1859" name="__codelineno-0-1859"></a>        <span class="n">param_names_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`&quot;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">problem_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="p">[])]</span>
<a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>        <span class="p">)</span>
<a id="__codelineno-0-1862" name="__codelineno-0-1862"></a>        <span class="n">metric_names_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`&quot;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">])</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863"></a>
<a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>        <span class="n">all_plots</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.svg&quot;</span><span class="p">,</span> <span class="s2">&quot;.png&quot;</span><span class="p">))]</span>
<a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>        <span class="n">plot_list_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;    *   `</span><span class="si">{</span><span class="n">plot</span><span class="si">}</span><span class="s2">`&quot;</span> <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">all_plots</span><span class="p">])</span>
<a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>
<a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>        <span class="n">method_details</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>            <span class="s2">&quot;sobol&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sobol&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1870" name="__codelineno-0-1870"></a>                <span class="s2">&quot;methodology&quot;</span><span class="p">:</span> <span class="s2">&quot;指出本次分析采用了SALib库，并使用了**Sobol方法**。这是一种基于方差的全局敏感性分析技术，能够量化单个参数以及参数间交互作用对模型输出方差的贡献。&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1871" name="__codelineno-0-1871"></a>                <span class="s2">&quot;results_discussion&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;*   对于每个性能指标，哪些输入参数的一阶敏感性（S1）和总体敏感性（ST）最高？请结合图表（如条形图）进行解读。</span>
<a id="__codelineno-0-1872" name="__codelineno-0-1872"></a><span class="s2">        *   S1和ST指数之间的差异揭示了什么？（例如，ST显著大于S1意味着该参数与其他参数存在显著的交互作用或其影响是非线性的）。</span>
<a id="__codelineno-0-1873" name="__codelineno-0-1873"></a><span class="s2">        *   分析不同指标之间的**权衡关系 (Trade-offs)**。例如，某个参数对某个指标 (e.g., `Startup_Inventory`) 有正面影响，但可能对另一个指标 (e.g., `Doubling_Time`) 有负面影响。&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1874" name="__codelineno-0-1874"></a>            <span class="p">},</span>
<a id="__codelineno-0-1875" name="__codelineno-0-1875"></a>            <span class="s2">&quot;morris&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-0-1876" name="__codelineno-0-1876"></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Morris&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1877" name="__codelineno-0-1877"></a>                <span class="s2">&quot;methodology&quot;</span><span class="p">:</span> <span class="s2">&quot;指出本次分析采用了SALib库，并使用了**Morris方法**。这是一种基于轨迹的“一次性”设计方法，常用于在高维参数空间中进行参数筛选，以识别出影响最大的少数几个参数。&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1878" name="__codelineno-0-1878"></a>                <span class="s2">&quot;results_discussion&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;*   对于每个性能指标，哪些参数的 `μ*` (mu_star) 值最高，表明其对输出的总体影响最重要？</span>
<a id="__codelineno-0-1879" name="__codelineno-0-1879"></a><span class="s2">        *   `σ` (sigma) 值的大小又说明了什么？较高的 `σ` 值通常表明参数具有非线性效应或与其他参数存在强烈的交互作用。</span>
<a id="__codelineno-0-1880" name="__codelineno-0-1880"></a><span class="s2">        *   请结合 `μ*-σ` 图进行分析，对参数进行分类（例如，高 `μ*`/高 `σ` vs. 高 `μ*`/低 `σ`），并解释其含义。</span>
<a id="__codelineno-0-1881" name="__codelineno-0-1881"></a><span class="s2">        *   分析不同指标之间的**权衡关系 (Trade-offs)**。例如，某个参数对某个指标 (e.g., `Startup_Inventory`) 有正面影响，但可能对另一个指标 (e.g., `Doubling_Time`) 有负面影响。&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1882" name="__codelineno-0-1882"></a>            <span class="p">},</span>
<a id="__codelineno-0-1883" name="__codelineno-0-1883"></a>            <span class="s2">&quot;fast&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-0-1884" name="__codelineno-0-1884"></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;FAST&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1885" name="__codelineno-0-1885"></a>                <span class="s2">&quot;methodology&quot;</span><span class="p">:</span> <span class="s2">&quot;指出本次分析采用了SALib库，并使用了**FAST（傅里叶幅度敏感性检验）方法**。这是一种基于频率的全局敏感性分析技术，通过将参数在傅里叶级数中展开来计算敏感性指数。&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1886" name="__codelineno-0-1886"></a>                <span class="s2">&quot;results_discussion&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;*   对于每个性能指标，哪些输入参数的一阶敏感性（S1）最高？</span>
<a id="__codelineno-0-1887" name="__codelineno-0-1887"></a><span class="s2">        *   （如果可用）总体敏感性（ST）与一阶敏感性（S1）的比较揭示了什么？较大的差异通常表明存在参数交互。</span>
<a id="__codelineno-0-1888" name="__codelineno-0-1888"></a><span class="s2">        *   分析不同指标之间的**权衡关系 (Trade-offs)**。例如，某个参数对某个指标 (e.g., `Startup_Inventory`) 有正面影响，但可能对另一个指标 (e.g., `Doubling_Time`) 有负面影响。&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1889" name="__codelineno-0-1889"></a>            <span class="p">},</span>
<a id="__codelineno-0-1890" name="__codelineno-0-1890"></a>        <span class="p">}</span>
<a id="__codelineno-0-1891" name="__codelineno-0-1891"></a>
<a id="__codelineno-0-1892" name="__codelineno-0-1892"></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;latin&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1893" name="__codelineno-0-1893"></a>            <span class="n">ACADEMIC_REPORT_PROMPT_WRAPPER</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;**角色：** 您是一位在核聚变工程，特别是氚燃料循环领域，具有深厚学术背景的资深科学家，擅长进行**不确定性量化 (UQ)** 和风险评估。</span>
<a id="__codelineno-0-1894" name="__codelineno-0-1894"></a>
<a id="__codelineno-0-1895" name="__codelineno-0-1895"></a><span class="s2">**任务：** 您收到了一个基于**拉丁超立方采样 (LHS)** 的不确定性分析初步报告和一份专业术语表。请您基于这两份文件，撰写一份更加专业、正式、符合学术发表标准的深度分析总结报告。</span>
<a id="__codelineno-0-1896" name="__codelineno-0-1896"></a>
<a id="__codelineno-0-1897" name="__codelineno-0-1897"></a><span class="s2">**指令：**</span>
<a id="__codelineno-0-1898" name="__codelineno-0-1898"></a>
<a id="__codelineno-0-1899" name="__codelineno-0-1899"></a><span class="s2">1.  **专业化语言：** 将初步报告中的模型参数/缩写替换为术语表中对应的专业词汇。</span>
<a id="__codelineno-0-1900" name="__codelineno-0-1900"></a><span class="s2">2.  **学术化重述：** 用严谨、客观的学术语言重新组织和阐述初步报告中的发现，聚焦于**不确定性**的量化和解读。</span>
<a id="__codelineno-0-1901" name="__codelineno-0-1901"></a><span class="s2">3.  **图表和表格的呈现与引用：**</span>
<a id="__codelineno-0-1902" name="__codelineno-0-1902"></a><span class="s2">    *   **显示图表：** 在报告的“结果与讨论”部分，您**必须**使用Markdown语法 `![图表标题](图表文件名)` 来**直接嵌入**和显示初步报告中包含的所有图表。可用的图表文件如下：</span>
<a id="__codelineno-0-1903" name="__codelineno-0-1903"></a><span class="si">{</span><span class="n">plot_list_str</span><span class="si">}</span>
<a id="__codelineno-0-1904" name="__codelineno-0-1904"></a><span class="s2">    *   **引用图表：** 在正文中分析和讨论图表内容时，请使用“如图1所示...”等方式对图表进行编号和文字引用。</span>
<a id="__codelineno-0-1905" name="__codelineno-0-1905"></a><span class="s2">    *   **显示表格：** 当呈现数据时（例如，统计摘要、分布数据等），您**必须**使用Markdown的管道表格（pipe-table）格式来清晰地展示它们。您可以直接复用或重新格式化初步报告中的数据表格。</span>
<a id="__codelineno-0-1906" name="__codelineno-0-1906"></a><span class="s2">4.  **结构化报告：** 您的报告是关于一项**不确定性分析**。报告应包含以下部分：</span>
<a id="__codelineno-0-1907" name="__codelineno-0-1907"></a><span class="s2">    *   **摘要 (Abstract):** 简要概括本次不确定性研究的目的，明确指出分析的输入参数是 </span><span class="si">{</span><span class="n">param_names_str</span><span class="si">}</span><span class="s2">，总结这些参数的不确定性对关键性能指标 (</span><span class="si">{</span><span class="n">metric_names_str</span><span class="si">}</span><span class="s2">) 的输出分布（如均值、标准差、置信区间）有何影响。</span>
<a id="__codelineno-0-1908" name="__codelineno-0-1908"></a><span class="s2">    *   **引言 (Introduction):** 描述进行这项不确定性分析的背景和重要性。阐述研究目标，即量化评估当输入参数 </span><span class="si">{</span><span class="n">param_names_str</span><span class="si">}</span><span class="s2"> 在其定义域内变化时，氚燃料循环系统关键性能指标的统计分布和稳定性。</span>
<a id="__codelineno-0-1909" name="__codelineno-0-1909"></a><span class="s2">    *   **方法 (Methodology):** 简要说明分析方法。指出本次分析采用了拉丁超立方采样（LHS）方法来对输入参数空间进行抽样。说明被评估的关键性能指标是 </span><span class="si">{</span><span class="n">metric_names_str</span><span class="si">}</span><span class="s2">，以及输入参数的概率分布和范围。</span>
<a id="__codelineno-0-1910" name="__codelineno-0-1910"></a><span class="s2">    *   **结果与讨论 (Results and Discussion):** 这是报告的核心。请结合初步报告中的统计数据和您嵌入的图表（如直方图、累积分布图），分点详细论述：</span>
<a id="__codelineno-0-1911" name="__codelineno-0-1911"></a><span class="s2">        *   对于每个性能指标，其输出的**概率分布**是怎样的？（例如，是正态分布、偏态分布还是双峰分布？）</span>
<a id="__codelineno-0-1912" name="__codelineno-0-1912"></a><span class="s2">        *   输出指标的**不确定性范围**有多大？（参考标准差和5%-95%百分位数区间）。这个范围在工程实践中是否可以接受？</span>
<a id="__codelineno-0-1913" name="__codelineno-0-1913"></a><span class="s2">        *   是否存在某些指标的波动范围过大，可能导致系统性能低于设计要求或存在运行风险？</span>
<a id="__codelineno-0-1914" name="__codelineno-0-1914"></a><span class="s2">    *   **结论 (Conclusion):** 总结本次不确定性分析得出的主要学术结论（例如，模型的稳定性、输出指标的可靠性等），并对降低关键指标不确定性或未来的风险评估提出具体建议。</span>
<a id="__codelineno-0-1915" name="__codelineno-0-1915"></a><span class="s2">5.  **输出格式：** 请直接输出完整的学术分析报告正文，确保所有内容都遵循正确的Markdown语法。</span>
<a id="__codelineno-0-1916" name="__codelineno-0-1916"></a>
<a id="__codelineno-0-1917" name="__codelineno-0-1917"></a><span class="s2">**输入文件：**</span>
<a id="__codelineno-0-1918" name="__codelineno-0-1918"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1919" name="__codelineno-0-1919"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1920" name="__codelineno-0-1920"></a>            <span class="n">selected_method</span> <span class="o">=</span> <span class="n">method_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
<a id="__codelineno-0-1921" name="__codelineno-0-1921"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">selected_method</span><span class="p">:</span>
<a id="__codelineno-0-1922" name="__codelineno-0-1922"></a>                <span class="c1"># Fallback for unknown methods</span>
<a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>                <span class="n">selected_method</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">method</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span>
<a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>                    <span class="s2">&quot;methodology&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;指出本次分析采用了SALib库，并提及具体的敏感性分析方法为**</span><span class="si">{</span><span class="n">method</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">**。&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1926" name="__codelineno-0-1926"></a>                    <span class="s2">&quot;results_discussion&quot;</span><span class="p">:</span> <span class="s2">&quot;*   对于每个性能指标，识别出最重要的输入参数。</span><span class="se">\n</span><span class="s2">*   讨论这些发现的意义。&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1927" name="__codelineno-0-1927"></a>                <span class="p">}</span>
<a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>
<a id="__codelineno-0-1929" name="__codelineno-0-1929"></a>            <span class="n">ACADEMIC_REPORT_PROMPT_WRAPPER</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;**角色：** 您是一位在核聚变工程，特别是氚燃料循环领域，具有深厚学术背景的资深科学家。</span>
<a id="__codelineno-0-1930" name="__codelineno-0-1930"></a>
<a id="__codelineno-0-1931" name="__codelineno-0-1931"></a><span class="s2">**任务：** 您收到了一个关于**SALib </span><span class="si">{</span><span class="n">selected_method</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> 方法敏感性分析**的程序生成的初步报告和一份专业术语表。请您基于这两份文件，撰写一份更加专业、正式、符合学术发表标准的深度分析总结报告。</span>
<a id="__codelineno-0-1932" name="__codelineno-0-1932"></a>
<a id="__codelineno-0-1933" name="__codelineno-0-1933"></a><span class="s2">**指令：**</span>
<a id="__codelineno-0-1934" name="__codelineno-0-1934"></a>
<a id="__codelineno-0-1935" name="__codelineno-0-1935"></a><span class="s2">1.  **专业化语言：** 将初步报告中的模型参数/缩写（例如 `sds.I[1]`, `Startup_Inventory`）替换为术语表中对应的“中文翻译”或“英文术语”。</span>
<a id="__codelineno-0-1936" name="__codelineno-0-1936"></a><span class="s2">2.  **学术化重述：** 用严谨、客观的学术语言重新组织和阐述初步报告中的发现。</span>
<a id="__codelineno-0-1937" name="__codelineno-0-1937"></a><span class="s2">3.  **图表和表格的呈现与引用：**</span>
<a id="__codelineno-0-1938" name="__codelineno-0-1938"></a><span class="s2">    *   **显示图表：** 在报告的“结果与讨论”部分，您**必须**使用Markdown语法 `![图表标题](图表文件名)` 来**直接嵌入**和显示初步报告中包含的所有图表。可用的图表文件如下：</span>
<a id="__codelineno-0-1939" name="__codelineno-0-1939"></a><span class="si">{</span><span class="n">plot_list_str</span><span class="si">}</span>
<a id="__codelineno-0-1940" name="__codelineno-0-1940"></a><span class="s2">    *   **引用图表：** 在正文中分析和讨论图表内容时，请使用“如图1所示...”等方式对图表进行编号和文字引用。</span>
<a id="__codelineno-0-1941" name="__codelineno-0-1941"></a><span class="s2">    *   **显示表格：** 当呈现数据时（例如，敏感性指数表），您**必须**使用Markdown的管道表格（pipe-table）格式来清晰地展示它们。您可以直接复用或重新格式化初步报告中的数据表格。</span>
<a id="__codelineno-0-1942" name="__codelineno-0-1942"></a><span class="s2">4.  **结构化报告：** 您的报告是关于一项**敏感性分析**。报告应包含以下部分：</span>
<a id="__codelineno-0-1943" name="__codelineno-0-1943"></a><span class="s2">    *   **摘要 (Abstract):** 简要概括本次敏感性研究的目的，明确指明分析的输入参数是 </span><span class="si">{</span><span class="n">param_names_str</span><span class="si">}</span><span class="s2">，总结哪些参数对关键性能指标 (</span><span class="si">{</span><span class="n">metric_names_str</span><span class="si">}</span><span class="s2">) 影响最显著，并陈述核心结论。</span>
<a id="__codelineno-0-1944" name="__codelineno-0-1944"></a><span class="s2">    *   **引言 (Introduction):** 描述进行这项敏感性分析的背景和重要性。阐述研究目标，即量化评估输入参数的变化对氚燃料循环系统性能的影响。</span>
<a id="__codelineno-0-1945" name="__codelineno-0-1945"></a><span class="s2">    *   **方法 (Methodology):** </span><span class="si">{</span><span class="n">selected_method</span><span class="p">[</span><span class="s1">&#39;methodology&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> 说明被评估的关键性能指标是 </span><span class="si">{</span><span class="n">metric_names_str</span><span class="si">}</span><span class="s2">，以及输入参数 </span><span class="si">{</span><span class="n">param_names_str</span><span class="si">}</span><span class="s2"> 的变化范围。</span>
<a id="__codelineno-0-1946" name="__codelineno-0-1946"></a><span class="s2">    *   **结果与讨论 (Results and Discussion):** 这是报告的核心。请结合初步报告中的数据和您嵌入的图表，分点详细论述：</span>
<a id="__codelineno-0-1947" name="__codelineno-0-1947"></a><span class="si">{</span><span class="n">selected_method</span><span class="p">[</span><span class="s1">&#39;results_discussion&#39;</span><span class="p">]</span><span class="si">}</span>
<a id="__codelineno-0-1948" name="__codelineno-0-1948"></a><span class="s2">    *   **结论 (Conclusion):** 总结本次敏感性分析得出的主要学术结论，并对反应堆设计或未来研究方向提出具体建议。</span>
<a id="__codelineno-0-1949" name="__codelineno-0-1949"></a><span class="s2">5.  **输出格式：** 请直接输出完整的学术分析报告正文，确保所有内容都遵循正确的Markdown语法。</span>
<a id="__codelineno-0-1950" name="__codelineno-0-1950"></a>
<a id="__codelineno-0-1951" name="__codelineno-0-1951"></a><span class="s2">**输入文件：**</span>
<a id="__codelineno-0-1952" name="__codelineno-0-1952"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1953" name="__codelineno-0-1953"></a>
<a id="__codelineno-0-1954" name="__codelineno-0-1954"></a>        <span class="n">full_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ACADEMIC_REPORT_PROMPT_WRAPPER</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">---</span><span class="se">\n</span><span class="s2">### 1. 初步分析报告</span><span class="se">\n</span><span class="s2">---</span><span class="se">\n</span><span class="si">{</span><span class="n">analysis_report</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">---</span><span class="se">\n</span><span class="s2">### 2. 专业术语表</span><span class="se">\n</span><span class="s2">---</span><span class="se">\n</span><span class="si">{</span><span class="n">glossary_content</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1955" name="__codelineno-0-1955"></a>
<a id="__codelineno-0-1956" name="__codelineno-0-1956"></a>        <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
<a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>                <span class="n">client</span> <span class="o">=</span> <span class="n">openai</span><span class="o">.</span><span class="n">OpenAI</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">)</span>
<a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>                    <span class="sa">f</span><span class="s2">&quot;Sending data for academic report to LLM (Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2">)...&quot;</span>
<a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>                <span class="p">)</span>
<a id="__codelineno-0-1963" name="__codelineno-0-1963"></a>
<a id="__codelineno-0-1964" name="__codelineno-0-1964"></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>                    <span class="n">model</span><span class="o">=</span><span class="n">ai_model</span><span class="p">,</span>
<a id="__codelineno-0-1966" name="__codelineno-0-1966"></a>                    <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">full_prompt</span><span class="p">}],</span>
<a id="__codelineno-0-1967" name="__codelineno-0-1967"></a>                    <span class="n">max_tokens</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span>
<a id="__codelineno-0-1968" name="__codelineno-0-1968"></a>                <span class="p">)</span>
<a id="__codelineno-0-1969" name="__codelineno-0-1969"></a>                <span class="n">academic_report</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<a id="__codelineno-0-1970" name="__codelineno-0-1970"></a>
<a id="__codelineno-0-1971" name="__codelineno-0-1971"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;LLM academic report generation successful.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>                <span class="k">return</span> <span class="n">ACADEMIC_REPORT_PROMPT_WRAPPER</span><span class="p">,</span> <span class="n">academic_report</span>
<a id="__codelineno-0-1973" name="__codelineno-0-1973"></a>
<a id="__codelineno-0-1974" name="__codelineno-0-1974"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1975" name="__codelineno-0-1975"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>                    <span class="sa">f</span><span class="s2">&quot;Error calling LLM for academic report on attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1977" name="__codelineno-0-1977"></a>                <span class="p">)</span>
<a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1981" name="__codelineno-0-1981"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>                        <span class="sa">f</span><span class="s2">&quot;Failed to get LLM academic report after </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> attempts.&quot;</span>
<a id="__codelineno-0-1983" name="__codelineno-0-1983"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1984" name="__codelineno-0-1984"></a>                    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
<a id="__codelineno-0-1985" name="__codelineno-0-1985"></a>
<a id="__codelineno-0-1986" name="__codelineno-0-1986"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1987" name="__codelineno-0-1987"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in call_llm_for_academic_report: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1988" name="__codelineno-0-1988"></a>        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.salib.call_llm_for_salib_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">call_llm_for_salib_analysis</span><span class="p">(</span><span class="n">report_content</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">ai_model</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.call_llm_for_salib_analysis" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Sends a SALib analysis report to an LLM for summarization and returns the prompt and summary.</p>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1745" name="__codelineno-0-1745"></a><span class="k">def</span><span class="w"> </span><span class="nf">call_llm_for_salib_analysis</span><span class="p">(</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>    <span class="n">report_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ai_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sends a SALib analysis report to an LLM for summarization and returns the prompt and summary.&quot;&quot;&quot;</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Proceeding with LLM analysis for SALib report.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>        <span class="n">PROMPT_TEMPLATES</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>            <span class="s2">&quot;sobol&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;**角色：** 你是一名在氚燃料循环领域具有深厚背景的敏感性分析专家。</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a><span class="s2">**任务：** 请仔细审查并解读以下这份由SALib库生成的**Sobol敏感性分析**报告。你的目标是：</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a><span class="s2">1.  **总结核心发现**：对于报告中提到的每一个输出指标（如“启动氚量”等），总结其敏感性分析结果。</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a><span class="s2">2.  **识别关键参数**：明确指出哪些输入参数的**一阶敏感性指数（S1）**和**总敏感性指数（ST）**最高。</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a><span class="s2">3.  **解读指数含义**：解释S1和ST指数的含义。例如，高S1值表示参数对输出有重要的直接影响，而ST与S1的显著差异表示参数存在强烈的交互作用或非线性效应。</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a><span class="s2">4.  **提供综合结论**：基于所有分析结果，对模型的整体行为、参数间的相互作用，以及这些发现对工程实践的潜在启示，给出一个综合性的结论。</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a><span class="s2">请确保你的分析清晰、专业，并直接切入要点。</span>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>            <span class="s2">&quot;morris&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;**角色：** 你是一名在氚燃料循环领域具有深厚背景的敏感性分析专家。</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a><span class="s2">**任务：** 请仔细审查并解读以下这份由SALib库生成的**Morris敏感性分析**报告。你的目标是：</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a><span class="s2">1.  **总结核心发现**：对于报告中提到的每一个输出指标（如“启动氚量”等），总结其敏感性分析结果。</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a><span class="s2">2.  **识别关键参数**：根据**μ* (mu_star)**值对参数进行排序，识别出对模型输出影响最大的参数。</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a><span class="s2">3.  **解读参数效应**：解释**μ***和**σ (sigma)**的含义。高μ*表示参数有重要影响，高σ表示参数存在非线性影响或与其他参数有交互作用。结合μ*-σ图进行分析。</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a><span class="s2">4.  **提供综合结论**：基于所有分析结果，对模型的整体行为、参数间的相互作用，以及这些发现对工程实践的潜在启示，给出一个综合性的结论。</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a><span class="s2">请确保你的分析清晰、专业，并直接切入要点。</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>            <span class="s2">&quot;fast&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;**角色：** 你是一名在氚燃料循环领域具有深厚背景的敏感性分析专家。</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a><span class="s2">**任务：** 请仔细审查并解读以下这份由SALib库生成的**FAST敏感性分析**报告。你的目标是：</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a><span class="s2">1.  **总结核心发现**：对于报告中提到的每一个输出指标（如“启动氚量”等），总结其敏感性分析结果。</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a><span class="s2">2.  **识别关键参数**：明确指出哪些输入参数的**一阶敏感性指数（S1）**和**总敏感性指数（ST）**最高。</span>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a><span class="s2">3.  **解读指数含义**：解释S1和ST指数的含义。高S1值表示参数对输出有重要的直接影响，而ST与S1的差异表示参数可能存在交互作用。</span>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a><span class="s2">4.  **提供综合结论**：基于所有分析结果，对模型的整体行为、参数间的相互作用，以及这些发现对工程实践的潜在启示，给出一个综合性的结论。</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>
<a id="__codelineno-0-1781" name="__codelineno-0-1781"></a><span class="s2">请确保你的分析清晰、专业，并直接切入要点。</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>            <span class="s2">&quot;latin&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;**角色：** 你是一名在氚燃料循环领域具有深厚背景的统计学和不确定性分析专家。</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a><span class="s2">**任务：** 请仔细审查并解读以下这份由拉丁超立方采样（LHS）生成的不确定性分析报告。你的目标是：</span>
<a id="__codelineno-0-1786" name="__codelineno-0-1786"></a><span class="s2">1.  **解读统计数据**：对于报告中的每一个输出指标（如“启动氚量”等），解读其均值、标准差、最大/最小值和百分位数。</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787"></a><span class="s2">2.  **评估不确定性**：基于标准差和5%/95%百分位数的范围，评估模型输出结果的不确定性或波动范围有多大。</span>
<a id="__codelineno-0-1788" name="__codelineno-0-1788"></a><span class="s2">3.  **提供综合结论**：总结在给定的参数不确定性下，模型的关键性能指标（KPIs）表现如何，是否存在较大的风险（例如，输出值波动范围过大），并对模型的稳定性给出评价。</span>
<a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>
<a id="__codelineno-0-1790" name="__codelineno-0-1790"></a><span class="s2">请确保你的分析聚焦于不确定性的量化和解读，而不是参数的敏感性排序。</span>
<a id="__codelineno-0-1791" name="__codelineno-0-1791"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>        <span class="p">}</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>
<a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>        <span class="n">wrapper_prompt</span> <span class="o">=</span> <span class="n">PROMPT_TEMPLATES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>            <span class="n">method</span><span class="p">,</span>
<a id="__codelineno-0-1796" name="__codelineno-0-1796"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;**角色：** 你是一名在氚燃料循环领域具有深厚背景的敏感性分析专家。</span>
<a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>
<a id="__codelineno-0-1798" name="__codelineno-0-1798"></a><span class="sd">**任务：** 请仔细审查并解读以下这份由SALib库生成的敏感性分析报告。你的目标是：</span>
<a id="__codelineno-0-1799" name="__codelineno-0-1799"></a><span class="sd">1.  **总结核心发现**：简明扼要地总结报告中的关键信息。</span>
<a id="__codelineno-0-1800" name="__codelineno-0-1800"></a><span class="sd">2.  **识别关键参数**：对于报告中提到的每一个输出指标（如“启动氚量”、“倍增时间”等），明确指出哪些输入参数对它的影响最大（即最敏感）。</span>
<a id="__codelineno-0-1801" name="__codelineno-0-1801"></a><span class="sd">3.  **提供综合结论**：基于所有分析结果，对模型的整体行为、参数间的相互作用（如果可能）以及这些发现对工程实践的潜在启示，给出一个综合性的结论。</span>
<a id="__codelineno-0-1802" name="__codelineno-0-1802"></a>
<a id="__codelineno-0-1803" name="__codelineno-0-1803"></a><span class="sd">请确保你的分析清晰、专业，并直接切入要点。</span>
<a id="__codelineno-0-1804" name="__codelineno-0-1804"></a><span class="sd">&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1805" name="__codelineno-0-1805"></a>        <span class="p">)</span>
<a id="__codelineno-0-1806" name="__codelineno-0-1806"></a>
<a id="__codelineno-0-1807" name="__codelineno-0-1807"></a>        <span class="n">full_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">wrapper_prompt</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">---</span><span class="se">\n</span><span class="s2">**分析报告原文：**</span><span class="se">\n\n</span><span class="si">{</span><span class="n">report_content</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808"></a>
<a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>        <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-0-1810" name="__codelineno-0-1810"></a>        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
<a id="__codelineno-0-1811" name="__codelineno-0-1811"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1812" name="__codelineno-0-1812"></a>                <span class="n">client</span> <span class="o">=</span> <span class="n">openai</span><span class="o">.</span><span class="n">OpenAI</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">)</span>
<a id="__codelineno-0-1813" name="__codelineno-0-1813"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1814" name="__codelineno-0-1814"></a>                    <span class="sa">f</span><span class="s2">&quot;Sending SALib report to LLM (Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2">)...&quot;</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815"></a>                <span class="p">)</span>
<a id="__codelineno-0-1816" name="__codelineno-0-1816"></a>
<a id="__codelineno-0-1817" name="__codelineno-0-1817"></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818"></a>                    <span class="n">model</span><span class="o">=</span><span class="n">ai_model</span><span class="p">,</span>
<a id="__codelineno-0-1819" name="__codelineno-0-1819"></a>                    <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">full_prompt</span><span class="p">}],</span>
<a id="__codelineno-0-1820" name="__codelineno-0-1820"></a>                    <span class="n">max_tokens</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span>
<a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>                <span class="p">)</span>
<a id="__codelineno-0-1822" name="__codelineno-0-1822"></a>                <span class="n">llm_summary</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<a id="__codelineno-0-1823" name="__codelineno-0-1823"></a>
<a id="__codelineno-0-1824" name="__codelineno-0-1824"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;LLM analysis successful for SALib report.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1825" name="__codelineno-0-1825"></a>                <span class="k">return</span> <span class="n">wrapper_prompt</span><span class="p">,</span> <span class="n">llm_summary</span>  <span class="c1"># Return wrapper prompt and summary</span>
<a id="__codelineno-0-1826" name="__codelineno-0-1826"></a>
<a id="__codelineno-0-1827" name="__codelineno-0-1827"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>                    <span class="sa">f</span><span class="s2">&quot;Error calling LLM for SALib report on attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1830" name="__codelineno-0-1830"></a>                <span class="p">)</span>
<a id="__codelineno-0-1831" name="__codelineno-0-1831"></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>                        <span class="sa">f</span><span class="s2">&quot;Failed to get LLM summary for SALib report after </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> attempts.&quot;</span>
<a id="__codelineno-0-1836" name="__codelineno-0-1836"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1837" name="__codelineno-0-1837"></a>                    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># Return None on failure</span>
<a id="__codelineno-0-1838" name="__codelineno-0-1838"></a>
<a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1840" name="__codelineno-0-1840"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in call_llm_for_salib_analysis: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.analysis.salib.run_salib_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_salib_analysis</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#tricys.analysis.salib.run_salib_analysis" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Orchestrates the SALib sensitivity analysis workflow.</p>
<p>This function extracts the necessary configuration, defines the problem
space for SALib, and then runs the analysis.</p>


<p><span class="doc-section-title">参数：</span></p>
    <table>
      <thead>
        <tr>
          <th>名称</th>
          <th>类型</th>
          <th>描述</th>
          <th>默认</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The main configuration dictionary.</p>
              </div>
            </td>
            <td>
                <em>必需</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>源代码位于： <code>tricys/analysis/salib.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span>
<span class="normal"><a href="#__codelineno-0-2059">2059</a></span>
<span class="normal"><a href="#__codelineno-0-2060">2060</a></span>
<span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span>
<span class="normal"><a href="#__codelineno-0-2068">2068</a></span>
<span class="normal"><a href="#__codelineno-0-2069">2069</a></span>
<span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span>
<span class="normal"><a href="#__codelineno-0-2078">2078</a></span>
<span class="normal"><a href="#__codelineno-0-2079">2079</a></span>
<span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span>
<span class="normal"><a href="#__codelineno-0-2097">2097</a></span>
<span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span>
<span class="normal"><a href="#__codelineno-0-2118">2118</a></span>
<span class="normal"><a href="#__codelineno-0-2119">2119</a></span>
<span class="normal"><a href="#__codelineno-0-2120">2120</a></span>
<span class="normal"><a href="#__codelineno-0-2121">2121</a></span>
<span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1991" name="__codelineno-0-1991"></a><span class="k">def</span><span class="w"> </span><span class="nf">run_salib_analysis</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1992" name="__codelineno-0-1992"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1993" name="__codelineno-0-1993"></a><span class="sd">    Orchestrates the SALib sensitivity analysis workflow.</span>
<a id="__codelineno-0-1994" name="__codelineno-0-1994"></a>
<a id="__codelineno-0-1995" name="__codelineno-0-1995"></a><span class="sd">    This function extracts the necessary configuration, defines the problem</span>
<a id="__codelineno-0-1996" name="__codelineno-0-1996"></a><span class="sd">    space for SALib, and then runs the analysis.</span>
<a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>
<a id="__codelineno-0-1998" name="__codelineno-0-1998"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1999" name="__codelineno-0-1999"></a><span class="sd">        config: The main configuration dictionary.</span>
<a id="__codelineno-0-2000" name="__codelineno-0-2000"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2001" name="__codelineno-0-2001"></a>    <span class="c1"># 1. Extract sensitivity analysis configuration</span>
<a id="__codelineno-0-2002" name="__codelineno-0-2002"></a>    <span class="n">sa_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2003" name="__codelineno-0-2003"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">sa_config</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">sa_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">):</span>
<a id="__codelineno-0-2004" name="__codelineno-0-2004"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sensitivity analysis is not enabled in the configuration file.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2005" name="__codelineno-0-2005"></a>        <span class="k">return</span>
<a id="__codelineno-0-2006" name="__codelineno-0-2006"></a>
<a id="__codelineno-0-2007" name="__codelineno-0-2007"></a>    <span class="c1"># 2. Create analyzer</span>
<a id="__codelineno-0-2008" name="__codelineno-0-2008"></a>    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">TricysSALibAnalyzer</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-2009" name="__codelineno-0-2009"></a>
<a id="__codelineno-0-2010" name="__codelineno-0-2010"></a>    <span class="c1"># 3. Define the problem space from configuration</span>
<a id="__codelineno-0-2011" name="__codelineno-0-2011"></a>    <span class="n">analysis_case</span> <span class="o">=</span> <span class="n">sa_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;analysis_case&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-2012" name="__codelineno-0-2012"></a>    <span class="n">param_names</span> <span class="o">=</span> <span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;independent_variable&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2013" name="__codelineno-0-2013"></a>    <span class="n">sampling_details</span> <span class="o">=</span> <span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;independent_variable_sampling&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2014" name="__codelineno-0-2014"></a>
<a id="__codelineno-0-2015" name="__codelineno-0-2015"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-2016" name="__codelineno-0-2016"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;independent_variable&#39; must be a list of parameter names.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2017" name="__codelineno-0-2017"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sampling_details</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-2018" name="__codelineno-0-2018"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2019" name="__codelineno-0-2019"></a>            <span class="s2">&quot;&#39;independent_variable_sampling&#39; must be an object with parameter details.&quot;</span>
<a id="__codelineno-0-2020" name="__codelineno-0-2020"></a>        <span class="p">)</span>
<a id="__codelineno-0-2021" name="__codelineno-0-2021"></a>
<a id="__codelineno-0-2022" name="__codelineno-0-2022"></a>    <span class="n">param_bounds</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>        <span class="n">name</span><span class="p">:</span> <span class="n">sampling_details</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;bounds&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">param_names</span>
<a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sampling_details</span>
<a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>    <span class="p">}</span>
<a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>    <span class="n">param_dists</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>        <span class="n">name</span><span class="p">:</span> <span class="n">sampling_details</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;distribution&quot;</span><span class="p">,</span> <span class="s2">&quot;unif&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">param_names</span>
<a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sampling_details</span>
<a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>    <span class="p">}</span>
<a id="__codelineno-0-2032" name="__codelineno-0-2032"></a>
<a id="__codelineno-0-2033" name="__codelineno-0-2033"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_bounds</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_names</span><span class="p">):</span>
<a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2035" name="__codelineno-0-2035"></a>            <span class="s2">&quot;The keys of &#39;independent_variable&#39; and &#39;independent_variable_sampling&#39; do not match&quot;</span>
<a id="__codelineno-0-2036" name="__codelineno-0-2036"></a>        <span class="p">)</span>
<a id="__codelineno-0-2037" name="__codelineno-0-2037"></a>
<a id="__codelineno-0-2038" name="__codelineno-0-2038"></a>    <span class="n">problem</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">define_problem</span><span class="p">(</span><span class="n">param_bounds</span><span class="p">,</span> <span class="n">param_dists</span><span class="p">)</span>
<a id="__codelineno-0-2039" name="__codelineno-0-2039"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-2040" name="__codelineno-0-2040"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔍 The problem space with </span><span class="si">{</span><span class="n">problem</span><span class="p">[</span><span class="s1">&#39;num_vars&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> parameters was defined from the configuration file&quot;</span>
<a id="__codelineno-0-2041" name="__codelineno-0-2041"></a>    <span class="p">)</span>
<a id="__codelineno-0-2042" name="__codelineno-0-2042"></a>
<a id="__codelineno-0-2043" name="__codelineno-0-2043"></a>    <span class="c1"># 4. Generate samples from configuration</span>
<a id="__codelineno-0-2044" name="__codelineno-0-2044"></a>    <span class="n">analyzer_config</span> <span class="o">=</span> <span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;analyzer&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-2045" name="__codelineno-0-2045"></a>    <span class="n">enabled_method_name</span> <span class="o">=</span> <span class="n">analyzer_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2046" name="__codelineno-0-2046"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">enabled_method_name</span><span class="p">:</span>
<a id="__codelineno-0-2047" name="__codelineno-0-2047"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-2048" name="__codelineno-0-2048"></a>            <span class="s2">&quot;No method found in &#39;sensitivity_analysis.analysis_case.analyzer&#39;&quot;</span>
<a id="__codelineno-0-2049" name="__codelineno-0-2049"></a>        <span class="p">)</span>
<a id="__codelineno-0-2050" name="__codelineno-0-2050"></a>
<a id="__codelineno-0-2051" name="__codelineno-0-2051"></a>    <span class="n">N</span> <span class="o">=</span> <span class="n">analyzer_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sample_N&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-0-2052" name="__codelineno-0-2052"></a>
<a id="__codelineno-0-2053" name="__codelineno-0-2053"></a>    <span class="n">sample_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-2054" name="__codelineno-0-2054"></a>
<a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>    <span class="n">samples</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">generate_samples</span><span class="p">(</span>
<a id="__codelineno-0-2056" name="__codelineno-0-2056"></a>        <span class="n">method</span><span class="o">=</span><span class="n">enabled_method_name</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="o">**</span><span class="n">sample_kwargs</span>
<a id="__codelineno-0-2057" name="__codelineno-0-2057"></a>    <span class="p">)</span>
<a id="__codelineno-0-2058" name="__codelineno-0-2058"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span><span class="si">}</span><span class="s2"> parameter samples&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2059" name="__codelineno-0-2059"></a>
<a id="__codelineno-0-2060" name="__codelineno-0-2060"></a>    <span class="c1"># 5. Run Tricys simulation</span>
<a id="__codelineno-0-2061" name="__codelineno-0-2061"></a>    <span class="n">output_metrics</span> <span class="o">=</span> <span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependent_variables&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-2062" name="__codelineno-0-2062"></a>
<a id="__codelineno-0-2063" name="__codelineno-0-2063"></a>    <span class="n">csv_file_path</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">run_tricys_simulations</span><span class="p">(</span><span class="n">output_metrics</span><span class="o">=</span><span class="n">output_metrics</span><span class="p">)</span>
<a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Parameter file has been generated: </span><span class="si">{</span><span class="n">csv_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2065" name="__codelineno-0-2065"></a>
<a id="__codelineno-0-2066" name="__codelineno-0-2066"></a>    <span class="n">summary_file</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-2067" name="__codelineno-0-2067"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-2068" name="__codelineno-0-2068"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Attempting to run Tricys analysis directly...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2069" name="__codelineno-0-2069"></a>        <span class="n">summary_file</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">run_tricys_analysis</span><span class="p">(</span>
<a id="__codelineno-0-2070" name="__codelineno-0-2070"></a>            <span class="n">csv_file_path</span><span class="o">=</span><span class="n">csv_file_path</span><span class="p">,</span> <span class="n">output_metrics</span><span class="o">=</span><span class="n">output_metrics</span>
<a id="__codelineno-0-2071" name="__codelineno-0-2071"></a>        <span class="p">)</span>
<a id="__codelineno-0-2072" name="__codelineno-0-2072"></a>        <span class="k">if</span> <span class="n">summary_file</span><span class="p">:</span>
<a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Tricys analysis completed, result file: </span><span class="si">{</span><span class="n">summary_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2074" name="__codelineno-0-2074"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2075" name="__codelineno-0-2075"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;⚠️  Tricys analysis result file not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2076" name="__codelineno-0-2076"></a>            <span class="k">return</span>
<a id="__codelineno-0-2077" name="__codelineno-0-2077"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-2078" name="__codelineno-0-2078"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚠️  Tricys analysis failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2079" name="__codelineno-0-2079"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Please check if the model path and configuration are correct&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2080" name="__codelineno-0-2080"></a>        <span class="k">return</span>
<a id="__codelineno-0-2081" name="__codelineno-0-2081"></a>
<a id="__codelineno-0-2082" name="__codelineno-0-2082"></a>    <span class="c1"># 6. Run SALib analysis from Tricys results</span>
<a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-2084" name="__codelineno-0-2084"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Running SALib analysis from Tricys results...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2085" name="__codelineno-0-2085"></a>        <span class="n">all_results</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">run_salib_analysis_from_tricys_results</span><span class="p">(</span>
<a id="__codelineno-0-2086" name="__codelineno-0-2086"></a>            <span class="n">sensitivity_summary_csv</span><span class="o">=</span><span class="n">summary_file</span><span class="p">,</span>
<a id="__codelineno-0-2087" name="__codelineno-0-2087"></a>            <span class="n">param_bounds</span><span class="o">=</span><span class="n">param_bounds</span><span class="p">,</span>
<a id="__codelineno-0-2088" name="__codelineno-0-2088"></a>            <span class="n">output_metrics</span><span class="o">=</span><span class="n">output_metrics</span><span class="p">,</span>
<a id="__codelineno-0-2089" name="__codelineno-0-2089"></a>            <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="n">enabled_method_name</span><span class="p">],</span>
<a id="__codelineno-0-2090" name="__codelineno-0-2090"></a>            <span class="n">save_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">summary_file</span><span class="p">),</span>
<a id="__codelineno-0-2091" name="__codelineno-0-2091"></a>        <span class="p">)</span>
<a id="__codelineno-0-2092" name="__codelineno-0-2092"></a>
<a id="__codelineno-0-2093" name="__codelineno-0-2093"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✅ SALib </span><span class="si">{</span><span class="n">enabled_method_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> analysis completed!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2094" name="__codelineno-0-2094"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-2095" name="__codelineno-0-2095"></a>            <span class="sa">f</span><span class="s2">&quot;📁 The results have been saved to: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">summary_file</span><span class="p">),</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;salib_analysis_</span><span class="si">{</span><span class="n">enabled_method_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2096" name="__codelineno-0-2096"></a>        <span class="p">)</span>
<a id="__codelineno-0-2097" name="__codelineno-0-2097"></a>
<a id="__codelineno-0-2098" name="__codelineno-0-2098"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📈 Brief results:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2099" name="__codelineno-0-2099"></a>        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_results</span> <span class="ow">in</span> <span class="n">all_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-2100" name="__codelineno-0-2100"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2101" name="__codelineno-0-2101"></a>            <span class="k">if</span> <span class="n">enabled_method_name</span> <span class="ow">in</span> <span class="n">metric_results</span><span class="p">:</span>
<a id="__codelineno-0-2102" name="__codelineno-0-2102"></a>                <span class="n">result_data</span> <span class="o">=</span> <span class="n">metric_results</span><span class="p">[</span><span class="n">enabled_method_name</span><span class="p">]</span>
<a id="__codelineno-0-2103" name="__codelineno-0-2103"></a>                <span class="k">if</span> <span class="n">enabled_method_name</span> <span class="o">==</span> <span class="s2">&quot;sobol&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2104" name="__codelineno-0-2104"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;🔥 Most sensitive parameters (Sobol ST):&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2105" name="__codelineno-0-2105"></a>                    <span class="n">st_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">analyzer</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span> <span class="n">result_data</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-2106" name="__codelineno-0-2106"></a>                    <span class="n">st_values</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-2107" name="__codelineno-0-2107"></a>                    <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">st_values</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
<a id="__codelineno-0-2108" name="__codelineno-0-2108"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">st</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2109" name="__codelineno-0-2109"></a>                <span class="k">elif</span> <span class="n">enabled_method_name</span> <span class="o">==</span> <span class="s2">&quot;morris&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2110" name="__codelineno-0-2110"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;📊 Most Sensitive Parameter (Morris μ*):&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2111" name="__codelineno-0-2111"></a>                    <span class="n">mu_star_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-0-2112" name="__codelineno-0-2112"></a>                        <span class="nb">zip</span><span class="p">(</span><span class="n">analyzer</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span> <span class="n">result_data</span><span class="p">[</span><span class="s2">&quot;mu_star&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2113" name="__codelineno-0-2113"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2114" name="__codelineno-0-2114"></a>                    <span class="n">mu_star_values</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-2115" name="__codelineno-0-2115"></a>                    <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">mu_star</span> <span class="ow">in</span> <span class="n">mu_star_values</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
<a id="__codelineno-0-2116" name="__codelineno-0-2116"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">mu_star</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2117" name="__codelineno-0-2117"></a>                <span class="k">elif</span> <span class="n">enabled_method_name</span> <span class="o">==</span> <span class="s2">&quot;fast&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2118" name="__codelineno-0-2118"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;⚡ Most Sensitive Parameter (Morris μ*):&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2119" name="__codelineno-0-2119"></a>                    <span class="n">st_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">analyzer</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">],</span> <span class="n">result_data</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-2120" name="__codelineno-0-2120"></a>                    <span class="n">st_values</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-2121" name="__codelineno-0-2121"></a>                    <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">st_values</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
<a id="__codelineno-0-2122" name="__codelineno-0-2122"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">st</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>
<a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>        <span class="k">return</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">all_results</span>
<a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>
<a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SALib analysis failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
</div>
</div>







  
  




  



                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../tricys_utils/" class="md-footer__link md-footer__link--prev" aria-label="Previous: tricys.utils">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                tricys.utils
              </div>
            </div>
          </a>
        
        
          
          <a href="../tricys_postprocess/" class="md-footer__link md-footer__link--next" aria-label="Next: tricys.postprocess">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                tricys.postprocess
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.sections", "navigation.footer", "navigation.top", "search.highlight", "search.suggest", "navigation.tabs", "content.code.copy", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>