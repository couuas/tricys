
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
        
          <link rel="alternate" href="../goview_integration_master_plan.html" hreflang="en">
        
          <link rel="alternate" href="goview_integration_master_plan.html" hreflang="zh">
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Tricys x GoView æœ€ç»ˆé›†æˆå®ç°æ–¹æ¡ˆï¼ˆAPI v2ï¼‰ - æ°šç‡ƒæ–™å¾ªç¯é›†æˆä»¿çœŸå¹³å°</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tricys-x-goview-api-v2" class="md-skip">
          è·³è½¬è‡³
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="é¡µçœ‰">
    <a href="index.html" title="æ°šç‡ƒæ–™å¾ªç¯é›†æˆä»¿çœŸå¹³å°" class="md-header__button md-logo" aria-label="æ°šç‡ƒæ–™å¾ªç¯é›†æˆä»¿çœŸå¹³å°" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            æ°šç‡ƒæ–™å¾ªç¯é›†æˆä»¿çœŸå¹³å°
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tricys x GoView æœ€ç»ˆé›†æˆå®ç°æ–¹æ¡ˆï¼ˆAPI v2ï¼‰
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="é€‰æ‹©å½“å‰è¯­è¨€">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../goview_integration_master_plan.html" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="goview_integration_master_plan.html" hreflang="zh" class="md-select__link">
              ç®€ä½“ä¸­æ–‡
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="æœç´¢" placeholder="æœç´¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="æŸ¥æ‰¾">
        
        <button type="reset" class="md-search__icon md-icon" title="æ¸…ç©ºå½“å‰å†…å®¹" aria-label="æ¸…ç©ºå½“å‰å†…å®¹" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/asipp-neutronics/tricys" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    TRICYS
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="æ ‡ç­¾" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="index.html" class="md-tabs__link">
        
  
  
    
  
  ä¸»é¡µ

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="guides/quickstart.html" class="md-tabs__link">
          
  
  
  å…¥é—¨æŒ‡å—

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="explanation/architecture.html" class="md-tabs__link">
          
  
  
  åŸç†è§£è¯´

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="api/tricys_simulation.html" class="md-tabs__link">
          
  
  
  API å‚è€ƒ

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="questions/installation.html" class="md-tabs__link">
          
  
  
  å¸¸è§é—®é¢˜

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="changelog.html" class="md-tabs__link">
        
  
  
    
  
  æ›´æ–°æ—¥å¿—

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="license.html" class="md-tabs__link">
        
  
  
    
  
  å¼€æºè®¸å¯

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="å¯¼èˆªæ " data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="æ°šç‡ƒæ–™å¾ªç¯é›†æˆä»¿çœŸå¹³å°" class="md-nav__button md-logo" aria-label="æ°šç‡ƒæ–™å¾ªç¯é›†æˆä»¿çœŸå¹³å°" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    æ°šç‡ƒæ–™å¾ªç¯é›†æˆä»¿çœŸå¹³å°
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/asipp-neutronics/tricys" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    TRICYS
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ä¸»é¡µ
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    å…¥é—¨æŒ‡å—
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    å…¥é—¨æŒ‡å—
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guides/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    å¿«é€Ÿå¼€å§‹
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    æ¨¡å‹æ¦‚è¿°
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    æ¨¡å‹æ¦‚è¿°
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guides/models/cycle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    æ°šç‡ƒæ–™å¾ªç¯0ç»´ç³»ç»Ÿæ¨¡å‹
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    åŸºç¡€ä»¿çœŸï¼ˆTRICYS BASICï¼‰
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    åŸºç¡€ä»¿çœŸï¼ˆTRICYS BASICï¼‰
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guides/tricys_basic/basic_configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    åŸºç¡€é…ç½®
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guides/tricys_basic/parameter_sweep.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    å‚æ•°æ‰«æ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guides/tricys_basic/concurrent_operation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    å¹¶å‘è¿è¡Œ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guides/tricys_basic/post_processing_module.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    åå¤„ç†æ¨¡å—
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guides/tricys_basic/co_simulation_module.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ååŒä»¿çœŸæ¨¡å—
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    è‡ªåŠ¨åˆ†æï¼ˆTRICYS ANALYSIS)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    è‡ªåŠ¨åˆ†æï¼ˆTRICYS ANALYSIS)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guides/tricys_analysis/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    é€šç”¨ä»‹ç»
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guides/tricys_analysis/baseline_condition_analysis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    åŸºå‡†å·¥å†µåˆ†æ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guides/tricys_analysis/single_parameter_sensitivity_analysis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    å•å‚æ•°æ•æ„Ÿæ€§åˆ†æ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guides/tricys_analysis/multi_parameter_sensitivity_analysis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    å¤šå‚æ•°æ•æ„Ÿæ€§åˆ†æ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guides/tricys_analysis/sobol_global_sensitivity_analysis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SOBOLå…¨å±€æ•æ„Ÿæ€§åˆ†æ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="guides/tricys_analysis/latin_uncertainty_analysis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Latinä¸ç¡®å®šæ€§é‡åŒ–åˆ†æ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    åŸç†è§£è¯´
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    åŸç†è§£è¯´
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="explanation/architecture.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ç³»ç»Ÿæ¶æ„è®¾è®¡
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    åŸºç¡€ä»¿çœŸï¼ˆTRICYS BASICï¼‰
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    åŸºç¡€ä»¿çœŸï¼ˆTRICYS BASICï¼‰
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="explanation/tricys_basic/simulation_flow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ä»¿çœŸæ‰§è¡Œæµç¨‹
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="explanation/tricys_basic/co_simulation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ååŒä»¿çœŸåŸç†
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="explanation/tricys_basic/concurrency.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    å¹¶å‘è®¡ç®—æ¨¡å¼
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    è‡ªåŠ¨åˆ†æï¼ˆTRICYS ANALYSIS)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    è‡ªåŠ¨åˆ†æï¼ˆTRICYS ANALYSIS)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="explanation/tricys_analysis/analysis_flow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    è‡ªåŠ¨åˆ†ææµç¨‹
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="explanation/tricys_analysis/performance_metrics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="explanation/tricys_analysis/analysis_report.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ç”Ÿæˆåˆ†ææŠ¥å‘Š
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="explanation/tricys_analysis/salib_integration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SALIBé›†æˆæ–¹æ³•
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API å‚è€ƒ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API å‚è€ƒ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="api/tricys_simulation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.simulation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="api/tricys_core.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="api/tricys_utils.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="api/tricys_analysis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="api/tricys_postprocess.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.postprocess
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="api/tricys_handlers.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.handlers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    å¸¸è§é—®é¢˜
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    å¸¸è§é—®é¢˜
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="questions/installation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ğŸš€ å®‰è£…ç¯å¢ƒ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="questions/configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    âš™ï¸ é…ç½®è¿è¡Œ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="questions/advanced_features.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ğŸ”¬ é«˜çº§åŠŸèƒ½
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="questions/troubleshooting.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ğŸ› æ•…éšœæ’é™¤
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="questions/best_practices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ğŸ’¡ æœ€ä½³å®è·µ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="changelog.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    æ›´æ–°æ—¥å¿—
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="license.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    å¼€æºè®¸å¯
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        ç›®å½•
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. ç›®æ ‡ä¸å†³ç­–
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. æ¶æ„æ€»è§ˆ
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-goview-master-fetch" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. GoView ç¼–è¾‘å™¨ï¼ˆmaster-fetchï¼‰å‰ç«¯è°ƒæ•´
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-tricys_visual-iframe-b" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. tricys_visual iframe é›†æˆï¼ˆæ–¹æ¡ˆ Bï¼‰
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-api-v2-master-fetch" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. åç«¯ API v2 å…¼å®¹å±‚ï¼ˆmaster-fetch å¿…éœ€ï¼‰
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. åç«¯ API v2 å…¼å®¹å±‚ï¼ˆmaster-fetch å¿…éœ€ï¼‰">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 è·¯ç”±å‰ç¼€
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-master-fetch" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 å¿…éœ€æ¥å£ï¼ˆmaster-fetchï¼‰
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3 å“åº”å¥‘çº¦
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.4 ç™»å½•å¤ç”¨
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.5 æ•°æ®æ¨¡å‹å»ºè®®
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-goview" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. GoView å›¾è¡¨æ•°æ®é€‚é…æ¥å£ï¼ˆå¯é€‰ï¼‰
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. å­—æ®µæ˜ å°„ä¸å“åº”å¥‘çº¦
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-postmessage" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. postMessage åè®®çº¦å®š
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-goview-tricys" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. GoView ç»„ä»¶é…ç½®ç¤ºä¾‹ï¼ˆtricys æ•°æ®é€‚é…ï¼‰
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. æ¥å£è¯·æ±‚/å“åº”ç¤ºä¾‹ï¼ˆæ›´ç»†ï¼‰
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. æ¥å£è¯·æ±‚/å“åº”ç¤ºä¾‹ï¼ˆæ›´ç»†ï¼‰">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-syslogin" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.1 sys/login
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-projectcreate" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.2 project/create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#103-projectsavedata" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.3 project/save/data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#104-projectgetdata" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.4 project/getData
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#105-projectupload" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.5 project/upload
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. ä»£ç çº§ä¼ªå®ç°æ¨¡æ¿
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. ä»£ç çº§ä¼ªå®ç°æ¨¡æ¿">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-v2" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.1 è·¯ç”±æŒ‚è½½ï¼ˆv2ï¼‰
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2 ç»Ÿä¸€å“åº”å°è£…
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3 ç™»å½•é€‚é…
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-getdata" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.4 getData ç™½åå•é€»è¾‘
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115-sqlmodel" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.5 SQLModel å®šä¹‰è‰æ¡ˆ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#116-goviewrouterpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.6 è·¯ç”±æ–‡ä»¶æ¨¡æ¿ï¼ˆgoview/router.pyï¼‰
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#117-projectpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.7 project.py ä¼ªå®ç°ï¼ˆå«æ ¡éªŒã€åˆ†é¡µã€ä¸Šä¼ ï¼‰
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#118-syspy-jsonform" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.8 sys.py ä¼ªå®ç°ï¼ˆå« JSON/form å…¼å®¹ï¼‰
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#119-depspy-token" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.9 deps.py ä¼ªå®ç°ï¼ˆtoken è§£æ/ç™½åå•ï¼‰
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1110-depspy" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.10 deps.py ä¸­é—´ä»¶ä¸å¼‚å¸¸å¤„ç†ï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1111-responsespy" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.11 responses.py ä¼ªå®ç°ï¼ˆç»Ÿä¸€å“åº”ï¼‰
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1112-file-save" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.12 file save ä¼ªå®ç°ï¼ˆä¸Šä¼ ä¿å­˜ï¼‰
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1113-projectpy-meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.13 project.py åˆ†é¡µè¿”å› meta ç»“æ„
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1114" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.14 ä¸Šä¼ æ–‡ä»¶ç±»å‹/å¤§å°ç™½åå•ç­–ç•¥
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      
        12. é”™è¯¯ç ã€ç™½åå•ä¸å®‰å…¨è¦ç‚¹
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    <span class="md-ellipsis">
      
        13. å®æ–½æ­¥éª¤ï¼ˆæœ€å°æ”¹åŠ¨é›†ï¼‰
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    <span class="md-ellipsis">
      
        14. æµ‹è¯•ä¸éªŒè¯
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15" class="md-nav__link">
    <span class="md-ellipsis">
      
        15. æ–‡ä»¶æ”¹åŠ¨æ¸…å•
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#16" class="md-nav__link">
    <span class="md-ellipsis">
      
        16. å‚è€ƒèµ„æ–™
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="tricys-x-goview-api-v2">Tricys x GoView æœ€ç»ˆé›†æˆå®ç°æ–¹æ¡ˆï¼ˆAPI v2ï¼‰<a class="headerlink" href="#tricys-x-goview-api-v2" title="Permanent link">&para;</a></h1>
<p>æœ¬æ–‡æ¡£åˆå¹¶å¹¶æ•´ç†äº† GoView master-fetch åç«¯å…¼å®¹æ–¹æ¡ˆä¸ tricys_visual çš„ iframe é›†æˆæ–¹æ¡ˆï¼Œä½œä¸ºæœ€ç»ˆå®æ–½æŒ‡å—ã€‚</p>
<p>æ›´æ–°æ—¶é—´ï¼š2026-02-09</p>
<hr />
<h2 id="_1">ç›®å½•<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#tricys-x-goview-æœ€ç»ˆé›†æˆå®ç°æ–¹æ¡ˆapi-v2">Tricys x GoView æœ€ç»ˆé›†æˆå®ç°æ–¹æ¡ˆï¼ˆAPI v2ï¼‰</a></li>
<li><a href="#ç›®å½•">ç›®å½•</a></li>
<li><a href="#1-ç›®æ ‡ä¸å†³ç­–">1. ç›®æ ‡ä¸å†³ç­–</a></li>
<li><a href="#2-æ¶æ„æ€»è§ˆ">2. æ¶æ„æ€»è§ˆ</a></li>
<li><a href="#3-goview-ç¼–è¾‘å™¨master-fetchå‰ç«¯è°ƒæ•´">3. GoView ç¼–è¾‘å™¨ï¼ˆmaster-fetchï¼‰å‰ç«¯è°ƒæ•´</a></li>
<li><a href="#4-tricys_visual-iframe-é›†æˆæ–¹æ¡ˆ-b">4. tricys_visual iframe é›†æˆï¼ˆæ–¹æ¡ˆ Bï¼‰</a></li>
<li><a href="#5-åç«¯-api-v2-å…¼å®¹å±‚master-fetch-å¿…éœ€">5. åç«¯ API v2 å…¼å®¹å±‚ï¼ˆmaster-fetch å¿…éœ€ï¼‰</a><ul>
<li><a href="#51-è·¯ç”±å‰ç¼€">5.1 è·¯ç”±å‰ç¼€</a></li>
<li><a href="#52-å¿…éœ€æ¥å£master-fetch">5.2 å¿…éœ€æ¥å£ï¼ˆmaster-fetchï¼‰</a></li>
<li><a href="#53-å“åº”å¥‘çº¦">5.3 å“åº”å¥‘çº¦</a></li>
<li><a href="#54-ç™»å½•å¤ç”¨">5.4 ç™»å½•å¤ç”¨</a></li>
<li><a href="#55-æ•°æ®æ¨¡å‹å»ºè®®">5.5 æ•°æ®æ¨¡å‹å»ºè®®</a></li>
</ul>
</li>
<li><a href="#6-goview-å›¾è¡¨æ•°æ®é€‚é…æ¥å£å¯é€‰">6. GoView å›¾è¡¨æ•°æ®é€‚é…æ¥å£ï¼ˆå¯é€‰ï¼‰</a></li>
<li><a href="#7-å­—æ®µæ˜ å°„ä¸å“åº”å¥‘çº¦">7. å­—æ®µæ˜ å°„ä¸å“åº”å¥‘çº¦</a></li>
<li><a href="#8-postmessage-åè®®çº¦å®š">8. postMessage åè®®çº¦å®š</a></li>
<li><a href="#9-goview-ç»„ä»¶é…ç½®ç¤ºä¾‹tricys-æ•°æ®é€‚é…">9. GoView ç»„ä»¶é…ç½®ç¤ºä¾‹ï¼ˆtricys æ•°æ®é€‚é…ï¼‰</a></li>
<li><a href="#10-æ¥å£è¯·æ±‚å“åº”ç¤ºä¾‹æ›´ç»†">10. æ¥å£è¯·æ±‚/å“åº”ç¤ºä¾‹ï¼ˆæ›´ç»†ï¼‰</a><ul>
<li><a href="#101-syslogin">10.1 sys/login</a></li>
<li><a href="#102-projectcreate">10.2 project/create</a></li>
<li><a href="#103-projectsavedata">10.3 project/save/data</a></li>
<li><a href="#104-projectgetdata">10.4 project/getData</a></li>
<li><a href="#105-projectupload">10.5 project/upload</a></li>
</ul>
</li>
<li><a href="#11-ä»£ç çº§ä¼ªå®ç°æ¨¡æ¿">11. ä»£ç çº§ä¼ªå®ç°æ¨¡æ¿</a><ul>
<li><a href="#111-è·¯ç”±æŒ‚è½½v2">11.1 è·¯ç”±æŒ‚è½½ï¼ˆv2ï¼‰</a></li>
<li><a href="#112-ç»Ÿä¸€å“åº”å°è£…">11.2 ç»Ÿä¸€å“åº”å°è£…</a></li>
<li><a href="#113-ç™»å½•é€‚é…">11.3 ç™»å½•é€‚é…</a></li>
<li><a href="#114-getdata-ç™½åå•é€»è¾‘">11.4 getData ç™½åå•é€»è¾‘</a></li>
<li><a href="#115-sqlmodel-å®šä¹‰è‰æ¡ˆ">11.5 SQLModel å®šä¹‰è‰æ¡ˆ</a></li>
<li><a href="#116-è·¯ç”±æ–‡ä»¶æ¨¡æ¿goviewrouterpy">11.6 è·¯ç”±æ–‡ä»¶æ¨¡æ¿ï¼ˆgoview/router.pyï¼‰</a></li>
<li><a href="#117-projectpy-ä¼ªå®ç°å«æ ¡éªŒåˆ†é¡µä¸Šä¼ ">11.7 project.py ä¼ªå®ç°ï¼ˆå«æ ¡éªŒã€åˆ†é¡µã€ä¸Šä¼ ï¼‰</a></li>
<li><a href="#118-syspy-ä¼ªå®ç°å«-jsonform-å…¼å®¹">11.8 sys.py ä¼ªå®ç°ï¼ˆå« JSON/form å…¼å®¹ï¼‰</a></li>
<li><a href="#119-depspy-ä¼ªå®ç°token-è§£æç™½åå•">11.9 deps.py ä¼ªå®ç°ï¼ˆtoken è§£æ/ç™½åå•ï¼‰</a></li>
<li><a href="#1110-depspy-ä¸­é—´ä»¶ä¸å¼‚å¸¸å¤„ç†å®Œæ•´ç¤ºä¾‹">11.10 deps.py ä¸­é—´ä»¶ä¸å¼‚å¸¸å¤„ç†ï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰</a></li>
<li><a href="#1111-responsespy-ä¼ªå®ç°ç»Ÿä¸€å“åº”">11.11 responses.py ä¼ªå®ç°ï¼ˆç»Ÿä¸€å“åº”ï¼‰</a></li>
<li><a href="#1112-file-save-ä¼ªå®ç°ä¸Šä¼ ä¿å­˜">11.12 file save ä¼ªå®ç°ï¼ˆä¸Šä¼ ä¿å­˜ï¼‰</a></li>
<li><a href="#1113-projectpy-åˆ†é¡µè¿”å›-meta-ç»“æ„">11.13 project.py åˆ†é¡µè¿”å› meta ç»“æ„</a></li>
<li><a href="#1114-ä¸Šä¼ æ–‡ä»¶ç±»å‹å¤§å°ç™½åå•ç­–ç•¥">11.14 ä¸Šä¼ æ–‡ä»¶ç±»å‹/å¤§å°ç™½åå•ç­–ç•¥</a></li>
</ul>
</li>
<li><a href="#12-é”™è¯¯ç ç™½åå•ä¸å®‰å…¨è¦ç‚¹">12. é”™è¯¯ç ã€ç™½åå•ä¸å®‰å…¨è¦ç‚¹</a></li>
<li><a href="#13-å®æ–½æ­¥éª¤æœ€å°æ”¹åŠ¨é›†">13. å®æ–½æ­¥éª¤ï¼ˆæœ€å°æ”¹åŠ¨é›†ï¼‰</a></li>
<li><a href="#14-æµ‹è¯•ä¸éªŒè¯">14. æµ‹è¯•ä¸éªŒè¯</a></li>
<li><a href="#15-æ–‡ä»¶æ”¹åŠ¨æ¸…å•">15. æ–‡ä»¶æ”¹åŠ¨æ¸…å•</a></li>
<li><a href="#16-å‚è€ƒèµ„æ–™">16. å‚è€ƒèµ„æ–™</a></li>
</ul>
<hr />
<h2 id="1">1. ç›®æ ‡ä¸å†³ç­–<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<ul>
<li>é‡‡ç”¨ GoView master-fetch ä»¥æ”¯æŒç¼–è¾‘ä¸å‘å¸ƒã€‚</li>
<li>åç«¯å…¼å®¹å±‚ä½¿ç”¨ /api/v2/goviewã€‚</li>
<li>tricys_visual ä½¿ç”¨ iframe æ–¹æ¡ˆ Bï¼ˆapiBase å«å®Œæ•´ /api/v2/goview å‰ç¼€ï¼‰ã€‚</li>
<li>ç™»å½•å…¼å®¹ JSON ä¸ formï¼Œå¤ç”¨ç°æœ‰ç™»å½•é€»è¾‘ã€‚</li>
</ul>
<hr />
<h2 id="2">2. æ¶æ„æ€»è§ˆ<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<ul>
<li>tricys_goviewï¼ˆGoView master-fetchï¼‰ï¼šé¡¹ç›® CRUDã€å‘å¸ƒã€èµ„æºä¸Šä¼ ã€‚</li>
<li>tricys_visualï¼šiframe åµŒå…¥ GoViewï¼Œé€šè¿‡ postMessage ä¼ é€’ä¸Šä¸‹æ–‡ã€‚</li>
<li>tricys_backendï¼šå¯¹å¤–æš´éœ² /api/v2/goview å…¼å®¹æ¥å£ã€‚</li>
<li>å¯é€‰ï¼šå¢åŠ  tricys HDF5 æ•°æ®é€‚é…æ¥å£ä¾›å›¾è¡¨ä½¿ç”¨ã€‚</li>
</ul>
<hr />
<h2 id="3-goview-master-fetch">3. GoView ç¼–è¾‘å™¨ï¼ˆmaster-fetchï¼‰å‰ç«¯è°ƒæ•´<a class="headerlink" href="#3-goview-master-fetch" title="Permanent link">&para;</a></h2>
<ul>
<li>è¯·æ±‚å‰ç¼€ï¼š</li>
<li>tricys_goview/src/settings/httpSetting.ts</li>
<li>axiosPre = "/api/v2/goview"</li>
<li>baseURLï¼š</li>
<li>tricys_goview/src/api/axios.ts ä½¿ç”¨ (prod ? VITE_PRO_PATH : "") + axiosPre</li>
<li>ç¯å¢ƒå˜é‡ï¼š</li>
<li>tricys_goview/.env</li>
<li>VITE_DEV_PATH / VITE_PRO_PATH æŒ‡å‘åç«¯ä¸»æœº</li>
</ul>
<hr />
<h2 id="4-tricys_visual-iframe-b">4. tricys_visual iframe é›†æˆï¼ˆæ–¹æ¡ˆ Bï¼‰<a class="headerlink" href="#4-tricys_visual-iframe-b" title="Permanent link">&para;</a></h2>
<ul>
<li>GoviewView ä¼ å…¥ apiBaseï¼š</li>
<li>apiBase = http://<host>/api/v2/goview</li>
<li>ç¯å¢ƒå˜é‡ç¤ºä¾‹ï¼ˆtricys_visual/.envï¼‰ï¼š</li>
<li>VITE_GOVIEW_URL = http://localhost:5173/</li>
<li>VITE_API_V2_URL = http://localhost:8000/api/v2/goview</li>
<li>VITE_API_URL = http://localhost:8000/api/v1</li>
<li>postMessageï¼š</li>
<li>type: TRICYS_CTX</li>
<li>payload: projectId, token, apiBase</li>
</ul>
<p>è¯´æ˜ï¼šåªè¦ GoView èƒ½è®¿é—®åç«¯ä¸»æœºï¼Œiframe é›†æˆä¸å—å½±å“ã€‚</p>
<hr />
<h2 id="5-api-v2-master-fetch">5. åç«¯ API v2 å…¼å®¹å±‚ï¼ˆmaster-fetch å¿…éœ€ï¼‰<a class="headerlink" href="#5-api-v2-master-fetch" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 è·¯ç”±å‰ç¼€<a class="headerlink" href="#51" title="Permanent link">&para;</a></h3>
<ul>
<li>/api/v2/goview</li>
</ul>
<h3 id="52-master-fetch">5.2 å¿…éœ€æ¥å£ï¼ˆmaster-fetchï¼‰<a class="headerlink" href="#52-master-fetch" title="Permanent link">&para;</a></h3>
<p>ç³»ç»Ÿæ¥å£ï¼ˆsysï¼‰ï¼š
- POST /api/v2/goview/sys/login
- GET /api/v2/goview/sys/logout
- GET /api/v2/goview/sys/getOssInfo</p>
<p>é¡¹ç›®æ¥å£ï¼ˆprojectï¼‰ï¼š
- GET /api/v2/goview/project/list
- POST /api/v2/goview/project/create
- GET /api/v2/goview/project/getData
- POST /api/v2/goview/project/save/data
- POST /api/v2/goview/project/edit
- DELETE /api/v2/goview/project/delete
- PUT /api/v2/goview/project/publish
- POST /api/v2/goview/project/upload</p>
<h3 id="53">5.3 å“åº”å¥‘çº¦<a class="headerlink" href="#53" title="Permanent link">&para;</a></h3>
<ul>
<li>æˆåŠŸï¼š{ code: 200, msg: "success", data: ... }</li>
<li>å¤±è´¥ï¼š{ code: <err>, msg: <message>, data: null }</li>
<li>token å¤±æ•ˆï¼šcode = 886</li>
</ul>
<h3 id="54">5.4 ç™»å½•å¤ç”¨<a class="headerlink" href="#54" title="Permanent link">&para;</a></h3>
<ul>
<li>å¤ç”¨ verify_password + create_access_tokenã€‚</li>
<li>å…¼å®¹ JSON ä¸ formã€‚</li>
<li>è¿”å› tokenName ä¸ tokenValue ä¾›å‰ç«¯æ³¨å…¥ headerã€‚</li>
</ul>
<h3 id="55">5.5 æ•°æ®æ¨¡å‹å»ºè®®<a class="headerlink" href="#55" title="Permanent link">&para;</a></h3>
<p>æ–°å¢ GoviewProjectï¼Œå­—æ®µå»ºè®®ï¼š
- id (uuid)
- projectName
- content (string)
- state (-1/1)
- indexImage
- remarks
- createUserId
- createTime</p>
<hr />
<h2 id="6-goview">6. GoView å›¾è¡¨æ•°æ®é€‚é…æ¥å£ï¼ˆå¯é€‰ï¼‰<a class="headerlink" href="#6-goview" title="Permanent link">&para;</a></h2>
<p>ç”¨äº GoView å›¾è¡¨ç›´æ¥æ¶ˆè´¹ tricys æ•°æ®ï¼š</p>
<ul>
<li>GET /api/v2/goview/summary?projectId=...</li>
<li>GET /api/v2/goview/tasks?projectId=...&amp;limit=10</li>
<li>GET /api/v2/goview/metrics?taskId=...</li>
<li>GET /api/v2/goview/timeseries?taskId=...&amp;var=...</li>
<li>POST /api/v2/goview/timeseries/batch</li>
<li>GET /api/v2/goview/files?taskId=...</li>
<li>GET /api/v2/goview/files/download?taskId=...&amp;path=...</li>
<li>GET /api/v2/goview/analysis/tasks?projectId=...</li>
<li>GET /api/v2/goview/analysis/report?taskId=...</li>
</ul>
<p>å»ºè®®é‡‡ç”¨ { code, msg, data } æ ¼å¼ä»¥ä¿æŒä¸€è‡´ã€‚</p>
<hr />
<h2 id="7">7. å­—æ®µæ˜ å°„ä¸å“åº”å¥‘çº¦<a class="headerlink" href="#7" title="Permanent link">&para;</a></h2>
<p>ProjectItemï¼š
- id
- projectName
- state
- createTime
- indexImage
- createUserId
- remarks</p>
<p>ProjectDetail é¢å¤–å­—æ®µï¼š
- content (string)</p>
<p>ç™»å½•å“åº”ï¼š
- token: { tokenValue, tokenName }
- userinfo: { nickname, username, id }</p>
<p>æ¥å£å‚æ•°ç»†åŒ–ï¼š
- sys/login: JSON or form (username, password)
- project/list: page, pageSize, keyword
- project/create: projectName, remarks, indexImage, state
- project/getData: id
- project/save/data: id, content (x-www-form-urlencoded)
- project/edit: id, projectName, remarks, indexImage
- project/delete: id
- project/publish: id, state
- project/upload: file (multipart/form-data)</p>
<hr />
<h2 id="8-postmessage">8. postMessage åè®®çº¦å®š<a class="headerlink" href="#8-postmessage" title="Permanent link">&para;</a></h2>
<p>æ¶ˆæ¯ç»“æ„ï¼š
{
  "type": "TRICYS_CTX",
  "payload": { ... }
}</p>
<p>å®¿ä¸» -&gt; GoViewï¼š
- TRICYS_CTX: projectId, token, apiBase
- TRICYS_PROJECT_SWITCH: projectId
- TRICYS_REFRESH: reason</p>
<p>GoView -&gt; å®¿ä¸»ï¼š
- GOVIEW_READY: version
- GOVIEW_ERROR: message, code
- GOVIEW_REQUEST_REFRESH: projectId</p>
<p>å®‰å…¨è¦æ±‚ï¼šå¿…é¡»æ ¡éªŒ originï¼Œä¸ä½¿ç”¨ "*"ã€‚</p>
<hr />
<h2 id="9-goview-tricys">9. GoView ç»„ä»¶é…ç½®ç¤ºä¾‹ï¼ˆtricys æ•°æ®é€‚é…ï¼‰<a class="headerlink" href="#9-goview-tricys" title="Permanent link">&para;</a></h2>
<p>æŒ‡æ ‡å¡ï¼š
- URL: ${apiBase}/metrics?taskId=${taskId}
- dataPath: data.TBR</p>
<p>å•å˜é‡æŠ˜çº¿ï¼š
- URL: ${apiBase}/timeseries?taskId=${taskId}&amp;var=sds.I
- transform: (resp) =&gt; ({ x: resp.data.time, y: resp.data.value })</p>
<p>å¤šå˜é‡æŠ˜çº¿ï¼š
- URL: ${apiBase}/timeseries/batch
- body: { taskId, variables }
- transform: (resp) =&gt; ({ time: resp.data.time, series: resp.data.series })</p>
<p>æ–‡ä»¶æ ‘ï¼š
- URL: ${apiBase}/files?taskId=${taskId}
- dataPath: data</p>
<hr />
<h2 id="10">10. æ¥å£è¯·æ±‚/å“åº”ç¤ºä¾‹ï¼ˆæ›´ç»†ï¼‰<a class="headerlink" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="101-syslogin">10.1 sys/login<a class="headerlink" href="#101-syslogin" title="Permanent link">&para;</a></h3>
<p>Request (JSON):
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>POST /api/v2/goview/sys/login
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>{
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>  &quot;username&quot;: &quot;demo&quot;,
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>  &quot;password&quot;: &quot;demo&quot;
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>}
</code></pre></div></p>
<p>Response:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>{
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>  &quot;code&quot;: 200,
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>  &quot;msg&quot;: &quot;success&quot;,
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>  &quot;data&quot;: {
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    &quot;token&quot;: { &quot;tokenValue&quot;: &quot;&lt;jwt&gt;&quot;, &quot;tokenName&quot;: &quot;token&quot; },
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    &quot;userinfo&quot;: { &quot;nickname&quot;: &quot;demo&quot;, &quot;username&quot;: &quot;demo&quot;, &quot;id&quot;: &quot;&lt;uuid&gt;&quot; }
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>  }
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>}
</code></pre></div></p>
<h3 id="102-projectcreate">10.2 project/create<a class="headerlink" href="#102-projectcreate" title="Permanent link">&para;</a></h3>
<p>Request:
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>POST /api/v2/goview/project/create
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>{
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>  &quot;projectName&quot;: &quot;Demo Board&quot;,
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>  &quot;remarks&quot;: &quot;first draft&quot;,
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>  &quot;indexImage&quot;: &quot;&quot;,
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>  &quot;state&quot;: -1
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>}
</code></pre></div></p>
<p>Response:
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>{
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>  &quot;code&quot;: 200,
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>  &quot;msg&quot;: &quot;success&quot;,
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>  &quot;data&quot;: { &quot;id&quot;: &quot;&lt;uuid&gt;&quot; }
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>}
</code></pre></div></p>
<h3 id="103-projectsavedata">10.3 project/save/data<a class="headerlink" href="#103-projectsavedata" title="Permanent link">&para;</a></h3>
<p>Request (x-www-form-urlencoded):
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>POST /api/v2/goview/project/save/data
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>id=&lt;uuid&gt;&amp;content=&lt;json-string&gt;
</code></pre></div></p>
<p>Response:
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>{ &quot;code&quot;: 200, &quot;msg&quot;: &quot;success&quot;, &quot;data&quot;: null }
</code></pre></div></p>
<h3 id="104-projectgetdata">10.4 project/getData<a class="headerlink" href="#104-projectgetdata" title="Permanent link">&para;</a></h3>
<p>Request:
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>GET /api/v2/goview/project/getData?id=&lt;uuid&gt;
</code></pre></div></p>
<p>Response:
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>{
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>  &quot;code&quot;: 200,
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>  &quot;msg&quot;: &quot;success&quot;,
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>  &quot;data&quot;: {
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    &quot;id&quot;: &quot;&lt;uuid&gt;&quot;,
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    &quot;projectName&quot;: &quot;Demo Board&quot;,
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    &quot;state&quot;: 1,
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    &quot;indexImage&quot;: &quot;&quot;,
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    &quot;createUserId&quot;: &quot;&lt;uuid&gt;&quot;,
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    &quot;createTime&quot;: &quot;2026-02-09T10:00:00Z&quot;,
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    &quot;remarks&quot;: &quot;first draft&quot;,
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>    &quot;content&quot;: &quot;{...}&quot;
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>  }
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>}
</code></pre></div></p>
<h3 id="105-projectupload">10.5 project/upload<a class="headerlink" href="#105-projectupload" title="Permanent link">&para;</a></h3>
<p>Request (multipart/form-data):
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>POST /api/v2/goview/project/upload
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>file=@image.png
</code></pre></div></p>
<p>Response:
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>{
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>  &quot;code&quot;: 200,
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>  &quot;msg&quot;: &quot;success&quot;,
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>  &quot;data&quot;: { &quot;fileName&quot;: &quot;image.png&quot;, &quot;fileurl&quot;: &quot;/assets/goview/image.png&quot; }
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>}
</code></pre></div></p>
<hr />
<h2 id="11">11. ä»£ç çº§ä¼ªå®ç°æ¨¡æ¿<a class="headerlink" href="#11" title="Permanent link">&para;</a></h2>
<h3 id="111-v2">11.1 è·¯ç”±æŒ‚è½½ï¼ˆv2ï¼‰<a class="headerlink" href="#111-v2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIRouter</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.api.v2.goview</span><span class="w"> </span><span class="kn">import</span> <span class="n">router</span> <span class="k">as</span> <span class="n">goview_router</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">api_v2_router</span> <span class="o">=</span> <span class="n">APIRouter</span><span class="p">()</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">api_v2_router</span><span class="o">.</span><span class="n">include_router</span><span class="p">(</span><span class="n">goview_router</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;/goview&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GoView&quot;</span><span class="p">])</span>
</code></pre></div>
<h3 id="112">11.2 ç»Ÿä¸€å“åº”å°è£…<a class="headerlink" href="#112" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">success</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">):</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</code></pre></div>
<h3 id="113">11.3 ç™»å½•é€‚é…<a class="headerlink" href="#113" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/sys/login&quot;</span><span class="p">)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">form</span><span class="p">:</span> <span class="n">OAuth2PasswordRequestForm</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(),</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">)):</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>  <span class="n">payload</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>  <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;application/json&quot;</span><span class="p">):</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    <span class="n">payload</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>  <span class="n">username</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">form</span><span class="o">.</span><span class="n">username</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>  <span class="n">password</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">form</span><span class="o">.</span><span class="n">password</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>  <span class="c1"># verify_password + create_access_token</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>  <span class="k">return</span> <span class="n">success</span><span class="p">({</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;tokenValue&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;tokenName&quot;</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span><span class="p">},</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>    <span class="s2">&quot;userinfo&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;nickname&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>  <span class="p">})</span>
</code></pre></div>
<h3 id="114-getdata">11.4 getData ç™½åå•é€»è¾‘<a class="headerlink" href="#114-getdata" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/project/getData&quot;</span><span class="p">)</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">)):</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="c1"># å…è®¸åŒ¿åï¼Œä»…è¿”å›å·²å‘å¸ƒé¡¹ç›®</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="n">project</span> <span class="o">=</span> <span class="n">get_project</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="k">if</span> <span class="n">project</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>        <span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s2">&quot;not published&quot;</span><span class="p">)</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    <span class="k">return</span> <span class="n">success</span><span class="p">(</span><span class="n">project_to_detail</span><span class="p">(</span><span class="n">project</span><span class="p">))</span>
</code></pre></div>
<h3 id="115-sqlmodel">11.5 SQLModel å®šä¹‰è‰æ¡ˆ<a class="headerlink" href="#115-sqlmodel" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sqlmodel</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLModel</span><span class="p">,</span> <span class="n">Field</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">GoviewProject</span><span class="p">(</span><span class="n">SQLModel</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>  <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>  <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>  <span class="n">content</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>  <span class="n">state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>  <span class="n">index_image</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>  <span class="n">remarks</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>  <span class="n">create_user_id</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>  <span class="n">create_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>  <span class="n">update_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
</code></pre></div>
<h3 id="116-goviewrouterpy">11.6 è·¯ç”±æ–‡ä»¶æ¨¡æ¿ï¼ˆgoview/router.pyï¼‰<a class="headerlink" href="#116-goviewrouterpy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIRouter</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.api.v2.goview</span><span class="w"> </span><span class="kn">import</span> <span class="n">sys</span><span class="p">,</span> <span class="n">project</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">router</span> <span class="o">=</span> <span class="n">APIRouter</span><span class="p">()</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">router</span><span class="o">.</span><span class="n">include_router</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">router</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;/sys&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GoView&quot;</span><span class="p">])</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">router</span><span class="o">.</span><span class="n">include_router</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">router</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;/project&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GoView&quot;</span><span class="p">])</span>
</code></pre></div>
<h3 id="117-projectpy">11.7 project.py ä¼ªå®ç°ï¼ˆå«æ ¡éªŒã€åˆ†é¡µã€ä¸Šä¼ ï¼‰<a class="headerlink" href="#117-projectpy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIRouter</span><span class="p">,</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">UploadFile</span><span class="p">,</span> <span class="n">File</span><span class="p">,</span> <span class="n">Query</span><span class="p">,</span> <span class="n">Form</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sqlmodel</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">select</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">func</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.utils.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_session</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.api.v2.goview.responses</span><span class="w"> </span><span class="kn">import</span> <span class="n">success</span><span class="p">,</span> <span class="n">error</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.api.v2.goview.deps</span><span class="w"> </span><span class="kn">import</span> <span class="n">require_token</span><span class="p">,</span> <span class="n">optional_token</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.models.goview_project</span><span class="w"> </span><span class="kn">import</span> <span class="n">GoviewProject</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="n">router</span> <span class="o">=</span> <span class="n">APIRouter</span><span class="p">()</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/list&quot;</span><span class="p">)</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">list_projects</span><span class="p">(</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>  <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>  <span class="n">pageSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>  <span class="n">keyword</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>  <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>  <span class="n">user</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">require_token</span><span class="p">)</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="p">):</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>  <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">pageSize</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a>  <span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">GoviewProject</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">GoviewProject</span><span class="o">.</span><span class="n">create_user_id</span> <span class="o">==</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>  <span class="k">if</span> <span class="n">keyword</span><span class="p">:</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">GoviewProject</span><span class="o">.</span><span class="n">project_name</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a>  <span class="n">total</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">())</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">subquery</span><span class="p">()))</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>  <span class="n">items</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">pageSize</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a>  <span class="n">data</span> <span class="o">=</span> <span class="p">[{</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>    <span class="s2">&quot;projectName&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a>    <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a>    <span class="s2">&quot;createTime&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">create_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a>    <span class="s2">&quot;indexImage&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">index_image</span><span class="p">,</span>
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a>    <span class="s2">&quot;createUserId&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">create_user_id</span><span class="p">,</span>
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a>    <span class="s2">&quot;remarks&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">remarks</span><span class="p">,</span>
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a>  <span class="p">}</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a>  <span class="k">return</span> <span class="n">success</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a>
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/create&quot;</span><span class="p">)</span>
<a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_project</span><span class="p">(</span><span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">require_token</span><span class="p">)):</span>
<a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a>  <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projectName&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;New Project&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a>    <span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;projectName too long&quot;</span><span class="p">)</span>
<a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a>  <span class="n">project</span> <span class="o">=</span> <span class="n">GoviewProject</span><span class="p">(</span>
<a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a>    <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
<a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a>    <span class="n">project_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a>    <span class="n">content</span><span class="o">=</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-16-49" name="__codelineno-16-49" href="#__codelineno-16-49"></a>    <span class="n">state</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
<a id="__codelineno-16-50" name="__codelineno-16-50" href="#__codelineno-16-50"></a>    <span class="n">index_image</span><span class="o">=</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indexImage&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-16-51" name="__codelineno-16-51" href="#__codelineno-16-51"></a>    <span class="n">remarks</span><span class="o">=</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;remarks&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-16-52" name="__codelineno-16-52" href="#__codelineno-16-52"></a>    <span class="n">create_user_id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-16-53" name="__codelineno-16-53" href="#__codelineno-16-53"></a>  <span class="p">)</span>
<a id="__codelineno-16-54" name="__codelineno-16-54" href="#__codelineno-16-54"></a>  <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
<a id="__codelineno-16-55" name="__codelineno-16-55" href="#__codelineno-16-55"></a>  <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-16-56" name="__codelineno-16-56" href="#__codelineno-16-56"></a>  <span class="k">return</span> <span class="n">success</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">project</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
<a id="__codelineno-16-57" name="__codelineno-16-57" href="#__codelineno-16-57"></a>
<a id="__codelineno-16-58" name="__codelineno-16-58" href="#__codelineno-16-58"></a><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/getData&quot;</span><span class="p">)</span>
<a id="__codelineno-16-59" name="__codelineno-16-59" href="#__codelineno-16-59"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">optional_token</span><span class="p">)):</span>
<a id="__codelineno-16-60" name="__codelineno-16-60" href="#__codelineno-16-60"></a>  <span class="n">project</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">GoviewProject</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
<a id="__codelineno-16-61" name="__codelineno-16-61" href="#__codelineno-16-61"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span><span class="p">:</span>
<a id="__codelineno-16-62" name="__codelineno-16-62" href="#__codelineno-16-62"></a>    <span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;not found&quot;</span><span class="p">)</span>
<a id="__codelineno-16-63" name="__codelineno-16-63" href="#__codelineno-16-63"></a>  <span class="k">if</span> <span class="n">project</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">user</span> <span class="ow">or</span> <span class="n">project</span><span class="o">.</span><span class="n">create_user_id</span> <span class="o">!=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
<a id="__codelineno-16-64" name="__codelineno-16-64" href="#__codelineno-16-64"></a>    <span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s2">&quot;not published&quot;</span><span class="p">)</span>
<a id="__codelineno-16-65" name="__codelineno-16-65" href="#__codelineno-16-65"></a>  <span class="k">return</span> <span class="n">success</span><span class="p">({</span>
<a id="__codelineno-16-66" name="__codelineno-16-66" href="#__codelineno-16-66"></a>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">project</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-16-67" name="__codelineno-16-67" href="#__codelineno-16-67"></a>    <span class="s2">&quot;projectName&quot;</span><span class="p">:</span> <span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span>
<a id="__codelineno-16-68" name="__codelineno-16-68" href="#__codelineno-16-68"></a>    <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">project</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
<a id="__codelineno-16-69" name="__codelineno-16-69" href="#__codelineno-16-69"></a>    <span class="s2">&quot;indexImage&quot;</span><span class="p">:</span> <span class="n">project</span><span class="o">.</span><span class="n">index_image</span><span class="p">,</span>
<a id="__codelineno-16-70" name="__codelineno-16-70" href="#__codelineno-16-70"></a>    <span class="s2">&quot;createUserId&quot;</span><span class="p">:</span> <span class="n">project</span><span class="o">.</span><span class="n">create_user_id</span><span class="p">,</span>
<a id="__codelineno-16-71" name="__codelineno-16-71" href="#__codelineno-16-71"></a>    <span class="s2">&quot;createTime&quot;</span><span class="p">:</span> <span class="n">project</span><span class="o">.</span><span class="n">create_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
<a id="__codelineno-16-72" name="__codelineno-16-72" href="#__codelineno-16-72"></a>    <span class="s2">&quot;remarks&quot;</span><span class="p">:</span> <span class="n">project</span><span class="o">.</span><span class="n">remarks</span><span class="p">,</span>
<a id="__codelineno-16-73" name="__codelineno-16-73" href="#__codelineno-16-73"></a>    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">project</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
<a id="__codelineno-16-74" name="__codelineno-16-74" href="#__codelineno-16-74"></a>  <span class="p">})</span>
<a id="__codelineno-16-75" name="__codelineno-16-75" href="#__codelineno-16-75"></a>
<a id="__codelineno-16-76" name="__codelineno-16-76" href="#__codelineno-16-76"></a><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/save/data&quot;</span><span class="p">)</span>
<a id="__codelineno-16-77" name="__codelineno-16-77" href="#__codelineno-16-77"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_data</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">require_token</span><span class="p">)):</span>
<a id="__codelineno-16-78" name="__codelineno-16-78" href="#__codelineno-16-78"></a>  <span class="n">project</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">GoviewProject</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
<a id="__codelineno-16-79" name="__codelineno-16-79" href="#__codelineno-16-79"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span> <span class="ow">or</span> <span class="n">project</span><span class="o">.</span><span class="n">create_user_id</span> <span class="o">!=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
<a id="__codelineno-16-80" name="__codelineno-16-80" href="#__codelineno-16-80"></a>    <span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s2">&quot;forbidden&quot;</span><span class="p">)</span>
<a id="__codelineno-16-81" name="__codelineno-16-81" href="#__codelineno-16-81"></a>  <span class="n">project</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
<a id="__codelineno-16-82" name="__codelineno-16-82" href="#__codelineno-16-82"></a>  <span class="n">project</span><span class="o">.</span><span class="n">update_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
<a id="__codelineno-16-83" name="__codelineno-16-83" href="#__codelineno-16-83"></a>  <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
<a id="__codelineno-16-84" name="__codelineno-16-84" href="#__codelineno-16-84"></a>  <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-16-85" name="__codelineno-16-85" href="#__codelineno-16-85"></a>  <span class="k">return</span> <span class="n">success</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-16-86" name="__codelineno-16-86" href="#__codelineno-16-86"></a>
<a id="__codelineno-16-87" name="__codelineno-16-87" href="#__codelineno-16-87"></a><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/edit&quot;</span><span class="p">)</span>
<a id="__codelineno-16-88" name="__codelineno-16-88" href="#__codelineno-16-88"></a><span class="k">def</span><span class="w"> </span><span class="nf">edit_project</span><span class="p">(</span><span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">require_token</span><span class="p">)):</span>
<a id="__codelineno-16-89" name="__codelineno-16-89" href="#__codelineno-16-89"></a>  <span class="n">project</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">GoviewProject</span><span class="p">,</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>
<a id="__codelineno-16-90" name="__codelineno-16-90" href="#__codelineno-16-90"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span> <span class="ow">or</span> <span class="n">project</span><span class="o">.</span><span class="n">create_user_id</span> <span class="o">!=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
<a id="__codelineno-16-91" name="__codelineno-16-91" href="#__codelineno-16-91"></a>    <span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s2">&quot;forbidden&quot;</span><span class="p">)</span>
<a id="__codelineno-16-92" name="__codelineno-16-92" href="#__codelineno-16-92"></a>  <span class="k">if</span> <span class="s2">&quot;projectName&quot;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
<a id="__codelineno-16-93" name="__codelineno-16-93" href="#__codelineno-16-93"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projectName&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-16-94" name="__codelineno-16-94" href="#__codelineno-16-94"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-16-95" name="__codelineno-16-95" href="#__codelineno-16-95"></a>      <span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;projectName too long&quot;</span><span class="p">)</span>
<a id="__codelineno-16-96" name="__codelineno-16-96" href="#__codelineno-16-96"></a>    <span class="n">project</span><span class="o">.</span><span class="n">project_name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-16-97" name="__codelineno-16-97" href="#__codelineno-16-97"></a>  <span class="k">if</span> <span class="s2">&quot;remarks&quot;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
<a id="__codelineno-16-98" name="__codelineno-16-98" href="#__codelineno-16-98"></a>    <span class="n">project</span><span class="o">.</span><span class="n">remarks</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;remarks&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-16-99" name="__codelineno-16-99" href="#__codelineno-16-99"></a>  <span class="k">if</span> <span class="s2">&quot;indexImage&quot;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
<a id="__codelineno-16-100" name="__codelineno-16-100" href="#__codelineno-16-100"></a>    <span class="n">project</span><span class="o">.</span><span class="n">index_image</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indexImage&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-16-101" name="__codelineno-16-101" href="#__codelineno-16-101"></a>  <span class="n">project</span><span class="o">.</span><span class="n">update_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
<a id="__codelineno-16-102" name="__codelineno-16-102" href="#__codelineno-16-102"></a>  <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
<a id="__codelineno-16-103" name="__codelineno-16-103" href="#__codelineno-16-103"></a>  <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-16-104" name="__codelineno-16-104" href="#__codelineno-16-104"></a>  <span class="k">return</span> <span class="n">success</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-16-105" name="__codelineno-16-105" href="#__codelineno-16-105"></a>
<a id="__codelineno-16-106" name="__codelineno-16-106" href="#__codelineno-16-106"></a><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/delete&quot;</span><span class="p">)</span>
<a id="__codelineno-16-107" name="__codelineno-16-107" href="#__codelineno-16-107"></a><span class="k">def</span><span class="w"> </span><span class="nf">delete_project</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">require_token</span><span class="p">)):</span>
<a id="__codelineno-16-108" name="__codelineno-16-108" href="#__codelineno-16-108"></a>  <span class="n">project</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">GoviewProject</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
<a id="__codelineno-16-109" name="__codelineno-16-109" href="#__codelineno-16-109"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span> <span class="ow">or</span> <span class="n">project</span><span class="o">.</span><span class="n">create_user_id</span> <span class="o">!=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
<a id="__codelineno-16-110" name="__codelineno-16-110" href="#__codelineno-16-110"></a>    <span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s2">&quot;forbidden&quot;</span><span class="p">)</span>
<a id="__codelineno-16-111" name="__codelineno-16-111" href="#__codelineno-16-111"></a>  <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
<a id="__codelineno-16-112" name="__codelineno-16-112" href="#__codelineno-16-112"></a>  <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-16-113" name="__codelineno-16-113" href="#__codelineno-16-113"></a>  <span class="k">return</span> <span class="n">success</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-16-114" name="__codelineno-16-114" href="#__codelineno-16-114"></a>
<a id="__codelineno-16-115" name="__codelineno-16-115" href="#__codelineno-16-115"></a><span class="nd">@router</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;/publish&quot;</span><span class="p">)</span>
<a id="__codelineno-16-116" name="__codelineno-16-116" href="#__codelineno-16-116"></a><span class="k">def</span><span class="w"> </span><span class="nf">publish_project</span><span class="p">(</span><span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">require_token</span><span class="p">)):</span>
<a id="__codelineno-16-117" name="__codelineno-16-117" href="#__codelineno-16-117"></a>  <span class="n">project</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">GoviewProject</span><span class="p">,</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>
<a id="__codelineno-16-118" name="__codelineno-16-118" href="#__codelineno-16-118"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span> <span class="ow">or</span> <span class="n">project</span><span class="o">.</span><span class="n">create_user_id</span> <span class="o">!=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
<a id="__codelineno-16-119" name="__codelineno-16-119" href="#__codelineno-16-119"></a>    <span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s2">&quot;forbidden&quot;</span><span class="p">)</span>
<a id="__codelineno-16-120" name="__codelineno-16-120" href="#__codelineno-16-120"></a>  <span class="n">project</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-16-121" name="__codelineno-16-121" href="#__codelineno-16-121"></a>  <span class="n">project</span><span class="o">.</span><span class="n">update_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
<a id="__codelineno-16-122" name="__codelineno-16-122" href="#__codelineno-16-122"></a>  <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
<a id="__codelineno-16-123" name="__codelineno-16-123" href="#__codelineno-16-123"></a>  <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-16-124" name="__codelineno-16-124" href="#__codelineno-16-124"></a>  <span class="k">return</span> <span class="n">success</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-16-125" name="__codelineno-16-125" href="#__codelineno-16-125"></a>
<a id="__codelineno-16-126" name="__codelineno-16-126" href="#__codelineno-16-126"></a><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/upload&quot;</span><span class="p">)</span>
<a id="__codelineno-16-127" name="__codelineno-16-127" href="#__codelineno-16-127"></a><span class="k">def</span><span class="w"> </span><span class="nf">upload_file</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">UploadFile</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">require_token</span><span class="p">)):</span>
<a id="__codelineno-16-128" name="__codelineno-16-128" href="#__codelineno-16-128"></a>  <span class="c1"># validate file type/size here</span>
<a id="__codelineno-16-129" name="__codelineno-16-129" href="#__codelineno-16-129"></a>  <span class="n">filename</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">filename</span> <span class="ow">or</span> <span class="s2">&quot;upload.bin&quot;</span>
<a id="__codelineno-16-130" name="__codelineno-16-130" href="#__codelineno-16-130"></a>  <span class="n">save_path</span> <span class="o">=</span> <span class="n">save_to_assets</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>  <span class="c1"># implement file save</span>
<a id="__codelineno-16-131" name="__codelineno-16-131" href="#__codelineno-16-131"></a>  <span class="n">safe_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-16-132" name="__codelineno-16-132" href="#__codelineno-16-132"></a>  <span class="k">return</span> <span class="n">success</span><span class="p">({</span><span class="s2">&quot;fileName&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;fileurl&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;/assets/goview/</span><span class="si">{</span><span class="n">safe_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>
</code></pre></div>
<h3 id="118-syspy-jsonform">11.8 sys.py ä¼ªå®ç°ï¼ˆå« JSON/form å…¼å®¹ï¼‰<a class="headerlink" href="#118-syspy-jsonform" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIRouter</span><span class="p">,</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">Request</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.security</span><span class="w"> </span><span class="kn">import</span> <span class="n">OAuth2PasswordRequestForm</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sqlmodel</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">select</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.utils.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_session</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.core.security</span><span class="w"> </span><span class="kn">import</span> <span class="n">verify_password</span><span class="p">,</span> <span class="n">create_access_token</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.models.user</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.api.v2.goview.responses</span><span class="w"> </span><span class="kn">import</span> <span class="n">success</span><span class="p">,</span> <span class="n">error</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="n">router</span> <span class="o">=</span> <span class="n">APIRouter</span><span class="p">()</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">)</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">form</span><span class="p">:</span> <span class="n">OAuth2PasswordRequestForm</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(),</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">)):</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>  <span class="n">payload</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>  <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;application/json&quot;</span><span class="p">):</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>    <span class="n">payload</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>  <span class="n">username</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">form</span><span class="o">.</span><span class="n">username</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>  <span class="n">password</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">form</span><span class="o">.</span><span class="n">password</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>  <span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">verify_password</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">hashed_password</span><span class="p">):</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>    <span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;invalid credentials&quot;</span><span class="p">)</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>  <span class="n">token</span> <span class="o">=</span> <span class="n">create_access_token</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>  <span class="k">return</span> <span class="n">success</span><span class="p">({</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>    <span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;tokenValue&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;tokenName&quot;</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span><span class="p">},</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>    <span class="s2">&quot;userinfo&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;nickname&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>  <span class="p">})</span>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/logout&quot;</span><span class="p">)</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="k">def</span><span class="w"> </span><span class="nf">logout</span><span class="p">():</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a>  <span class="k">return</span> <span class="n">success</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/getOssInfo&quot;</span><span class="p">)</span>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_oss_info</span><span class="p">():</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a>  <span class="k">return</span> <span class="n">success</span><span class="p">({</span><span class="s2">&quot;bucketURL&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v2/goview/project/upload&quot;</span><span class="p">})</span>
</code></pre></div>
<h3 id="119-depspy-token">11.9 deps.py ä¼ªå®ç°ï¼ˆtoken è§£æ/ç™½åå•ï¼‰<a class="headerlink" href="#119-depspy-token" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">Depends</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.responses</span><span class="w"> </span><span class="kn">import</span> <span class="n">JSONResponse</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.api.v2.goview.responses</span><span class="w"> </span><span class="kn">import</span> <span class="n">error</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.core.security</span><span class="w"> </span><span class="kn">import</span> <span class="n">decode_access_token</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.utils.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_session</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.models.user</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="n">ALLOW_LIST</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>  <span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;/project/getData&quot;</span><span class="p">),</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>  <span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;/sys/getOssInfo&quot;</span><span class="p">),</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>  <span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/sys/login&quot;</span><span class="p">),</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="p">}</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_allowed</span><span class="p">(</span><span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>  <span class="k">return</span> <span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">path</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ALLOW_LIST</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_token</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>  <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token&quot;</span><span class="p">)</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>    <span class="n">auth</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>    <span class="k">if</span> <span class="n">auth</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Bearer &quot;</span><span class="p">):</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>      <span class="n">token</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Bearer &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>  <span class="k">return</span> <span class="n">token</span>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="k">def</span><span class="w"> </span><span class="nf">require_token</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">)):</span>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a>  <span class="k">if</span> <span class="n">is_allowed</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/api/v2/goview&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)):</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>    <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a>  <span class="n">token</span> <span class="o">=</span> <span class="n">extract_token</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>    <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">401</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;token overdue&quot;</span><span class="p">)</span>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a>  <span class="n">payload</span> <span class="o">=</span> <span class="n">decode_access_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>  <span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sub&quot;</span><span class="p">))</span>
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
<a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>    <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">401</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;token overdue&quot;</span><span class="p">)</span>
<a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>  <span class="k">return</span> <span class="n">user</span>
<a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a>
<a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="k">def</span><span class="w"> </span><span class="nf">optional_token</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">)):</span>
<a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a>  <span class="n">token</span> <span class="o">=</span> <span class="n">extract_token</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
<a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a>    <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a>  <span class="n">payload</span> <span class="o">=</span> <span class="n">decode_access_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a>  <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sub&quot;</span><span class="p">))</span>
<a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a>
<a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a><span class="c1"># app å±‚ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼Œå°† HTTPException è½¬ä¸º {code,msg,data}</span>
<a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a><span class="c1"># @app.exception_handler(HTTPException)</span>
<a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a><span class="c1"># def http_exc_handler(request, exc):</span>
<a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a><span class="c1">#     if exc.detail == &quot;token overdue&quot;:</span>
<a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a><span class="c1">#         return JSONResponse(status_code=200, content=error(886, &quot;token overdue&quot;))</span>
<a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a><span class="c1">#     return JSONResponse(status_code=200, content=error(500, str(exc.detail)))</span>
</code></pre></div>
<h3 id="1110-depspy">11.10 deps.py ä¸­é—´ä»¶ä¸å¼‚å¸¸å¤„ç†ï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰<a class="headerlink" href="#1110-depspy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">Request</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.responses</span><span class="w"> </span><span class="kn">import</span> <span class="n">JSONResponse</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTTPException</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tricys_backend.api.v2.goview.responses</span><span class="w"> </span><span class="kn">import</span> <span class="n">error</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">register_goview_handlers</span><span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="n">FastAPI</span><span class="p">):</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>  <span class="nd">@app</span><span class="o">.</span><span class="n">exception_handler</span><span class="p">(</span><span class="n">HTTPException</span><span class="p">)</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>  <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">goview_http_exception_handler</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span> <span class="n">HTTPException</span><span class="p">):</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>    <span class="c1"># ç»Ÿä¸€æˆ code/msg/data æ ¼å¼</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">detail</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;token overdue&quot;</span><span class="p">:</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>      <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">error</span><span class="p">(</span><span class="mi">886</span><span class="p">,</span> <span class="s2">&quot;token overdue&quot;</span><span class="p">))</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">error</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">detail</span><span class="p">)))</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>  <span class="nd">@app</span><span class="o">.</span><span class="n">middleware</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>  <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">goview_response_wrapper</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">call_next</span><span class="p">):</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">call_next</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>    <span class="k">return</span> <span class="n">response</span>
</code></pre></div>
<h3 id="1111-responsespy">11.11 responses.py ä¼ªå®ç°ï¼ˆç»Ÿä¸€å“åº”ï¼‰<a class="headerlink" href="#1111-responsespy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ResultCode</span><span class="p">:</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>  <span class="n">SUCCESS</span> <span class="o">=</span> <span class="mi">200</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>  <span class="n">TOKEN_OVERDUE</span> <span class="o">=</span> <span class="mi">886</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>  <span class="n">SERVER_ERROR</span> <span class="o">=</span> <span class="mi">500</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">success</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">):</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>  <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">ResultCode</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>  <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</code></pre></div>
<h3 id="1112-file-save">11.12 file save ä¼ªå®ç°ï¼ˆä¸Šä¼ ä¿å­˜ï¼‰<a class="headerlink" href="#1112-file-save" title="Permanent link">&para;</a></h3>
<h3 id="1113-projectpy-meta">11.13 project.py åˆ†é¡µè¿”å› meta ç»“æ„<a class="headerlink" href="#1113-projectpy-meta" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># å»ºè®®ç»Ÿä¸€è¿”å›ç»“æ„ï¼š</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="c1"># {</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="c1">#   &quot;code&quot;: 200,</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="c1">#   &quot;msg&quot;: &quot;success&quot;,</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="c1">#   &quot;data&quot;: [ ... ],</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="c1">#   &quot;meta&quot;: {&quot;page&quot;: 1, &quot;pageSize&quot;: 20, &quot;total&quot;: 100}</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="c1"># }</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>  <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>  <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>  <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>  <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span> <span class="s2">&quot;pageSize&quot;</span><span class="p">:</span> <span class="n">pageSize</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="n">total</span><span class="p">}</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="p">}</span>
</code></pre></div>
<h3 id="1114">11.14 ä¸Šä¼ æ–‡ä»¶ç±»å‹/å¤§å°ç™½åå•ç­–ç•¥<a class="headerlink" href="#1114" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">ALLOWED_EXT</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;.jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;.gif&quot;</span><span class="p">,</span> <span class="s2">&quot;.svg&quot;</span><span class="p">,</span> <span class="s2">&quot;.webp&quot;</span><span class="p">}</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">MAX_SIZE_MB</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_upload</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">UploadFile</span><span class="p">):</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>    <span class="n">suffix</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>    <span class="k">if</span> <span class="n">suffix</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_EXT</span><span class="p">:</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;invalid file type&quot;</span><span class="p">)</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>    <span class="n">file</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>    <span class="n">file</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>    <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="n">MAX_SIZE_MB</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;file too large&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="n">ASSETS_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;tricys_backend/assets/goview&quot;</span><span class="p">)</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_to_assets</span><span class="p">(</span><span class="n">upload_file</span><span class="p">:</span> <span class="n">UploadFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>  <span class="n">ASSETS_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>  <span class="n">filename</span> <span class="o">=</span> <span class="n">upload_file</span><span class="o">.</span><span class="n">filename</span> <span class="ow">or</span> <span class="s2">&quot;upload.bin&quot;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>  <span class="n">safe_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>  <span class="n">target</span> <span class="o">=</span> <span class="n">ASSETS_DIR</span> <span class="o">/</span> <span class="n">safe_name</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>  <span class="k">with</span> <span class="n">target</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>    <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">upload_file</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>  <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="12">12. é”™è¯¯ç ã€ç™½åå•ä¸å®‰å…¨è¦ç‚¹<a class="headerlink" href="#12" title="Permanent link">&para;</a></h2>
<ul>
<li>ç™½åå•ï¼šsys/login, sys/getOssInfo, project/getData</li>
<li>token å¤±æ•ˆï¼šcode=886</li>
<li>å…¶ä½™æ¥å£å¿…é¡»å¸¦ token header</li>
<li>å»ºè®® HTTP status ç»Ÿä¸€ 200ï¼Œé”™è¯¯ç”± code/msg è¡¨è¾¾</li>
<li>CORS å…è®¸ tricys_visual ä¸ tricys_goview origin</li>
</ul>
<hr />
<h2 id="13">13. å®æ–½æ­¥éª¤ï¼ˆæœ€å°æ”¹åŠ¨é›†ï¼‰<a class="headerlink" href="#13" title="Permanent link">&para;</a></h2>
<ol>
<li>å¢åŠ  /api/v2/goview è·¯ç”±æ¨¡å—ã€‚</li>
<li>æ–°å¢ GoviewProject æ•°æ®æ¨¡å‹ä¸ CRUD æœåŠ¡ã€‚</li>
<li>å®ç° sys/project æ¥å£ä¸å“åº”å°è£…ã€‚</li>
<li>æŒ‚è½½ assets/goview é™æ€èµ„æºã€‚</li>
<li>é…ç½® GoView å‰ç«¯å‰ç¼€ä¸ç¯å¢ƒå˜é‡ã€‚</li>
<li>é‡‡ç”¨ iframe æ–¹æ¡ˆ B å¹¶ä¼ å…¥ apiBaseã€‚</li>
</ol>
<hr />
<h2 id="14">14. æµ‹è¯•ä¸éªŒè¯<a class="headerlink" href="#14" title="Permanent link">&para;</a></h2>
<ul>
<li>ç™»å½• JSON / formã€‚</li>
<li>CRUDï¼šcreate -&gt; save -&gt; getData -&gt; publishã€‚</li>
<li>token è¿‡æœŸè¿”å› code=886ã€‚</li>
<li>ä¸Šä¼ æ–‡ä»¶è¿”å›å¯è®¿é—® fileurlã€‚</li>
<li>iframe æ­£å¸¸åŠ è½½å¹¶å®Œæˆè¯·æ±‚ã€‚</li>
</ul>
<hr />
<h2 id="15">15. æ–‡ä»¶æ”¹åŠ¨æ¸…å•<a class="headerlink" href="#15" title="Permanent link">&para;</a></h2>
<p>å‰ç«¯ï¼š
- tricys_goview/src/settings/httpSetting.ts
- tricys_goview/.env
- tricys_visual/src/views/GoviewView.vue
- tricys_visual/.env</p>
<p>åç«¯ï¼š
- tricys_backend/api/v2/goview/*
- tricys_backend/models/goview_project.py
- tricys_backend/services/goview_project_service.py
- tricys_backend/main.pyï¼ˆé™æ€èµ„æºã€CORSã€è·¯ç”±æŒ‚è½½ï¼‰</p>
<hr />
<h2 id="16">16. å‚è€ƒèµ„æ–™<a class="headerlink" href="#16" title="Permanent link">&para;</a></h2>
<ul>
<li>GoView master-fetch README</li>
<li>tricys_goview API path files</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  å›åˆ°é¡µé¢é¡¶éƒ¨
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.sections", "navigation.footer", "navigation.top", "search.highlight", "search.suggest", "navigation.tabs", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>