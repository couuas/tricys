
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../guides/tricys_analysis/latin_uncertainty_analysis/">
      
      
        <link rel="next" href="../tricys_core/">
      
      
        
          <link rel="alternate" href="../../en/api/tricys_simulation/" hreflang="en">
        
          <link rel="alternate" href="./" hreflang="zh">
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>tricys.simulation - 氚燃料循环集成仿真平台</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-simulation" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="氚燃料循环集成仿真平台" class="md-header__button md-logo" aria-label="氚燃料循环集成仿真平台" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            氚燃料循环集成仿真平台
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              tricys.simulation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../en/api/tricys_simulation/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="zh" class="md-select__link">
              简体中文
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/asipp-neutronics/tricys" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    TRICYS
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/quickstart/" class="md-tabs__link">
          
  
  
  入门指南

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  API 参考

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../explanation/architecture/" class="md-tabs__link">
          
  
  
  原理解说

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../questions/installation/" class="md-tabs__link">
          
  
  
  常见问题

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/" class="md-tabs__link">
        
  
  
    
  
  更新日志

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../license/" class="md-tabs__link">
        
  
  
    
  
  开源许可

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="氚燃料循环集成仿真平台" class="md-nav__button md-logo" aria-label="氚燃料循环集成仿真平台" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    氚燃料循环集成仿真平台
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/asipp-neutronics/tricys" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    TRICYS
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    主页
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    入门指南
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    入门指南
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    快速开始
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    模型概述
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    模型概述
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/models/cycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    氚燃料循环0维系统模型
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    基础仿真（TRICYS BASIC）
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    基础仿真（TRICYS BASIC）
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_basic/basic_configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基础配置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_basic/parameter_sweep/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    参数扫描
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_basic/concurrent_operation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    并发运行
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_basic/post_processing_module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    后处理模块
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_basic/co_simulation_module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    协同仿真模块
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    自动分析（TRICYS ANALYSIS)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    自动分析（TRICYS ANALYSIS)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_analysis/baseline_condition_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基准工况分析
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_analysis/single_parameter_sensitivity_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    单参数敏感性分析
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_analysis/multi_parameter_sensitivity_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    多参数敏感性分析
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_analysis/sobol_global_sensitivity_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SOBOL全局敏感性分析
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/tricys_analysis/latin_uncertainty_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Latin不确定性量化分析
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API 参考
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    API 参考
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    tricys.simulation
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.simulation
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        simulation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation.main" class="md-nav__link">
    <span class="md-ellipsis">
      
        main
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation.run_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_simulation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        simulation_analysis
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation_analysis.main" class="md-nav__link">
    <span class="md-ellipsis">
      
        main
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation_analysis.retry_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        retry_analysis
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation_analysis.run_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_simulation
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tricys_core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tricys_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tricys_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tricys_postprocess/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.postprocessing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tricys_handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tricys.handlers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    原理解说
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    原理解说
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. 系统架构设计
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/simulation_flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. 仿真执行流程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/co_simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. 协同仿真原理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/concurrency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. 并发计算模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/sensitivity_algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. 敏感性分析算法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/data_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. 数据管理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    常见问题
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    常见问题
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../questions/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. 安装环境
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../questions/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. 配置运行
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../questions/advanced_features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. 高级功能
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../questions/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. 故障排除
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../questions/best_practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. 最佳实践
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    更新日志
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    开源许可
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        simulation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation.main" class="md-nav__link">
    <span class="md-ellipsis">
      
        main
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation.run_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_simulation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        simulation_analysis
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation_analysis.main" class="md-nav__link">
    <span class="md-ellipsis">
      
        main
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation_analysis.retry_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        retry_analysis
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricys.simulation.simulation_analysis.run_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_simulation
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  
  



  
  


<h1 id="api-simulation">API 参考 - 主程序仿真入口 (Simulation)<a class="headerlink" href="#api-simulation" title="Permanent link">&para;</a></h1>
<div class="admonition tip">
<p class="admonition-title">主程序仿真入口 (Simulation)</p>
<p>主程序仿真入口 (Simulation) 包含了 TRICYS 的主要执行脚本，负责启动标准仿真和分析工作流。
请在下方的标签页中选择您感兴趣的特定模块。</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Standard Simulation (标准仿真)</label><label for="__tabbed_1_2">Simulation Analysis (仿真分析)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">


<div class="doc doc-object doc-module">



<a id="tricys.simulation.simulation"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="tricys.simulation.simulation.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span></code>

<a href="#tricys.simulation.simulation.main" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Main entry point for a standard simulation run.</p>
<p>This function prepares the configuration, sets up logging, and calls
the main <code>run_simulation</code> orchestrator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the JSON configuration file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>tricys/simulation/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Main entry point for a standard simulation run.</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a><span class="sd">    This function prepares the configuration, sets up logging, and calls</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><span class="sd">    the main `run_simulation` orchestrator.</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a><span class="sd">        config_path (str): The path to the JSON configuration file.</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>    <span class="n">config</span><span class="p">,</span> <span class="n">original_config</span> <span class="o">=</span> <span class="n">basic_prepare_config</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>    <span class="n">setup_logging</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">original_config</span><span class="p">)</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>        <span class="s2">&quot;Loading configuration&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>            <span class="s2">&quot;config_path&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config_path</span><span class="p">),</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>        <span class="p">},</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>    <span class="p">)</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>        <span class="n">run_simulation</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Main execution completed successfully&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>            <span class="s2">&quot;Main execution failed&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;exception&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>        <span class="p">)</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.simulation.simulation.run_simulation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_simulation</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#tricys.simulation.simulation.run_simulation" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Orchestrates the main simulation workflow.</p>
<p>This function serves as the primary orchestrator for running simulations.
It generates jobs from parameters, executes them (concurrently or sequentially,
as standard or co-simulations), merges the results into a single DataFrame,
and triggers any configured post-processing steps.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The main configuration dictionary for the run.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Supports concurrent (ThreadPoolExecutor) and sequential execution modes.
Co-simulations use ProcessPoolExecutor for better isolation. Merges all job
results into single CSV with parameter-labeled columns. Triggers post-processing
tasks if configured. Results saved to paths.results_dir.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>tricys/simulation/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="k">def</span><span class="w"> </span><span class="nf">run_simulation</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Orchestrates the main simulation workflow.</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">    This function serves as the primary orchestrator for running simulations.</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">    It generates jobs from parameters, executes them (concurrently or sequentially,</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">    as standard or co-simulations), merges the results into a single DataFrame,</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="sd">    and triggers any configured post-processing steps.</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a><span class="sd">        config: The main configuration dictionary for the run.</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">        Supports concurrent (ThreadPoolExecutor) and sequential execution modes.</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">        Co-simulations use ProcessPoolExecutor for better isolation. Merges all job</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="sd">        results into single CSV with parameter-labeled columns. Triggers post-processing</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">        tasks if configured. Results saved to paths.results_dir.</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>    <span class="n">jobs</span> <span class="o">=</span> <span class="n">generate_simulation_jobs</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">,</span> <span class="p">{}))</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>        <span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">][</span><span class="s2">&quot;results_dir&quot;</span><span class="p">])</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required path key in configuration file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>    <span class="n">simulation_results</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>    <span class="n">use_concurrent</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;concurrent&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>        <span class="n">max_workers</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_workers&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;co_simulation&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>            <span class="k">if</span> <span class="n">use_concurrent</span><span class="p">:</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>                    <span class="s2">&quot;Starting simulation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>                        <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;CONCURRENT&quot;</span><span class="p">,</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>                        <span class="s2">&quot;max_workers&quot;</span><span class="p">:</span> <span class="n">max_workers</span><span class="p">,</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>                    <span class="p">},</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>                <span class="p">)</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>                <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>                    <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>                <span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>                    <span class="n">future_to_job</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>                        <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>                            <span class="n">_run_single_job</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">job_params</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>                        <span class="p">):</span> <span class="n">job_params</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">job_params</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>                    <span class="p">}</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>                    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_job</span><span class="p">):</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>                        <span class="n">job_params</span> <span class="o">=</span> <span class="n">future_to_job</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>                        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>                            <span class="n">result_path</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                            <span class="k">if</span> <span class="n">result_path</span><span class="p">:</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>                                <span class="n">simulation_results</span><span class="p">[</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>                                    <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">job_params</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>                                <span class="p">]</span> <span class="o">=</span> <span class="n">result_path</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>                                <span class="sa">f</span><span class="s2">&quot;Job for </span><span class="si">{</span><span class="n">job_params</span><span class="si">}</span><span class="s2"> generated an exception: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>                                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>                            <span class="p">)</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting simulation&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;SEQUENTIAL&quot;</span><span class="p">})</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>                <span class="n">result_paths</span> <span class="o">=</span> <span class="n">_run_sequential_sweep</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">jobs</span><span class="p">)</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result_paths</span><span class="p">):</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>                    <span class="k">if</span> <span class="n">result_path</span><span class="p">:</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>                        <span class="n">simulation_results</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">jobs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()))]</span> <span class="o">=</span> <span class="n">result_path</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>            <span class="k">if</span> <span class="n">use_concurrent</span><span class="p">:</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>                    <span class="s2">&quot;Starting co-simulation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>                        <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;CONCURRENT&quot;</span><span class="p">,</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>                        <span class="s2">&quot;max_workers&quot;</span><span class="p">:</span> <span class="n">max_workers</span><span class="p">,</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>                    <span class="p">},</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>                <span class="p">)</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>                <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>                    <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>                <span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>                    <span class="n">future_to_job</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>                        <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>                            <span class="n">_run_co_simulation</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">job_params</span><span class="p">,</span> <span class="n">job_id</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>                        <span class="p">):</span> <span class="n">job_params</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">job_params</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>                    <span class="p">}</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>                    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_job</span><span class="p">):</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>                        <span class="n">job_params</span> <span class="o">=</span> <span class="n">future_to_job</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>                        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>                            <span class="n">result_path</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>                            <span class="k">if</span> <span class="n">result_path</span><span class="p">:</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>                                <span class="n">simulation_results</span><span class="p">[</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>                                    <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">job_params</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>                                <span class="p">]</span> <span class="o">=</span> <span class="n">result_path</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>                                    <span class="s2">&quot;Successfully finished co-simulation job&quot;</span><span class="p">,</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>                                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>                                        <span class="s2">&quot;job_params&quot;</span><span class="p">:</span> <span class="n">job_params</span><span class="p">,</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>                                    <span class="p">},</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>                                <span class="p">)</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>                            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>                                    <span class="s2">&quot;Co-simulation job did not return a result path&quot;</span><span class="p">,</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>                                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>                                        <span class="s2">&quot;job_params&quot;</span><span class="p">:</span> <span class="n">job_params</span><span class="p">,</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>                                    <span class="p">},</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>                                <span class="p">)</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>                                <span class="s2">&quot;Co-simulation job generated an exception&quot;</span><span class="p">,</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>                                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>                                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>                                    <span class="s2">&quot;job_params&quot;</span><span class="p">:</span> <span class="n">job_params</span><span class="p">,</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                                    <span class="s2">&quot;exception&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>                                <span class="p">},</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>                            <span class="p">)</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting co-simulation&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;SEQUENTIAL&quot;</span><span class="p">})</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">job_params</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jobs</span><span class="p">):</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>                    <span class="n">job_id</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>                        <span class="s2">&quot;Starting Sequential Co-simulation Job&quot;</span><span class="p">,</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>                            <span class="s2">&quot;job_index&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>                        <span class="p">},</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>                    <span class="p">)</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>                        <span class="n">result_path</span> <span class="o">=</span> <span class="n">_run_co_simulation</span><span class="p">(</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>                            <span class="n">config</span><span class="p">,</span> <span class="n">job_params</span><span class="p">,</span> <span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>                        <span class="p">)</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>                        <span class="k">if</span> <span class="n">result_path</span><span class="p">:</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>                            <span class="n">simulation_results</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">job_params</span><span class="o">.</span><span class="n">items</span><span class="p">()))]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>                                <span class="n">result_path</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>                            <span class="p">)</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>                                <span class="s2">&quot;Successfully finished co-simulation job&quot;</span><span class="p">,</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>                                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>                                    <span class="s2">&quot;job_params&quot;</span><span class="p">:</span> <span class="n">job_params</span><span class="p">,</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>                                <span class="p">},</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>                            <span class="p">)</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>                                <span class="s2">&quot;Co-simulation job did not return a result path&quot;</span><span class="p">,</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>                                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>                                    <span class="s2">&quot;job_params&quot;</span><span class="p">:</span> <span class="n">job_params</span><span class="p">,</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>                                <span class="p">},</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>                            <span class="p">)</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>                            <span class="s2">&quot;Co-simulation job generated an exception&quot;</span><span class="p">,</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>                            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>                            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>                                <span class="s2">&quot;job_params&quot;</span><span class="p">:</span> <span class="n">job_params</span><span class="p">,</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>                                <span class="s2">&quot;exception&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>                            <span class="p">},</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>                        <span class="p">)</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>                        <span class="s2">&quot;Finished Sequential Co-simulation Job&quot;</span><span class="p">,</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>                            <span class="s2">&quot;job_index&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>                        <span class="p">},</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>                    <span class="p">)</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to run simulation&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>    <span class="c1"># --- Result Handling ---</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>    <span class="c1"># The simulation_results dictionary now contains paths to results inside temporary job workspaces.</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>    <span class="c1"># The results_dir from the config is now the self-contained workspace&#39;s results folder.</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>    <span class="n">run_results_dir</span> <span class="o">=</span> <span class="n">results_dir</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">run_results_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>    <span class="c1"># Unified result processing for both single and multiple jobs</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>        <span class="s2">&quot;Processing jobs and combining results&quot;</span><span class="p">,</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>            <span class="s2">&quot;num_jobs&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">),</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>        <span class="p">},</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>    <span class="p">)</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>    <span class="n">combined_df</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>    <span class="n">all_dfs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>    <span class="n">time_df_added</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>    <span class="k">for</span> <span class="n">job_params</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>        <span class="n">job_key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">job_params</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>        <span class="n">result_path</span> <span class="o">=</span> <span class="n">simulation_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">job_key</span><span class="p">)</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">result_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">result_path</span><span class="p">):</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>                <span class="s2">&quot;Job produced no result file&quot;</span><span class="p">,</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>                    <span class="s2">&quot;job_params&quot;</span><span class="p">:</span> <span class="n">job_params</span><span class="p">,</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>                <span class="p">},</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>            <span class="p">)</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>            <span class="k">continue</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>        <span class="c1"># Read the current job&#39;s result file</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">result_path</span><span class="p">)</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>        <span class="c1"># From the very first valid DataFrame, grab the &#39;time&#39; column</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">time_df_added</span> <span class="ow">and</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>            <span class="n">all_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s2">&quot;time&quot;</span><span class="p">]])</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>            <span class="n">time_df_added</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>        <span class="c1"># Prepare the parameter string for column renaming</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>        <span class="n">param_string</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">job_params</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>        <span class="c1"># Isolate the data columns (everything except &#39;time&#39;)</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>        <span class="n">data_columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>        <span class="c1"># Create a dictionary to map old column names to new ones</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>        <span class="c1"># e.g., {&#39;voltage&#39;: &#39;voltage&amp;param1=A&amp;param2=B&#39;}</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>        <span class="n">rename_mapping</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>            <span class="n">col</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">{</span><span class="n">param_string</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">param_string</span> <span class="k">else</span> <span class="n">col</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data_columns</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>        <span class="p">}</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>        <span class="c1"># Rename the columns and add the resulting DataFrame to our list</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>        <span class="n">all_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_columns</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename_mapping</span><span class="p">))</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>    <span class="c1"># Concatenate all the DataFrames in the list along the columns axis (axis=1)</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>    <span class="k">if</span> <span class="n">all_dfs</span><span class="p">:</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>        <span class="n">combined_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>        <span class="n">combined_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># Or None, as you had before</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>    <span class="k">if</span> <span class="n">combined_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>            <span class="c1"># For single job, save as simulation_result.csv</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>            <span class="n">combined_csv_path</span> <span class="o">=</span> <span class="n">get_unique_filename</span><span class="p">(</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>                <span class="n">run_results_dir</span><span class="p">,</span> <span class="s2">&quot;simulation_result.csv&quot;</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>            <span class="p">)</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>            <span class="c1"># For multiple jobs, save as sweep_results.csv</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>            <span class="n">combined_csv_path</span> <span class="o">=</span> <span class="n">get_unique_filename</span><span class="p">(</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>                <span class="n">run_results_dir</span><span class="p">,</span> <span class="s2">&quot;sweep_results.csv&quot;</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>            <span class="p">)</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>        <span class="n">combined_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">combined_csv_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>            <span class="s2">&quot;Combined results saved&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>                <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">combined_csv_path</span><span class="p">,</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>            <span class="p">},</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>        <span class="p">)</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No valid results found to combine&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>    <span class="c1"># --- Post-Processing ---</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>    <span class="k">if</span> <span class="n">combined_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>        <span class="c1"># Calculate the top-level post-processing directory</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>        <span class="n">top_level_run_workspace</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;run_timestamp&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>        <span class="n">top_level_post_processing_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>            <span class="n">top_level_run_workspace</span><span class="p">,</span> <span class="s2">&quot;post_processing&quot;</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>        <span class="p">)</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>        <span class="n">_run_post_processing</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">combined_df</span><span class="p">,</span> <span class="n">top_level_post_processing_dir</span><span class="p">)</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No simulation results generated, skipping post-processing&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>    <span class="c1"># --- Final Cleanup ---</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>    <span class="c1"># The primary cleanup of job workspaces is handled by the `finally` block in `_run_co_simulation`.</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>    <span class="c1"># This is an additional safeguard.</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_temp_files&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>        <span class="n">temp_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_dir&quot;</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>            <span class="s2">&quot;Cleaning up temporary directory&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="n">temp_dir_path</span><span class="p">,</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>            <span class="p">},</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>        <span class="p">)</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">temp_dir_path</span><span class="p">):</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_dir_path</span><span class="p">)</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">temp_dir_path</span><span class="p">)</span>  <span class="c1"># Recreate for next run</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>                    <span class="s2">&quot;Error cleaning up temporary directory&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>                        <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="n">temp_dir_path</span><span class="p">,</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>                        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>                    <span class="p">},</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
<div class="tabbed-block">


<div class="doc doc-object doc-module">



<a id="tricys.simulation.simulation_analysis"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="tricys.simulation.simulation_analysis.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span></code>

<a href="#tricys.simulation.simulation_analysis.main" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Main entry point for a simulation analysis run.</p>
<p>This function prepares the configuration for an analysis run, sets up
logging, and calls the main <code>run_simulation</code> orchestrator for analysis.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the JSON configuration file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>tricys/simulation/simulation_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span>
<span class="normal"><a href="#__codelineno-0-1875">1875</a></span>
<span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1856" name="__codelineno-0-1856"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1857" name="__codelineno-0-1857"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Main entry point for a simulation analysis run.</span>
<a id="__codelineno-0-1858" name="__codelineno-0-1858"></a>
<a id="__codelineno-0-1859" name="__codelineno-0-1859"></a><span class="sd">    This function prepares the configuration for an analysis run, sets up</span>
<a id="__codelineno-0-1860" name="__codelineno-0-1860"></a><span class="sd">    logging, and calls the main `run_simulation` orchestrator for analysis.</span>
<a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>
<a id="__codelineno-0-1862" name="__codelineno-0-1862"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863"></a><span class="sd">        config_path (str): The path to the JSON configuration file.</span>
<a id="__codelineno-0-1864" name="__codelineno-0-1864"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>    <span class="n">config</span><span class="p">,</span> <span class="n">original_config</span> <span class="o">=</span> <span class="n">analysis_prepare_config</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
<a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>    <span class="n">setup_logging</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">original_config</span><span class="p">)</span>
<a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>        <span class="s2">&quot;Loading configuration&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-1870" name="__codelineno-0-1870"></a>            <span class="s2">&quot;config_path&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config_path</span><span class="p">),</span>
<a id="__codelineno-0-1871" name="__codelineno-0-1871"></a>        <span class="p">},</span>
<a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>    <span class="p">)</span>
<a id="__codelineno-0-1873" name="__codelineno-0-1873"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1874" name="__codelineno-0-1874"></a>        <span class="n">run_simulation</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-1875" name="__codelineno-0-1875"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Main execution completed successfully&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1876" name="__codelineno-0-1876"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1877" name="__codelineno-0-1877"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1878" name="__codelineno-0-1878"></a>            <span class="s2">&quot;Main execution failed&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;exception&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
<a id="__codelineno-0-1879" name="__codelineno-0-1879"></a>        <span class="p">)</span>
<a id="__codelineno-0-1880" name="__codelineno-0-1880"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.simulation.simulation_analysis.retry_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">retry_analysis</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span></code>

<a href="#tricys.simulation.simulation_analysis.retry_analysis" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Retries a failed AI analysis for a given run timestamp.</p>
<p>This function restores the configuration from the log file of a previous
run and re-triggers the AI-dependent parts of the analysis, including
report generation and consolidation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>timestamp</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The timestamp of the run to retry (e.g., "20230101_120000").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>tricys/simulation/simulation_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1814" name="__codelineno-0-1814"></a><span class="k">def</span><span class="w"> </span><span class="nf">retry_analysis</span><span class="p">(</span><span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Retries a failed AI analysis for a given run timestamp.</span>
<a id="__codelineno-0-1816" name="__codelineno-0-1816"></a>
<a id="__codelineno-0-1817" name="__codelineno-0-1817"></a><span class="sd">    This function restores the configuration from the log file of a previous</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818"></a><span class="sd">    run and re-triggers the AI-dependent parts of the analysis, including</span>
<a id="__codelineno-0-1819" name="__codelineno-0-1819"></a><span class="sd">    report generation and consolidation.</span>
<a id="__codelineno-0-1820" name="__codelineno-0-1820"></a>
<a id="__codelineno-0-1821" name="__codelineno-0-1821"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1822" name="__codelineno-0-1822"></a><span class="sd">        timestamp (str): The timestamp of the run to retry (e.g., &quot;20230101_120000&quot;).</span>
<a id="__codelineno-0-1823" name="__codelineno-0-1823"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1824" name="__codelineno-0-1824"></a>    <span class="n">config</span><span class="p">,</span> <span class="n">original_config</span> <span class="o">=</span> <span class="n">restore_configs_from_log</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
<a id="__codelineno-0-1825" name="__codelineno-0-1825"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">original_config</span><span class="p">:</span>
<a id="__codelineno-0-1826" name="__codelineno-0-1826"></a>        <span class="c1"># Error is printed inside the helper function</span>
<a id="__codelineno-0-1827" name="__codelineno-0-1827"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>
<a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;run_timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span>
<a id="__codelineno-0-1830" name="__codelineno-0-1830"></a>
<a id="__codelineno-0-1831" name="__codelineno-0-1831"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>        <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
<a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(levelname)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>        <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
<a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>    <span class="p">)</span>
<a id="__codelineno-0-1836" name="__codelineno-0-1836"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-0-1837" name="__codelineno-0-1837"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1838" name="__codelineno-0-1838"></a>        <span class="sa">f</span><span class="s2">&quot;Successfully restored configuration for timestamp </span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2"> for retry.&quot;</span>
<a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>    <span class="p">)</span>
<a id="__codelineno-0-1840" name="__codelineno-0-1840"></a>
<a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting in AI analysis retry mode...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1842" name="__codelineno-0-1842"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">analysis_validate_config</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
<a id="__codelineno-0-1843" name="__codelineno-0-1843"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1844" name="__codelineno-0-1844"></a>
<a id="__codelineno-0-1845" name="__codelineno-0-1845"></a>    <span class="n">case_configs</span> <span class="o">=</span> <span class="n">analysis_setup_analysis_cases_workspaces</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-1846" name="__codelineno-0-1846"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">case_configs</span><span class="p">:</span>
<a id="__codelineno-0-1847" name="__codelineno-0-1847"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not set up case workspaces for retry. Aborting.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>
<a id="__codelineno-0-1850" name="__codelineno-0-1850"></a>    <span class="n">retry_ai_analysis</span><span class="p">(</span><span class="n">case_configs</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851"></a>    <span class="n">consolidate_reports</span><span class="p">(</span><span class="n">case_configs</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-1852" name="__codelineno-0-1852"></a>
<a id="__codelineno-0-1853" name="__codelineno-0-1853"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;AI analysis retry and consolidation complete.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tricys.simulation.simulation_analysis.run_simulation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_simulation</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#tricys.simulation.simulation_analysis.run_simulation" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Orchestrates the simulation analysis workflow.</p>
<p>This is the main orchestrator for a simulation analysis run. It handles
different execution paths based on the configuration:
- If 'analysis_cases' are defined, it sets up and executes each case,
  potentially in parallel.
- If a SALib analysis is defined, it delegates to the SALib workflow.
- Otherwise, it runs a standard parameter sweep, merges results,
  generates plots, and triggers sensitivity analysis and post-processing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The main configuration dictionary for the run.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Supports three modes: multi-case analysis (analysis_cases), SALib analysis
(independent_variable as list with analyzer), or standard parameter sweep.
For multi-case mode, creates isolated workspaces and can run cases in parallel
with ProcessPoolExecutor. Generates summary reports and handles AI analysis retries
if configured.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>tricys/simulation/simulation_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1320" name="__codelineno-0-1320"></a><span class="k">def</span><span class="w"> </span><span class="nf">run_simulation</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Orchestrates the simulation analysis workflow.</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a><span class="sd">    This is the main orchestrator for a simulation analysis run. It handles</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a><span class="sd">    different execution paths based on the configuration:</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a><span class="sd">    - If &#39;analysis_cases&#39; are defined, it sets up and executes each case,</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a><span class="sd">      potentially in parallel.</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a><span class="sd">    - If a SALib analysis is defined, it delegates to the SALib workflow.</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a><span class="sd">    - Otherwise, it runs a standard parameter sweep, merges results,</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a><span class="sd">      generates plots, and triggers sensitivity analysis and post-processing.</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a><span class="sd">        config: The main configuration dictionary for the run.</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a><span class="sd">        Supports three modes: multi-case analysis (analysis_cases), SALib analysis</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a><span class="sd">        (independent_variable as list with analyzer), or standard parameter sweep.</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a><span class="sd">        For multi-case mode, creates isolated workspaces and can run cases in parallel</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a><span class="sd">        with ProcessPoolExecutor. Generates summary reports and handles AI analysis retries</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a><span class="sd">        if configured.</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>    <span class="c1"># 1. Split analysis_cases and determine salib_analysis_case</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>    <span class="n">has_analysis_cases</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>        <span class="s2">&quot;sensitivity_analysis&quot;</span> <span class="ow">in</span> <span class="n">config</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>        <span class="ow">and</span> <span class="s2">&quot;analysis_cases&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>        <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>            <span class="c1"># Support list format</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>            <span class="p">(</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">][</span><span class="s2">&quot;analysis_cases&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">][</span><span class="s2">&quot;analysis_cases&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>            <span class="p">)</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>            <span class="ow">or</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>            <span class="c1"># Support single object format</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>            <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">][</span><span class="s2">&quot;analysis_cases&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>        <span class="p">)</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>    <span class="p">)</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>    <span class="c1"># Check if it&#39;s a SALib analysis case (and not a multi-case analysis)</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>    <span class="n">sa_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>    <span class="n">analysis_case</span> <span class="o">=</span> <span class="n">sa_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;analysis_case&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>    <span class="n">has_salib_analysis_case</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>        <span class="ow">not</span> <span class="n">has_analysis_cases</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">analysis_case</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;independent_variable&quot;</span><span class="p">),</span> <span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;independent_variable_sampling&quot;</span><span class="p">),</span> <span class="nb">dict</span><span class="p">)</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>        <span class="ow">and</span> <span class="s2">&quot;analyzer&quot;</span> <span class="ow">in</span> <span class="n">analysis_case</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>    <span class="p">)</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>    <span class="k">if</span> <span class="n">has_analysis_cases</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_salib_analysis_case</span><span class="p">:</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>            <span class="s2">&quot;Detected analysis_cases field, starting to create independent working directories for each analysis case...&quot;</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>        <span class="p">)</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>        <span class="c1"># Create independent working directories and configuration files for each analysis_case</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>        <span class="n">case_configs</span> <span class="o">=</span> <span class="n">analysis_setup_analysis_cases_workspaces</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">case_configs</span><span class="p">:</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>                <span class="s2">&quot;Unable to create analysis_cases working directories, stopping execution&quot;</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>            <span class="p">)</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>            <span class="k">return</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting execution of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">case_configs</span><span class="p">)</span><span class="si">}</span><span class="s2"> analysis cases...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>        <span class="n">sa_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>        <span class="n">run_cases_concurrently</span> <span class="o">=</span> <span class="n">sa_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;concurrent_cases&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>        <span class="n">successful_cases</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>        <span class="k">if</span> <span class="n">run_cases_concurrently</span><span class="p">:</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>                <span class="sa">f</span><span class="s2">&quot;Starting execution of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">case_configs</span><span class="p">)</span><span class="si">}</span><span class="s2"> analysis cases in PARALLEL.&quot;</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>            <span class="p">)</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>            <span class="n">max_workers</span> <span class="o">=</span> <span class="n">sa_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_case_workers&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>                <span class="sa">f</span><span class="s2">&quot;Using up to </span><span class="si">{</span><span class="n">max_workers</span><span class="si">}</span><span class="s2"> parallel processes for analysis cases.&quot;</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>            <span class="p">)</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>            <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>                <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>                <span class="n">future_to_case</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>                    <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">_execute_analysis_case</span><span class="p">,</span> <span class="n">case_info</span><span class="p">):</span> <span class="n">case_info</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>                    <span class="k">for</span> <span class="n">case_info</span> <span class="ow">in</span> <span class="n">case_configs</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>                <span class="p">}</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>                <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_case</span><span class="p">):</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>                    <span class="n">case_info</span> <span class="o">=</span> <span class="n">future_to_case</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>                    <span class="n">case_name</span> <span class="o">=</span> <span class="n">case_info</span><span class="p">[</span><span class="s2">&quot;case_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">case_info</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>                        <span class="k">if</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">():</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>                            <span class="n">successful_cases</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>                                <span class="sa">f</span><span class="s2">&quot;Parallel case &#39;</span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">&#39; completed successfully.&quot;</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>                                <span class="sa">f</span><span class="s2">&quot;Parallel case &#39;</span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">&#39; completed with errors.&quot;</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>                            <span class="sa">f</span><span class="s2">&quot;Parallel case &#39;</span><span class="si">{</span><span class="n">case_name</span><span class="si">}</span><span class="s2">&#39; failed in executor with: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>                            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>                <span class="sa">f</span><span class="s2">&quot;Starting execution of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">case_configs</span><span class="p">)</span><span class="si">}</span><span class="s2"> analysis cases SEQUENTIALLY.&quot;</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>            <span class="p">)</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>            <span class="k">for</span> <span class="n">case_info</span> <span class="ow">in</span> <span class="n">case_configs</span><span class="p">:</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>                    <span class="n">case_index</span> <span class="o">=</span> <span class="n">case_info</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>                    <span class="n">case_workspace</span> <span class="o">=</span> <span class="n">case_info</span><span class="p">[</span><span class="s2">&quot;workspace&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>                    <span class="n">case_config</span> <span class="o">=</span> <span class="n">case_info</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>                    <span class="n">case_data</span> <span class="o">=</span> <span class="n">case_info</span><span class="p">[</span><span class="s2">&quot;case_data&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Starting execution of analysis case </span><span class="si">{</span><span class="n">case_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">case_configs</span><span class="p">)</span><span class="si">}</span><span class="s2"> ===&quot;</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>                        <span class="sa">f</span><span class="s2">&quot;Case name: </span><span class="si">{</span><span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;Case</span><span class="si">{</span><span class="n">case_index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>                        <span class="sa">f</span><span class="s2">&quot;Independent variable: </span><span class="si">{</span><span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;independent_variable&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Working directory: </span><span class="si">{</span><span class="n">case_workspace</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>                    <span class="n">original_cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>                    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">case_workspace</span><span class="p">)</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>                        <span class="n">setup_logging</span><span class="p">(</span><span class="n">case_config</span><span class="p">)</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>                        <span class="n">run_simulation</span><span class="p">(</span><span class="n">case_config</span><span class="p">)</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>                        <span class="n">successful_cases</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>                            <span class="sa">f</span><span class="s2">&quot;✓ Analysis case </span><span class="si">{</span><span class="n">case_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> executed successfully&quot;</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">case_e</span><span class="p">:</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>                            <span class="sa">f</span><span class="s2">&quot;✗ Analysis case </span><span class="si">{</span><span class="n">case_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> execution failed: </span><span class="si">{</span><span class="n">case_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>                            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>                    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>                        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">original_cwd</span><span class="p">)</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>                        <span class="n">setup_logging</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>                        <span class="sa">f</span><span class="s2">&quot;✗ Error processing analysis case </span><span class="si">{</span><span class="n">case_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>                        <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Analysis Cases Execution Completed ===&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>            <span class="sa">f</span><span class="s2">&quot;Successfully executed: </span><span class="si">{</span><span class="n">successful_cases</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">case_configs</span><span class="p">)</span><span class="si">}</span><span class="s2"> cases&quot;</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>        <span class="p">)</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>        <span class="n">generate_analysis_cases_summary</span><span class="p">(</span><span class="n">case_configs</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>        <span class="k">return</span>  <span class="c1"># End analysis_cases processing</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>    <span class="k">elif</span> <span class="n">has_salib_analysis_case</span><span class="p">:</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Detected SALib analysis case, diverting to SALib workflow...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>        <span class="n">run_salib_analysis</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a>        <span class="k">return</span>  <span class="c1"># SALib workflow is self-contained, so we exit here.</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>    <span class="c1"># 2. Core operational logic</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>    <span class="n">jobs</span> <span class="o">=</span> <span class="n">generate_simulation_jobs</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;simulation_parameters&quot;</span><span class="p">,</span> <span class="p">{}))</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>    <span class="c1"># --- START: Add baseline jobs based on default parameter values ---</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>    <span class="n">analysis_case</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;analysis_case&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>    <span class="n">default_values</span> <span class="o">=</span> <span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default_simulation_values&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>    <span class="k">if</span> <span class="n">default_values</span><span class="p">:</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>            <span class="s2">&quot;Found default_simulation_values, generating additional baseline jobs.&quot;</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>        <span class="p">)</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>        <span class="c1"># Prepare simulation parameters for the baseline run, starting with default values</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>        <span class="n">baseline_params</span> <span class="o">=</span> <span class="n">default_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>        <span class="c1"># Add the main independent variable sweep to the baseline parameters</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>        <span class="n">independent_var</span> <span class="o">=</span> <span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;independent_variable&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>        <span class="n">independent_sampling</span> <span class="o">=</span> <span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;independent_variable_sampling&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>        <span class="k">if</span> <span class="n">independent_var</span> <span class="ow">and</span> <span class="n">independent_sampling</span><span class="p">:</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>            <span class="n">baseline_params</span><span class="p">[</span><span class="n">independent_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">independent_sampling</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>            <span class="c1"># Generate the additional jobs using the baseline config</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>            <span class="n">default_jobs</span> <span class="o">=</span> <span class="n">generate_simulation_jobs</span><span class="p">(</span><span class="n">baseline_params</span><span class="p">)</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>            <span class="c1"># Combine with existing jobs and deduplicate</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>            <span class="n">combined_jobs</span> <span class="o">=</span> <span class="n">jobs</span> <span class="o">+</span> <span class="n">default_jobs</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>            <span class="c1"># Deduplicate the list of job dictionaries</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>            <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>            <span class="n">unique_jobs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>            <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">combined_jobs</span><span class="p">:</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>                <span class="n">job_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>                <span class="k">if</span> <span class="n">job_tuple</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>                    <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">job_tuple</span><span class="p">)</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>                    <span class="n">unique_jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>                <span class="sa">f</span><span class="s2">&quot;Original jobs: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span><span class="si">}</span><span class="s2">, Combined jobs: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">combined_jobs</span><span class="p">)</span><span class="si">}</span><span class="s2">, Unique jobs after deduplication: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_jobs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>            <span class="p">)</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>            <span class="n">jobs</span> <span class="o">=</span> <span class="n">unique_jobs</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>    <span class="c1"># --- END: Add baseline jobs ---</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>        <span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">][</span><span class="s2">&quot;results_dir&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required path key in configuration file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>    <span class="n">simulation_results</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>    <span class="n">use_concurrent</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;concurrent&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;co_simulation&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>            <span class="k">if</span> <span class="n">use_concurrent</span><span class="p">:</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting simulation in CONCURRENT mode.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>                <span class="n">max_workers</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_workers&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using up to </span><span class="si">{</span><span class="n">max_workers</span><span class="si">}</span><span class="s2"> parallel workers.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>                <span class="n">final_results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>                <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>                    <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>                <span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>                    <span class="n">future_to_job</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>                        <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>                            <span class="n">_run_single_job</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">job_params</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>                        <span class="p">):</span> <span class="n">job_params</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">job_params</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>                    <span class="p">}</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>                    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_job</span><span class="p">):</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>                        <span class="n">job_params</span> <span class="o">=</span> <span class="n">future_to_job</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>                        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>                            <span class="p">(</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>                                <span class="n">optimal_params</span><span class="p">,</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>                                <span class="n">optimal_values</span><span class="p">,</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>                                <span class="n">result_path</span><span class="p">,</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>                            <span class="p">)</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>                            <span class="k">if</span> <span class="n">result_path</span><span class="p">:</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>                                <span class="n">simulation_results</span><span class="p">[</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>                                    <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">job_params</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>                                <span class="p">]</span> <span class="o">=</span> <span class="n">result_path</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>                                <span class="sa">f</span><span class="s2">&quot;Job for </span><span class="si">{</span><span class="n">job_params</span><span class="si">}</span><span class="s2"> generated an exception: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>                                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>                        <span class="n">final_result_entry</span> <span class="o">=</span> <span class="n">job_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>                        <span class="n">final_result_entry</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optimal_params</span><span class="p">)</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>                        <span class="n">final_result_entry</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optimal_values</span><span class="p">)</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>                        <span class="n">final_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_result_entry</span><span class="p">)</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>                <span class="k">if</span> <span class="n">_get_optimization_tasks</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>                    <span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">][</span><span class="s2">&quot;results_dir&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>                    <span class="k">if</span> <span class="n">final_results</span><span class="p">:</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>                        <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">final_results</span><span class="p">)</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>                        <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>                            <span class="n">results_dir</span><span class="p">,</span> <span class="s2">&quot;requierd_tbr_summary.csv&quot;</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>                        <span class="n">final_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8-sig&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>                            <span class="sa">f</span><span class="s2">&quot;Sweep optimization summary saved to: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting simulation in SEQUENTIAL mode.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>                <span class="n">result_paths</span> <span class="o">=</span> <span class="n">_run_sequential_sweep</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">jobs</span><span class="p">)</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result_paths</span><span class="p">):</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>                    <span class="k">if</span> <span class="n">result_path</span><span class="p">:</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>                        <span class="n">simulation_results</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">jobs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()))]</span> <span class="o">=</span> <span class="n">result_path</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>            <span class="k">if</span> <span class="n">use_concurrent</span><span class="p">:</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting co-simulation in CONCURRENT mode.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>                <span class="n">max_workers</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_workers&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using up to </span><span class="si">{</span><span class="n">max_workers</span><span class="si">}</span><span class="s2"> parallel processes.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>                <span class="n">final_results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>                <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>                    <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>                <span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>                    <span class="n">future_to_job</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>                        <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>                            <span class="n">_run_co_simulation</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">job_params</span><span class="p">,</span> <span class="n">job_id</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>                        <span class="p">):</span> <span class="n">job_params</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">job_params</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>                    <span class="p">}</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>                    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_job</span><span class="p">):</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>                        <span class="n">job_params</span> <span class="o">=</span> <span class="n">future_to_job</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>                        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>                            <span class="p">(</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>                                <span class="n">optimal_params</span><span class="p">,</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>                                <span class="n">optimal_values</span><span class="p">,</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>                                <span class="n">result_path</span><span class="p">,</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>                            <span class="p">)</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>                            <span class="k">if</span> <span class="n">result_path</span><span class="p">:</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>                                <span class="n">simulation_results</span><span class="p">[</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>                                    <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">job_params</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>                                <span class="p">]</span> <span class="o">=</span> <span class="n">result_path</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>                                    <span class="sa">f</span><span class="s2">&quot;Successfully finished job for params: </span><span class="si">{</span><span class="n">job_params</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>                                <span class="p">)</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>                            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>                                    <span class="sa">f</span><span class="s2">&quot;Job for params </span><span class="si">{</span><span class="n">job_params</span><span class="si">}</span><span class="s2"> did not return a result path.&quot;</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>                                <span class="p">)</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>                                <span class="sa">f</span><span class="s2">&quot;Job for params </span><span class="si">{</span><span class="n">job_params</span><span class="si">}</span><span class="s2"> generated an exception: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>                                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>                        <span class="n">final_result_entry</span> <span class="o">=</span> <span class="n">job_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>                        <span class="n">final_result_entry</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optimal_params</span><span class="p">)</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>                        <span class="n">final_result_entry</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optimal_values</span><span class="p">)</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>                        <span class="n">final_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_result_entry</span><span class="p">)</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting co-simulation in SEQUENTIAL mode.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>                <span class="n">final_results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">job_params</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jobs</span><span class="p">):</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>                    <span class="n">job_id</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Starting Sequential Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>                        <span class="p">(</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>                            <span class="n">optimal_params</span><span class="p">,</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>                            <span class="n">optimal_values</span><span class="p">,</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>                            <span class="n">result_path</span><span class="p">,</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>                        <span class="p">)</span> <span class="o">=</span> <span class="n">_run_co_simulation</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">job_params</span><span class="p">,</span> <span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span><span class="p">)</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>                        <span class="k">if</span> <span class="n">result_path</span><span class="p">:</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>                            <span class="n">simulation_results</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">job_params</span><span class="o">.</span><span class="n">items</span><span class="p">()))]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>                                <span class="n">result_path</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>                                <span class="sa">f</span><span class="s2">&quot;Successfully finished job for params: </span><span class="si">{</span><span class="n">job_params</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>                                <span class="sa">f</span><span class="s2">&quot;Job for params </span><span class="si">{</span><span class="n">job_params</span><span class="si">}</span><span class="s2"> did not return a result path.&quot;</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>                        <span class="n">final_result_entry</span> <span class="o">=</span> <span class="n">job_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>                        <span class="n">final_result_entry</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optimal_params</span><span class="p">)</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>                        <span class="n">final_result_entry</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optimal_values</span><span class="p">)</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>                        <span class="n">final_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_result_entry</span><span class="p">)</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>                            <span class="sa">f</span><span class="s2">&quot;Job for params </span><span class="si">{</span><span class="n">job_params</span><span class="si">}</span><span class="s2"> generated an exception: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>                            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Finished Sequential Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>            <span class="k">if</span> <span class="n">_get_optimization_tasks</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>                <span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">][</span><span class="s2">&quot;results_dir&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>                <span class="k">if</span> <span class="n">final_results</span><span class="p">:</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>                    <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">final_results</span><span class="p">)</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>                    <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="s2">&quot;requierd_tbr_summary.csv&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>                    <span class="n">final_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8-sig&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sweep optimization summary saved to: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to run simualtion: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>    <span class="c1"># 3. Data merging and processing</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>    <span class="n">run_results_dir</span> <span class="o">=</span> <span class="n">results_dir</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">run_results_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>    <span class="c1"># Unified result processing for both single and multiple jobs</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span><span class="si">}</span><span class="s2"> job(s). Combining results.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>    <span class="n">combined_df</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>    <span class="n">all_dfs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>    <span class="n">time_df_added</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>    <span class="k">for</span> <span class="n">job_params</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>        <span class="n">job_key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">job_params</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>        <span class="n">result_path</span> <span class="o">=</span> <span class="n">simulation_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">job_key</span><span class="p">)</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">result_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">result_path</span><span class="p">):</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_params</span><span class="si">}</span><span class="s2"> produced no result file. Skipping.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>            <span class="k">continue</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>        <span class="c1"># Read the current job&#39;s result file</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">result_path</span><span class="p">)</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>        <span class="c1"># From the very first valid DataFrame, grab the &#39;time&#39; column</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">time_df_added</span> <span class="ow">and</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>            <span class="n">all_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s2">&quot;time&quot;</span><span class="p">]])</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>            <span class="n">time_df_added</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>        <span class="c1"># Prepare the parameter string for column renaming</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>        <span class="n">param_string</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">job_params</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>        <span class="c1"># Isolate the data columns (everything except &#39;time&#39;)</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>        <span class="n">data_columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>        <span class="c1"># Create a dictionary to map old column names to new ones</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>        <span class="c1"># e.g., {&#39;voltage&#39;: &#39;voltage&amp;param1=A&amp;param2=B&#39;}</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>        <span class="n">rename_mapping</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>            <span class="n">col</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">{</span><span class="n">param_string</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">param_string</span> <span class="k">else</span> <span class="n">col</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data_columns</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>        <span class="p">}</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>        <span class="c1"># Rename the columns and add the resulting DataFrame to our list</span>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>        <span class="n">all_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_columns</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename_mapping</span><span class="p">))</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>    <span class="c1"># Concatenate all the DataFrames in the list along the columns axis (axis=1)</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>    <span class="k">if</span> <span class="n">all_dfs</span><span class="p">:</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>        <span class="n">combined_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>        <span class="n">combined_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># Or None, as you had before</span>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>    <span class="k">if</span> <span class="n">combined_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>            <span class="c1"># For single job, save as simulation_result.csv</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>            <span class="n">combined_csv_path</span> <span class="o">=</span> <span class="n">get_unique_filename</span><span class="p">(</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>                <span class="n">run_results_dir</span><span class="p">,</span> <span class="s2">&quot;simulation_result.csv&quot;</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>            <span class="p">)</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>            <span class="c1"># For multiple jobs, save as sweep_results.csv</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>            <span class="n">combined_csv_path</span> <span class="o">=</span> <span class="n">get_unique_filename</span><span class="p">(</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>                <span class="n">run_results_dir</span><span class="p">,</span> <span class="s2">&quot;sweep_results.csv&quot;</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>            <span class="p">)</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>        <span class="c1"># Clean up rows where the &#39;time&#39; column is blank, which often occurs as redundant rows at the end of the file.</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>        <span class="n">combined_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>        <span class="n">combined_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">combined_csv_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Combined results saved to: </span><span class="si">{</span><span class="n">combined_csv_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No valid results found to combine.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>    <span class="c1"># Check if sweep_time plotting is enabled</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>    <span class="n">analysis_case</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;analysis_case&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>    <span class="n">sweep_time_list</span> <span class="o">=</span> <span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sweep_time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>    <span class="k">if</span> <span class="n">sweep_time_list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sweep_time_list</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a>        <span class="c1"># Get parameters for plot_sweep_time_series</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a>        <span class="n">independent_var</span> <span class="o">=</span> <span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;independent_variable&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>        <span class="n">dependent_vars</span> <span class="o">=</span> <span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependent_variables&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>        <span class="n">independent_var_alias</span> <span class="o">=</span> <span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;independent_variable_alias&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>            <span class="n">independent_var</span>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>            <span class="ow">and</span> <span class="n">dependent_vars</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>            <span class="ow">and</span> <span class="n">combined_csv_path</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>            <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">combined_csv_path</span><span class="p">)</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>        <span class="p">):</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>                <span class="c1"># Get default values if they exist to filter the plot</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>                <span class="n">default_values</span> <span class="o">=</span> <span class="n">analysis_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default_simulation_values&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>                <span class="n">plot_path</span> <span class="o">=</span> <span class="n">plot_sweep_time_series</span><span class="p">(</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>                    <span class="n">csv_path</span><span class="o">=</span><span class="n">combined_csv_path</span><span class="p">,</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>                    <span class="n">save_dir</span><span class="o">=</span><span class="n">run_results_dir</span><span class="p">,</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>                    <span class="n">y_var_name</span><span class="o">=</span><span class="n">sweep_time_list</span><span class="p">,</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>                    <span class="n">independent_var_name</span><span class="o">=</span><span class="n">independent_var</span><span class="p">,</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>                    <span class="n">independent_var_alias</span><span class="o">=</span><span class="n">independent_var_alias</span><span class="p">,</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>                    <span class="n">default_params</span><span class="o">=</span><span class="n">default_values</span><span class="p">,</span>  <span class="c1"># Pass default values to the plot function</span>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>                    <span class="n">glossary_path</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;sensitivity_analysis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>                        <span class="s2">&quot;glossary_path&quot;</span><span class="p">,</span> <span class="kc">None</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>                <span class="p">)</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>                <span class="k">if</span> <span class="n">plot_path</span><span class="p">:</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sweep time series plot generated: </span><span class="si">{</span><span class="n">plot_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to generate sweep time series plot&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error generating sweep time series plot: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>
<a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>    <span class="c1"># 4. Sensitivity analysis</span>
<a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>    <span class="n">_run_sensitivity_analysis</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">run_results_dir</span><span class="p">,</span> <span class="n">jobs</span><span class="p">)</span>
<a id="__codelineno-0-1791" name="__codelineno-0-1791"></a>
<a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>    <span class="c1"># 5. Post-processing</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>    <span class="k">if</span> <span class="n">combined_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>        <span class="c1"># Calculate the top-level post-processing directory</span>
<a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>        <span class="n">top_level_run_workspace</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;post_processing&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1796" name="__codelineno-0-1796"></a>        <span class="n">_run_post_processing</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">combined_df</span><span class="p">,</span> <span class="n">top_level_run_workspace</span><span class="p">)</span>
<a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1798" name="__codelineno-0-1798"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-1799" name="__codelineno-0-1799"></a>            <span class="s2">&quot;No simulation results were generated, skipping post-processing.&quot;</span>
<a id="__codelineno-0-1800" name="__codelineno-0-1800"></a>        <span class="p">)</span>
<a id="__codelineno-0-1801" name="__codelineno-0-1801"></a>
<a id="__codelineno-0-1802" name="__codelineno-0-1802"></a>    <span class="c1"># 6. Intermediate data cleaning</span>
<a id="__codelineno-0-1803" name="__codelineno-0-1803"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_temp_files&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-1804" name="__codelineno-0-1804"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up temporary directory...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1805" name="__codelineno-0-1805"></a>        <span class="n">temp_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_dir&quot;</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1806" name="__codelineno-0-1806"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">temp_dir_path</span><span class="p">):</span>
<a id="__codelineno-0-1807" name="__codelineno-0-1807"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808"></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_dir_path</span><span class="p">)</span>
<a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">temp_dir_path</span><span class="p">)</span>  <span class="c1"># Recreate for next run</span>
<a id="__codelineno-0-1810" name="__codelineno-0-1810"></a>            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1811" name="__codelineno-0-1811"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error cleaning up temp directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
</div>
</div>







  
  




  



                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../guides/tricys_analysis/latin_uncertainty_analysis/" class="md-footer__link md-footer__link--prev" aria-label="上一页: Latin不确定性量化分析">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                Latin不确定性量化分析
              </div>
            </div>
          </a>
        
        
          
          <a href="../tricys_core/" class="md-footer__link md-footer__link--next" aria-label="下一页: tricys.core">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                tricys.core
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "navigation.footer", "navigation.top", "search.highlight", "search.suggest", "navigation.tabs", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>